<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Server Comparison Tool - House of Web</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c4a6e 0%, #075985 100%);
            color: #e0f2fe;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #0c4a6e;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255, 255, 255, 0.3);
        }

        .subtitle {
            color: #075985;
            font-size: 1.2em;
        }

        .back-link {
            display: inline-block;
            color: #0c4a6e;
            text-decoration: none;
            margin-top: 15px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: bold;
        }

        .back-link:hover {
            background: white;
            transform: translateX(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: rgba(12, 74, 110, 0.6);
            border: 2px solid #0ea5e9;
            color: #7dd3fc;
            cursor: pointer;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
            font-weight: 600;
        }

        .tab-btn:hover {
            background: rgba(14, 165, 233, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(14, 165, 233, 0.4);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            color: #0c4a6e;
            box-shadow: 0 5px 20px rgba(14, 165, 233, 0.5);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(12, 74, 110, 0.9);
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .server-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .server-card {
            background: rgba(14, 165, 233, 0.1);
            border: 2px solid #38bdf8;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .server-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(56, 189, 248, 0.4);
            border-color: #7dd3fc;
        }

        .server-card.selected {
            background: rgba(14, 165, 233, 0.3);
            border-color: #7dd3fc;
            box-shadow: 0 0 20px rgba(125, 211, 252, 0.6);
        }

        .server-name {
            font-size: 1.8em;
            color: #38bdf8;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .server-description {
            color: #bae6fd;
            margin-bottom: 15px;
        }

        .server-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: rgba(7, 89, 133, 0.5);
            border-radius: 5px;
        }

        .stat-label {
            color: #7dd3fc;
            font-weight: 600;
        }

        .stat-value {
            color: #e0f2fe;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            border: 1px solid #0ea5e9;
            text-align: left;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            color: #0c4a6e;
            font-weight: bold;
        }

        .comparison-table tr:nth-child(even) {
            background: rgba(14, 165, 233, 0.1);
        }

        .comparison-table tr:hover {
            background: rgba(14, 165, 233, 0.2);
        }

        .checkmark {
            color: #4ade80;
            font-weight: bold;
        }

        .crossmark {
            color: #f87171;
            font-weight: bold;
        }

        .code-block {
            background: #0c2d48;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            color: #7dd3fc;
        }

        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .scenario-card {
            background: rgba(14, 165, 233, 0.15);
            border: 2px solid #0ea5e9;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .scenario-card:hover {
            background: rgba(14, 165, 233, 0.25);
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(56, 189, 248, 0.4);
        }

        .scenario-title {
            font-size: 1.3em;
            color: #38bdf8;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .recommendation {
            background: rgba(56, 189, 248, 0.2);
            border-left: 4px solid #38bdf8;
            padding: 20px;
            margin-top: 15px;
            border-radius: 8px;
        }

        .recommendation-title {
            font-size: 1.5em;
            color: #7dd3fc;
            margin-bottom: 10px;
        }

        .architecture-diagram {
            background: rgba(7, 89, 133, 0.3);
            border: 2px solid #0ea5e9;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .diagram-title {
            font-size: 1.4em;
            color: #38bdf8;
            margin-bottom: 15px;
            font-weight: bold;
        }

        canvas {
            background: rgba(12, 45, 72, 0.5);
            border-radius: 8px;
            max-width: 100%;
        }

        .quiz-question {
            background: rgba(14, 165, 233, 0.15);
            border: 2px solid #0ea5e9;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.3em;
            color: #38bdf8;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            padding: 15px;
            background: rgba(12, 74, 110, 0.6);
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-option:hover {
            background: rgba(14, 165, 233, 0.3);
            transform: translateX(10px);
        }

        .quiz-option.correct {
            background: rgba(74, 222, 128, 0.3);
            border-color: #4ade80;
        }

        .quiz-option.incorrect {
            background: rgba(248, 113, 113, 0.3);
            border-color: #f87171;
        }

        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
        }

        .quiz-feedback.correct {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
        }

        .quiz-feedback.incorrect {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
        }

        .quiz-score {
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            color: #0c4a6e;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            color: #0c4a6e;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(56, 189, 248, 0.5);
        }

        .feature-badge {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(56, 189, 248, 0.3);
            border: 1px solid #38bdf8;
            border-radius: 15px;
            font-size: 0.85em;
            margin: 3px;
            color: #7dd3fc;
        }

        .market-share-bar {
            width: 100%;
            height: 30px;
            background: rgba(7, 89, 133, 0.5);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }

        .market-share-fill {
            height: 100%;
            background: linear-gradient(90deg, #0ea5e9 0%, #38bdf8 100%);
            transition: width 1s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: #0c4a6e;
            font-weight: bold;
        }

        .config-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .config-btn {
            padding: 10px 20px;
            background: rgba(12, 74, 110, 0.6);
            border: 2px solid #0ea5e9;
            color: #7dd3fc;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .config-btn:hover {
            background: rgba(14, 165, 233, 0.3);
        }

        .config-btn.active {
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            color: #0c4a6e;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .tab-btn {
                width: 100%;
            }

            .comparison-table {
                font-size: 0.85em;
            }

            .comparison-table th,
            .comparison-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Web Server Comparison Tool</h1>
            <div class="subtitle">House of Web - Compare Apache, Nginx, IIS, LiteSpeed & Caddy</div>
            <a href="../../catalog.html" class="back-link">‚Üê Back to Catalog</a>
        </header>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('overview')">Server Overview</button>
            <button class="tab-btn" onclick="showTab('comparison')">Comparison Matrix</button>
            <button class="tab-btn" onclick="showTab('scenarios')">Scenario Selector</button>
            <button class="tab-btn" onclick="showTab('config')">Config Examples</button>
            <button class="tab-btn" onclick="showTab('architecture')">Architecture</button>
            <button class="tab-btn" onclick="showTab('quiz')">Quiz Mode</button>
        </div>

        <!-- Server Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="card">
                <h2 style="color: #38bdf8; margin-bottom: 20px;">Popular Web Server Profiles</h2>
                <div class="server-grid" id="serverGrid"></div>
            </div>
        </div>

        <!-- Comparison Matrix Tab -->
        <div id="comparison" class="tab-content">
            <div class="card">
                <h2 style="color: #38bdf8; margin-bottom: 20px;">Feature Comparison Matrix</h2>
                <div style="overflow-x: auto;">
                    <table class="comparison-table" id="comparisonTable"></table>
                </div>
            </div>
            <div class="card">
                <h2 style="color: #38bdf8; margin-bottom: 20px;">Market Share Statistics</h2>
                <div id="marketShare"></div>
            </div>
        </div>

        <!-- Scenario Selector Tab -->
        <div id="scenarios" class="tab-content">
            <div class="card">
                <h2 style="color: #38bdf8; margin-bottom: 20px;">Choose Your Use Case</h2>
                <p style="margin-bottom: 20px;">Select a scenario to get server recommendations:</p>
                <div class="scenario-grid" id="scenarioGrid"></div>
                <div id="scenarioRecommendation"></div>
            </div>
        </div>

        <!-- Config Examples Tab -->
        <div id="config" class="tab-content">
            <div class="card">
                <h2 style="color: #38bdf8; margin-bottom: 20px;">Configuration Examples</h2>
                <p style="margin-bottom: 20px;">Basic configuration syntax for common tasks:</p>
                <div class="config-selector" id="configSelector"></div>
                <div id="configDisplay"></div>
            </div>
        </div>

        <!-- Architecture Tab -->
        <div id="architecture" class="tab-content">
            <div class="card">
                <h2 style="color: #38bdf8; margin-bottom: 20px;">Architecture Models</h2>
                <div class="architecture-diagram">
                    <div class="diagram-title">Process-Based vs Event-Driven Architecture</div>
                    <canvas id="archCanvas" width="800" height="400"></canvas>
                </div>
                <div style="margin-top: 30px;">
                    <h3 style="color: #38bdf8; margin-bottom: 15px;">Process-Based (Apache MPM Prefork)</h3>
                    <p style="margin-bottom: 15px;">Each connection is handled by a separate process. Simple but memory-intensive.</p>
                    <ul style="margin-left: 20px; color: #bae6fd;">
                        <li>One process per connection</li>
                        <li>High memory usage under load</li>
                        <li>Better isolation (crash affects one connection)</li>
                        <li>Works well with non-thread-safe modules</li>
                    </ul>
                </div>
                <div style="margin-top: 30px;">
                    <h3 style="color: #38bdf8; margin-bottom: 15px;">Event-Driven (Nginx, LiteSpeed)</h3>
                    <p style="margin-bottom: 15px;">Asynchronous handling of multiple connections with fewer processes. Highly efficient.</p>
                    <ul style="margin-left: 20px; color: #bae6fd;">
                        <li>One worker handles many connections</li>
                        <li>Low memory footprint</li>
                        <li>Excellent for high-concurrency scenarios</li>
                        <li>Non-blocking I/O operations</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Quiz Tab -->
        <div id="quiz" class="tab-content">
            <div class="card">
                <h2 style="color: #38bdf8; margin-bottom: 20px;">Web Server Knowledge Quiz</h2>
                <div class="quiz-score" id="quizScore">Score: 0 / 0</div>
                <div id="quizContainer"></div>
                <button class="btn" onclick="resetQuiz()">Reset Quiz</button>
            </div>
        </div>
    </div>

    <script>
        // Server data
        const servers = {
            apache: {
                name: 'Apache HTTP Server',
                description: 'The world\'s most popular open-source web server with extensive module ecosystem.',
                platform: ['Windows', 'Linux', 'macOS', 'Unix'],
                performance: 'Good - Process/Thread-based',
                config: '.conf files (declarative)',
                modules: 'Extensive module system (mod_*)',
                ssl: 'mod_ssl with Let\'s Encrypt support',
                content: 'Excellent for both static and dynamic',
                reverseProxy: 'Yes (mod_proxy)',
                marketShare: 31.4,
                firstRelease: '1995',
                license: 'Apache License 2.0',
                features: ['.htaccess support', 'MPM (Multi-Processing Modules)', 'Virtual Hosts', 'Rewrite Engine']
            },
            nginx: {
                name: 'Nginx',
                description: 'High-performance event-driven web server and reverse proxy, excellent for static content and load balancing.',
                platform: ['Linux', 'Unix', 'macOS', 'Windows'],
                performance: 'Excellent - Event-driven',
                config: 'nginx.conf (declarative)',
                modules: 'Static and dynamic modules',
                ssl: 'Native SSL/TLS with SNI support',
                content: 'Best for static, proxy for dynamic',
                reverseProxy: 'Yes (Primary strength)',
                marketShare: 33.8,
                firstRelease: '2004',
                license: '2-clause BSD',
                features: ['Load Balancing', 'Reverse Proxy', 'HTTP/2 & HTTP/3', 'Low memory footprint']
            },
            iis: {
                name: 'Microsoft IIS',
                description: 'Windows-integrated web server with deep .NET framework integration and GUI management.',
                platform: ['Windows Server'],
                performance: 'Good - Hybrid model',
                config: 'XML (web.config) or GUI',
                modules: 'Native and managed modules',
                ssl: 'Integrated Windows certificates',
                content: 'Excellent for ASP.NET applications',
                reverseProxy: 'Yes (ARR module)',
                marketShare: 6.5,
                firstRelease: '1995',
                license: 'Proprietary (included with Windows)',
                features: ['GUI Management', 'Integrated Windows Auth', 'ASP.NET Integration', 'FTP Server']
            },
            litespeed: {
                name: 'LiteSpeed',
                description: 'High-performance commercial server with Apache compatibility and built-in caching, available in open-source version.',
                platform: ['Linux', 'Unix', 'macOS'],
                performance: 'Excellent - Event-driven',
                config: '.conf files (Apache-like)',
                modules: 'Apache module compatibility',
                ssl: 'Native with auto-renewal support',
                content: 'Optimized for both with LSCache',
                reverseProxy: 'Yes with caching',
                marketShare: 10.2,
                firstRelease: '2003',
                license: 'Proprietary & GPL (OpenLiteSpeed)',
                features: ['Apache .htaccess compatible', 'LSCache built-in', 'HTTP/3 QUIC', 'Anti-DDoS']
            },
            caddy: {
                name: 'Caddy',
                description: 'Modern web server with automatic HTTPS, written in Go. Simplest configuration of any major server.',
                platform: ['Linux', 'Windows', 'macOS', 'BSD'],
                performance: 'Very Good - Event-driven',
                config: 'Caddyfile (simple syntax) or JSON',
                modules: 'Plugin-based architecture',
                ssl: 'Automatic HTTPS (default)',
                content: 'Good for static, proxy for dynamic',
                reverseProxy: 'Yes (Simple configuration)',
                marketShare: 1.8,
                firstRelease: '2015',
                license: 'Apache License 2.0',
                features: ['Automatic HTTPS', 'HTTP/3 by default', 'Zero-config', 'Modern Go-based']
            }
        };

        // Scenarios data
        const scenarios = [
            {
                title: 'High-Traffic Static Site',
                description: 'Serving static HTML, CSS, JS, and images to millions of users',
                recommendation: {
                    primary: 'Nginx',
                    reason: 'Event-driven architecture excels at serving static files with minimal memory usage. Can handle 10,000+ concurrent connections efficiently.',
                    alternative: 'LiteSpeed or Caddy for built-in caching and modern protocols'
                }
            },
            {
                title: 'WordPress/PHP Application',
                description: 'Running a content management system with PHP and MySQL',
                recommendation: {
                    primary: 'LiteSpeed',
                    reason: 'LSCache dramatically improves WordPress performance. Apache-compatible so existing .htaccess rules work. OpenLiteSpeed is free.',
                    alternative: 'Apache with mod_php for simplicity, or Nginx with PHP-FPM for performance'
                }
            },
            {
                title: '.NET Application',
                description: 'ASP.NET Core or ASP.NET Framework application',
                recommendation: {
                    primary: 'Microsoft IIS',
                    reason: 'Native integration with .NET framework, Windows Authentication, and Visual Studio. Best tooling and debugging support.',
                    alternative: 'Nginx or Apache as reverse proxy for ASP.NET Core on Linux'
                }
            },
            {
                title: 'Reverse Proxy/Load Balancer',
                description: 'Distributing traffic across multiple backend servers',
                recommendation: {
                    primary: 'Nginx',
                    reason: 'Industry standard for reverse proxy and load balancing. Excellent performance, health checks, and various balancing algorithms.',
                    alternative: 'Caddy for automatic HTTPS or LiteSpeed for caching proxy'
                }
            },
            {
                title: 'Small Business Site',
                description: 'Simple website with occasional updates, limited technical staff',
                recommendation: {
                    primary: 'Caddy',
                    reason: 'Automatic HTTPS with zero configuration. Simplest setup and maintenance. Perfect for non-experts.',
                    alternative: 'Apache for shared hosting compatibility and extensive documentation'
                }
            }
        ];

        // Configuration examples
        const configExamples = {
            'Virtual Host': {
                apache: `<VirtualHost *:80>
    ServerName example.com
    ServerAlias www.example.com
    DocumentRoot /var/www/example

    <Directory /var/www/example>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog \${APACHE_LOG_DIR}/error.log
    CustomLog \${APACHE_LOG_DIR}/access.log combined
</VirtualHost>`,
                nginx: `server {
    listen 80;
    server_name example.com www.example.com;
    root /var/www/example;
    index index.html index.php;

    location / {
        try_files $uri $uri/ =404;
    }

    location ~ \\.php$ {
        fastcgi_pass unix:/run/php/php-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
    }

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;
}`,
                iis: `<!-- web.config in site root -->
<configuration>
    <system.webServer>
        <defaultDocument>
            <files>
                <add value="index.html" />
            </files>
        </defaultDocument>
        <directoryBrowse enabled="false" />
    </system.webServer>
</configuration>`,
                litespeed: `<virtualHost example.com>
    vhRoot                  /var/www/example
    configFile              conf/vhosts/example.conf
    allowSymbolLink         1
    enableScript            1
    restrained              1

    errorlog /var/log/litespeed/example_error.log {
        useServer           0
        logLevel            ERROR
    }
</virtualHost>`,
                caddy: `example.com {
    root * /var/www/example
    file_server
    encode gzip
    log {
        output file /var/log/caddy/access.log
    }
}`
            },
            'SSL/HTTPS': {
                apache: `<VirtualHost *:443>
    ServerName example.com
    DocumentRoot /var/www/example

    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/example.crt
    SSLCertificateKeyFile /etc/ssl/private/example.key
    SSLCertificateChainFile /etc/ssl/certs/chain.pem

    # Modern SSL configuration
    SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite HIGH:!aNULL:!MD5
</VirtualHost>`,
                nginx: `server {
    listen 443 ssl http2;
    server_name example.com;

    ssl_certificate /etc/ssl/certs/example.crt;
    ssl_certificate_key /etc/ssl/private/example.key;

    # Modern SSL configuration
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    # HSTS
    add_header Strict-Transport-Security "max-age=31536000" always;
}`,
                iis: `<!-- Use GUI for cert binding, or PowerShell -->
# PowerShell command to bind certificate:
New-WebBinding -Name "Example" -Protocol https -Port 443

# Get certificate and bind it
$cert = Get-ChildItem -Path Cert:\\LocalMachine\\My | Where-Object {$_.Subject -like "*example.com*"}
$binding = Get-WebBinding -Name "Example" -Protocol https
$binding.AddSslCertificate($cert.Thumbprint, "my")`,
                litespeed: `<sslCert>
    keyFile                 /etc/ssl/private/example.key
    certFile                /etc/ssl/certs/example.crt
    certChain               1
    CACertFile              /etc/ssl/certs/chain.pem
</sslCert>

<sslProtocol>24</sslProtocol>  # TLSv1.2 & TLSv1.3`,
                caddy: `example.com {
    # Automatic HTTPS - no configuration needed!
    # Caddy automatically obtains and renews certificates
    root * /var/www/example
    file_server
}

# For custom certificate:
example.com {
    tls /path/to/cert.pem /path/to/key.pem
}`
            },
            'Reverse Proxy': {
                apache: `<VirtualHost *:80>
    ServerName api.example.com

    ProxyPreserveHost On
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/

    # Load balancing to multiple backends
    <Proxy balancer://mycluster>
        BalancerMember http://backend1:3000
        BalancerMember http://backend2:3000
        ProxySet lbmethod=byrequests
    </Proxy>
</VirtualHost>`,
                nginx: `upstream backend {
    # Load balancing methods: round-robin (default),
    # least_conn, ip_hash
    least_conn;

    server backend1:3000 weight=3;
    server backend2:3000;
    server backend3:3000 backup;
}

server {
    listen 80;
    server_name api.example.com;

    location / {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}`,
                iis: `<!-- Install Application Request Routing (ARR) -->
<!-- web.config -->
<configuration>
    <system.webServer>
        <rewrite>
            <rules>
                <rule name="ReverseProxyRule" stopProcessing="true">
                    <match url="(.*)" />
                    <action type="Rewrite" url="http://localhost:3000/{R:1}" />
                </rule>
            </rules>
        </rewrite>
    </system.webServer>
</configuration>`,
                litespeed: `<context>
    type                    proxy
    handler                 fcgi://localhost:3000
    uri                     /

    # Load balancing
    extProcessor {
        type                lsapi
        address             uds://tmp/backend1.sock
        maxConns            10
        env                 LSAPI_CHILDREN=5
    }
</context>`,
                caddy: `api.example.com {
    # Simple reverse proxy
    reverse_proxy localhost:3000
}

# Load balancing
api.example.com {
    reverse_proxy backend1:3000 backend2:3000 backend3:3000 {
        lb_policy least_conn
        health_uri /health
        health_interval 10s
    }
}`
            },
            'URL Rewriting': {
                apache: `# .htaccess or VirtualHost config
RewriteEngine On

# Remove .html extension
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^(.*)$ $1.html [L]

# Redirect to HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Pretty URLs for blog
RewriteRule ^blog/([0-9]+)/([a-z0-9-]+)$ /blog.php?id=$1&slug=$2 [L,QSA]`,
                nginx: `location / {
    # Remove .html extension
    try_files $uri $uri.html $uri/ =404;
}

# Pretty URLs for blog
location ~ ^/blog/([0-9]+)/([a-z0-9-]+)$ {
    rewrite ^ /blog.php?id=$1&slug=$2 last;
}

# Redirect to HTTPS (separate server block)
server {
    listen 80;
    server_name example.com;
    return 301 https://$server_name$request_uri;
}`,
                iis: `<!-- web.config -->
<rewrite>
    <rules>
        <rule name="RemoveHTML" stopProcessing="true">
            <match url="^(.*)" />
            <conditions>
                <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
                <add input="{REQUEST_FILENAME}.html" matchType="IsFile" />
            </conditions>
            <action type="Rewrite" url="{R:1}.html" />
        </rule>
        <rule name="HTTPSRedirect" stopProcessing="true">
            <match url="(.*)" />
            <conditions>
                <add input="{HTTPS}" pattern="off" />
            </conditions>
            <action type="Redirect" url="https://{HTTP_HOST}/{R:1}" redirectType="Permanent" />
        </rule>
    </rules>
</rewrite>`,
                litespeed: `rewrite {
    enable                  1
    # Remove .html extension
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME}.html -f
    RewriteRule ^(.*)$ $1.html

    # Redirect to HTTPS
    RewriteCond %{HTTPS} !on
    RewriteRule ^(.*)$ https://%{SERVER_NAME}%{REQUEST_URI} [R=301,L]
}`,
                caddy: `example.com {
    # Remove .html extension
    @html {
        file {
            try_files {path}.html
        }
    }
    rewrite @html {http.matchers.file.relative}

    # Blog pretty URLs
    @blog path_regexp blog ^/blog/([0-9]+)/([a-z0-9-]+)$
    rewrite @blog /blog.php?id={re.blog.1}&slug={re.blog.2}
}`
            }
        };

        // Quiz questions
        const quizQuestions = [
            {
                question: 'Which web server uses an event-driven architecture for handling connections?',
                options: ['Apache (Prefork MPM)', 'Nginx', 'IIS', 'All of the above'],
                correct: 1,
                explanation: 'Nginx uses an event-driven, asynchronous architecture that allows it to handle thousands of concurrent connections with minimal memory usage.'
            },
            {
                question: 'What is the default behavior of Caddy regarding HTTPS?',
                options: ['Manual certificate configuration required', 'Automatic HTTPS with Let\'s Encrypt', 'HTTPS not supported', 'Self-signed certificates only'],
                correct: 1,
                explanation: 'Caddy automatically obtains and renews SSL certificates from Let\'s Encrypt, making HTTPS the default with zero configuration.'
            },
            {
                question: 'Which server is best integrated with ASP.NET applications?',
                options: ['Apache', 'Nginx', 'Microsoft IIS', 'LiteSpeed'],
                correct: 2,
                explanation: 'Microsoft IIS has native integration with the .NET framework and provides the best tooling, performance, and features for ASP.NET applications.'
            },
            {
                question: 'What is Apache\'s .htaccess file used for?',
                options: ['Database configuration', 'Per-directory configuration overrides', 'SSL certificate storage', 'Log file formatting'],
                correct: 1,
                explanation: '.htaccess files allow directory-level configuration overrides in Apache, commonly used for URL rewriting, access control, and custom error pages.'
            },
            {
                question: 'Which server currently has the highest market share?',
                options: ['Apache', 'Nginx', 'IIS', 'LiteSpeed'],
                correct: 1,
                explanation: 'As of recent statistics, Nginx has approximately 33.8% market share, slightly ahead of Apache at 31.4%.'
            },
            {
                question: 'What advantage does LiteSpeed offer for WordPress sites?',
                options: ['Free hosting', 'Built-in LSCache', 'Automatic backups', 'Database optimization'],
                correct: 1,
                explanation: 'LiteSpeed includes LSCache, a powerful built-in caching solution that dramatically improves WordPress performance without additional plugins.'
            },
            {
                question: 'Which configuration format does Nginx use?',
                options: ['XML files', 'JSON files', 'Declarative .conf files', 'YAML files'],
                correct: 2,
                explanation: 'Nginx uses declarative configuration files (nginx.conf) with a block-based syntax for defining server behavior.'
            },
            {
                question: 'What is the primary advantage of process-based architecture?',
                options: ['Lower memory usage', 'Better isolation between connections', 'Faster performance', 'Easier configuration'],
                correct: 1,
                explanation: 'Process-based architecture provides better isolation - if one process crashes, it only affects one connection, not the entire server.'
            },
            {
                question: 'Which server is written in the Go programming language?',
                options: ['Apache', 'Nginx', 'Caddy', 'IIS'],
                correct: 2,
                explanation: 'Caddy is written in Go, which contributes to its modern design, easy deployment (single binary), and good performance.'
            },
            {
                question: 'What does SNI stand for in SSL/TLS context?',
                options: ['Secure Network Interface', 'Server Name Indication', 'SSL Network Integration', 'Standard Nginx Implementation'],
                correct: 1,
                explanation: 'SNI (Server Name Indication) allows multiple SSL certificates on a single IP address by indicating which hostname the client is trying to connect to.'
            }
        ];

        // State
        let currentQuizState = {
            currentQuestion: 0,
            score: 0,
            answers: []
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderServerGrid();
            renderComparisonTable();
            renderMarketShare();
            renderScenarios();
            renderConfigSelector();
            renderQuiz();
            drawArchitectureDiagram();
        });

        // Tab switching
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-btn');

            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Render server grid
        function renderServerGrid() {
            const grid = document.getElementById('serverGrid');
            grid.innerHTML = '';

            Object.keys(servers).forEach(key => {
                const server = servers[key];
                const card = document.createElement('div');
                card.className = 'server-card';
                card.innerHTML = `
                    <div class="server-name">${server.name}</div>
                    <div class="server-description">${server.description}</div>
                    <div class="server-stats">
                        <div class="stat-item">
                            <span class="stat-label">Performance:</span>
                            <span class="stat-value">${server.performance}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Market Share:</span>
                            <span class="stat-value">${server.marketShare}%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">First Release:</span>
                            <span class="stat-value">${server.firstRelease}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">License:</span>
                            <span class="stat-value">${server.license}</span>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        ${server.features.map(f => `<span class="feature-badge">${f}</span>`).join('')}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Render comparison table
        function renderComparisonTable() {
            const table = document.getElementById('comparisonTable');
            const features = [
                { label: 'Platform Support', key: 'platform' },
                { label: 'Performance Model', key: 'performance' },
                { label: 'Configuration Style', key: 'config' },
                { label: 'Module System', key: 'modules' },
                { label: 'SSL/TLS Handling', key: 'ssl' },
                { label: 'Content Serving', key: 'content' },
                { label: 'Reverse Proxy', key: 'reverseProxy' }
            ];

            let html = '<thead><tr><th>Feature</th>';
            Object.keys(servers).forEach(key => {
                html += `<th>${servers[key].name}</th>`;
            });
            html += '</tr></thead><tbody>';

            features.forEach(feature => {
                html += `<tr><td><strong>${feature.label}</strong></td>`;
                Object.keys(servers).forEach(key => {
                    const value = servers[key][feature.key];
                    const displayValue = Array.isArray(value) ? value.join(', ') : value;
                    html += `<td>${displayValue}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody>';
            table.innerHTML = html;
        }

        // Render market share
        function renderMarketShare() {
            const container = document.getElementById('marketShare');
            container.innerHTML = '';

            Object.keys(servers).forEach(key => {
                const server = servers[key];
                const div = document.createElement('div');
                div.style.marginBottom = '20px';
                div.innerHTML = `
                    <div style="margin-bottom: 5px; color: #38bdf8; font-weight: bold;">${server.name}</div>
                    <div class="market-share-bar">
                        <div class="market-share-fill" style="width: 0%" data-width="${server.marketShare}">
                            ${server.marketShare}%
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });

            // Animate bars
            setTimeout(() => {
                document.querySelectorAll('.market-share-fill').forEach(bar => {
                    bar.style.width = bar.dataset.width + '%';
                });
            }, 100);
        }

        // Render scenarios
        function renderScenarios() {
            const grid = document.getElementById('scenarioGrid');
            grid.innerHTML = '';

            scenarios.forEach((scenario, index) => {
                const card = document.createElement('div');
                card.className = 'scenario-card';
                card.innerHTML = `
                    <div class="scenario-title">${scenario.title}</div>
                    <div style="color: #bae6fd;">${scenario.description}</div>
                `;
                card.onclick = () => showScenarioRecommendation(index);
                grid.appendChild(card);
            });
        }

        function showScenarioRecommendation(index) {
            const scenario = scenarios[index];
            const container = document.getElementById('scenarioRecommendation');
            container.innerHTML = `
                <div class="recommendation">
                    <div class="recommendation-title">Recommended: ${scenario.recommendation.primary}</div>
                    <p style="margin-bottom: 10px; color: #e0f2fe;"><strong>Reason:</strong> ${scenario.recommendation.reason}</p>
                    <p style="color: #bae6fd;"><strong>Alternative:</strong> ${scenario.recommendation.alternative}</p>
                </div>
            `;
        }

        // Render config selector
        function renderConfigSelector() {
            const selector = document.getElementById('configSelector');
            selector.innerHTML = '';

            Object.keys(configExamples).forEach((example, index) => {
                const btn = document.createElement('button');
                btn.className = 'config-btn' + (index === 0 ? ' active' : '');
                btn.textContent = example;
                btn.onclick = () => showConfigExample(example);
                selector.appendChild(btn);
            });

            showConfigExample(Object.keys(configExamples)[0]);
        }

        function showConfigExample(exampleName) {
            document.querySelectorAll('.config-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === exampleName);
            });

            const display = document.getElementById('configDisplay');
            const examples = configExamples[exampleName];

            let html = '';
            Object.keys(servers).forEach(key => {
                if (examples[key]) {
                    html += `
                        <h3 style="color: #38bdf8; margin-top: 20px; margin-bottom: 10px;">${servers[key].name}</h3>
                        <div class="code-block"><pre>${escapeHtml(examples[key])}</pre></div>
                    `;
                }
            });

            display.innerHTML = html;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Draw architecture diagram
        function drawArchitectureDiagram() {
            const canvas = document.getElementById('archCanvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            ctx.clearRect(0, 0, width, height);

            // Process-based (left side)
            ctx.fillStyle = '#38bdf8';
            ctx.font = 'bold 18px Arial';
            ctx.fillText('Process-Based (Apache)', 50, 30);

            ctx.strokeStyle = '#0ea5e9';
            ctx.fillStyle = 'rgba(14, 165, 233, 0.3)';
            ctx.lineWidth = 2;

            // Draw processes
            for (let i = 0; i < 5; i++) {
                ctx.fillRect(50, 60 + i * 60, 120, 40);
                ctx.strokeRect(50, 60 + i * 60, 120, 40);
                ctx.fillStyle = '#7dd3fc';
                ctx.font = '12px Arial';
                ctx.fillText(`Process ${i + 1}`, 70, 85 + i * 60);
                ctx.fillStyle = 'rgba(14, 165, 233, 0.3)';

                // Connection arrow
                ctx.strokeStyle = '#7dd3fc';
                ctx.beginPath();
                ctx.moveTo(20, 80 + i * 60);
                ctx.lineTo(50, 80 + i * 60);
                ctx.stroke();
                ctx.strokeStyle = '#0ea5e9';
            }

            ctx.fillStyle = '#7dd3fc';
            ctx.font = '12px Arial';
            ctx.fillText('1 connection per process', 50, 370);

            // Event-driven (right side)
            ctx.fillStyle = '#38bdf8';
            ctx.font = 'bold 18px Arial';
            ctx.fillText('Event-Driven (Nginx)', 500, 30);

            ctx.fillStyle = 'rgba(56, 189, 248, 0.3)';
            ctx.strokeStyle = '#0ea5e9';

            // Master process
            ctx.fillRect(500, 60, 150, 40);
            ctx.strokeRect(500, 60, 150, 40);
            ctx.fillStyle = '#7dd3fc';
            ctx.font = '12px Arial';
            ctx.fillText('Master Process', 520, 85);

            // Worker processes
            ctx.fillStyle = 'rgba(56, 189, 248, 0.3)';
            for (let i = 0; i < 2; i++) {
                ctx.fillRect(500, 140 + i * 80, 150, 50);
                ctx.strokeRect(500, 140 + i * 80, 150, 50);
                ctx.fillStyle = '#7dd3fc';
                ctx.fillText(`Worker ${i + 1}`, 540, 165 + i * 80);
                ctx.fillStyle = 'rgba(56, 189, 248, 0.3)';

                // Arrow from master
                ctx.strokeStyle = '#7dd3fc';
                ctx.beginPath();
                ctx.moveTo(575, 100);
                ctx.lineTo(575, 140 + i * 80);
                ctx.stroke();
                ctx.strokeStyle = '#0ea5e9';
            }

            // Multiple connections to each worker
            for (let i = 0; i < 2; i++) {
                for (let j = 0; j < 3; j++) {
                    ctx.strokeStyle = '#7dd3fc';
                    ctx.beginPath();
                    ctx.moveTo(680, 155 + i * 80 + j * 12);
                    ctx.lineTo(650, 155 + i * 80 + j * 12);
                    ctx.stroke();
                }
            }

            ctx.fillStyle = '#7dd3fc';
            ctx.font = '12px Arial';
            ctx.fillText('Multiple connections per worker', 480, 310);
            ctx.fillText('Non-blocking I/O', 530, 330);
        }

        // Render quiz
        function renderQuiz() {
            displayQuestion();
        }

        function displayQuestion() {
            const container = document.getElementById('quizContainer');
            const scoreDisplay = document.getElementById('quizScore');

            if (currentQuizState.currentQuestion >= quizQuestions.length) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h2 style="color: #38bdf8; margin-bottom: 20px;">Quiz Complete!</h2>
                        <p style="font-size: 1.5em;">Your final score: ${currentQuizState.score} / ${quizQuestions.length}</p>
                        <p style="margin-top: 20px; color: #bae6fd;">
                            ${currentQuizState.score === quizQuestions.length ? 'Perfect score! You\'re a web server expert!' :
                              currentQuizState.score >= quizQuestions.length * 0.7 ? 'Great job! You know your web servers well!' :
                              'Good effort! Review the materials and try again!'}
                        </p>
                    </div>
                `;
                return;
            }

            const question = quizQuestions[currentQuizState.currentQuestion];
            const answered = currentQuizState.answers[currentQuizState.currentQuestion] !== undefined;

            scoreDisplay.textContent = `Score: ${currentQuizState.score} / ${currentQuizState.currentQuestion}`;

            let html = `
                <div class="quiz-question">
                    <div class="question-text">Question ${currentQuizState.currentQuestion + 1} of ${quizQuestions.length}</div>
                    <div class="question-text" style="font-size: 1.1em; margin-top: 10px;">${question.question}</div>
                    <div class="quiz-options">
            `;

            question.options.forEach((option, index) => {
                let className = 'quiz-option';
                if (answered) {
                    if (index === question.correct) {
                        className += ' correct';
                    } else if (index === currentQuizState.answers[currentQuizState.currentQuestion]) {
                        className += ' incorrect';
                    }
                }

                html += `<div class="${className}" onclick="${!answered ? `answerQuestion(${index})` : ''}"
                         style="${answered ? 'cursor: default;' : ''}">${option}</div>`;
            });

            html += '</div>';

            if (answered) {
                const wasCorrect = currentQuizState.answers[currentQuizState.currentQuestion] === question.correct;
                html += `
                    <div class="quiz-feedback ${wasCorrect ? 'correct' : 'incorrect'}">
                        ${wasCorrect ? 'Correct!' : 'Incorrect.'} ${question.explanation}
                    </div>
                    <button class="btn" onclick="nextQuestion()">Next Question</button>
                `;
            }

            html += '</div>';
            container.innerHTML = html;
        }

        function answerQuestion(answerIndex) {
            const question = quizQuestions[currentQuizState.currentQuestion];
            currentQuizState.answers[currentQuizState.currentQuestion] = answerIndex;

            if (answerIndex === question.correct) {
                currentQuizState.score++;
            }

            displayQuestion();
        }

        function nextQuestion() {
            currentQuizState.currentQuestion++;
            displayQuestion();
        }

        function resetQuiz() {
            currentQuizState = {
                currentQuestion: 0,
                score: 0,
                answers: []
            };
            displayQuestion();
        }
    </script>
</body>
</html>