<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMB/File Sharing Guide - House of Web</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c4a6e 0%, #075985 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e0f2fe;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(12, 74, 110, 0.9);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            border: 2px solid #0ea5e9;
        }

        header {
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(14, 165, 233, 0.3);
        }

        h1 {
            color: #0c4a6e;
            font-size: 2.5em;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .back-link {
            display: inline-block;
            color: #7dd3fc;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(14, 165, 233, 0.2);
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(14, 165, 233, 0.4);
            transform: translateX(-5px);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px 15px;
            background: rgba(14, 165, 233, 0.3);
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            color: #7dd3fc;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            background: rgba(14, 165, 233, 0.5);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            color: #0c4a6e;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }

        .tab-content.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            background: rgba(7, 89, 133, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #0ea5e9;
        }

        h2 {
            color: #7dd3fc;
            margin-bottom: 15px;
            font-size: 1.8em;
            border-bottom: 2px solid #0ea5e9;
            padding-bottom: 10px;
        }

        h3 {
            color: #38bdf8;
            margin: 15px 0 10px;
            font-size: 1.3em;
        }

        .version-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .version-card {
            background: rgba(14, 165, 233, 0.15);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #0ea5e9;
            transition: all 0.3s ease;
        }

        .version-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
        }

        .deprecated { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        .recommended { border-color: #22c55e; background: rgba(34, 197, 94, 0.1); }

        ul.feature-list {
            list-style: none;
            margin-top: 10px;
        }

        .feature-list li {
            padding: 6px 0 6px 20px;
            position: relative;
        }

        .feature-list li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #7dd3fc;
            font-weight: bold;
        }

        .input-group {
            margin: 15px 0;
        }

        label {
            display: block;
            color: #7dd3fc;
            margin-bottom: 8px;
            font-weight: bold;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            background: rgba(12, 74, 110, 0.6);
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            color: #e0f2fe;
            font-size: 1em;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #38bdf8;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.3);
        }

        button {
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            color: #0c4a6e;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(14, 165, 233, 0.4);
        }

        .output-box, .code-block {
            background: rgba(12, 74, 110, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #0ea5e9;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            color: #7dd3fc;
            overflow-x: auto;
        }

        .step-list {
            list-style: none;
            counter-reset: step;
        }

        .step-list li {
            counter-increment: step;
            padding: 12px 12px 12px 50px;
            margin: 10px 0;
            background: rgba(14, 165, 233, 0.15);
            border-radius: 8px;
            border-left: 4px solid #0ea5e9;
            position: relative;
        }

        .step-list li:before {
            content: counter(step);
            position: absolute;
            left: 12px;
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            color: #0c4a6e;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            line-height: 28px;
            text-align: center;
        }

        .port-card {
            background: rgba(14, 165, 233, 0.15);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #0ea5e9;
            margin: 10px 0;
        }

        .port-number {
            font-size: 2em;
            color: #38bdf8;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #0ea5e9;
        }

        th {
            background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
            color: #0c4a6e;
            font-weight: bold;
        }

        .warning { background: rgba(239, 68, 68, 0.2); border: 2px solid #ef4444; padding: 12px; border-radius: 8px; margin: 10px 0; }
        .info { background: rgba(14, 165, 233, 0.2); border: 2px solid #0ea5e9; padding: 12px; border-radius: 8px; margin: 10px 0; }

        .quiz-question {
            background: rgba(14, 165, 233, 0.15);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #0ea5e9;
        }

        .quiz-options {
            list-style: none;
            margin-top: 10px;
        }

        .quiz-options li {
            padding: 10px;
            margin: 6px 0;
            background: rgba(12, 74, 110, 0.6);
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quiz-options li:hover { background: rgba(14, 165, 233, 0.3); }
        .quiz-options li.correct { background: rgba(34, 197, 94, 0.3); border-color: #22c55e; }
        .quiz-options li.wrong { background: rgba(239, 68, 68, 0.3); border-color: #ef4444; }

        .quiz-feedback {
            margin-top: 10px;
            padding: 12px;
            border-radius: 8px;
            display: none;
        }

        .quiz-feedback.show { display: block; }
        .quiz-feedback.correct { background: rgba(34, 197, 94, 0.2); border: 2px solid #22c55e; }
        .quiz-feedback.wrong { background: rgba(239, 68, 68, 0.2); border: 2px solid #ef4444; }

        .quiz-score {
            text-align: center;
            font-size: 1.4em;
            color: #7dd3fc;
            margin: 20px 0;
            padding: 15px;
            background: rgba(14, 165, 233, 0.2);
            border-radius: 8px;
            border: 2px solid #0ea5e9;
        }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            h1 { font-size: 1.8em; }
            .tabs { flex-direction: column; }
            .tab-btn { min-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../catalog.html" class="back-link">← Back to Catalog</a>

        <header>
            <h1>SMB/File Sharing Guide</h1>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="openTab('versions')">Versions</button>
            <button class="tab-btn" onclick="openTab('windows')">Windows</button>
            <button class="tab-btn" onclick="openTab('unc')">UNC Builder</button>
            <button class="tab-btn" onclick="openTab('linux')">Linux</button>
            <button class="tab-btn" onclick="openTab('ports')">Ports</button>
            <button class="tab-btn" onclick="openTab('troubleshoot')">Troubleshoot</button>
            <button class="tab-btn" onclick="openTab('quiz')">Quiz</button>
        </div>

        <div id="versions" class="tab-content active">
            <div class="section">
                <h2>SMB Protocol Versions</h2>
                <p>Server Message Block (SMB) is a network file sharing protocol developed by Microsoft. It allows applications to read and write files and request services from server programs over a network. Understanding version differences is critical for security and performance.</p>

                <div class="info">
                    <strong>Quick History:</strong> SMB was originally developed by IBM in the 1980s, enhanced by Microsoft, and has evolved significantly. CIFS (Common Internet File System) is essentially SMB 1.0 with some extensions.
                </div>

                <div class="version-grid">
                    <div class="version-card deprecated">
                        <h3>SMB 1.0</h3>
                        <p><strong>Windows 2000/XP/2003</strong></p>
                        <div class="warning">⚠ DEPRECATED - DISABLE</div>
                        <ul class="feature-list">
                            <li>Major security vulnerabilities</li>
                            <li>WannaCry/NotPetya target</li>
                            <li>No encryption</li>
                            <li>Poor performance</li>
                        </ul>
                    </div>
                    <div class="version-card">
                        <h3>SMB 2.0</h3>
                        <p><strong>Vista/Server 2008</strong></p>
                        <ul class="feature-list">
                            <li>Complete redesign</li>
                            <li>Reduced chattiness (19 commands vs 100+)</li>
                            <li>Better performance (up to 30x faster)</li>
                            <li>Larger buffers (64KB reads/writes)</li>
                            <li>Durable file handles</li>
                            <li>Improved message compounding</li>
                        </ul>
                    </div>
                    <div class="version-card">
                        <h3>SMB 2.1</h3>
                        <p><strong>Win 7/Server 2008 R2</strong></p>
                        <ul class="feature-list">
                            <li>Large MTU support</li>
                            <li>BranchCache</li>
                            <li>Improved leasing</li>
                            <li>Energy efficient</li>
                        </ul>
                    </div>
                    <div class="version-card recommended">
                        <h3>SMB 3.0</h3>
                        <p><strong>Win 8/Server 2012</strong></p>
                        <div class="info">✓ Encryption Support</div>
                        <ul class="feature-list">
                            <li>End-to-end encryption</li>
                            <li>SMB Direct (RDMA)</li>
                            <li>SMB Multichannel</li>
                            <li>Transparent failover</li>
                        </ul>
                    </div>
                    <div class="version-card recommended">
                        <h3>SMB 3.1.1</h3>
                        <p><strong>Win 10/Server 2016+</strong></p>
                        <div class="info">✓ RECOMMENDED</div>
                        <ul class="feature-list">
                            <li>Pre-auth integrity</li>
                            <li>AES-128-GCM encryption</li>
                            <li>MitM protection</li>
                            <li>Modern security</li>
                        </ul>
                    </div>
                </div>

                <h3>SMB Version Compatibility Matrix</h3>
                <table>
                    <tr>
                        <th>Windows Version</th>
                        <th>SMB Versions Supported</th>
                        <th>Default SMB Version</th>
                    </tr>
                    <tr>
                        <td>Windows 10/11, Server 2016+</td>
                        <td>2.0, 2.1, 3.0, 3.0.2, 3.1.1</td>
                        <td>3.1.1</td>
                    </tr>
                    <tr>
                        <td>Windows 8.1, Server 2012 R2</td>
                        <td>2.0, 2.1, 3.0, 3.0.2</td>
                        <td>3.0.2</td>
                    </tr>
                    <tr>
                        <td>Windows 8, Server 2012</td>
                        <td>2.0, 2.1, 3.0</td>
                        <td>3.0</td>
                    </tr>
                    <tr>
                        <td>Windows 7, Server 2008 R2</td>
                        <td>1.0, 2.0, 2.1</td>
                        <td>2.1</td>
                    </tr>
                    <tr>
                        <td>Windows Vista, Server 2008</td>
                        <td>1.0, 2.0</td>
                        <td>2.0</td>
                    </tr>
                </table>

                <h3>Migration Checklist: SMB 1.0 to SMB 3.x</h3>
                <ol class="step-list">
                    <li>Audit environment: Identify systems still using SMB 1.0</li>
                    <li>Update legacy systems to Windows 10/Server 2016 or later</li>
                    <li>Test applications for SMB 3.x compatibility</li>
                    <li>Disable SMB 1.0 on servers first, then clients</li>
                    <li>Monitor logs for any SMB 1.0 connection attempts</li>
                    <li>Document changes and update procedures</li>
                </ol>

                <div class="code-block"># Detect SMB1 usage (run on server)
Get-SmbConnection | Where-Object {$_.Dialect -like "1.0*"}

# Audit SMB1 requests
Set-SmbServerConfiguration -AuditSmb1Access $true

# Check audit results
Get-WinEvent -LogName Microsoft-Windows-SMBServer/Audit</div>

                <h3>Quick Reference: SMB Commands</h3>
                <table>
                    <tr>
                        <th>Task</th>
                        <th>Windows Command</th>
                        <th>PowerShell</th>
                    </tr>
                    <tr>
                        <td>List shares</td>
                        <td>net share</td>
                        <td>Get-SmbShare</td>
                    </tr>
                    <tr>
                        <td>Create share</td>
                        <td>net share name=path</td>
                        <td>New-SmbShare</td>
                    </tr>
                    <tr>
                        <td>Remove share</td>
                        <td>net share name /delete</td>
                        <td>Remove-SmbShare</td>
                    </tr>
                    <tr>
                        <td>Map drive</td>
                        <td>net use Z: \\server\share</td>
                        <td>New-PSDrive</td>
                    </tr>
                    <tr>
                        <td>View connections</td>
                        <td>net use</td>
                        <td>Get-SmbConnection</td>
                    </tr>
                    <tr>
                        <td>Disconnect drive</td>
                        <td>net use Z: /delete</td>
                        <td>Remove-PSDrive</td>
                    </tr>
                </table>

                <h3>SMB Feature Evolution Timeline</h3>
                <ul class="feature-list">
                    <li><strong>1983:</strong> IBM develops SMB for DOS</li>
                    <li><strong>1990s:</strong> Microsoft enhances SMB, creates CIFS</li>
                    <li><strong>2006:</strong> SMB 2.0 released with Vista</li>
                    <li><strong>2009:</strong> SMB 2.1 in Windows 7</li>
                    <li><strong>2012:</strong> SMB 3.0 adds encryption</li>
                    <li><strong>2013:</strong> SMB 3.0.2 in Windows 8.1</li>
                    <li><strong>2015:</strong> SMB 3.1.1 with pre-auth integrity</li>
                    <li><strong>2017:</strong> WannaCry highlights SMB 1.0 dangers</li>
                    <li><strong>2020:</strong> SMBGhost vulnerability patched</li>
                </ul>
            </div>
        </div>

        <div id="windows" class="tab-content">
            <div class="section">
                <h2>Windows Share Setup</h2>
                <h3>Creating a Share</h3>
                <ol class="step-list">
                    <li>Right-click folder → Properties</li>
                    <li>Sharing tab → Advanced Sharing</li>
                    <li>Check "Share this folder"</li>
                    <li>Set share name</li>
                    <li>Click Permissions</li>
                    <li>Configure access</li>
                </ol>

                <h3>Permissions Comparison</h3>
                <table>
                    <tr>
                        <th>Type</th>
                        <th>Scope</th>
                        <th>Levels</th>
                    </tr>
                    <tr>
                        <td>Share</td>
                        <td>Network only</td>
                        <td>Read, Change, Full</td>
                    </tr>
                    <tr>
                        <td>NTFS</td>
                        <td>Local & Network</td>
                        <td>Full, Modify, R&E, Read, Write</td>
                    </tr>
                </table>

                <div class="info">
                    <strong>Rule:</strong> Most restrictive wins. Share=Read + NTFS=Full = Read access
                </div>

                <h3>Best Practices</h3>
                <ul class="feature-list">
                    <li>Share: Everyone - Full Control</li>
                    <li>NTFS: Actual security control</li>
                    <li>Use groups, not users</li>
                    <li>Disable SMB 1.0</li>
                    <li>Regular audits</li>
                </ul>

                <h3>PowerShell Commands</h3>
                <div class="code-block"># Create a share
New-SmbShare -Name "ShareName" -Path "C:\SharedFolder" -FullAccess "Everyone"

# View existing shares
Get-SmbShare

# Remove a share
Remove-SmbShare -Name "ShareName"

# Set share permissions
Grant-SmbShareAccess -Name "ShareName" -AccountName "DOMAIN\User" -AccessRight Full

# View share access
Get-SmbShareAccess -Name "ShareName"</div>

                <h3>Permission Examples</h3>
                <table>
                    <tr>
                        <th>Scenario</th>
                        <th>Share Permission</th>
                        <th>NTFS Permission</th>
                        <th>Effective Result</th>
                    </tr>
                    <tr>
                        <td>Example 1</td>
                        <td>Read</td>
                        <td>Full Control</td>
                        <td>Read</td>
                    </tr>
                    <tr>
                        <td>Example 2</td>
                        <td>Full Control</td>
                        <td>Modify</td>
                        <td>Modify</td>
                    </tr>
                    <tr>
                        <td>Example 3</td>
                        <td>Change</td>
                        <td>Read</td>
                        <td>Read</td>
                    </tr>
                    <tr>
                        <td>Best Practice</td>
                        <td>Full Control</td>
                        <td>As needed</td>
                        <td>NTFS controls</td>
                    </tr>
                </table>
            </div>
        </div>

        <div id="unc" class="tab-content">
            <div class="section">
                <h2>UNC Path Builder</h2>
                <div class="input-group">
                    <label>Server:</label>
                    <input type="text" id="server" placeholder="SERVER01" oninput="buildUNC()">
                </div>
                <div class="input-group">
                    <label>Share:</label>
                    <input type="text" id="share" placeholder="SharedFolder" oninput="buildUNC()">
                </div>
                <div class="input-group">
                    <label>Path (optional):</label>
                    <input type="text" id="path" placeholder="Documents" oninput="buildUNC()">
                </div>
                <h3>UNC Path:</h3>
                <div class="output-box" id="unc-out">\\server\share</div>
                <button onclick="copyText('unc-out')">Copy</button>

                <h3>Map Drive Commands</h3>
                <div class="input-group">
                    <label>Drive Letter:</label>
                    <select id="drive" onchange="buildCmds()">
                        <option>Z:</option><option>Y:</option><option>X:</option><option>W:</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Username (optional):</label>
                    <input type="text" id="user" placeholder="DOMAIN\user" oninput="buildCmds()">
                </div>

                <h3>Windows:</h3>
                <div class="code-block" id="win-cmd"></div>
                <button onclick="copyText('win-cmd')">Copy</button>

                <h3>Linux:</h3>
                <div class="code-block" id="lin-cmd"></div>
                <button onclick="copyText('lin-cmd')">Copy</button>

                <h3>UNC Path Examples</h3>
                <table>
                    <tr>
                        <th>Example</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td>\\SERVER\Share</td>
                        <td>Basic share access</td>
                    </tr>
                    <tr>
                        <td>\\192.168.1.100\Share</td>
                        <td>Using IP address</td>
                    </tr>
                    <tr>
                        <td>\\SERVER.domain.local\Share</td>
                        <td>Fully qualified domain name</td>
                    </tr>
                    <tr>
                        <td>\\SERVER\Share\Folder\File.txt</td>
                        <td>Full path to file</td>
                    </tr>
                    <tr>
                        <td>\\SERVER\C$</td>
                        <td>Administrative share (requires admin rights)</td>
                    </tr>
                </table>

                <h3>Special Administrative Shares</h3>
                <ul class="feature-list">
                    <li>C$, D$, E$ - Drive root shares (admin only)</li>
                    <li>ADMIN$ - Windows installation folder</li>
                    <li>IPC$ - Inter-process communication</li>
                    <li>PRINT$ - Printer drivers</li>
                </ul>

                <h3>Accessing Hidden Shares</h3>
                <div class="info">
                    Shares ending with $ are hidden from browse lists but can be accessed directly with the full UNC path.
                </div>

                <h3>Drive Mapping Options</h3>
                <table>
                    <tr>
                        <th>Option</th>
                        <th>Command Switch</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td>Persistent</td>
                        <td>/persistent:yes</td>
                        <td>Reconnect at every logon</td>
                    </tr>
                    <tr>
                        <td>Specific User</td>
                        <td>/user:username</td>
                        <td>Authenticate as different user</td>
                    </tr>
                    <tr>
                        <td>Password</td>
                        <td>password</td>
                        <td>Provide password (not recommended)</td>
                    </tr>
                    <tr>
                        <td>Delete Mapping</td>
                        <td>/delete</td>
                        <td>Remove mapped drive</td>
                    </tr>
                </table>
            </div>
        </div>

        <div id="linux" class="tab-content">
            <div class="section">
                <h2>Linux Samba Setup</h2>
                <h3>Installation</h3>
                <div class="code-block"># Ubuntu/Debian
sudo apt install samba

# CentOS/RHEL
sudo yum install samba</div>

                <h3>Basic smb.conf</h3>
                <div class="code-block">[global]
workgroup = WORKGROUP
server string = Samba %v
security = user
min protocol = SMB2

[Share]
path = /srv/samba/share
browsable = yes
writable = yes
valid users = @smbgroup
create mask = 0755</div>

                <h3>User Management</h3>
                <div class="code-block"># Add user
sudo adduser smbuser
sudo smbpasswd -a smbuser

# Create group
sudo groupadd smbgroup
sudo usermod -aG smbgroup smbuser</div>

                <h3>Mount SMB Share</h3>
                <div class="code-block"># Install cifs-utils
sudo apt install cifs-utils

# Mount
sudo mount -t cifs //server/share /mnt/point \
  -o username=user,password=pass

# /etc/fstab entry
//server/share /mnt/point cifs credentials=/root/.creds,uid=1000 0 0</div>

                <h3>Samba Service Commands</h3>
                <div class="code-block"># Start Samba
sudo systemctl start smbd
sudo systemctl start nmbd

# Stop Samba
sudo systemctl stop smbd

# Restart after config changes
sudo systemctl restart smbd

# Enable at boot
sudo systemctl enable smbd

# Check status
sudo systemctl status smbd

# View active connections
sudo smbstatus

# Test configuration
testparm -s</div>

                <h3>Troubleshooting Samba</h3>
                <ul class="feature-list">
                    <li>Check logs: /var/log/samba/</li>
                    <li>Verify firewall allows ports 139, 445</li>
                    <li>Test config: testparm</li>
                    <li>Check SELinux if enabled</li>
                    <li>Verify user exists: pdbedit -L</li>
                </ul>

                <h3>Advanced smb.conf Options</h3>
                <div class="code-block">[global]
# Performance tuning
socket options = TCP_NODELAY SO_RCVBUF=65536 SO_SNDBUF=65536
read raw = yes
write raw = yes
max xmit = 65535

# Security hardening
restrict anonymous = 2
null passwords = no
obey pam restrictions = yes
unix password sync = yes

# Logging
log file = /var/log/samba/%m.log
log level = 1</div>
            </div>
        </div>

        <div id="ports" class="tab-content">
            <div class="section">
                <h2>SMB Ports & Security</h2>
                <div class="port-card">
                    <div class="port-number">445</div>
                    <h3>SMB Direct (TCP)</h3>
                    <p>Primary port for modern SMB (2.0+). Direct TCP without NetBIOS.</p>
                    <div class="warning">Never expose to internet!</div>
                </div>

                <div class="port-card">
                    <div class="port-number">139</div>
                    <h3>SMB over NetBIOS (TCP)</h3>
                    <p>Legacy port for SMB 1.0. Can be disabled in modern networks.</p>
                </div>

                <div class="port-card">
                    <div class="port-number">137, 138</div>
                    <h3>NetBIOS Services (UDP)</h3>
                    <p>Name resolution and datagrams. Legacy services.</p>
                </div>

                <h3>Security Commands</h3>
                <div class="code-block"># Disable SMB1
Disable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol

# Enable encryption
Set-SmbShare -Name "Share" -EncryptData $true

# Enable signing
Set-SmbServerConfiguration -RequireSecuritySignature $true</div>

                <h3>Best Practices</h3>
                <ul class="feature-list">
                    <li>Use SMB 3.1.1 minimum</li>
                    <li>Enable encryption</li>
                    <li>Require signing</li>
                    <li>Use VPN for remote</li>
                    <li>Block port 445 from internet</li>
                </ul>

                <h3>Network Isolation</h3>
                <div class="info">
                    <strong>CRITICAL:</strong> SMB should never be exposed to the internet. Use VPN, ZeroTier, or Tailscale for remote access.
                </div>

                <h3>Checking SMB Configuration</h3>
                <div class="code-block"># Check SMB version in use
Get-SmbConnection | Select ServerName, Dialect, Encrypted

# View server configuration
Get-SmbServerConfiguration | Select *

# Check if SMB1 is enabled (should be False)
Get-WindowsOptionalFeature -Online | Where-Object {$_.FeatureName -like "*SMB*"}

# View shares and their encryption status
Get-SmbShare | Select Name, EncryptData, Path</div>

                <h3>Security Audit Checklist</h3>
                <ul class="feature-list">
                    <li>SMB 1.0 disabled on all systems</li>
                    <li>Encryption enabled for sensitive shares</li>
                    <li>Signing required on domain controllers</li>
                    <li>Firewall blocking external SMB access</li>
                    <li>Regular permission audits</li>
                    <li>Guest access disabled</li>
                    <li>Strong password policy enforced</li>
                    <li>Network segmentation implemented</li>
                </ul>

                <h3>Performance Tuning</h3>
                <div class="code-block"># Enable SMB Direct (RDMA)
Set-SmbServerConfiguration -EnableSMBDirect $true

# Configure receive buffer size
Set-SmbServerConfiguration -MaxChannelPerSession 32

# Enable bandwidth management
Set-SmbBandwidthLimit -Category Default -BytesPerSecond 100MB

# Optimize for large file transfers
Set-SmbServerConfiguration -AsynchronousCredits 512</div>

                <h3>Notable SMB Vulnerabilities</h3>
                <table>
                    <tr>
                        <th>Vulnerability</th>
                        <th>CVE</th>
                        <th>Impact</th>
                        <th>Mitigation</th>
                    </tr>
                    <tr>
                        <td>EternalBlue</td>
                        <td>CVE-2017-0144</td>
                        <td>Remote code execution (WannaCry)</td>
                        <td>Disable SMB1, patch systems</td>
                    </tr>
                    <tr>
                        <td>SMBGhost</td>
                        <td>CVE-2020-0796</td>
                        <td>SMB 3.1.1 compression flaw</td>
                        <td>Apply KB4551762 patch</td>
                    </tr>
                    <tr>
                        <td>SambaCry</td>
                        <td>CVE-2017-7494</td>
                        <td>Remote code execution (Samba)</td>
                        <td>Update Samba to 4.6.4+</td>
                    </tr>
                </table>

                <h3>SMB Hardening Best Practices</h3>
                <ul class="feature-list">
                    <li>Implement network segmentation (VLANs)</li>
                    <li>Use IPsec for additional encryption layer</li>
                    <li>Enable Windows Defender Firewall</li>
                    <li>Restrict anonymous access</li>
                    <li>Use service accounts with minimal privileges</li>
                    <li>Implement file screening (FSRM)</li>
                    <li>Regular security audits and penetration testing</li>
                    <li>Monitor SMB traffic with IDS/IPS</li>
                </ul>
            </div>
        </div>

        <div id="troubleshoot" class="tab-content">
            <div class="section">
                <h2>Troubleshooting</h2>

                <h3>Access Denied</h3>
                <ul class="feature-list">
                    <li>Check Share permissions</li>
                    <li>Verify NTFS permissions</li>
                    <li>Confirm user group membership</li>
                    <li>Test credentials</li>
                </ul>
                <div class="code-block"># Check permissions
Get-SmbShare -Name "Share" | Get-SmbShareAccess
Get-Acl "C:\Share" | Format-List</div>

                <h3>Network Discovery Issues</h3>
                <ul class="feature-list">
                    <li>Enable Network Discovery</li>
                    <li>Start Function Discovery services</li>
                    <li>Check firewall rules</li>
                    <li>Set network to Private</li>
                </ul>
                <div class="code-block"># Enable discovery
Get-NetFirewallRule -DisplayGroup "Network Discovery" | Enable-NetFirewallRule</div>

                <h3>Can't Map Drive</h3>
                <ul class="feature-list">
                    <li>Ping server</li>
                    <li>Test port 445</li>
                    <li>Verify share name</li>
                    <li>Clear cached credentials</li>
                </ul>
                <div class="code-block"># Test connectivity
Test-NetConnection server -Port 445

# Clear credentials
cmdkey /delete:server</div>

                <h3>Slow Transfers</h3>
                <ul class="feature-list">
                    <li>Enable SMB Multichannel</li>
                    <li>Check network speed</li>
                    <li>Disable antivirus scanning</li>
                    <li>Ensure not using SMB 1.0</li>
                </ul>
                <div class="code-block"># Check SMB version
Get-SmbConnection | Select ServerName,Dialect

# Enable Multichannel
Set-SmbServerConfiguration -EnableMultiChannel $true

# Check bandwidth
Get-SmbBandwidthLimit</div>

                <h3>Error 0x80070035 - Network Path Not Found</h3>
                <ul class="feature-list">
                    <li>Verify computer name/IP is correct</li>
                    <li>Check network connectivity (ping)</li>
                    <li>Ensure share exists on target</li>
                    <li>Verify DNS resolution</li>
                    <li>Check Windows Firewall settings</li>
                </ul>

                <h3>Error 0x80004005 - Unspecified Error</h3>
                <ul class="feature-list">
                    <li>Often caused by SMB 1.0 dependencies</li>
                    <li>Check SMB version compatibility</li>
                    <li>Verify network discovery enabled</li>
                    <li>Reset TCP/IP stack if needed</li>
                </ul>
                <div class="code-block"># Reset network
netsh int ip reset
netsh winsock reset
ipconfig /flushdns</div>

                <h3>Common Log Locations</h3>
                <ul class="feature-list">
                    <li>Windows: Event Viewer → Applications and Services → Microsoft → Windows → SMBServer</li>
                    <li>Linux: /var/log/samba/log.smbd</li>
                    <li>macOS: /var/log/system.log</li>
                </ul>

                <h3>Advanced Troubleshooting Tools</h3>
                <div class="code-block"># Capture SMB traffic
netsh trace start capture=yes tracefile=smb.etl

# Stop capture
netsh trace stop

# View SMB sessions
Get-SmbSession | Format-Table

# Clear SMB cache
Get-SmbConnection | Close-SmbSession

# Reset SMB configuration
Reset-SmbServerConfiguration</div>

                <h3>Performance Diagnostics</h3>
                <div class="code-block"># Check SMB statistics
Get-SmbServerNetworkInterface

# Monitor throughput
Get-SmbConnection | Select ServerName, Dialect, NumOpens

# View open files
Get-SmbOpenFile | Select Path, ClientComputerName, SessionId</div>

                <h3>Troubleshooting Flowchart</h3>
                <ol class="step-list">
                    <li>Can you ping the server? NO → Check network connectivity</li>
                    <li>Is port 445 open? NO → Check firewall settings</li>
                    <li>Can you resolve the server name? NO → Check DNS or use IP</li>
                    <li>Do you have correct credentials? NO → Verify username/password</li>
                    <li>Are permissions correct? NO → Check Share and NTFS permissions</li>
                    <li>Is SMB version compatible? NO → Update client or server</li>
                    <li>Still not working? → Check event logs and enable debug logging</li>
                </ol>
            </div>
        </div>

        <div id="quiz" class="tab-content">
            <div class="section">
                <h2>SMB Knowledge Quiz</h2>
                <div id="quiz-container"></div>
                <div class="quiz-score" id="score"></div>
                <button onclick="resetQuiz()">Reset Quiz</button>
            </div>
        </div>
    </div>

    <script>
        function openTab(name) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(name).classList.add('active');
            event.target.classList.add('active');
        }

        function buildUNC() {
            const s = document.getElementById('server').value || 'server';
            const sh = document.getElementById('share').value || 'share';
            const p = document.getElementById('path').value;
            let unc = '\\\\' + s + '\\' + sh;
            if(p) unc += '\\' + p.replace(/\//g, '\\');
            document.getElementById('unc-out').textContent = unc;
            buildCmds();
        }

        function buildCmds() {
            const unc = document.getElementById('unc-out').textContent;
            const drv = document.getElementById('drive').value;
            const usr = document.getElementById('user').value;

            let win = 'net use ' + drv + ' "' + unc + '"';
            if(usr) win += ' /user:' + usr;
            document.getElementById('win-cmd').textContent = win;

            const lin = unc.replace(/\\\\/g, '//').replace(/\\/g, '/');
            let lincmd = 'sudo mount -t cifs "' + lin + '" /mnt/share';
            if(usr) lincmd += ' -o username=' + usr;
            document.getElementById('lin-cmd').textContent = lincmd;
        }

        function copyText(id) {
            const txt = document.getElementById(id).textContent;
            navigator.clipboard.writeText(txt).then(() => alert('Copied!'));
        }

        const quiz = [
            {q: "Which SMB version introduced encryption?", o: ["1.0","2.0","3.0","3.1.1"], a: 2, e: "SMB 3.0 introduced end-to-end encryption."},
            {q: "Default port for modern SMB?", o: ["139","445","137","138"], a: 1, e: "Port 445 is used for SMB direct hosting."},
            {q: "When permissions conflict, which applies?", o: ["Share","NTFS","Most restrictive","Most permissive"], a: 2, e: "The most restrictive permission always wins."},
            {q: "Why disable SMB 1.0?", o: ["Slow","Security holes","Incompatible","Bandwidth"], a: 1, e: "SMB 1.0 has critical vulnerabilities (WannaCry)."},
            {q: "What does UNC stand for?", o: ["Universal Network Connection","Universal Naming Convention","Unified Network Control","Unique Name Config"], a: 1, e: "UNC = Universal Naming Convention"},
            {q: "Best Share permission practice?", o: ["Read only","Change","Everyone Full Control","Disable"], a: 2, e: "Set Share to Everyone Full, use NTFS for security."},
            {q: "Main Samba config file?", o: ["/etc/smb.conf","/etc/samba/smb.conf","/etc/samba/config","/etc/samba.conf"], a: 1, e: "Located at /etc/samba/smb.conf"},
            {q: "Which protects against MitM?", o: ["Encryption","SMB Signing","Multichannel","Direct hosting"], a: 1, e: "SMB Signing prevents man-in-the-middle attacks."},
            {q: "What command tests Samba config?", o: ["smbtest","testparm","configtest","samba-check"], a: 1, e: "testparm validates Samba configuration syntax."},
            {q: "SMB 3.0 feature for bandwidth?", o: ["Direct","Signing","Multichannel","Encryption"], a: 2, e: "SMB Multichannel uses multiple network connections."},
            {q: "Port 139 is used for?", o: ["SMB Direct","NetBIOS","CIFS","DNS"], a: 1, e: "Port 139 is for SMB over NetBIOS sessions."},
            {q: "Which Windows command creates a share?", o: ["net share","New-SmbShare","share.exe","mkshare"], a: 1, e: "New-SmbShare is the PowerShell cmdlet for creating shares."},
            {q: "What encrypts SMB 3.1.1 traffic?", o: ["MD5","SHA-1","AES-128-GCM","3DES"], a: 2, e: "SMB 3.1.1 uses AES-128-GCM for encryption."},
            {q: "Linux package to mount SMB shares?", o: ["smbfs","cifs-utils","mount-smb","smb-client"], a: 1, e: "cifs-utils provides CIFS/SMB mounting capabilities."},
            {q: "What adds a Samba user?", o: ["useradd","adduser","smbpasswd","net user"], a: 2, e: "smbpasswd -a adds users to Samba database."},
        ];

        let ans = [];
        let score = 0;

        function renderQuiz() {
            const c = document.getElementById('quiz-container');
            c.innerHTML = '';
            quiz.forEach((q,i) => {
                const d = document.createElement('div');
                d.className = 'quiz-question';
                d.innerHTML = '<h3>Q' + (i+1) + '</h3><p><strong>' + q.q + '</strong></p><ul class="quiz-options" id="opt' + i + '">' +
                    q.o.map((opt,j) => '<li onclick="answer(' + i + ',' + j + ')">' + opt + '</li>').join('') +
                    '</ul><div class="quiz-feedback" id="fb' + i + '"></div>';
                c.appendChild(d);
            });
            updateScore();
        }

        function answer(qi, ai) {
            if(ans[qi]) return;
            ans[qi] = true;
            const q = quiz[qi];
            const opts = document.getElementById('opt' + qi).children;
            const fb = document.getElementById('fb' + qi);

            if(ai === q.a) {
                opts[ai].classList.add('correct');
                fb.className = 'quiz-feedback show correct';
                fb.textContent = '✓ Correct! ' + q.e;
                score++;
            } else {
                opts[ai].classList.add('wrong');
                opts[q.a].classList.add('correct');
                fb.className = 'quiz-feedback show wrong';
                fb.textContent = '✗ ' + q.e;
            }
            Array.from(opts).forEach(o => o.style.pointerEvents = 'none');
            updateScore();
        }

        function updateScore() {
            const total = ans.filter(a => a).length;
            const s = document.getElementById('score');
            if(total === 0) {
                s.textContent = 'Answer questions to see your score!';
            } else if(total === quiz.length) {
                const pct = Math.round((score/quiz.length)*100);
                let msg = pct >= 90 ? 'Excellent!' : pct >= 70 ? 'Great job!' : pct >= 50 ? 'Good effort!' : 'Keep learning!';
                s.textContent = 'Score: ' + score + '/' + quiz.length + ' (' + pct + '%) - ' + msg;
            } else {
                s.textContent = 'Progress: ' + score + '/' + total + ' correct';
            }
        }

        function resetQuiz() {
            ans = [];
            score = 0;
            renderQuiz();
        }

        buildUNC();
        renderQuiz();
    </script>
</body>
</html>