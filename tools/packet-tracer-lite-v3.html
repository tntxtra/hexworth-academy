<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Packet Tracer Lite v3.9 - Interactive Network Lab Library</title>
    <style>
        /* ========== GLOBAL RESET & VARIABLES ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0f172a;
            --bg-panel: #1e293b;
            --bg-card: #334155;
            --accent-cyan: #06b6d4;
            --accent-purple: #9333ea;
            --accent-green: #10b981;
            --accent-orange: #f59e0b;
            --accent-red: #ef4444;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border: #475569;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a2942 100%);
            color: var(--text-primary);
            height: 100vh;
            overflow: auto;
        }

        /* ========== MAIN LAYOUT ========== */
        .app-container {
            display: grid;
            grid-template-rows: auto 1fr auto;
            height: 100vh;
        }

        /* ========== HEADER / TOOLBAR ========== */
        .toolbar {
            background: var(--bg-panel);
            border-bottom: 2px solid var(--border);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .toolbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .app-title {
            font-size: 1.3em;
            font-weight: bold;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .toolbar-right {
            display: flex;
            gap: 10px;
        }

        .btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background: var(--bg-panel);
            border-color: var(--accent-cyan);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-purple), #7c3aed);
            border: none;
            font-weight: bold;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            box-shadow: 0 4px 12px rgba(147, 51, 234, 0.5);
        }

        .btn-icon {
            font-size: 1.2em;
        }

        .btn.delete-mode-active {
            background: linear-gradient(135deg, #ef4444, #dc2626) !important;
            border-color: #ef4444 !important;
            animation: pulse-delete 1.5s infinite;
        }

        @keyframes pulse-delete {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
        }

        .canvas-delete-mode {
            cursor: crosshair !important;
        }

        .canvas-delete-mode line:hover {
            stroke: #ef4444 !important;
            stroke-width: 6px !important;
            filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.8));
        }

        .canvas-delete-mode g:hover circle {
            stroke: #ef4444 !important;
            stroke-width: 4px !important;
            filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.8));
        }

        /* ========== MAIN WORKSPACE ========== */
        .workspace {
            display: grid;
            grid-template-columns: 200px 1fr 320px;
            height: 100%;
            gap: 0;
        }

        /* ========== LEFT PANEL: DEVICE PALETTE ========== */
        .device-palette {
            background: var(--bg-panel);
            border-right: 2px solid var(--border);
            padding: 16px;
            overflow-y: auto;
        }

        .palette-title {
            font-size: 1.1em;
            margin-bottom: 12px;
            color: var(--accent-cyan);
            font-weight: bold;
        }

        .device-item {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: grab;
            transition: all 0.3s ease;
            text-align: center;
        }

        .device-item:hover {
            border-color: var(--accent-cyan);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
        }

        .device-item:active {
            cursor: grabbing;
        }

        .device-icon {
            font-size: 2.5em;
            margin-bottom: 6px;
        }

        .device-name {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        /* ========== CENTER: CANVAS ========== */
        .canvas-container {
            background: radial-gradient(ellipse at top, #1a2942 0%, var(--bg-dark) 60%);
            position: relative;
            overflow: hidden;
        }

        #network-canvas {
            width: 100%;
            height: 100%;
        }

        .canvas-overlay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 41, 59, 0.95);
            border: 2px solid var(--accent-cyan);
            border-radius: 12px;
            padding: 20px 30px;
            text-align: center;
            max-width: 500px;
        }

        .canvas-overlay h2 {
            color: var(--accent-cyan);
            margin-bottom: 10px;
        }

        .canvas-overlay p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* ========== RIGHT PANEL: CONFIGURATION & INSTRUCTIONS ========== */
        .config-panel {
            background: var(--bg-panel);
            border-left: 2px solid var(--border);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .panel-tabs {
            display: flex;
            background: var(--bg-dark);
            border-bottom: 2px solid var(--border);
        }

        .panel-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .panel-tab:hover {
            background: var(--bg-panel);
        }

        .panel-tab.active {
            border-bottom-color: var(--accent-cyan);
            color: var(--accent-cyan);
        }

        .panel-content {
            padding: 16px;
            flex: 1;
            overflow-y: auto;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        /* Instructions Panel */
        .instruction-step {
            background: var(--bg-card);
            border-left: 4px solid var(--accent-purple);
            padding: 14px;
            margin-bottom: 12px;
            border-radius: 8px;
        }

        .instruction-step.completed {
            border-left-color: var(--success);
            opacity: 0.7;
        }

        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .step-number {
            background: var(--accent-purple);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .step-status {
            font-size: 1.2em;
        }

        .step-title {
            font-weight: bold;
            color: var(--accent-cyan);
            margin-bottom: 6px;
        }

        .step-description {
            color: var(--text-secondary);
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .step-commands {
            background: #0f1729;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: var(--success);
            margin-top: 8px;
        }

        .step-commands div {
            margin: 4px 0;
        }

        .step-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8em;
            border-radius: 6px;
        }

        /* Progress Bar */
        .progress-container {
            background: var(--bg-card);
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 8px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-dark);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-cyan));
            transition: width 0.5s ease;
            width: 0%;
        }

        /* ========== FOOTER / STATUS BAR ========== */
        .status-bar {
            background: var(--bg-panel);
            border-top: 2px solid var(--border);
            padding: 8px 20px;
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: var(--text-muted);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }

        /* ========== LAB LIBRARY MODAL ========== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--bg-panel);
            border: 3px solid var(--accent-cyan);
            border-radius: 16px;
            max-width: 900px;
            max-height: 80vh;
            width: 90%;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(6, 182, 212, 0.5);
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.8em;
            font-weight: bold;
            color: white;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 20px 30px;
            overflow-y: auto;
            flex: 1;
        }

        .lab-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover,
        .filter-btn.active {
            border-color: var(--accent-cyan);
            background: rgba(6, 182, 212, 0.1);
            color: var(--accent-cyan);
        }

        .lab-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .lab-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .lab-card:hover {
            border-color: var(--accent-cyan);
            box-shadow: 0 6px 20px rgba(6, 182, 212, 0.3);
            transform: translateY(-2px);
        }

        .lab-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .lab-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .lab-badge.beginner {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .lab-badge.intermediate {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .lab-badge.advanced {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .lab-title {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--accent-cyan);
            margin-bottom: 8px;
        }

        .lab-meta {
            display: flex;
            gap: 16px;
            font-size: 0.85em;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .lab-meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .lab-description {
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .lab-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .lab-tag {
            background: rgba(147, 51, 234, 0.2);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75em;
            color: var(--accent-purple);
        }

        .lab-actions {
            display: flex;
            gap: 10px;
        }

        /* ========== CUMULATIVE LABS SYSTEM ========== */
        .cumulative-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .cumulative-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            display: grid;
            grid-template-columns: 60px 1fr auto;
            gap: 20px;
            align-items: center;
        }

        .cumulative-card:hover {
            border-color: #10b981;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
            transform: translateX(5px);
        }

        .cumulative-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .cumulative-card.locked:hover {
            transform: none;
            box-shadow: none;
            border-color: var(--border);
        }

        .cumulative-num {
            font-size: 2em;
            font-weight: bold;
            color: #10b981;
            text-align: center;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 10px;
            padding: 10px;
        }

        .cumulative-card.locked .cumulative-num {
            color: var(--text-muted);
            background: rgba(255, 255, 255, 0.05);
        }

        .cumulative-info h3 {
            font-size: 1.15em;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .cumulative-info p {
            font-size: 0.9em;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .cumulative-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .cumulative-tag {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 500;
        }

        .cumulative-meta {
            text-align: right;
            color: var(--text-muted);
            font-size: 0.85em;
        }

        .cumulative-meta .time {
            display: block;
            margin-bottom: 4px;
        }

        .cumulative-meta .devices {
            color: var(--text-secondary);
        }

        .cumulative-arrow {
            font-size: 1.5em;
            color: #10b981;
        }

        .cumulative-card.locked .cumulative-arrow {
            color: var(--text-muted);
        }

        /* ========== TROUBLESHOOTING SYSTEM ========== */
        .ts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }

        .ts-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .ts-card:hover {
            border-color: var(--accent-orange);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
            transform: translateY(-2px);
        }

        .ts-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .ts-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .ts-badge.beginner {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .ts-badge.intermediate {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .ts-badge.advanced {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
            border: 1px solid var(--error);
        }

        .ts-status {
            font-size: 1.5em;
        }

        .ts-title {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .ts-meta {
            display: flex;
            gap: 16px;
            margin-bottom: 12px;
            font-size: 0.85em;
            color: var(--text-muted);
        }

        .ts-description {
            color: var(--text-secondary);
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .ts-stats {
            display: flex;
            gap: 12px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
            font-size: 0.85em;
        }

        .ts-stat {
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text-muted);
        }

        /* Troubleshooting Mode UI */
        .ts-mode-active .config-panel {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
        }

        .ts-mode-indicator {
            background: linear-gradient(135deg, var(--accent-orange), #ea580c);
            padding: 12px 20px;
            text-align: center;
            font-weight: bold;
            color: white;
            border-bottom: 2px solid var(--accent-orange);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ts-panel-section {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .ts-panel-section h3 {
            color: var(--accent-orange);
            margin-bottom: 12px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ts-problem-description {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--accent-orange);
            padding: 14px;
            border-radius: 8px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .ts-tools-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }

        .ts-tool-btn {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 10px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
            text-align: left;
        }

        .ts-tool-btn:hover {
            background: var(--bg-card);
            border-color: var(--accent-cyan);
            transform: translateX(4px);
        }

        .ts-hints-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ts-hint-btn {
            background: var(--bg-panel);
            border: 2px solid var(--border);
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ts-hint-btn:not(.locked):hover {
            border-color: var(--accent-purple);
            background: rgba(147, 51, 234, 0.1);
        }

        .ts-hint-btn.locked {
            opacity: 0.5;
            cursor: not-allowed;
            background: var(--bg-dark);
        }

        .ts-hint-btn.used {
            border-color: var(--accent-purple);
            background: rgba(147, 51, 234, 0.15);
        }

        .ts-hint-btn.solution {
            background: linear-gradient(135deg, var(--accent-red), #dc2626);
            border: none;
            color: white;
        }

        .ts-hint-btn.solution:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }

        .ts-hint-content {
            display: none;
            background: rgba(147, 51, 234, 0.1);
            border: 1px solid var(--accent-purple);
            border-radius: 8px;
            padding: 14px;
            margin-top: 10px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .ts-hint-content.visible {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ts-solution-content {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            border-radius: 8px;
            padding: 14px;
            margin-top: 10px;
            display: none;
        }

        .ts-solution-content.visible {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .ts-solution-explanation {
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .ts-solution-commands {
            background: #0f1729;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: var(--success);
            margin-bottom: 12px;
        }

        .ts-solution-commands div {
            margin: 4px 0;
        }

        .ts-solution-why {
            color: var(--text-muted);
            font-size: 0.9em;
            font-style: italic;
        }

        .ts-progress-tracker {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ts-progress-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-panel);
            border-radius: 8px;
            border-left: 4px solid var(--border);
        }

        .ts-progress-item.completed {
            border-left-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .ts-progress-item.in-progress {
            border-left-color: var(--accent-cyan);
            background: rgba(6, 182, 212, 0.1);
        }

        .ts-progress-icon {
            font-size: 1.2em;
        }

        .ts-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 16px;
        }

        .ts-test-btn {
            background: linear-gradient(135deg, var(--accent-green), #059669);
            border: none;
            color: white;
            padding: 14px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .ts-test-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .ts-result {
            padding: 16px;
            border-radius: 8px;
            margin-top: 12px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .ts-result.visible {
            display: block;
        }

        .ts-result.success {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--success);
        }

        .ts-result.partial {
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid var(--warning);
        }

        .ts-result.failed {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid var(--error);
        }

        .ts-result-header {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ts-result-message {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .ts-score {
            background: linear-gradient(135deg, var(--accent-purple), #7c3aed);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 12px;
        }

        .ts-score-number {
            font-size: 3em;
            font-weight: bold;
            color: white;
        }

        .ts-score-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
            margin-top: 8px;
        }

        .ts-skills {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .ts-skills h4 {
            color: var(--accent-cyan);
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .ts-skills-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .ts-skill-tag {
            background: rgba(6, 182, 212, 0.2);
            color: var(--accent-cyan);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75em;
        }

        /* ========== ANIMATIONS ========== */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }

        /* ========== SCROLLBAR STYLING ========== */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-card);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border);
        }

        /* ========== HELP MODAL SYSTEM ========== */
        .help-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            backdrop-filter: blur(4px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .help-modal-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }

        .help-modal {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-width: 900px;
            width: 90%;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            overflow: hidden;
        }

        .help-modal-overlay.active .help-modal {
            transform: scale(1);
        }

        .help-modal-header {
            background: linear-gradient(135deg, #2a5298 0%, #1e3a5f 100%);
            color: white;
            padding: 24px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #1e3a5f;
        }

        .help-modal-title {
            font-size: 1.8em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .help-close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .help-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .help-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            padding: 0 20px;
            gap: 5px;
            overflow-x: auto;
        }

        .help-tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #495057;
            font-weight: 600;
            font-size: 0.95em;
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .help-tab:hover {
            background: rgba(42, 82, 152, 0.1);
            color: #2a5298;
        }

        .help-tab.active {
            color: #2a5298;
            border-bottom-color: #2a5298;
            background: white;
        }

        .help-modal-content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            color: #212529;
            background: white;
        }

        /* Command Reference Popup Styles */
        .cmd-ref-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }
        .cmd-ref-overlay.active {
            display: flex;
        }
        .cmd-ref-popup {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 15px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(0, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
        }
        .cmd-ref-header {
            background: linear-gradient(90deg, #667eea, #764ba2);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .cmd-ref-title {
            color: white;
            font-size: 1.5em;
            font-weight: bold;
        }
        .cmd-ref-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px 12px;
            border-radius: 8px;
            transition: background 0.2s;
        }
        .cmd-ref-close:hover {
            background: rgba(255,255,255,0.3);
        }
        .cmd-ref-search {
            padding: 15px 20px;
            background: rgba(0,0,0,0.3);
        }
        .cmd-ref-search input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(0,255,255,0.3);
            border-radius: 8px;
            background: rgba(0,0,0,0.5);
            color: #0ff;
            font-size: 1em;
            font-family: 'Courier New', monospace;
        }
        .cmd-ref-search input::placeholder {
            color: rgba(0,255,255,0.5);
        }
        .cmd-ref-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        .cmd-category {
            margin-bottom: 25px;
        }
        .cmd-category-title {
            color: #ffd700;
            font-size: 1.2em;
            font-weight: bold;
            padding: 10px 0;
            border-bottom: 2px solid rgba(255,215,0,0.3);
            margin-bottom: 15px;
        }
        .cmd-item {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-left: 4px solid #0ff;
        }
        .cmd-syntax {
            color: #0ff;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .cmd-desc {
            color: #aaa;
            font-size: 0.9em;
            line-height: 1.4;
        }
        .cmd-example {
            margin-top: 8px;
            padding: 8px 12px;
            background: rgba(0,255,0,0.1);
            border-radius: 5px;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
        }
        .cmd-mode {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            margin-left: 10px;
            background: rgba(102,126,234,0.3);
            color: #a0b0ff;
        }
        .cmd-item.hidden {
            display: none;
        }

        .help-section {
            display: none;
        }

        .help-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .help-section h2 {
            color: #2a5298;
            font-size: 1.6em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .help-section h3 {
            color: #495057;
            font-size: 1.3em;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .help-section p {
            line-height: 1.7;
            margin-bottom: 15px;
            color: #495057;
        }

        .help-section ul,
        .help-section ol {
            margin-left: 25px;
            margin-bottom: 20px;
        }

        .help-section li {
            margin-bottom: 10px;
            line-height: 1.6;
            color: #495057;
        }

        .help-search-box {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            margin-bottom: 25px;
            transition: border-color 0.2s ease;
        }

        .help-search-box:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .command-category {
            margin-bottom: 30px;
        }

        .command-category h3 {
            background: linear-gradient(135deg, #2a5298 0%, #1e3a5f 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .command-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            border-left: 4px solid #2a5298;
            transition: all 0.2s ease;
        }

        .command-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .command-syntax {
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            color: #2a5298;
            margin-bottom: 5px;
            font-size: 1.05em;
        }

        .command-description {
            color: #495057;
            margin-left: 20px;
        }

        .help-note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
        }

        .help-tip {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
        }

        .help-warning {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
        }

        .keyboard-shortcut {
            display: inline-block;
            background: #495057;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            margin: 0 4px;
        }

        .no-results {
            text-align: center;
            color: #6c757d;
            padding: 40px;
            font-size: 1.1em;
        }

        .step-number {
            display: inline-block;
            background: #2a5298;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            transition: all 0.2s ease;
        }

        .feature-card:hover {
            border-color: #2a5298;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(42, 82, 152, 0.2);
        }

        .feature-card h4 {
            color: #2a5298;
            margin-bottom: 10px;
        }

        .version-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .help-modal {
                width: 95%;
                max-height: 90vh;
            }

            .help-modal-content {
                padding: 20px;
            }

            .help-tabs {
                padding: 0 10px;
            }

            .help-tab {
                padding: 12px 15px;
                font-size: 0.85em;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- HEADER TOOLBAR -->
        <header class="toolbar">
            <div class="toolbar-left">
                <div class="app-title">üìö Packet Tracer Lite v3.9</div>
                <span style="color: var(--text-muted); font-size: 0.85em;">Interactive Network Lab Library</span>
            </div>
            <div class="toolbar-right">
                <a href="../catalog.html" class="btn" style="text-decoration: none;">
                    <span class="btn-icon">üìÅ</span> Back to Catalog
                </a>
                <button class="btn" id="homeBtn" style="display: none;">
                    <span class="btn-icon">üè†</span> Home
                </button>
                <button class="btn" id="newTopologyBtn">
                    <span class="btn-icon">üìÑ</span> New
                </button>
                <button class="btn" id="connectBtn">
                    <span class="btn-icon">üîó</span> Connect
                </button>
                <button class="btn" id="deleteModeBtn" title="Toggle delete mode - click connections or devices to remove them">
                    <span class="btn-icon">üóëÔ∏è</span> Delete
                </button>
                <select id="connectionColor" style="padding: 8px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 6px; cursor: pointer;">
                    <option value="#06b6d4" style="background: #06b6d4; color: white;">üîµ Cyan (LAN)</option>
                    <option value="#10b981" style="background: #10b981; color: white;">üü¢ Green (Subnet 1)</option>
                    <option value="#f59e0b" style="background: #f59e0b; color: white;">üü† Orange (Subnet 2)</option>
                    <option value="#ef4444" style="background: #ef4444; color: white;">üî¥ Red (WAN)</option>
                    <option value="#9333ea" style="background: #9333ea; color: white;">üü£ Purple (DMZ)</option>
                    <option value="#ec4899" style="background: #ec4899; color: white;">üî¥ Pink (Management)</option>
                    <option value="#6366f1" style="background: #6366f1; color: white;">üîµ Indigo (Backup)</option>
                    <option value="#ffffff" style="background: #ffffff; color: black;">‚ö™ White (Default)</option>
                </select>
                <button class="btn" id="exportBtn">
                    <span class="btn-icon">üíæ</span> Export
                </button>
                <button class="btn" id="importBtn" title="Import a previously exported topology JSON file">
                    <span class="btn-icon">üìÇ</span> Import
                </button>
                <input type="file" id="importFileInput" accept=".json" style="display: none;">
                <button class="btn btn-primary" id="labLibraryBtn">
                    <span class="btn-icon">üìö</span> Lab Library
                </button>
                <button class="btn" id="troubleshootBtn" style="background: linear-gradient(135deg, var(--accent-orange), #ea580c); border: none; font-weight: bold;">
                    <span class="btn-icon">üîß</span> Troubleshoot
                </button>
                <button class="btn" id="cumulativeLabsBtn" style="background: linear-gradient(135deg, #10b981, #059669); border: none; font-weight: bold;">
                    <span class="btn-icon">üèóÔ∏è</span> Cumulative Labs
                </button>
                <button class="btn" id="helpBtn">
                    <span class="btn-icon">‚ùì</span> Help
                </button>
            </div>
        </header>

        <!-- MAIN WORKSPACE -->
        <main class="workspace">
            <!-- LEFT: DEVICE PALETTE -->
            <aside class="device-palette">
                <div class="palette-title">üîß Devices</div>
                <div class="device-item" draggable="true" data-device-type="router">
                    <div class="device-icon" style="color: var(--accent-cyan);">üî∑</div>
                    <div class="device-name">Router</div>
                </div>
                <div class="device-item" draggable="true" data-device-type="l2switch">
                    <div class="device-icon" style="color: var(--accent-purple);">üî∂</div>
                    <div class="device-name">L2 Switch</div>
                </div>
                <div class="device-item" draggable="true" data-device-type="l3switch">
                    <div class="device-icon" style="color: var(--accent-green);">üî∑</div>
                    <div class="device-name">L3 Switch</div>
                </div>
                <div class="device-item" draggable="true" data-device-type="pc">
                    <div class="device-icon" style="color: var(--accent-green);">üíª</div>
                    <div class="device-name">PC</div>
                </div>
                <div class="device-item" draggable="true" data-device-type="server">
                    <div class="device-icon" style="color: var(--accent-orange);">üñ•Ô∏è</div>
                    <div class="device-name">Server</div>
                </div>
            </aside>

            <!-- CENTER: CANVAS -->
            <div class="canvas-container">
                <svg id="network-canvas"></svg>
                <div class="canvas-overlay" id="welcomeMessage">
                    <h2>Welcome to Packet Tracer Lite v3.9!</h2>
                    <p>üéØ Click <strong>Lab Library</strong> to load a pre-built scenario</p>
                    <p>üñ±Ô∏è Or drag devices from the left panel to build your own network</p>
                    <p>üìñ Follow step-by-step instructions on the right panel</p>
                </div>
            </div>

            <!-- RIGHT: CONFIG PANEL -->
            <aside class="config-panel">
                <div class="panel-tabs">
                    <div class="panel-tab active" data-tab="instructions">üìù Instructions</div>
                    <div class="panel-tab" data-tab="config">‚öôÔ∏è Config</div>
                    <div class="panel-tab" data-tab="cli">üíª CLI</div>
                </div>
                <div class="panel-content">
                    <!-- INSTRUCTIONS TAB -->
                    <div id="instructionsTab" class="tab-pane active">
                        <div class="progress-container">
                            <div class="progress-header">
                                <span><strong>Lab Progress</strong></span>
                                <span id="progressPercent">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                        </div>
                        <div id="instructionsList">
                            <p style="color: var(--text-muted); text-align: center; padding: 40px 20px;">
                                Load a lab from the <strong>Lab Library</strong> to see step-by-step instructions here!
                            </p>
                        </div>
                    </div>

                    <!-- CONFIG TAB -->
                    <div id="configTab" class="tab-pane">
                        <div id="configContent">
                            <div class="config-header" style="padding: 15px; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 15px;">
                                <h3 style="color: var(--accent-cyan); margin-bottom: 10px;">Device Configuration</h3>
                                <p id="selectedDeviceInfo" style="color: var(--text-muted); font-size: 0.9em;">
                                    Click a device on the canvas to configure it
                                </p>
                            </div>

                            <div id="deviceConfigForm" style="display: none;">
                                <div class="config-group" style="margin-bottom: 20px;">
                                    <label style="display: block; color: var(--text-secondary); margin-bottom: 8px; font-weight: bold;">Device Name</label>
                                    <input type="text" id="deviceNameInput" class="config-input" style="width: 100%; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-family: 'Courier New', monospace;">
                                </div>

                                <div class="config-group" style="margin-bottom: 20px;">
                                    <label style="display: block; color: var(--text-secondary); margin-bottom: 8px; font-weight: bold;">Interface</label>
                                    <select id="interfaceSelect" style="width: 100%; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-family: 'Courier New', monospace; cursor: pointer;">
                                        <!-- Options populated dynamically -->
                                    </select>
                                </div>

                                <div id="interfaceConfig">
                                    <div class="config-group" style="margin-bottom: 20px;">
                                        <label style="display: block; color: var(--text-secondary); margin-bottom: 8px; font-weight: bold;">IP Address</label>
                                        <input type="text" id="deviceIpInput" class="config-input" placeholder="192.168.1.1" style="width: 100%; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-family: 'Courier New', monospace;">
                                    </div>

                                    <div class="config-group" style="margin-bottom: 20px;">
                                        <label style="display: block; color: var(--text-secondary); margin-bottom: 8px; font-weight: bold;">Subnet Mask</label>
                                        <input type="text" id="deviceMaskInput" class="config-input" placeholder="255.255.255.0" style="width: 100%; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-family: 'Courier New', monospace;">
                                    </div>

                                    <div class="config-group" id="gatewayGroup" style="margin-bottom: 20px; display: none;">
                                        <label style="display: block; color: var(--text-secondary); margin-bottom: 8px; font-weight: bold;">Default Gateway</label>
                                        <input type="text" id="deviceGatewayInput" class="config-input" placeholder="192.168.1.254" style="width: 100%; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-family: 'Courier New', monospace;">
                                    </div>

                                    <div class="config-group" id="dhcpClientGroup" style="margin-bottom: 20px; display: none;">
                                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                            <input type="checkbox" id="dhcpClientCheckbox" style="width: 20px; height: 20px; cursor: pointer;">
                                            <span style="color: var(--text-secondary); font-weight: bold;">üîÑ Enable DHCP Client (Auto-configure IP)</span>
                                        </label>
                                        <button id="requestDhcpBtn" class="btn" style="width: 100%; margin-top: 10px; background: var(--accent-cyan); color: white; display: none;">
                                            Request IP from DHCP Server
                                        </button>
                                    </div>

                                    <div class="config-group" style="margin-bottom: 20px;">
                                        <label style="display: block; color: var(--text-secondary); margin-bottom: 8px; font-weight: bold;">Status</label>
                                        <select id="interfaceStatus" style="width: 100%; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-family: 'Courier New', monospace;">
                                            <option value="up">Up (no shutdown)</option>
                                            <option value="down">Down (shutdown)</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- DHCP SERVER CONFIGURATION (for server devices only) -->
                                <div id="dhcpServerConfig" style="display: none; margin-bottom: 20px; padding: 15px; background: var(--bg-secondary); border-radius: 8px; border: 2px solid var(--accent-purple);">
                                    <h4 style="color: var(--accent-purple); margin-bottom: 15px;">üåê DHCP Server Configuration</h4>

                                    <div class="config-group" style="margin-bottom: 15px;">
                                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                            <input type="checkbox" id="dhcpServerEnabled" style="width: 20px; height: 20px; cursor: pointer;">
                                            <span style="color: var(--text-secondary); font-weight: bold;">Enable DHCP Server</span>
                                        </label>
                                    </div>

                                    <div id="dhcpPoolConfig" style="display: none;">
                                        <div class="config-group" style="margin-bottom: 10px;">
                                            <label style="display: block; color: var(--text-secondary); margin-bottom: 5px; font-size: 0.9em;">Pool Name</label>
                                            <input type="text" id="dhcpPoolName" placeholder="default" style="width: 100%; padding: 8px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: 'Courier New', monospace; font-size: 0.85em;">
                                        </div>

                                        <div class="config-group" style="margin-bottom: 10px;">
                                            <label style="display: block; color: var(--text-secondary); margin-bottom: 5px; font-size: 0.9em;">Network</label>
                                            <input type="text" id="dhcpNetwork" placeholder="192.168.1.0" style="width: 100%; padding: 8px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: 'Courier New', monospace; font-size: 0.85em;">
                                        </div>

                                        <div class="config-group" style="margin-bottom: 10px;">
                                            <label style="display: block; color: var(--text-secondary); margin-bottom: 5px; font-size: 0.9em;">Subnet Mask</label>
                                            <input type="text" id="dhcpSubnetMask" placeholder="255.255.255.0" style="width: 100%; padding: 8px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: 'Courier New', monospace; font-size: 0.85em;">
                                        </div>

                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                            <div class="config-group">
                                                <label style="display: block; color: var(--text-secondary); margin-bottom: 5px; font-size: 0.9em;">Start IP</label>
                                                <input type="text" id="dhcpStartIp" placeholder="192.168.1.10" style="width: 100%; padding: 8px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: 'Courier New', monospace; font-size: 0.85em;">
                                            </div>
                                            <div class="config-group">
                                                <label style="display: block; color: var(--text-secondary); margin-bottom: 5px; font-size: 0.9em;">End IP</label>
                                                <input type="text" id="dhcpEndIp" placeholder="192.168.1.100" style="width: 100%; padding: 8px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: 'Courier New', monospace; font-size: 0.85em;">
                                            </div>
                                        </div>

                                        <div class="config-group" style="margin-bottom: 10px;">
                                            <label style="display: block; color: var(--text-secondary); margin-bottom: 5px; font-size: 0.9em;">Default Gateway</label>
                                            <input type="text" id="dhcpGateway" placeholder="192.168.1.1" style="width: 100%; padding: 8px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: 'Courier New', monospace; font-size: 0.85em;">
                                        </div>

                                        <div class="config-group" style="margin-bottom: 10px;">
                                            <label style="display: block; color: var(--text-secondary); margin-bottom: 5px; font-size: 0.9em;">DNS Server</label>
                                            <input type="text" id="dhcpDns" placeholder="8.8.8.8" style="width: 100%; padding: 8px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: 'Courier New', monospace; font-size: 0.85em;">
                                        </div>

                                        <button id="applyDhcpServerBtn" class="btn" style="width: 100%; margin-top: 10px; background: var(--accent-purple); color: white; font-size: 0.9em;">
                                            Apply DHCP Server Config
                                        </button>

                                        <div id="dhcpLeaseInfo" style="margin-top: 15px; padding: 10px; background: var(--bg-card); border-radius: 6px; font-size: 0.85em;">
                                            <strong style="color: var(--accent-green);">Active Leases:</strong>
                                            <div id="dhcpLeaseList" style="color: var(--text-muted); margin-top: 5px;">No active leases</div>
                                        </div>
                                    </div>
                                </div>

                                <button id="applyConfigBtn" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                                    Apply Configuration
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- CLI TAB -->
                    <div id="cliTab" class="tab-pane">
                        <div class="cli-header" style="padding: 15px; background: var(--bg-secondary); border-radius: 8px; margin-bottom: 15px;">
                            <h3 style="color: var(--accent-cyan); margin-bottom: 10px;">Command Line Interface</h3>
                            <p id="cliDeviceInfo" style="color: var(--text-muted); font-size: 0.9em;">
                                Click a device on the canvas to access its CLI
                            </p>
                        </div>

                        <div id="cliInterface" style="display: none;">
                            <div id="cliOutput" style="background: #000; color: #0f0; padding: 15px; border-radius: 6px; height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.9em; margin-bottom: 10px; border: 2px solid var(--accent-cyan);">
                                <div>Cisco IOS Software, Lite Version 3.9</div>
                                <div>Type 'help' for available commands</div>
                                <div style="margin-top: 10px;">Ready.</div>
                            </div>

                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span id="cliPrompt" style="color: var(--accent-cyan); font-family: 'Courier New', monospace; font-weight: bold;">Router&gt;</span>
                                <input type="text" id="cliInput" placeholder="Enter command..." style="flex: 1; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; color: var(--text-primary); font-family: 'Courier New', monospace;">
                                <button id="cmdRefBtn" onclick="openCommandReference()" title="Command Reference" style="padding: 8px 12px; background: var(--accent-purple); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">üìñ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>

        <!-- FOOTER STATUS BAR -->
        <footer class="status-bar">
            <div class="status-item">
                <span class="status-dot"></span>
                <span>Ready</span>
            </div>
            <div class="status-item">
                <span>Mode: <strong id="currentMode">Design</strong></span>
            </div>
            <div class="status-item">
                <span>Lab: <strong id="currentLab">None</strong></span>
            </div>
            <div class="status-item">
                <span>Prepared by: EQ6</span>
            </div>
        </footer>
    </div>

    <!-- LAB LIBRARY MODAL -->
    <div class="modal-overlay" id="labLibraryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üìö Lab Library - Choose Your Learning Path</h2>
                <button class="modal-close" id="closeLabLibrary">&times;</button>
            </div>
            <div class="modal-body">
                <div class="lab-filters">
                    <button class="filter-btn active" data-filter="all">All Labs</button>
                    <button class="filter-btn" data-filter="beginner">üî∞ Beginner</button>
                    <button class="filter-btn" data-filter="intermediate">üéì Intermediate</button>
                    <button class="filter-btn" data-filter="advanced">üèÜ Advanced</button>
                </div>
                <div class="lab-grid" id="labGrid">
                    <!-- Labs will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- TROUBLESHOOTING MODAL -->
    <div class="modal-overlay" id="troubleshootModal">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, var(--accent-orange), #ea580c);">
                <h2 class="modal-title">üîß Troubleshooting Scenarios - Fix Broken Networks</h2>
                <button class="modal-close" id="closeTroubleshoot">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 1.2em; color: var(--text-secondary);">
                        <strong id="tsCompletionCount">0/10</strong> scenarios completed
                    </div>
                </div>
                <div class="lab-filters" id="tsFilters">
                    <button class="filter-btn active" data-filter="all">All Scenarios</button>
                    <button class="filter-btn" data-filter="beginner">üî∞ Beginner</button>
                    <button class="filter-btn" data-filter="intermediate">üéì Intermediate</button>
                    <button class="filter-btn" data-filter="advanced">üèÜ Advanced</button>
                </div>
                <div class="ts-grid" id="tsGrid">
                    <!-- Scenarios will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- CUMULATIVE LABS MODAL -->
    <div class="modal-overlay" id="cumulativeLabsModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header" style="background: linear-gradient(135deg, #10b981, #059669);">
                <h2 class="modal-title">üèóÔ∏è Cumulative Lab Series - Build an Enterprise Network</h2>
                <button class="modal-close" id="closeCumulativeLabs">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 10px; border: 1px solid rgba(16, 185, 129, 0.3);">
                    <p style="color: var(--text-secondary); margin-bottom: 10px;">
                        <strong style="color: #10b981;">Progressive Learning:</strong> Each lab builds on the previous one!
                    </p>
                    <p style="color: var(--text-muted); font-size: 0.9em;">
                        Start with Lab 1 and work your way up. By Lab 6, you'll have a complete enterprise network.
                    </p>
                    <div style="margin-top: 12px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button id="unlockAllLabsBtn" style="padding: 6px 12px; font-size: 0.75em; background: rgba(139, 92, 246, 0.2); border: 1px solid rgba(139, 92, 246, 0.5); color: #a78bfa; border-radius: 5px; cursor: pointer;" title="Unlock all labs for testing (Ctrl+Shift+U)">
                            üîì Unlock All
                        </button>
                        <button id="resetLabProgressBtn" style="padding: 6px 12px; font-size: 0.75em; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); color: #f87171; border-radius: 5px; cursor: pointer;" title="Reset all progress and lock labs">
                            üîÑ Reset Progress
                        </button>
                    </div>
                </div>
                <div class="cumulative-grid" id="cumulativeLabsGrid">
                    <!-- Labs will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- TROUBLESHOOTING MODE PANEL (Hidden by default, shown when scenario loaded) -->
    <div id="troubleshootingPanel" style="display: none;">
        <div class="ts-mode-indicator">
            <span>üîß TROUBLESHOOTING MODE</span>
            <button class="btn btn-small" id="exitTroubleshootingBtn" style="background: rgba(255,255,255,0.2); border: none; color: white;">Exit</button>
        </div>

        <div class="panel-content">
            <!-- Problem Description -->
            <div class="ts-panel-section">
                <h3>üìã Problem Description</h3>
                <div class="ts-problem-description" id="tsProblemDescription">
                    <!-- Populated dynamically -->
                </div>
            </div>

            <!-- Diagnostic Tools -->
            <div class="ts-panel-section">
                <h3>üõ†Ô∏è Diagnostic Tools</h3>
                <div class="ts-tools-grid" id="tsToolsGrid">
                    <button class="ts-tool-btn" onclick="simulateCommand('show vlan brief')">show vlan brief</button>
                    <button class="ts-tool-btn" onclick="simulateCommand('show interfaces status')">show interfaces status</button>
                    <button class="ts-tool-btn" onclick="simulateCommand('show ip interface brief')">show ip interface brief</button>
                    <button class="ts-tool-btn" onclick="simulateCommand('show running-config')">show running-config</button>
                    <button class="ts-tool-btn" onclick="simulateCommand('ping [destination]')">ping [destination]</button>
                    <button class="ts-tool-btn" onclick="simulateCommand('show ip route')">show ip route</button>
                </div>
            </div>

            <!-- Progress Tracker -->
            <div class="ts-panel-section">
                <h3>üìä Progress Tracker</h3>
                <div class="ts-progress-tracker">
                    <div class="ts-progress-item completed">
                        <span class="ts-progress-icon">‚úÖ</span>
                        <span>Identified symptom</span>
                    </div>
                    <div class="ts-progress-item" id="tsProgressDiagnose">
                        <span class="ts-progress-icon">‚è≥</span>
                        <span>Diagnosing root cause</span>
                    </div>
                    <div class="ts-progress-item" id="tsProgressFix">
                        <span class="ts-progress-icon">‚¨ú</span>
                        <span>Applied fix</span>
                    </div>
                    <div class="ts-progress-item" id="tsProgressVerify">
                        <span class="ts-progress-icon">‚¨ú</span>
                        <span>Verified solution</span>
                    </div>
                </div>
            </div>

            <!-- Progressive Hints -->
            <div class="ts-panel-section">
                <h3>üí° Progressive Hints</h3>
                <div class="ts-hints-container">
                    <div>
                        <button class="ts-hint-btn" id="hint1Btn" onclick="revealHint(1)">
                            <span>üîç Hint 1: General Guidance</span>
                            <span>‚ñº</span>
                        </button>
                        <div class="ts-hint-content" id="hint1Content"></div>
                    </div>
                    <div>
                        <button class="ts-hint-btn locked" id="hint2Btn" onclick="revealHint(2)">
                            <span>üîç Hint 2: Specific Location</span>
                            <span>üîí</span>
                        </button>
                        <div class="ts-hint-content" id="hint2Content"></div>
                    </div>
                    <div>
                        <button class="ts-hint-btn locked" id="hint3Btn" onclick="revealHint(3)">
                            <span>üîç Hint 3: Exact Problem</span>
                            <span>üîí</span>
                        </button>
                        <div class="ts-hint-content" id="hint3Content"></div>
                    </div>
                    <div>
                        <button class="ts-hint-btn solution" id="solutionBtn" onclick="revealSolution()">
                            <span>‚ö†Ô∏è Show Complete Solution</span>
                            <span>‚ö†Ô∏è</span>
                        </button>
                        <div class="ts-solution-content" id="solutionContent"></div>
                    </div>
                </div>
            </div>

            <!-- Actions and Results -->
            <div class="ts-actions">
                <button class="ts-test-btn" id="testFixBtn" onclick="testFix()">
                    üß™ Test Fix
                </button>
                <button class="btn" onclick="resetScenario()">
                    üîÑ Reset Scenario
                </button>
            </div>

            <div id="tsResultContainer"></div>
        </div>
    </div>

    <!-- COMMAND REFERENCE POPUP -->
    <div class="cmd-ref-overlay" id="cmdRefPopup">
        <div class="cmd-ref-popup">
            <div class="cmd-ref-header">
                <div class="cmd-ref-title">üìñ CLI Command Reference - Packet Tracer Lite v3.9</div>
                <button class="cmd-ref-close" onclick="closeCommandReference()">‚úï</button>
            </div>
            <div class="cmd-ref-search">
                <input type="text" id="cmdRefSearch" placeholder="üîç Search commands (e.g., 'vlan', 'ospf', 'show')..." oninput="filterCommands()">
            </div>
            <div class="cmd-ref-body" id="cmdRefBody">
                <!-- Mode Navigation Commands -->
                <div class="cmd-category">
                    <div class="cmd-category-title">üîê Mode Navigation</div>
                    <div class="cmd-item" data-keywords="enable en privileged exec">
                        <div class="cmd-syntax">enable <span class="cmd-mode">User Mode</span></div>
                        <div class="cmd-desc">Enter privileged EXEC mode. Shortcut: <code>en</code></div>
                    </div>
                    <div class="cmd-item" data-keywords="configure terminal conf t config global">
                        <div class="cmd-syntax">configure terminal <span class="cmd-mode">Privileged</span></div>
                        <div class="cmd-desc">Enter global configuration mode. Shortcut: <code>conf t</code></div>
                    </div>
                    <div class="cmd-item" data-keywords="exit back previous">
                        <div class="cmd-syntax">exit <span class="cmd-mode">Any Mode</span></div>
                        <div class="cmd-desc">Return to the previous mode level</div>
                    </div>
                    <div class="cmd-item" data-keywords="end privileged return">
                        <div class="cmd-syntax">end <span class="cmd-mode">Config Modes</span></div>
                        <div class="cmd-desc">Return directly to privileged EXEC mode from any config mode</div>
                    </div>
                </div>

                <!-- Interface Configuration -->
                <div class="cmd-category">
                    <div class="cmd-category-title">üîå Interface Configuration</div>
                    <div class="cmd-item" data-keywords="interface int gi fa eth vlan port">
                        <div class="cmd-syntax">interface [name] <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Enter interface configuration mode</div>
                        <div class="cmd-example">Example: int Gi0/0, int Fa0/1, int vlan 10</div>
                    </div>
                    <div class="cmd-item" data-keywords="interface range int range multiple ports">
                        <div class="cmd-syntax">interface range [ports] <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Configure multiple interfaces at once</div>
                        <div class="cmd-example">Example: int range Fa0/1-24</div>
                    </div>
                    <div class="cmd-item" data-keywords="ip address configure ipv4 subnet mask">
                        <div class="cmd-syntax">ip address [ip] [mask] <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Assign IPv4 address to the interface</div>
                        <div class="cmd-example">Example: ip address 192.168.1.1 255.255.255.0</div>
                    </div>
                    <div class="cmd-item" data-keywords="no shutdown enable activate up">
                        <div class="cmd-syntax">no shutdown <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Enable the interface (bring it up). Shortcut: <code>no shut</code></div>
                    </div>
                    <div class="cmd-item" data-keywords="shutdown disable down">
                        <div class="cmd-syntax">shutdown <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Disable the interface (bring it down)</div>
                    </div>
                    <div class="cmd-item" data-keywords="loopback virtual testing">
                        <div class="cmd-syntax">interface loopback [number] <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Create a virtual loopback interface (for testing/router-id)</div>
                        <div class="cmd-example">Example: int loopback 0</div>
                    </div>
                </div>

                <!-- Switching Commands -->
                <div class="cmd-category">
                    <div class="cmd-category-title">üîÄ Switching / VLANs</div>
                    <div class="cmd-item" data-keywords="vlan create id number">
                        <div class="cmd-syntax">vlan [id] <span class="cmd-mode">Config/Privileged</span></div>
                        <div class="cmd-desc">Create a VLAN and enter VLAN configuration mode</div>
                        <div class="cmd-example">Example: vlan 10</div>
                    </div>
                    <div class="cmd-item" data-keywords="name vlan label description">
                        <div class="cmd-syntax">name [vlan-name] <span class="cmd-mode">VLAN Config</span></div>
                        <div class="cmd-desc">Assign a name to the current VLAN</div>
                        <div class="cmd-example">Example: name Sales</div>
                    </div>
                    <div class="cmd-item" data-keywords="switchport mode access port type">
                        <div class="cmd-syntax">switchport mode access <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Set port to access mode (single VLAN)</div>
                    </div>
                    <div class="cmd-item" data-keywords="switchport mode trunk tagging 802.1q">
                        <div class="cmd-syntax">switchport mode trunk <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Set port to trunk mode (carry multiple VLANs)</div>
                    </div>
                    <div class="cmd-item" data-keywords="switchport access vlan assign port">
                        <div class="cmd-syntax">switchport access vlan [id] <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Assign port to a specific VLAN</div>
                        <div class="cmd-example">Example: switchport access vlan 10</div>
                    </div>
                    <div class="cmd-item" data-keywords="switchport trunk native vlan untagged">
                        <div class="cmd-syntax">switchport trunk native vlan [id] <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Set the native (untagged) VLAN for trunk</div>
                    </div>
                    <div class="cmd-item" data-keywords="no switchport routed layer3 l3">
                        <div class="cmd-syntax">no switchport <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Convert switch port to routed (Layer 3) port</div>
                    </div>
                </div>

                <!-- Spanning Tree -->
                <div class="cmd-category">
                    <div class="cmd-category-title">üå≥ Spanning Tree Protocol</div>
                    <div class="cmd-item" data-keywords="spanning-tree mode rapid pvst rstp">
                        <div class="cmd-syntax">spanning-tree mode rapid-pvst <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Enable Rapid PVST+ spanning tree protocol</div>
                    </div>
                    <div class="cmd-item" data-keywords="spanning-tree root primary bridge priority">
                        <div class="cmd-syntax">spanning-tree vlan [id] root primary <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Make this switch the root bridge for specified VLAN</div>
                    </div>
                    <div class="cmd-item" data-keywords="spanning-tree root secondary backup">
                        <div class="cmd-syntax">spanning-tree vlan [id] root secondary <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Make this switch the backup root bridge</div>
                    </div>
                    <div class="cmd-item" data-keywords="spanning-tree portfast edge fast">
                        <div class="cmd-syntax">spanning-tree portfast <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Enable PortFast on access ports (skip listening/learning)</div>
                    </div>
                    <div class="cmd-item" data-keywords="spanning-tree bpduguard security protect">
                        <div class="cmd-syntax">spanning-tree bpduguard enable <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Shut down port if it receives a BPDU</div>
                    </div>
                </div>

                <!-- Routing Commands -->
                <div class="cmd-category">
                    <div class="cmd-category-title">üõ£Ô∏è Routing</div>
                    <div class="cmd-item" data-keywords="ip route static default gateway next-hop">
                        <div class="cmd-syntax">ip route [network] [mask] [next-hop] <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Configure a static route</div>
                        <div class="cmd-example">Example: ip route 0.0.0.0 0.0.0.0 192.168.1.254</div>
                    </div>
                    <div class="cmd-item" data-keywords="router ospf process dynamic link-state">
                        <div class="cmd-syntax">router ospf [process-id] <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Enable OSPF and enter router configuration mode</div>
                        <div class="cmd-example">Example: router ospf 1</div>
                    </div>
                    <div class="cmd-item" data-keywords="router eigrp as autonomous system">
                        <div class="cmd-syntax">router eigrp [as-number] <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Enable EIGRP and enter router configuration mode</div>
                        <div class="cmd-example">Example: router eigrp 100</div>
                    </div>
                    <div class="cmd-item" data-keywords="network advertise area wildcard">
                        <div class="cmd-syntax">network [ip] [wildcard] area [id] <span class="cmd-mode">Router-OSPF</span></div>
                        <div class="cmd-desc">Advertise a network in OSPF</div>
                        <div class="cmd-example">Example: network 192.168.1.0 0.0.0.255 area 0</div>
                    </div>
                    <div class="cmd-item" data-keywords="network eigrp advertise wildcard">
                        <div class="cmd-syntax">network [ip] [wildcard] <span class="cmd-mode">Router-EIGRP</span></div>
                        <div class="cmd-desc">Advertise a network in EIGRP</div>
                        <div class="cmd-example">Example: network 10.0.0.0 0.255.255.255</div>
                    </div>
                    <div class="cmd-item" data-keywords="router-id ospf rid loopback">
                        <div class="cmd-syntax">router-id [ip] <span class="cmd-mode">Router</span></div>
                        <div class="cmd-desc">Manually set the OSPF/EIGRP router ID</div>
                    </div>
                    <div class="cmd-item" data-keywords="passive-interface silent suppress">
                        <div class="cmd-syntax">passive-interface [name] <span class="cmd-mode">Router</span></div>
                        <div class="cmd-desc">Suppress routing updates on an interface</div>
                    </div>
                    <div class="cmd-item" data-keywords="no auto-summary classful eigrp">
                        <div class="cmd-syntax">no auto-summary <span class="cmd-mode">Router-EIGRP</span></div>
                        <div class="cmd-desc">Disable automatic route summarization</div>
                    </div>
                    <div class="cmd-item" data-keywords="redistribute import routes protocol">
                        <div class="cmd-syntax">redistribute [protocol] <span class="cmd-mode">Router</span></div>
                        <div class="cmd-desc">Import routes from another routing protocol</div>
                    </div>
                </div>

                <!-- HSRP -->
                <div class="cmd-category">
                    <div class="cmd-category-title">üîÑ HSRP (First Hop Redundancy)</div>
                    <div class="cmd-item" data-keywords="standby hsrp virtual ip vip gateway">
                        <div class="cmd-syntax">standby [group] ip [vip] <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Configure HSRP virtual IP address</div>
                        <div class="cmd-example">Example: standby 1 ip 192.168.1.1</div>
                    </div>
                    <div class="cmd-item" data-keywords="standby hsrp priority active master">
                        <div class="cmd-syntax">standby [group] priority [value] <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Set HSRP priority (higher = preferred active)</div>
                    </div>
                    <div class="cmd-item" data-keywords="standby hsrp preempt takeover">
                        <div class="cmd-syntax">standby [group] preempt <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Allow this router to take over as active when it has higher priority</div>
                    </div>
                </div>

                <!-- Access Control Lists -->
                <div class="cmd-category">
                    <div class="cmd-category-title">üõ°Ô∏è Access Control Lists (ACLs)</div>
                    <div class="cmd-item" data-keywords="ip access-list extended named acl security">
                        <div class="cmd-syntax">ip access-list extended [name] <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Create a named extended ACL</div>
                        <div class="cmd-example">Example: ip access-list extended BLOCK_TELNET</div>
                    </div>
                    <div class="cmd-item" data-keywords="permit allow acl rule">
                        <div class="cmd-syntax">permit [protocol] [source] [dest] <span class="cmd-mode">ACL Config</span></div>
                        <div class="cmd-desc">Allow matching traffic</div>
                        <div class="cmd-example">Example: permit tcp any any eq 80</div>
                    </div>
                    <div class="cmd-item" data-keywords="deny block acl rule drop">
                        <div class="cmd-syntax">deny [protocol] [source] [dest] <span class="cmd-mode">ACL Config</span></div>
                        <div class="cmd-desc">Block matching traffic</div>
                        <div class="cmd-example">Example: deny tcp any any eq 23</div>
                    </div>
                    <div class="cmd-item" data-keywords="ip access-group apply acl interface in out">
                        <div class="cmd-syntax">ip access-group [name] [in|out] <span class="cmd-mode">Interface</span></div>
                        <div class="cmd-desc">Apply ACL to interface</div>
                        <div class="cmd-example">Example: ip access-group BLOCK_TELNET in</div>
                    </div>
                </div>

                <!-- DHCP -->
                <div class="cmd-category">
                    <div class="cmd-category-title">üìã DHCP Configuration</div>
                    <div class="cmd-item" data-keywords="ip dhcp pool server create">
                        <div class="cmd-syntax">ip dhcp pool [name] <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Create a DHCP address pool</div>
                    </div>
                    <div class="cmd-item" data-keywords="ip dhcp excluded-address reserve">
                        <div class="cmd-syntax">ip dhcp excluded-address [start] [end] <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Exclude addresses from DHCP pool</div>
                    </div>
                    <div class="cmd-item" data-keywords="default-router gateway dhcp option">
                        <div class="cmd-syntax">default-router [ip] <span class="cmd-mode">DHCP Pool</span></div>
                        <div class="cmd-desc">Set default gateway for DHCP clients</div>
                    </div>
                    <div class="cmd-item" data-keywords="dns-server dhcp option nameserver">
                        <div class="cmd-syntax">dns-server [ip] <span class="cmd-mode">DHCP Pool</span></div>
                        <div class="cmd-desc">Set DNS server for DHCP clients</div>
                    </div>
                </div>

                <!-- Device Management -->
                <div class="cmd-category">
                    <div class="cmd-category-title">‚öôÔ∏è Device Management</div>
                    <div class="cmd-item" data-keywords="hostname name device label">
                        <div class="cmd-syntax">hostname [name] <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Set the device hostname</div>
                        <div class="cmd-example">Example: hostname CoreRouter</div>
                    </div>
                    <div class="cmd-item" data-keywords="ping icmp test connectivity reachability">
                        <div class="cmd-syntax">ping [ip] <span class="cmd-mode">Any Mode</span></div>
                        <div class="cmd-desc">Test connectivity to a destination</div>
                        <div class="cmd-example">Example: ping 192.168.1.1</div>
                    </div>
                    <div class="cmd-item" data-keywords="clear screen reset output">
                        <div class="cmd-syntax">clear <span class="cmd-mode">Any Mode</span></div>
                        <div class="cmd-desc">Clear the CLI output screen</div>
                    </div>
                    <div class="cmd-item" data-keywords="snmp-server monitoring management trap">
                        <div class="cmd-syntax">snmp-server [options] <span class="cmd-mode">Config</span></div>
                        <div class="cmd-desc">Configure SNMP for network management</div>
                    </div>
                </div>

                <!-- Show Commands -->
                <div class="cmd-category">
                    <div class="cmd-category-title">üëÅÔ∏è Show Commands (Verification)</div>
                    <div class="cmd-item" data-keywords="show ip interface brief status summary">
                        <div class="cmd-syntax">show ip interface brief <span class="cmd-mode">Privileged</span></div>
                        <div class="cmd-desc">Display summary of all interfaces with IP and status</div>
                    </div>
                    <div class="cmd-item" data-keywords="show running-config run configuration">
                        <div class="cmd-syntax">show running-config <span class="cmd-mode">Privileged</span></div>
                        <div class="cmd-desc">Display the current configuration. Shortcut: <code>show run</code></div>
                    </div>
                    <div class="cmd-item" data-keywords="show vlan brief list all vlans">
                        <div class="cmd-syntax">show vlan brief <span class="cmd-mode">Privileged</span></div>
                        <div class="cmd-desc">Display all VLANs and their status</div>
                    </div>
                    <div class="cmd-item" data-keywords="show interfaces trunk trunking">
                        <div class="cmd-syntax">show interfaces trunk <span class="cmd-mode">Privileged</span></div>
                        <div class="cmd-desc">Display trunk port information</div>
                    </div>
                    <div class="cmd-item" data-keywords="show ip route routing table">
                        <div class="cmd-syntax">show ip route <span class="cmd-mode">Privileged</span></div>
                        <div class="cmd-desc">Display the IP routing table</div>
                    </div>
                    <div class="cmd-item" data-keywords="show spanning-tree stp bridge root">
                        <div class="cmd-syntax">show spanning-tree <span class="cmd-mode">Privileged</span></div>
                        <div class="cmd-desc">Display spanning tree protocol status</div>
                    </div>
                    <div class="cmd-item" data-keywords="show ip ospf neighbor adjacency">
                        <div class="cmd-syntax">show ip ospf neighbor <span class="cmd-mode">Privileged</span></div>
                        <div class="cmd-desc">Display OSPF neighbor relationships</div>
                    </div>
                    <div class="cmd-item" data-keywords="show ip eigrp neighbors adjacency">
                        <div class="cmd-syntax">show ip eigrp neighbors <span class="cmd-mode">Privileged</span></div>
                        <div class="cmd-desc">Display EIGRP neighbor relationships</div>
                    </div>
                    <div class="cmd-item" data-keywords="show standby hsrp status">
                        <div class="cmd-syntax">show standby <span class="cmd-mode">Privileged</span></div>
                        <div class="cmd-desc">Display HSRP status and configuration</div>
                    </div>
                    <div class="cmd-item" data-keywords="show access-lists acl rules">
                        <div class="cmd-syntax">show access-lists <span class="cmd-mode">Privileged</span></div>
                        <div class="cmd-desc">Display all configured ACLs</div>
                    </div>
                    <div class="cmd-item" data-keywords="help question mark available commands">
                        <div class="cmd-syntax">help or ? <span class="cmd-mode">Any Mode</span></div>
                        <div class="cmd-desc">Display quick help with available commands</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- HELP MODAL -->
    <div class="help-modal-overlay" id="helpModal">
        <div class="help-modal">
            <div class="help-modal-header">
                <div class="help-modal-title">
                    <span>üìñ</span>
                    <span>Help & Documentation</span>
                </div>
                <button class="help-close-btn" id="helpCloseBtn" aria-label="Close help">‚úï</button>
            </div>

            <div class="help-tabs">
                <button class="help-tab active" data-tab="quickstart">üöÄ Quick Start</button>
                <button class="help-tab" data-tab="controls">üéÆ Lab Controls</button>
                <button class="help-tab" data-tab="export-import">üíæ Export/Import</button>
                <button class="help-tab" data-tab="commands">üíª CLI Commands</button>
                <button class="help-tab" data-tab="shortcuts">‚å®Ô∏è Shortcuts</button>
                <button class="help-tab" data-tab="troubleshooting">üîß Troubleshooting</button>
                <button class="help-tab" data-tab="tips">üí° Tips</button>
                <button class="help-tab" data-tab="about">‚ÑπÔ∏è About</button>
            </div>

            <div class="help-modal-content">
                <!-- QUICK START SECTION -->
                <div class="help-section active" id="quickstart">
                    <h2>üöÄ Quick Start Guide</h2>
                    <p>Welcome to Packet Tracer Lite v3.9! This guide will help you get started in 5-10 minutes.</p>

                    <h3><span class="step-number">1</span>Open the Lab Library</h3>
                    <p>Click the <strong>Lab Library</strong> button in the top toolbar to view available lab scenarios.</p>

                    <h3><span class="step-number">2</span>Select a Lab Scenario</h3>
                    <p>Browse through the lab library and select a lab that matches your skill level:</p>
                    <ul>
                        <li><strong>Beginner:</strong> Basic routing, switching, and IP configuration</li>
                        <li><strong>Intermediate:</strong> VLANs, trunking, and static routing</li>
                        <li><strong>Advanced:</strong> OSPF, multi-area routing, and complex topologies</li>
                    </ul>

                    <h3><span class="step-number">3</span>Load the Lab</h3>
                    <p>Click the <strong>Load Lab</strong> button on any lab card. The network topology will automatically appear on the canvas with all devices pre-configured.</p>

                    <h3><span class="step-number">4</span>Follow Step-by-Step Instructions</h3>
                    <p>The right panel displays detailed instructions for the lab:</p>
                    <ul>
                        <li>Read each step carefully before attempting</li>
                        <li>Follow the command syntax exactly as shown</li>
                        <li>Commands are for reference - this is a read-only simulator</li>
                    </ul>

                    <h3><span class="step-number">5</span>Mark Steps as Complete</h3>
                    <p>As you complete each step:</p>
                    <ul>
                        <li>Click the checkbox next to the step</li>
                        <li>The checkbox will turn green with a checkmark</li>
                        <li>Your progress percentage will update automatically</li>
                    </ul>

                    <h3><span class="step-number">6</span>Track Your Progress</h3>
                    <p>Monitor your completion status:</p>
                    <ul>
                        <li>Progress bar shows overall completion percentage</li>
                        <li>Step counter displays completed/total steps</li>
                        <li>Progress is saved in your browser automatically</li>
                    </ul>

                    <div class="help-tip">
                        <strong>üí° Pro Tip:</strong> Start with Lab 1 (Basic Routing) if you're new to networking. It covers fundamental concepts like IP addressing, interface configuration, and static routing.
                    </div>
                </div>

                <!-- LAB CONTROLS SECTION -->
                <div class="help-section" id="controls">
                    <h2>üéÆ Lab Controls Reference</h2>

                    <h3>Lab Library Button</h3>
                    <p>Opens the lab library modal where you can browse and load pre-built lab scenarios.</p>
                    <ul>
                        <li>View all available labs</li>
                        <li>Filter by difficulty level</li>
                        <li>See lab objectives and step counts</li>
                        <li>Check your completion status</li>
                    </ul>

                    <h3>Difficulty Filters</h3>
                    <p>Filter labs by skill level:</p>
                    <ul>
                        <li><strong>All:</strong> Shows all available labs</li>
                        <li><strong>Beginner:</strong> Entry-level labs (1-2 devices)</li>
                        <li><strong>Intermediate:</strong> Medium complexity (3-4 devices)</li>
                        <li><strong>Advanced:</strong> Complex scenarios (5+ devices)</li>
                    </ul>

                    <h3>Progress Indicators</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>Progress Bar</h4>
                            <p>Visual representation of completion percentage</p>
                        </div>
                        <div class="feature-card">
                            <h4>Percentage Display</h4>
                            <p>Shows exact completion percentage (e.g., 75%)</p>
                        </div>
                        <div class="feature-card">
                            <h4>Step Counter</h4>
                            <p>Displays completed/total steps (e.g., 6/8)</p>
                        </div>
                        <div class="feature-card">
                            <h4>Checkboxes</h4>
                            <p>Interactive checkboxes for each step</p>
                        </div>
                    </div>

                    <h3>Step Completion Checkboxes</h3>
                    <p>Each lab step has a checkbox that:</p>
                    <ul>
                        <li>Starts unchecked (gray outline)</li>
                        <li>Turns green when clicked (with checkmark)</li>
                        <li>Updates the overall progress percentage</li>
                        <li>Saves your progress automatically</li>
                        <li>Can be unchecked if needed</li>
                    </ul>

                    <h3>Navigation Between Labs</h3>
                    <p>Easily switch between labs:</p>
                    <ul>
                        <li>Open Lab Library at any time</li>
                        <li>Your progress is saved for each lab</li>
                        <li>Return to previous labs without losing progress</li>
                        <li>Complete labs in any order you prefer</li>
                    </ul>

                    <div class="help-note">
                        <strong>üìù Note:</strong> All progress is saved in your browser's localStorage. Clearing browser data will reset your progress.
                    </div>

                    <h3>Toolbar Buttons</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>üîó Connect</h4>
                            <p>Click to toggle connection mode. Click two devices to create a connection between them.</p>
                        </div>
                        <div class="feature-card">
                            <h4>üóëÔ∏è Delete</h4>
                            <p>Toggle delete mode. Click connections to remove them, or click devices to delete them and their connections.</p>
                        </div>
                        <div class="feature-card">
                            <h4>üìÑ New</h4>
                            <p>Clear the canvas and start a new topology from scratch.</p>
                        </div>
                        <div class="feature-card">
                            <h4>üíæ Export</h4>
                            <p>Export your current topology as JSON for backup or sharing.</p>
                        </div>
                        <div class="feature-card">
                            <h4>üìÇ Import</h4>
                            <p>Import a previously exported JSON file to restore your topology and continue where you left off.</p>
                        </div>
                    </div>
                </div>

                <!-- EXPORT/IMPORT DETAILED SECTION -->
                <div class="help-section" id="export-import">
                    <h2>üíæ Export & Import Guide</h2>
                    <p>Save your work and share topologies with classmates or submit to your instructor.</p>

                    <h3 style="margin-top: 20px; color: var(--primary);">üì§ Exporting Your Topology</h3>
                    <div style="background: var(--surface); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p><strong>How to Export:</strong></p>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li>Build your topology and configure devices</li>
                            <li>Click the <strong>üíæ Export</strong> button in the toolbar</li>
                            <li>A JSON file downloads automatically</li>
                            <li>File is named: <code>topology_YYYY-MM-DDTHH-MM-SS.json</code></li>
                        </ol>
                        <p style="margin-top: 15px;"><strong>What Gets Saved:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>‚úÖ All devices and their positions</li>
                            <li>‚úÖ Device names (hostnames)</li>
                            <li>‚úÖ Interface configurations (IPs, masks, VLANs)</li>
                            <li>‚úÖ All connections between devices</li>
                            <li>‚úÖ Router configs (routes, OSPF, EIGRP, ACLs)</li>
                            <li>‚úÖ Switch configs (VLANs, STP settings)</li>
                            <li>‚úÖ DHCP server configurations</li>
                            <li>‚úÖ Lab progress (if working on a lab)</li>
                        </ul>
                    </div>

                    <h3 style="margin-top: 20px; color: var(--primary);">üì• Importing a Topology</h3>
                    <div style="background: var(--surface); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p><strong>How to Import:</strong></p>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li>Click the <strong>üìÇ Import</strong> button in the toolbar</li>
                            <li>Select a <code>.json</code> file from your computer</li>
                            <li>The topology loads with all configurations restored</li>
                            <li>If it was a lab, instructions and progress are restored too</li>
                        </ol>
                        <p style="margin-top: 15px;"><strong>Use Cases:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>üìÅ <strong>Backup:</strong> Save work before closing browser</li>
                            <li>üìß <strong>Submit:</strong> Export and email to instructor</li>
                            <li>üë• <strong>Share:</strong> Send topology to classmates</li>
                            <li>üíª <strong>Transfer:</strong> Move work between computers</li>
                            <li>üîÑ <strong>Continue:</strong> Resume work from previous session</li>
                        </ul>
                    </div>

                    <h3 style="margin-top: 20px; color: var(--primary);">‚ö†Ô∏è Important Notes</h3>
                    <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <ul style="margin-left: 20px;">
                            <li><strong>File Format:</strong> Only <code>.json</code> files exported from this tool can be imported</li>
                            <li><strong>Version Compatibility:</strong> Files from older versions (v3.9 and earlier) may not include all configuration data</li>
                            <li><strong>Browser Storage:</strong> Lab progress is also saved in localStorage automatically - export is for backup/sharing</li>
                            <li><strong>Real Packet Tracer:</strong> These JSON files are NOT compatible with Cisco Packet Tracer (.pkt files)</li>
                        </ul>
                    </div>

                    <h3 style="margin-top: 20px; color: var(--primary);">üìã For Lab Submissions</h3>
                    <div style="background: var(--surface); padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p><strong>Recommended naming convention for submissions:</strong></p>
                        <p style="margin-top: 10px; font-family: monospace; background: var(--background); padding: 10px; border-radius: 4px;">
                            Lab[#]_[YourName]_[Date].json<br>
                            Example: Lab3_JohnSmith_2025-12-09.json
                        </p>
                        <p style="margin-top: 10px;">After exporting, rename the file following your instructor's guidelines before submitting.</p>
                    </div>
                </div>

                <!-- CLI COMMANDS SECTION -->
                <div class="help-section" id="commands">
                    <h2>üíª CLI Command Reference</h2>
                    <p>Comprehensive reference of Cisco IOS commands used in the labs. Use the search box to quickly find commands.</p>

                    <input type="text" class="help-search-box" id="commandSearch" placeholder="üîç Search commands (e.g., 'vlan', 'ospf', 'interface')...">

                    <div id="commandList">
                        <!-- Basic Commands -->
                        <div class="command-category" data-category="basic">
                            <h3>üîπ Basic Commands</h3>
                            <div class="command-item" data-keywords="enable privileged exec mode">
                                <div class="command-syntax">enable</div>
                                <div class="command-description">Enter privileged EXEC mode (enables configuration commands)</div>
                            </div>
                            <div class="command-item" data-keywords="configure terminal config global configuration">
                                <div class="command-syntax">configure terminal</div>
                                <div class="command-description">Enter global configuration mode</div>
                            </div>
                            <div class="command-item" data-keywords="exit quit leave mode">
                                <div class="command-syntax">exit</div>
                                <div class="command-description">Exit current configuration mode</div>
                            </div>
                            <div class="command-item" data-keywords="show running-config configuration view">
                                <div class="command-syntax">show running-config</div>
                                <div class="command-description">View the current running configuration</div>
                            </div>
                            <div class="command-item" data-keywords="show ip interface brief status summary">
                                <div class="command-syntax">show ip interface brief</div>
                                <div class="command-description">View a summary of all interfaces with IP addresses and status</div>
                            </div>
                            <div class="command-item" data-keywords="show version info information">
                                <div class="command-syntax">show version</div>
                                <div class="command-description">Display system hardware and software status</div>
                            </div>
                            <div class="command-item" data-keywords="write memory save config configuration">
                                <div class="command-syntax">write memory</div>
                                <div class="command-description">Save running configuration to startup configuration</div>
                            </div>
                        </div>

                        <!-- Interface Configuration -->
                        <div class="command-category" data-category="interface">
                            <h3>üîπ Interface Configuration</h3>
                            <div class="command-item" data-keywords="interface gigabitethernet fastethernet port">
                                <div class="command-syntax">interface [type] [number]</div>
                                <div class="command-description">Enter interface configuration mode (e.g., interface GigabitEthernet0/0)</div>
                            </div>
                            <div class="command-item" data-keywords="ip address assign configure">
                                <div class="command-syntax">ip address [ip] [mask]</div>
                                <div class="command-description">Assign an IP address and subnet mask to an interface</div>
                            </div>
                            <div class="command-item" data-keywords="no shutdown enable activate interface">
                                <div class="command-syntax">no shutdown</div>
                                <div class="command-description">Enable/activate an interface (bring it up)</div>
                            </div>
                            <div class="command-item" data-keywords="shutdown disable deactivate interface">
                                <div class="command-syntax">shutdown</div>
                                <div class="command-description">Administratively disable an interface</div>
                            </div>
                            <div class="command-item" data-keywords="description label name interface">
                                <div class="command-syntax">description [text]</div>
                                <div class="command-description">Add a descriptive label to an interface</div>
                            </div>
                            <div class="command-item" data-keywords="show interfaces status details">
                                <div class="command-syntax">show interfaces</div>
                                <div class="command-description">Display detailed information about all interfaces</div>
                            </div>
                        </div>

                        <!-- VLAN Commands -->
                        <div class="command-category" data-category="vlan">
                            <h3>üîπ VLAN Commands</h3>
                            <div class="command-item" data-keywords="vlan create virtual lan">
                                <div class="command-syntax">vlan [id]</div>
                                <div class="command-description">Create a VLAN and enter VLAN configuration mode</div>
                            </div>
                            <div class="command-item" data-keywords="name vlan label">
                                <div class="command-syntax">name [name]</div>
                                <div class="command-description">Assign a name to a VLAN</div>
                            </div>
                            <div class="command-item" data-keywords="switchport mode access port">
                                <div class="command-syntax">switchport mode access</div>
                                <div class="command-description">Configure port as an access port (single VLAN)</div>
                            </div>
                            <div class="command-item" data-keywords="switchport access vlan assign">
                                <div class="command-syntax">switchport access vlan [id]</div>
                                <div class="command-description">Assign an access port to a specific VLAN</div>
                            </div>
                            <div class="command-item" data-keywords="switchport mode trunk multiple vlans">
                                <div class="command-syntax">switchport mode trunk</div>
                                <div class="command-description">Configure port as a trunk (carries multiple VLANs)</div>
                            </div>
                            <div class="command-item" data-keywords="show vlan brief display list">
                                <div class="command-syntax">show vlan brief</div>
                                <div class="command-description">Display a summary of all VLANs</div>
                            </div>
                            <div class="command-item" data-keywords="show interfaces trunk status">
                                <div class="command-syntax">show interfaces trunk</div>
                                <div class="command-description">Display information about trunk ports</div>
                            </div>
                        </div>

                        <!-- OSPF Commands -->
                        <div class="command-category" data-category="ospf">
                            <h3>üîπ OSPF Commands</h3>
                            <div class="command-item" data-keywords="router ospf enable start process">
                                <div class="command-syntax">router ospf [process-id]</div>
                                <div class="command-description">Enable OSPF routing and enter OSPF configuration mode</div>
                            </div>
                            <div class="command-item" data-keywords="network advertise area ospf">
                                <div class="command-syntax">network [network] [wildcard] area [area-id]</div>
                                <div class="command-description">Advertise a network in OSPF with wildcard mask and area ID</div>
                            </div>
                            <div class="command-item" data-keywords="router-id rid identifier ospf">
                                <div class="command-syntax">router-id [id]</div>
                                <div class="command-description">Manually set the OSPF Router ID</div>
                            </div>
                            <div class="command-item" data-keywords="show ip ospf neighbor adjacency">
                                <div class="command-syntax">show ip ospf neighbor</div>
                                <div class="command-description">Display OSPF neighbor relationships and states</div>
                            </div>
                            <div class="command-item" data-keywords="show ip ospf interface">
                                <div class="command-syntax">show ip ospf interface</div>
                                <div class="command-description">Display OSPF information for interfaces</div>
                            </div>
                            <div class="command-item" data-keywords="show ip ospf database lsdb">
                                <div class="command-syntax">show ip ospf database</div>
                                <div class="command-description">Display the OSPF link-state database</div>
                            </div>
                        </div>

                        <!-- Routing Commands -->
                        <div class="command-category" data-category="routing">
                            <h3>üîπ Routing Commands</h3>
                            <div class="command-item" data-keywords="ip route static next-hop gateway">
                                <div class="command-syntax">ip route [dest] [mask] [next-hop]</div>
                                <div class="command-description">Configure a static route to a destination network</div>
                            </div>
                            <div class="command-item" data-keywords="show ip route table routing">
                                <div class="command-syntax">show ip route</div>
                                <div class="command-description">Display the routing table with all known routes</div>
                            </div>
                            <div class="command-item" data-keywords="show ip protocols routing">
                                <div class="command-syntax">show ip protocols</div>
                                <div class="command-description">Display information about routing protocols</div>
                            </div>
                            <div class="command-item" data-keywords="ping test connectivity icmp">
                                <div class="command-syntax">ping [destination]</div>
                                <div class="command-description">Test network connectivity to a destination IP address</div>
                            </div>
                            <div class="command-item" data-keywords="traceroute trace path route">
                                <div class="command-syntax">traceroute [destination]</div>
                                <div class="command-description">Trace the path packets take to reach a destination</div>
                            </div>
                        </div>

                        <!-- Hostname & Security -->
                        <div class="command-category" data-category="basic">
                            <h3>üîπ Device Configuration</h3>
                            <div class="command-item" data-keywords="hostname name device">
                                <div class="command-syntax">hostname [name]</div>
                                <div class="command-description">Set the device hostname</div>
                            </div>
                            <div class="command-item" data-keywords="banner motd message login">
                                <div class="command-syntax">banner motd # [message] #</div>
                                <div class="command-description">Configure a message-of-the-day banner</div>
                            </div>
                        </div>
                    </div>

                    <div class="no-results" id="noResults" style="display: none;">
                        <p>üîç No commands found matching your search.</p>
                        <p style="font-size: 0.9em; margin-top: 10px;">Try different keywords or check the spelling.</p>
                    </div>

                    <div class="help-tip" style="margin-top: 30px;">
                        <strong>üí° Tip:</strong> These commands are for reference and learning. In a real Cisco device, you would type these commands in the CLI. This simulator provides a visual representation of network configuration.
                    </div>
                </div>

                <!-- KEYBOARD SHORTCUTS SECTION -->
                <div class="help-section" id="shortcuts">
                    <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
                    <p>Use these keyboard shortcuts to navigate the help system more efficiently.</p>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>Close Help Modal</h4>
                            <p><span class="keyboard-shortcut">Escape</span></p>
                            <p style="margin-top: 10px; font-size: 0.9em;">Press the Escape key to quickly close the help window</p>
                        </div>

                        <div class="feature-card">
                            <h4>Search Commands</h4>
                            <p><span class="keyboard-shortcut">Ctrl</span> + <span class="keyboard-shortcut">F</span></p>
                            <p style="margin-top: 10px; font-size: 0.9em;">Jump to the command search box (when on Commands tab)</p>
                        </div>

                        <div class="feature-card">
                            <h4>Navigate Elements</h4>
                            <p><span class="keyboard-shortcut">Tab</span></p>
                            <p style="margin-top: 10px; font-size: 0.9em;">Move between interactive elements (tabs, buttons, search)</p>
                        </div>

                        <div class="feature-card">
                            <h4>Activate Elements</h4>
                            <p><span class="keyboard-shortcut">Enter</span> or <span class="keyboard-shortcut">Space</span></p>
                            <p style="margin-top: 10px; font-size: 0.9em;">Activate focused buttons or tabs</p>
                        </div>
                    </div>

                    <h3>Canvas Shortcuts</h3>
                    <ul>
                        <li><span class="keyboard-shortcut">Ctrl</span> + <span class="keyboard-shortcut">Click</span> on connection - Delete connection (alternative to Delete mode)</li>
                    </ul>

                    <h3>Browser Shortcuts (Still Available)</h3>
                    <ul>
                        <li><span class="keyboard-shortcut">Ctrl</span> + <span class="keyboard-shortcut">+</span> - Zoom in</li>
                        <li><span class="keyboard-shortcut">Ctrl</span> + <span class="keyboard-shortcut">-</span> - Zoom out</li>
                        <li><span class="keyboard-shortcut">Ctrl</span> + <span class="keyboard-shortcut">0</span> - Reset zoom</li>
                        <li><span class="keyboard-shortcut">F5</span> - Refresh page</li>
                        <li><span class="keyboard-shortcut">F11</span> - Toggle fullscreen mode</li>
                    </ul>

                    <div class="help-note">
                        <strong>üìù Note:</strong> Some shortcuts may vary depending on your operating system. Mac users should use <span class="keyboard-shortcut">Cmd</span> instead of <span class="keyboard-shortcut">Ctrl</span>.
                    </div>
                </div>

                <!-- TROUBLESHOOTING SECTION -->
                <div class="help-section" id="troubleshooting">
                    <h2>üîß Troubleshooting Common Issues</h2>

                    <h3>Lab Won't Load</h3>
                    <div class="help-warning">
                        <strong>Problem:</strong> When I click "Load Lab", nothing happens or the page freezes.
                    </div>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Check browser compatibility (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)</li>
                        <li>Try refreshing the page with <span class="keyboard-shortcut">F5</span> or <span class="keyboard-shortcut">Ctrl</span> + <span class="keyboard-shortcut">R</span></li>
                        <li>Clear your browser cache and reload</li>
                        <li>Ensure JavaScript is enabled in your browser settings</li>
                        <li>Disable browser extensions that might interfere (ad blockers, script blockers)</li>
                    </ul>

                    <h3>Can't Mark Step Complete</h3>
                    <div class="help-warning">
                        <strong>Problem:</strong> Clicking the checkbox doesn't mark the step as complete.
                    </div>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Click directly on the checkbox (not the step text)</li>
                        <li>Wait a moment - the checkbox should turn green with a checkmark</li>
                        <li>If it's unresponsive, try refreshing the page</li>
                        <li>Check browser console for JavaScript errors (F12 key)</li>
                    </ul>

                    <h3>Progress Not Saving</h3>
                    <div class="help-warning">
                        <strong>Problem:</strong> My lab progress resets when I close the browser.
                    </div>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>This simulator requires browser localStorage to save progress</li>
                        <li>Check if localStorage is enabled (not in Private/Incognito mode)</li>
                        <li>Don't clear browser data/cookies while using the simulator</li>
                        <li>Some browsers in "strict privacy mode" may block localStorage</li>
                        <li>Try using a different browser if the issue persists</li>
                    </ul>

                    <h3>Topology Not Displaying</h3>
                    <div class="help-warning">
                        <strong>Problem:</strong> The network canvas is blank or devices don't appear.
                    </div>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Canvas support is required - update your browser to the latest version</li>
                        <li>Check if hardware acceleration is enabled in browser settings</li>
                        <li>Try zooming in/out with <span class="keyboard-shortcut">Ctrl</span> + <span class="keyboard-shortcut">+/-</span></li>
                        <li>Reload the lab from the Lab Library</li>
                        <li>Check browser console (F12) for error messages</li>
                    </ul>

                    <h3>Commands Not Working</h3>
                    <div class="help-warning">
                        <strong>Problem:</strong> I can't type commands or interact with devices.
                    </div>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>This is a <strong>read-only simulator</strong> - you can't execute commands</li>
                        <li>Commands shown in instructions are for learning/reference only</li>
                        <li>The simulator demonstrates network concepts visually</li>
                        <li>Use the checkboxes to mark steps as "completed" after reading</li>
                        <li>For hands-on practice, use Cisco Packet Tracer or real equipment</li>
                    </ul>

                    <h3>Performance Issues</h3>
                    <div class="help-warning">
                        <strong>Problem:</strong> The simulator is slow or laggy.
                    </div>
                    <p><strong>Solutions:</strong></p>
                    <ul>
                        <li>Close other browser tabs to free up memory</li>
                        <li>Close other applications running on your computer</li>
                        <li>Try using a different browser (Chrome is recommended)</li>
                        <li>Ensure your system meets minimum requirements</li>
                        <li>Disable browser extensions temporarily</li>
                    </ul>

                    <div class="help-tip">
                        <strong>üí° Still Having Issues?</strong> Try using the simulator in a different browser or on a different device. Chrome and Firefox typically offer the best compatibility.
                    </div>
                </div>

                <!-- TIPS SECTION -->
                <div class="help-section" id="tips">
                    <h2>üí° Lab Completion Tips</h2>

                    <h3>Before Starting a Lab</h3>
                    <ul>
                        <li><strong>Read the objectives:</strong> Understand what the lab aims to teach before diving in</li>
                        <li><strong>Review the topology:</strong> Study the network diagram to understand device connections</li>
                        <li><strong>Check the difficulty:</strong> Make sure the lab matches your current skill level</li>
                        <li><strong>Set aside time:</strong> Allocate 15-45 minutes depending on lab complexity</li>
                    </ul>

                    <h3>During the Lab</h3>
                    <ul>
                        <li><strong>Read each step carefully:</strong> Don't rush - understanding is more important than speed</li>
                        <li><strong>Follow command syntax exactly:</strong> Pay attention to spacing, brackets, and punctuation</li>
                        <li><strong>Verify configurations:</strong> Use show commands to confirm your changes took effect</li>
                        <li><strong>Understand the 'why':</strong> Don't just follow steps - understand why each command is needed</li>
                        <li><strong>Take notes:</strong> Write down key concepts and commands for future reference</li>
                        <li><strong>Mark steps as you go:</strong> Check off completed steps to track progress</li>
                    </ul>

                    <h3>After Completing a Lab</h3>
                    <ul>
                        <li><strong>Review the configuration:</strong> Look at the complete running-config</li>
                        <li><strong>Test connectivity:</strong> Verify all devices can communicate as intended</li>
                        <li><strong>Understand the routing table:</strong> Check how routes were learned or configured</li>
                        <li><strong>Experiment (if possible):</strong> Try variations to deepen understanding</li>
                        <li><strong>Document your learning:</strong> Write a summary of what you learned</li>
                    </ul>

                    <h3>Learning Strategies</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>üéØ Focus on Concepts</h4>
                            <p>Don't just memorize commands - understand the networking concepts behind them</p>
                        </div>
                        <div class="feature-card">
                            <h4>üîÑ Repeat Labs</h4>
                            <p>Practice labs multiple times to build muscle memory and confidence</p>
                        </div>
                        <div class="feature-card">
                            <h4>üìù Create Flashcards</h4>
                            <p>Make flashcards for important commands and concepts</p>
                        </div>
                        <div class="feature-card">
                            <h4>üéì Progressive Learning</h4>
                            <p>Master beginner labs before moving to intermediate and advanced</p>
                        </div>
                    </div>

                    <h3>Certification Preparation</h3>
                    <p>If you're preparing for CCNA or Network+ certifications:</p>
                    <ul>
                        <li><strong>Complete all labs:</strong> Work through all difficulty levels systematically</li>
                        <li><strong>Time yourself:</strong> Practice completing labs within time constraints</li>
                        <li><strong>Simulate exam conditions:</strong> No reference materials, time pressure</li>
                        <li><strong>Understand troubleshooting:</strong> Focus on identifying and fixing misconfigurations</li>
                        <li><strong>Review objectives:</strong> Map lab skills to certification exam objectives</li>
                    </ul>

                    <div class="help-tip">
                        <strong>üí° Expert Tip:</strong> The best way to learn is by doing. Complete each lab at least twice - once to learn, and once to reinforce. Teaching the concepts to someone else is even better!
                    </div>
                </div>

                <!-- ABOUT SECTION -->
                <div class="help-section" id="about">
                    <h2>‚ÑπÔ∏è About Packet Tracer Lite</h2>

                    <div style="text-align: center; margin: 30px 0;">
                        <h3 style="font-size: 2em; color: #2a5298;">
                            Packet Tracer Lite
                            <span class="version-badge">v3.9</span>
                        </h3>
                        <p style="color: #6c757d; margin-top: 10px;">Interactive Network Lab Library Edition</p>
                    </div>

                    <h3>What is Packet Tracer Lite?</h3>
                    <p>Packet Tracer Lite is a browser-based network simulation and visualization tool designed for education and training. It provides an interactive learning environment for networking concepts without requiring physical equipment or complex software installations.</p>

                    <h3>Key Features</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>üåê Browser-Based</h4>
                            <p>No installation required - runs entirely in your web browser</p>
                        </div>
                        <div class="feature-card">
                            <h4>üìö Lab Library</h4>
                            <p>Pre-built lab scenarios covering core networking topics</p>
                        </div>
                        <div class="feature-card">
                            <h4>üìä Visual Learning</h4>
                            <p>Interactive network topologies with device visualization</p>
                        </div>
                        <div class="feature-card">
                            <h4>‚úÖ Progress Tracking</h4>
                            <p>Track completion status for each lab and step</p>
                        </div>
                        <div class="feature-card">
                            <h4>üéì Educational Focus</h4>
                            <p>Designed for CCNA and Network+ certification prep</p>
                        </div>
                        <div class="feature-card">
                            <h4>üíæ Auto-Save</h4>
                            <p>Automatic progress saving with browser localStorage</p>
                        </div>
                    </div>

                    <h3>Phase 1: Core Labs (Current)</h3>
                    <p>The current version includes 7 foundational labs:</p>
                    <ul>
                        <li><strong>Lab 1: Basic Routing</strong> - Two-network routing with static routes</li>
                        <li><strong>Lab 2: VLAN Configuration</strong> - Switch VLANs, access ports, and trunk ports</li>
                        <li><strong>Lab 3: OSPF Routing</strong> - Dynamic routing with OSPF configuration</li>
                        <li><strong>Lab 4: Inter-VLAN Routing</strong> - L3 switch routing with SVIs</li>
                        <li><strong>Lab 5: OSPF Multi-Area</strong> - Advanced OSPF with multiple areas</li>
                        <li><strong>Lab 6: Access Control Lists (ACLs)</strong> - Standard and extended ACLs for security</li>
                        <li><strong>Lab 7: VLAN Trunking (802.1Q)</strong> - Trunk configuration and native VLAN security</li>
                    </ul>

                    <h3>Phase 2: Coming Soon</h3>
                    <p>Future updates will include additional labs covering:</p>
                    <ul>
                        <li><strong>EIGRP Routing:</strong> Enhanced Interior Gateway Routing Protocol</li>
                        <li><strong>NAT/PAT Configuration:</strong> Network address translation</li>
                        <li><strong>DHCP Server Configuration:</strong> Dynamic host configuration</li>
                        <li><strong>WAN Technologies:</strong> PPP, Frame Relay concepts</li>
                        <li><strong>Port Security & Etherchannel:</strong> Advanced switching features</li>
                    </ul>

                    <h3>Browser Requirements</h3>
                    <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                        <tr style="background: #f8f9fa;">
                            <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6;">Browser</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6;">Minimum Version</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #dee2e6;">Status</th>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">Google Chrome</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">90+</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; color: #28a745;">‚úÖ Recommended</td>
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <td style="padding: 12px; border: 1px solid #dee2e6;">Mozilla Firefox</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">88+</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; color: #28a745;">‚úÖ Supported</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">Safari</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">14+</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; color: #28a745;">‚úÖ Supported</td>
                        </tr>
                        <tr style="background: #f8f9fa;">
                            <td style="padding: 12px; border: 1px solid #dee2e6;">Microsoft Edge</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6;">90+</td>
                            <td style="padding: 12px; border: 1px solid #dee2e6; color: #28a745;">‚úÖ Supported</td>
                        </tr>
                    </table>

                    <h3>Technical Requirements</h3>
                    <ul>
                        <li><strong>HTML5 Canvas:</strong> Required for network topology rendering</li>
                        <li><strong>JavaScript:</strong> Must be enabled (ES6+ features used)</li>
                        <li><strong>localStorage:</strong> Required for progress saving</li>
                        <li><strong>Screen Resolution:</strong> Minimum 1024x768 recommended</li>
                        <li><strong>Internet Connection:</strong> Only needed for initial page load</li>
                    </ul>

                    <h3>Educational Use</h3>
                    <p>This tool is designed for:</p>
                    <ul>
                        <li>Self-paced learning and certification preparation</li>
                        <li>Classroom demonstrations and instruction</li>
                        <li>Lab practice when physical equipment is unavailable</li>
                        <li>Visual understanding of network concepts</li>
                        <li>Quick reference for CLI commands and syntax</li>
                    </ul>

                    <div class="help-note">
                        <strong>üìù Note:</strong> This is a visual simulator designed for learning. For hands-on CLI practice, consider using Cisco Packet Tracer (full version), GNS3, or physical equipment.
                    </div>

                    <h3>Feedback & Support</h3>
                    <p>We're continuously improving Packet Tracer Lite. Your feedback helps us create better learning experiences.</p>

                    <div class="help-tip">
                        <strong>üí° Tip:</strong> Bookmark this page for quick access to your labs and progress tracking!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== LAB LIBRARY DATA ==========
        const LAB_LIBRARY = {
            lab01: {
                id: "lab01",
                title: "Lab 1: Basic Routing - Two Networks",
                difficulty: "beginner",
                estimatedTime: "20 minutes",
                icon: "üî∞",
                description: "Learn to configure IP addresses and static routes to connect two separate networks through a router. Perfect introduction to Layer 3 routing.",
                concepts: ["IP Addressing", "Static Routes", "Gateway Configuration", "Ping Testing"],
                devices: "1 Router, 2 Switches, 4 PCs",
                topology: {
                    devices: [
                        {id: "R1", type: "router", name: "Router-1", x: 400, y: 200},
                        {id: "SW1", type: "l2switch", name: "Switch-1", x: 200, y: 350},
                        {id: "SW2", type: "l2switch", name: "Switch-2", x: 600, y: 350},
                        {id: "PC1", type: "pc", name: "PC-A", x: 100, y: 500},
                        {id: "PC2", type: "pc", name: "PC-B", x: 300, y: 500},
                        {id: "PC3", type: "pc", name: "PC-C", x: 500, y: 500},
                        {id: "PC4", type: "pc", name: "PC-D", x: 700, y: 500}
                    ],
                    connections: []
                },
                instructions: [
                    {
                        step: 1,
                        title: "Configure Router Interface Gi0/0",
                        description: "Assign IP address 192.168.1.1/24 to the router interface connected to Network 1 (left side).",
                        commands: ["enable", "configure terminal", "interface GigabitEthernet0/0", "ip address 192.168.1.1 255.255.255.0", "no shutdown", "exit"],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 2,
                        title: "Configure Router Interface Gi0/1",
                        description: "Assign IP address 192.168.2.1/24 to the router interface connected to Network 2 (right side).",
                        commands: ["interface GigabitEthernet0/1", "ip address 192.168.2.1 255.255.255.0", "no shutdown", "exit", "end"],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 3,
                        title: "Configure PC-A",
                        description: "Set IP address 192.168.1.10/24 with gateway 192.168.1.1 on PC-A.",
                        commands: ["IP: 192.168.1.10", "Mask: 255.255.255.0", "Gateway: 192.168.1.1"],
                        verification: "ipconfig",
                        completed: false
                    },
                    {
                        step: 4,
                        title: "Configure PC-B",
                        description: "Set IP address 192.168.1.20/24 with gateway 192.168.1.1 on PC-B.",
                        commands: ["IP: 192.168.1.20", "Mask: 255.255.255.0", "Gateway: 192.168.1.1"],
                        verification: "ipconfig",
                        completed: false
                    },
                    {
                        step: 5,
                        title: "Configure PC-C",
                        description: "Set IP address 192.168.2.10/24 with gateway 192.168.2.1 on PC-C.",
                        commands: ["IP: 192.168.2.10", "Mask: 255.255.255.0", "Gateway: 192.168.2.1"],
                        verification: "ipconfig",
                        completed: false
                    },
                    {
                        step: 6,
                        title: "Configure PC-D",
                        description: "Set IP address 192.168.2.20/24 with gateway 192.168.2.1 on PC-D.",
                        commands: ["IP: 192.168.2.20", "Mask: 255.255.255.0", "Gateway: 192.168.2.1"],
                        verification: "ipconfig",
                        completed: false
                    },
                    {
                        step: 7,
                        title: "Test Same-Network Connectivity",
                        description: "Ping from PC-A to PC-B to verify Layer 2 connectivity within Network 1.",
                        commands: ["ping 192.168.1.20"],
                        verification: "Successful ping (4 replies)",
                        completed: false
                    },
                    {
                        step: 8,
                        title: "Test Cross-Network Connectivity",
                        description: "Ping from PC-A to PC-C to verify Layer 3 routing between networks.",
                        commands: ["ping 192.168.2.10"],
                        verification: "Successful ping (4 replies)",
                        completed: false
                    }
                ]
            },

            lab02: {
                id: "lab02",
                title: "Lab 2: VLAN Configuration & Segmentation",
                difficulty: "beginner",
                estimatedTime: "25 minutes",
                icon: "üî∞",
                description: "Create multiple VLANs on a switch, assign ports to different VLANs, and observe broadcast domain isolation. Essential for understanding network segmentation.",
                concepts: ["VLANs", "Access Ports", "Broadcast Domains", "Network Isolation"],
                devices: "1 L2 Switch, 4 PCs",
                topology: {
                    devices: [
                        {id: "SW1", type: "l2switch", name: "Switch-Core", x: 400, y: 250},
                        {id: "PC1", type: "pc", name: "Sales-PC1", x: 200, y: 400},
                        {id: "PC2", type: "pc", name: "Sales-PC2", x: 350, y: 400},
                        {id: "PC3", type: "pc", name: "IT-PC1", x: 450, y: 400},
                        {id: "PC4", type: "pc", name: "IT-PC2", x: 600, y: 400}
                    ],
                    connections: []
                },
                instructions: [
                    {
                        step: 1,
                        title: "Create VLAN 10 (Sales)",
                        description: "Create VLAN 10 and name it 'Sales' on the switch.",
                        commands: ["enable", "configure terminal", "vlan 10", "name Sales", "exit"],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 2,
                        title: "Create VLAN 20 (IT)",
                        description: "Create VLAN 20 and name it 'IT' on the switch.",
                        commands: ["vlan 20", "name IT", "exit"],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 3,
                        title: "Assign Fa0/1 to VLAN 10",
                        description: "Configure FastEthernet0/1 (Sales-PC1) as an access port in VLAN 10.",
                        commands: ["interface FastEthernet0/1", "switchport mode access", "switchport access vlan 10", "exit"],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 4,
                        title: "Assign Fa0/2 to VLAN 10",
                        description: "Configure FastEthernet0/2 (Sales-PC2) as an access port in VLAN 10.",
                        commands: ["interface FastEthernet0/2", "switchport mode access", "switchport access vlan 10", "exit"],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 5,
                        title: "Assign Fa0/3 to VLAN 20",
                        description: "Configure FastEthernet0/3 (IT-PC1) as an access port in VLAN 20.",
                        commands: ["interface FastEthernet0/3", "switchport mode access", "switchport access vlan 20", "exit"],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 6,
                        title: "Assign Fa0/4 to VLAN 20",
                        description: "Configure FastEthernet0/4 (IT-PC2) as an access port in VLAN 20.",
                        commands: ["interface FastEthernet0/4", "switchport mode access", "switchport access vlan 20", "exit", "end"],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 7,
                        title: "Configure PCs in VLAN 10",
                        description: "Set Sales-PC1 to 192.168.10.10/24 and Sales-PC2 to 192.168.10.20/24.",
                        commands: ["PC1: 192.168.10.10/24", "PC2: 192.168.10.20/24"],
                        verification: "ipconfig on both PCs",
                        completed: false
                    },
                    {
                        step: 8,
                        title: "Configure PCs in VLAN 20",
                        description: "Set IT-PC1 to 192.168.20.10/24 and IT-PC2 to 192.168.20.20/24.",
                        commands: ["PC3: 192.168.20.10/24", "PC4: 192.168.20.20/24"],
                        verification: "ipconfig on both PCs",
                        completed: false
                    },
                    {
                        step: 9,
                        title: "Test Same-VLAN Connectivity",
                        description: "Ping from Sales-PC1 to Sales-PC2. This should work (same VLAN).",
                        commands: ["ping 192.168.10.20"],
                        verification: "Successful ping",
                        completed: false
                    },
                    {
                        step: 10,
                        title: "Test Cross-VLAN Isolation",
                        description: "Ping from Sales-PC1 to IT-PC1. This should FAIL (different VLANs, no routing).",
                        commands: ["ping 192.168.20.10"],
                        verification: "Ping fails (Request timed out)",
                        completed: false
                    }
                ]
            },

            lab03: {
                id: "lab03",
                title: "Lab 3: OSPF Single-Area Dynamic Routing",
                difficulty: "intermediate",
                estimatedTime: "35 minutes",
                icon: "üéì",
                description: "Implement OSPF routing protocol across three routers in Area 0. Learn neighbor discovery, LSA flooding, and automatic routing table construction.",
                concepts: ["OSPF Protocol", "Area 0", "Neighbor Adjacency", "Link-State Routing", "Dynamic Routes"],
                devices: "3 Routers, 3 Switches, 3 PCs",
                topology: {
                    devices: [
                        {id: "R1", type: "router", name: "Router-West", x: 150, y: 200},
                        {id: "R2", type: "router", name: "Router-Central", x: 400, y: 200},
                        {id: "R3", type: "router", name: "Router-East", x: 650, y: 200},
                        {id: "SW1", type: "l2switch", name: "SW-West", x: 150, y: 350},
                        {id: "SW2", type: "l2switch", name: "SW-Central", x: 400, y: 350},
                        {id: "SW3", type: "l2switch", name: "SW-East", x: 650, y: 350},
                        {id: "PC1", type: "pc", name: "PC-West", x: 150, y: 500},
                        {id: "PC2", type: "pc", name: "PC-Central", x: 400, y: 500},
                        {id: "PC3", type: "pc", name: "PC-East", x: 650, y: 500}
                    ],
                    connections: []
                },
                instructions: [
                    {
                        step: 1,
                        title: "Configure R1 Interfaces",
                        description: "Configure Router-West with Gi0/0 (10.1.1.1/24 to LAN) and Gi0/1 (10.12.12.1/30 to R2).",
                        commands: [
                            "enable",
                            "configure terminal",
                            "interface Gi0/0",
                            "ip address 10.1.1.1 255.255.255.0",
                            "no shutdown",
                            "interface Gi0/1",
                            "ip address 10.12.12.1 255.255.255.252",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 2,
                        title: "Configure R2 Interfaces",
                        description: "Configure Router-Central with three interfaces for LAN and WAN links.",
                        commands: [
                            "configure terminal",
                            "interface Gi0/0",
                            "ip address 10.2.2.1 255.255.255.0",
                            "no shutdown",
                            "interface Gi0/1",
                            "ip address 10.12.12.2 255.255.255.252",
                            "no shutdown",
                            "interface Gi0/2",
                            "ip address 10.23.23.1 255.255.255.252",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 3,
                        title: "Configure R3 Interfaces",
                        description: "Configure Router-East with Gi0/0 (10.3.3.1/24 to LAN) and Gi0/1 (10.23.23.2/30 to R2).",
                        commands: [
                            "configure terminal",
                            "interface Gi0/0",
                            "ip address 10.3.3.1 255.255.255.0",
                            "no shutdown",
                            "interface Gi0/1",
                            "ip address 10.23.23.2 255.255.255.252",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 4,
                        title: "Enable OSPF on R1",
                        description: "Configure OSPF process 1 on Router-West and advertise all connected networks into Area 0.",
                        commands: [
                            "router ospf 1",
                            "network 10.1.1.0 0.0.0.255 area 0",
                            "network 10.12.12.0 0.0.0.3 area 0",
                            "end"
                        ],
                        verification: "show ip ospf",
                        completed: false
                    },
                    {
                        step: 5,
                        title: "Enable OSPF on R2",
                        description: "Configure OSPF process 1 on Router-Central for all networks.",
                        commands: [
                            "router ospf 1",
                            "network 10.2.2.0 0.0.0.255 area 0",
                            "network 10.12.12.0 0.0.0.3 area 0",
                            "network 10.23.23.0 0.0.0.3 area 0",
                            "end"
                        ],
                        verification: "show ip ospf neighbor",
                        completed: false
                    },
                    {
                        step: 6,
                        title: "Enable OSPF on R3",
                        description: "Configure OSPF process 1 on Router-East and advertise networks into Area 0.",
                        commands: [
                            "router ospf 1",
                            "network 10.3.3.0 0.0.0.255 area 0",
                            "network 10.23.23.0 0.0.0.3 area 0",
                            "end"
                        ],
                        verification: "show ip ospf neighbor",
                        completed: false
                    },
                    {
                        step: 7,
                        title: "Verify OSPF Neighbors",
                        description: "Check that all routers have formed OSPF adjacencies (FULL state).",
                        commands: ["show ip ospf neighbor"],
                        verification: "All neighbors show FULL/DR or FULL/BDR",
                        completed: false
                    },
                    {
                        step: 8,
                        title: "Verify Routing Tables",
                        description: "Verify that each router has learned routes via OSPF (marked with 'O').",
                        commands: ["show ip route"],
                        verification: "Routes with 'O' prefix present",
                        completed: false
                    },
                    {
                        step: 9,
                        title: "Configure PCs",
                        description: "Set PC-West (10.1.1.10/24), PC-Central (10.2.2.10/24), PC-East (10.3.3.10/24) with appropriate gateways.",
                        commands: [
                            "PC-West: 10.1.1.10/24, GW 10.1.1.1",
                            "PC-Central: 10.2.2.10/24, GW 10.2.2.1",
                            "PC-East: 10.3.3.10/24, GW 10.3.3.1"
                        ],
                        verification: "ipconfig on all PCs",
                        completed: false
                    },
                    {
                        step: 10,
                        title: "Test End-to-End Connectivity",
                        description: "Ping from PC-West to PC-East to verify multi-hop OSPF routing.",
                        commands: ["ping 10.3.3.10"],
                        verification: "Successful ping with 3-hop path",
                        completed: false
                    }
                ]
            },

            lab04: {
                id: "lab04",
                title: "Lab 4: Inter-VLAN Routing",
                difficulty: "intermediate",
                estimatedTime: "30 minutes",
                icon: "üéì",
                description: "Configure a Layer 3 switch to route between VLANs using SVIs (Switch Virtual Interfaces). Learn the difference between L2 and L3 switching.",
                concepts: ["Layer 3 Switching", "SVIs", "Inter-VLAN Routing", "IP Routing", "VLAN Segmentation"],
                devices: "1 L3 Switch, 3 PCs, 1 Server",
                topology: {
                    devices: [
                        {id: "L3SW1", type: "l3switch", name: "CoreSwitch", x: 400, y: 200},
                        {id: "PC1", type: "pc", name: "PC-Sales", x: 200, y: 350},
                        {id: "PC2", type: "pc", name: "PC-Engineering", x: 400, y: 350},
                        {id: "PC3", type: "pc", name: "PC-Servers", x: 600, y: 350},
                        {id: "PC4", type: "pc", name: "PC-Sales2", x: 200, y: 500},
                        {id: "SRV1", type: "server", name: "FileServer", x: 400, y: 500}
                    ],
                    connections: []
                },
                instructions: [
                    {
                        step: 1,
                        title: "Introduction and Topology Overview",
                        description: "In this lab, you'll configure a Layer 3 switch to route between VLANs. Unlike traditional routing with a router, L3 switches use Switch Virtual Interfaces (SVIs) to provide default gateways for each VLAN. Observe the topology: One L3 switch connected to 6 end devices. Each device belongs to a different VLAN (Sales=VLAN 10, Engineering=VLAN 20, Servers=VLAN 30).",
                        commands: [],
                        verification: "Review the topology and understand the VLAN design",
                        completed: false
                    },
                    {
                        step: 2,
                        title: "Access CoreSwitch Configuration Mode",
                        description: "Enter privileged EXEC mode, then global configuration mode on the CoreSwitch.",
                        commands: [
                            "enable",
                            "configure terminal"
                        ],
                        verification: "Prompt shows CoreSwitch(config)#",
                        completed: false
                    },
                    {
                        step: 3,
                        title: "Create VLANs",
                        description: "Create three VLANs for network segmentation: VLAN 10 (Sales), VLAN 20 (Engineering), and VLAN 30 (Servers).",
                        commands: [
                            "vlan 10",
                            "name Sales",
                            "vlan 20",
                            "name Engineering",
                            "vlan 30",
                            "name Servers",
                            "exit"
                        ],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 4,
                        title: "Configure Access Ports for VLAN 10 (Sales)",
                        description: "Assign Gi0/1 and Gi0/5 to VLAN 10 for Sales PCs. These ports will operate in access mode.",
                        commands: [
                            "interface range GigabitEthernet0/1 , GigabitEthernet0/5",
                            "switchport mode access",
                            "switchport access vlan 10",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 5,
                        title: "Configure Access Ports for VLAN 20 (Engineering)",
                        description: "Assign Gi0/2 to VLAN 20 for the Engineering PC.",
                        commands: [
                            "interface GigabitEthernet0/2",
                            "switchport mode access",
                            "switchport access vlan 20",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 6,
                        title: "Configure Access Ports for VLAN 30 (Servers)",
                        description: "Assign Gi0/3 and Gi0/4 to VLAN 30 for the Server subnet.",
                        commands: [
                            "interface range GigabitEthernet0/3-4",
                            "switchport mode access",
                            "switchport access vlan 30",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 7,
                        title: "Verify VLAN Configuration",
                        description: "Verify that all VLANs have been created and interfaces are correctly assigned to their respective VLANs.",
                        commands: ["show vlan brief"],
                        verification: "VLANs 10, 20, and 30 with correct interfaces assigned",
                        completed: false
                    },
                    {
                        step: 8,
                        title: "Enable IP Routing on L3 Switch",
                        description: "This command enables Layer 3 routing functionality. Without this, the switch cannot route between VLANs! This is the critical command that transforms an L2 switch into an L3 switch.",
                        commands: [
                            "ip routing"
                        ],
                        verification: "show ip route (should show routing table)",
                        completed: false
                    },
                    {
                        step: 9,
                        title: "Create SVI for VLAN 10",
                        description: "Create SVI (Switch Virtual Interface) for VLAN 10. This IP becomes the default gateway for Sales devices (192.168.10.1).",
                        commands: [
                            "interface vlan 10",
                            "ip address 192.168.10.1 255.255.255.0",
                            "description Gateway for Sales VLAN",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 10,
                        title: "Create SVI for VLAN 20",
                        description: "Create SVI for VLAN 20 - Engineering gateway (192.168.20.1).",
                        commands: [
                            "interface vlan 20",
                            "ip address 192.168.20.1 255.255.255.0",
                            "description Gateway for Engineering VLAN",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 11,
                        title: "Create SVI for VLAN 30",
                        description: "Create SVI for VLAN 30 - Server gateway (192.168.30.1).",
                        commands: [
                            "interface vlan 30",
                            "ip address 192.168.30.1 255.255.255.0",
                            "description Gateway for Servers VLAN",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 12,
                        title: "Verify SVI Configuration",
                        description: "Verify that all three VLAN interfaces (Vlan10, Vlan20, Vlan30) show as 'up' with correct IP addresses.",
                        commands: ["show ip interface brief"],
                        verification: "All VLAN interfaces up with correct IPs",
                        completed: false
                    },
                    {
                        step: 13,
                        title: "Configure End Devices",
                        description: "Configure IP addresses and gateways on all end devices: PC-Sales (192.168.10.10/24, GW 192.168.10.1), PC-Sales2 (192.168.10.20/24, GW 192.168.10.1), PC-Engineering (192.168.20.10/24, GW 192.168.20.1), PC-Servers (192.168.30.10/24, GW 192.168.30.1), FileServer (192.168.30.100/24, GW 192.168.30.1).",
                        commands: [
                            "PC-Sales: 192.168.10.10/24, GW 192.168.10.1",
                            "PC-Sales2: 192.168.10.20/24, GW 192.168.10.1",
                            "PC-Engineering: 192.168.20.10/24, GW 192.168.20.1",
                            "PC-Servers: 192.168.30.10/24, GW 192.168.30.1",
                            "FileServer: 192.168.30.100/24, GW 192.168.30.1"
                        ],
                        verification: "ipconfig on all devices",
                        completed: false
                    },
                    {
                        step: 14,
                        title: "Test Inter-VLAN Connectivity",
                        description: "From PC-Sales (192.168.10.10), ping PC-Engineering (192.168.20.10) and FileServer (192.168.30.100). All pings should succeed! Inter-VLAN routing is working - devices in different VLANs can now communicate through the L3 switch.",
                        commands: [
                            "ping 192.168.20.10",
                            "ping 192.168.30.100"
                        ],
                        verification: "All pings successful - Inter-VLAN routing works!",
                        completed: false
                    }
                ]
            },

            lab05: {
                id: "lab05",
                title: "Lab 5: OSPF Multi-Area",
                difficulty: "advanced",
                estimatedTime: "40 minutes",
                icon: "üéì",
                category: "routing",
                description: "Configure multi-area OSPF with Areas 0, 1, and 2, understanding area types and LSA flooding",
                concepts: ["Multi-Area OSPF", "Area 0 Backbone", "ABR Configuration", "LSA Types", "OSPF Neighbors", "Inter-Area Routing"],
                devices: "3 Routers, 2 PCs",
                topology: {
                    devices: [
                        {id: "R1", type: "router", name: "ABR-West", x: 200, y: 250},
                        {id: "R2", type: "router", name: "ABR-Core", x: 400, y: 150},
                        {id: "R3", type: "router", name: "ABR-East", x: 600, y: 250},
                        {id: "PC1", type: "pc", name: "PC-West", x: 100, y: 400},
                        {id: "PC2", type: "pc", name: "PC-East", x: 700, y: 400}
                    ],
                    connections: [
                        {from: "R1", fromPort: "Gi0/0", to: "R2", toPort: "Gi0/0", color: "red", label: "Area 0"},
                        {from: "R2", fromPort: "Gi0/1", to: "R3", toPort: "Gi0/0", color: "red", label: "Area 0"},
                        {from: "R1", fromPort: "Gi0/1", to: "PC1", toPort: "Ethernet0", color: "green", label: "Area 1"},
                        {from: "R3", fromPort: "Gi0/1", to: "PC2", toPort: "Ethernet0", color: "orange", label: "Area 2"}
                    ]
                },
                instructions: [
                    {
                        step: 1,
                        title: "Introduction to Multi-Area OSPF",
                        description: "Multi-area OSPF reduces routing table size and LSA flooding. Area 0 (backbone) is mandatory, and all other areas must connect to it through an ABR (Area Border Router). In this lab, we have three areas: Area 0 (backbone connecting ABR-West, ABR-Core, ABR-East), Area 1 (West branch), and Area 2 (East branch).",
                        commands: [],
                        verification: "Review the topology and understand the area design",
                        completed: false
                    },
                    {
                        step: 2,
                        title: "Configure ABR-West Loopback (Router ID)",
                        description: "Loopback interfaces provide stable Router IDs that don't go down. Configure loopback 0 on ABR-West with IP 1.1.1.1/32.",
                        commands: [
                            "enable",
                            "configure terminal",
                            "interface loopback 0",
                            "ip address 1.1.1.1 255.255.255.255",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 3,
                        title: "Configure ABR-West Interfaces",
                        description: "Configure Gi0/0 (10.1.1.1/30 to ABR-Core) and Gi0/1 (10.2.1.1/24 to PC-West).",
                        commands: [
                            "interface GigabitEthernet0/0",
                            "ip address 10.1.1.1 255.255.255.252",
                            "no shutdown",
                            "exit",
                            "interface GigabitEthernet0/1",
                            "ip address 10.2.1.1 255.255.255.0",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 4,
                        title: "Configure OSPF on ABR-West",
                        description: "Configure OSPF process 1 with router-id 1.1.1.1. Add Gi0/0 (10.1.1.0/30) to Area 0 and Gi0/1 (10.2.1.0/24) to Area 1. Area 0 is the backbone. Area 1 is for the West branch.",
                        commands: [
                            "router ospf 1",
                            "router-id 1.1.1.1",
                            "network 10.1.1.0 0.0.0.3 area 0",
                            "network 10.2.1.0 0.0.0.255 area 1",
                            "exit"
                        ],
                        verification: "show ip protocols",
                        completed: false
                    },
                    {
                        step: 5,
                        title: "Configure ABR-Core Loopback",
                        description: "Configure loopback 0 on ABR-Core with IP 2.2.2.2/32 for stable Router ID.",
                        commands: [
                            "enable",
                            "configure terminal",
                            "interface loopback 0",
                            "ip address 2.2.2.2 255.255.255.255",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 6,
                        title: "Configure ABR-Core Interfaces",
                        description: "Configure Gi0/0 (10.1.1.2/30 to ABR-West) and Gi0/1 (10.1.2.1/30 to ABR-East). Both interfaces are in Area 0.",
                        commands: [
                            "interface GigabitEthernet0/0",
                            "ip address 10.1.1.2 255.255.255.252",
                            "no shutdown",
                            "exit",
                            "interface GigabitEthernet0/1",
                            "ip address 10.1.2.1 255.255.255.252",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 7,
                        title: "Configure OSPF on ABR-Core",
                        description: "Configure OSPF process 1 with router-id 2.2.2.2. Both interfaces belong to Area 0. ABR-Core is a pure backbone router.",
                        commands: [
                            "router ospf 1",
                            "router-id 2.2.2.2",
                            "network 10.1.1.0 0.0.0.3 area 0",
                            "network 10.1.2.0 0.0.0.3 area 0",
                            "exit"
                        ],
                        verification: "show ip protocols",
                        completed: false
                    },
                    {
                        step: 8,
                        title: "Configure ABR-East Loopback",
                        description: "Configure loopback 0 on ABR-East with IP 3.3.3.3/32 for stable Router ID.",
                        commands: [
                            "enable",
                            "configure terminal",
                            "interface loopback 0",
                            "ip address 3.3.3.3 255.255.255.255",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 9,
                        title: "Configure ABR-East Interfaces",
                        description: "Configure Gi0/0 (10.1.2.2/30 to ABR-Core) and Gi0/1 (10.3.1.1/24 to PC-East).",
                        commands: [
                            "interface GigabitEthernet0/0",
                            "ip address 10.1.2.2 255.255.255.252",
                            "no shutdown",
                            "exit",
                            "interface GigabitEthernet0/1",
                            "ip address 10.3.1.1 255.255.255.0",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 10,
                        title: "Configure OSPF on ABR-East",
                        description: "Configure OSPF process 1 with router-id 3.3.3.3. Add Gi0/0 (10.1.2.0/30) to Area 0 and Gi0/1 (10.3.1.0/24) to Area 2. ABR-East connects Area 0 and Area 2.",
                        commands: [
                            "router ospf 1",
                            "router-id 3.3.3.3",
                            "network 10.1.2.0 0.0.0.3 area 0",
                            "network 10.3.1.0 0.0.0.255 area 2",
                            "exit"
                        ],
                        verification: "show ip protocols",
                        completed: false
                    },
                    {
                        step: 11,
                        title: "Verify OSPF Neighbors",
                        description: "Check OSPF neighbor relationships on all routers. Each router should see its neighbors. ABRs show neighbors in multiple areas.",
                        commands: ["show ip ospf neighbor"],
                        verification: "All neighbors show FULL state with correct Router IDs",
                        completed: false
                    },
                    {
                        step: 12,
                        title: "Verify OSPF Database",
                        description: "Examine the OSPF Link State Database. Notice different LSA types: Type 1 (Router LSA), Type 2 (Network LSA), Type 3 (Summary LSA for inter-area routes).",
                        commands: ["show ip ospf database"],
                        verification: "LSA types 1, 2, and 3 visible in database",
                        completed: false
                    },
                    {
                        step: 13,
                        title: "Examine Routing Table",
                        description: "View OSPF routes in the routing table. Routes learned via OSPF are marked with 'O' (intra-area) or 'O IA' (inter-area routes from other areas).",
                        commands: ["show ip route ospf"],
                        verification: "OSPF routes present with O and O IA designations",
                        completed: false
                    },
                    {
                        step: 14,
                        title: "Verify ABR Status",
                        description: "Check OSPF process details. ABR-West and ABR-East should show as ABRs (Area Border Routers) because they connect multiple areas.",
                        commands: ["show ip ospf"],
                        verification: "ABR-West and ABR-East display as Area Border Routers",
                        completed: false
                    },
                    {
                        step: 15,
                        title: "Configure PC IP Addresses",
                        description: "Configure PC-West with IP 10.2.1.10/24 and gateway 10.2.1.1. Configure PC-East with IP 10.3.1.10/24 and gateway 10.3.1.1.",
                        commands: [
                            "PC-West: 10.2.1.10/24, GW 10.2.1.1",
                            "PC-East: 10.3.1.10/24, GW 10.3.1.1"
                        ],
                        verification: "ipconfig on both PCs shows correct IPs and gateways",
                        completed: false
                    },
                    {
                        step: 16,
                        title: "Test End-to-End Connectivity",
                        description: "Ping from PC-West (10.2.1.10) to PC-East (10.3.1.10). Traffic routes through Area 0 backbone! PC-West (Area 1) ‚Üí ABR-West ‚Üí Area 0 (ABR-Core) ‚Üí ABR-East ‚Üí PC-East (Area 2).",
                        commands: ["ping 10.3.1.10"],
                        verification: "Successful ping - Multi-area OSPF routing works!",
                        completed: false
                    }
                ]
            },

            lab06: {
                id: "lab06",
                title: "Lab 6: Access Control Lists (ACLs)",
                difficulty: "advanced",
                estimatedTime: "35 minutes",
                icon: "üîí",
                category: "security",
                description: "Configure standard and extended ACLs to control network traffic and enhance security",
                concepts: ["Standard ACLs", "Extended ACLs", "Access Control", "Traffic Filtering", "Security Policies", "Implicit Deny"],
                devices: "2 Routers, 2 PCs, 1 Server",
                topology: {
                    devices: [
                        {id: "R1", type: "router", name: "Gateway-Router", x: 400, y: 200},
                        {id: "PC1", type: "pc", name: "PC-User1", x: 200, y: 350},
                        {id: "PC2", type: "pc", name: "PC-User2", x: 300, y: 350},
                        {id: "SRV1", type: "server", name: "WebServer", x: 500, y: 350},
                        {id: "R2", type: "router", name: "ISP-Router", x: 600, y: 200}
                    ],
                    connections: [
                        {from: "R1", fromPort: "Gi0/0", to: "PC1", toPort: "Ethernet0", color: "cyan", label: "LAN"},
                        {from: "R1", fromPort: "Gi0/0", to: "PC2", toPort: "Ethernet0", color: "cyan", label: "LAN"},
                        {from: "R1", fromPort: "Gi0/1", to: "SRV1", toPort: "Ethernet0", color: "green", label: "DMZ"},
                        {from: "R1", fromPort: "Gi0/2", to: "R2", toPort: "Gi0/0", color: "red", label: "WAN"}
                    ]
                },
                instructions: [
                    {
                        step: 1,
                        title: "Introduction to ACLs",
                        description: "ACLs filter traffic based on IP addresses, protocols, and ports. They're essential for network security. Standard ACLs (1-99) filter by source IP only. Extended ACLs (100-199) filter by source/destination IP, protocol, and port. Remember: there's an implicit deny at the end of every ACL!",
                        commands: [],
                        verification: "Review the topology and understand ACL concepts",
                        completed: false
                    },
                    {
                        step: 2,
                        title: "Configure Gateway-Router Interfaces",
                        description: "Configure the three interfaces on Gateway-Router: Gi0/0 for LAN (Internal users), Gi0/1 for DMZ (Servers), and Gi0/2 for WAN (Internet connection).",
                        commands: [
                            "enable",
                            "configure terminal",
                            "hostname Gateway-Router",
                            "interface GigabitEthernet0/0",
                            "ip address 192.168.10.1 255.255.255.0",
                            "description LAN-Internal",
                            "no shutdown",
                            "exit",
                            "interface GigabitEthernet0/1",
                            "ip address 192.168.20.1 255.255.255.0",
                            "description DMZ-Servers",
                            "no shutdown",
                            "exit",
                            "interface GigabitEthernet0/2",
                            "ip address 203.0.113.1 255.255.255.252",
                            "description WAN-Internet",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show ip interface brief",
                        completed: false
                    },
                    {
                        step: 3,
                        title: "Configure ISP-Router Interface",
                        description: "Configure the WAN interface on ISP-Router to complete the Internet connection.",
                        commands: [
                            "enable",
                            "configure terminal",
                            "interface GigabitEthernet0/0",
                            "ip address 203.0.113.2 255.255.255.252",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show ip interface brief on ISP-Router",
                        completed: false
                    },
                    {
                        step: 4,
                        title: "Test Baseline Connectivity",
                        description: "Before applying ACLs, verify that connectivity works. Configure PCs and server, then test pings. PC-User1: 192.168.10.10/24, PC-User2: 192.168.10.20/24, WebServer: 192.168.20.10/24. All gateways point to their respective router interfaces.",
                        commands: [
                            "PC-User1: 192.168.10.10/24, GW 192.168.10.1",
                            "PC-User2: 192.168.10.20/24, GW 192.168.10.1",
                            "WebServer: 192.168.20.10/24, GW 192.168.20.1"
                        ],
                        verification: "Ping from PC-User1 to WebServer (192.168.20.10) - should succeed",
                        completed: false
                    },
                    {
                        step: 5,
                        title: "Create Standard ACL (Block PC-User2)",
                        description: "Create standard ACL 10 to block PC-User2 (192.168.10.20) from accessing the DMZ, but allow all other traffic. IMPORTANT: Add 'permit any' to avoid the implicit deny blocking everyone else!",
                        commands: [
                            "access-list 10 deny host 192.168.10.20",
                            "access-list 10 permit any"
                        ],
                        verification: "show access-lists",
                        completed: false
                    },
                    {
                        step: 6,
                        title: "Apply Standard ACL Outbound on Gi0/1",
                        description: "Apply ACL 10 outbound on the DMZ interface (Gi0/1). This prevents PC-User2 from reaching the WebServer while allowing PC-User1 access. Standard ACLs should be placed close to the destination.",
                        commands: [
                            "interface GigabitEthernet0/1",
                            "ip access-group 10 out",
                            "exit"
                        ],
                        verification: "show ip interface GigabitEthernet0/1",
                        completed: false
                    },
                    {
                        step: 7,
                        title: "Verify Standard ACL",
                        description: "Test the ACL: Ping from PC-User1 to WebServer should succeed. Ping from PC-User2 to WebServer should fail (blocked by ACL 10).",
                        commands: [
                            "From PC-User1: ping 192.168.20.10 (SUCCESS)",
                            "From PC-User2: ping 192.168.20.10 (FAIL - blocked)"
                        ],
                        verification: "PC-User1 can reach WebServer, PC-User2 cannot",
                        completed: false
                    },
                    {
                        step: 8,
                        title: "Create Extended ACL (Protocol/Port Filtering)",
                        description: "Create extended ACL 100 to allow HTTP (80) and HTTPS (443) to WebServer, allow ICMP everywhere, but block Telnet (23). This demonstrates protocol and port-based filtering.",
                        commands: [
                            "access-list 100 permit tcp any host 192.168.20.10 eq 80",
                            "access-list 100 permit tcp any host 192.168.20.10 eq 443",
                            "access-list 100 permit icmp any any",
                            "access-list 100 deny tcp any any eq 23",
                            "access-list 100 permit ip any any"
                        ],
                        verification: "show access-lists 100",
                        completed: false
                    },
                    {
                        step: 9,
                        title: "Apply Extended ACL Inbound on Gi0/0",
                        description: "Apply ACL 100 inbound on the LAN interface (Gi0/0) to filter traffic from internal users. Extended ACLs should be placed close to the source.",
                        commands: [
                            "interface GigabitEthernet0/0",
                            "ip access-group 100 in",
                            "exit"
                        ],
                        verification: "show ip interface GigabitEthernet0/0",
                        completed: false
                    },
                    {
                        step: 10,
                        title: "Remove Standard ACL (for Testing)",
                        description: "Temporarily remove the standard ACL from Gi0/1 so we can test the extended ACL in isolation without conflicts.",
                        commands: [
                            "interface GigabitEthernet0/1",
                            "no ip access-group 10 out",
                            "exit"
                        ],
                        verification: "show ip interface GigabitEthernet0/1 - no ACL applied",
                        completed: false
                    },
                    {
                        step: 11,
                        title: "Test Extended ACL - ICMP",
                        description: "Test that ICMP (ping) is still allowed. Ping from PC-User1 to WebServer should succeed because ACL 100 permits ICMP.",
                        commands: [
                            "ping 192.168.20.10"
                        ],
                        verification: "Ping successful - ICMP permitted by ACL 100",
                        completed: false
                    },
                    {
                        step: 12,
                        title: "Test Extended ACL - HTTP vs Telnet",
                        description: "In a real network, HTTP connections (port 80) to WebServer would succeed, while Telnet (port 23) would be blocked. ACL 100 allows HTTP/HTTPS to the server but denies Telnet everywhere.",
                        commands: [
                            "HTTP to 192.168.20.10:80 would succeed",
                            "Telnet to any device on port 23 would fail"
                        ],
                        verification: "Understand protocol-specific filtering",
                        completed: false
                    },
                    {
                        step: 13,
                        title: "View ACL Statistics",
                        description: "Use 'show access-lists' to view all configured ACLs and their match counters. Each line shows how many packets matched that rule. This helps troubleshoot ACL effectiveness.",
                        commands: [
                            "show access-lists"
                        ],
                        verification: "See ACLs 10 and 100 with match counters showing packet hits",
                        completed: false
                    },
                    {
                        step: 14,
                        title: "View Applied ACLs on Interfaces",
                        description: "Use 'show ip interface' to see which ACLs are applied to which interfaces and in which direction (in/out). This is crucial for verifying ACL placement.",
                        commands: [
                            "show ip interface GigabitEthernet0/0",
                            "show ip interface GigabitEthernet0/1"
                        ],
                        verification: "Gi0/0 shows ACL 100 inbound, Gi0/1 shows no ACL (we removed ACL 10)",
                        completed: false
                    },
                    {
                        step: 15,
                        title: "ACL Best Practices Summary",
                        description: "Key takeaways: (1) Standard ACLs close to destination, Extended ACLs close to source. (2) Always add explicit 'permit any' to avoid implicit deny blocking everything. (3) Process top-to-bottom, first match wins. (4) Use 'show access-lists' to verify rules. (5) Test thoroughly before deploying in production!",
                        commands: [],
                        verification: "Understand ACL design principles and best practices",
                        completed: false
                    }
                ]
            },

            lab07: {
                id: "lab07",
                title: "Lab 7: VLAN Trunking (802.1Q)",
                difficulty: "intermediate",
                estimatedTime: "30 minutes",
                icon: "üéì",
                category: "switching",
                description: "Configure 802.1Q trunks between switches to carry multiple VLANs, including native VLAN configuration",
                concepts: ["802.1Q Trunking", "Native VLAN", "VLAN Tagging", "Trunk Ports", "VLAN Security"],
                devices: "2 L2 Switches, 4 PCs",
                topology: {
                    devices: [
                        {id: "SW1", type: "l2switch", name: "CoreSwitch", x: 300, y: 200},
                        {id: "SW2", type: "l2switch", name: "DistroSwitch", x: 500, y: 200},
                        {id: "PC1", type: "pc", name: "PC-VLAN10-A", x: 200, y: 350},
                        {id: "PC2", type: "pc", name: "PC-VLAN20-A", x: 300, y: 350},
                        {id: "PC3", type: "pc", name: "PC-VLAN10-B", x: 500, y: 350},
                        {id: "PC4", type: "pc", name: "PC-VLAN20-B", x: 600, y: 350}
                    ],
                    connections: [
                        {from: "SW1", fromPort: "Gi0/1", to: "SW2", toPort: "Gi0/1", color: "purple", label: "Trunk"},
                        {from: "SW1", fromPort: "Gi0/2", to: "PC1", toPort: "Ethernet0", color: "cyan", label: "VLAN 10"},
                        {from: "SW1", fromPort: "Gi0/3", to: "PC2", toPort: "Ethernet0", color: "green", label: "VLAN 20"},
                        {from: "SW2", fromPort: "Gi0/2", to: "PC3", toPort: "Ethernet0", color: "cyan", label: "VLAN 10"},
                        {from: "SW2", fromPort: "Gi0/3", to: "PC4", toPort: "Ethernet0", color: "green", label: "VLAN 20"}
                    ]
                },
                instructions: [
                    {
                        step: 1,
                        title: "Introduction to VLAN Trunking",
                        description: "Trunk ports carry traffic for multiple VLANs using 802.1Q tagging. This allows switches to extend VLANs across the network. In this lab, you'll configure trunk links between two switches to carry VLAN 10 (Sales) and VLAN 20 (Engineering) traffic. You'll also configure a native VLAN for security purposes.",
                        commands: [],
                        verification: "Review the topology and understand trunk link concept",
                        completed: false
                    },
                    {
                        step: 2,
                        title: "Configure VLANs on CoreSwitch",
                        description: "Create VLANs 10, 20, and 99 (native VLAN for security). VLAN 10 will be used for Sales, VLAN 20 for Engineering, and VLAN 99 as an unused native VLAN to prevent VLAN hopping attacks.",
                        commands: [
                            "enable",
                            "configure terminal",
                            "hostname CoreSwitch",
                            "vlan 10",
                            "name Sales",
                            "vlan 20",
                            "name Engineering",
                            "vlan 99",
                            "name Native",
                            "exit"
                        ],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 3,
                        title: "Configure CoreSwitch Access Ports",
                        description: "Configure Gi0/2 as an access port in VLAN 10 and Gi0/3 as an access port in VLAN 20. Access ports carry traffic for only one VLAN and send untagged frames.",
                        commands: [
                            "interface GigabitEthernet0/2",
                            "switchport mode access",
                            "switchport access vlan 10",
                            "no shutdown",
                            "interface GigabitEthernet0/3",
                            "switchport mode access",
                            "switchport access vlan 20",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 4,
                        title: "Configure CoreSwitch Trunk Port",
                        description: "Configure Gi0/1 as trunk. Native VLAN 99 (untagged). Only VLANs 10, 20, 99 allowed. The native VLAN carries untagged traffic - using VLAN 99 (an unused VLAN) prevents VLAN hopping attacks. The 'allowed vlan' command restricts which VLANs can traverse the trunk.",
                        commands: [
                            "interface GigabitEthernet0/1",
                            "switchport mode trunk",
                            "switchport trunk native vlan 99",
                            "switchport trunk allowed vlan 10,20,99",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show interfaces trunk",
                        completed: false
                    },
                    {
                        step: 5,
                        title: "Configure VLANs on DistroSwitch",
                        description: "VLANs must exist on both switches for trunk to work properly. Create the same VLANs (10, 20, 99) on DistroSwitch with identical names.",
                        commands: [
                            "enable",
                            "configure terminal",
                            "hostname DistroSwitch",
                            "vlan 10",
                            "name Sales",
                            "vlan 20",
                            "name Engineering",
                            "vlan 99",
                            "name Native",
                            "exit"
                        ],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 6,
                        title: "Configure DistroSwitch Access Ports",
                        description: "Configure access ports on DistroSwitch: Gi0/2 for VLAN 10 and Gi0/3 for VLAN 20. These ports will connect to end devices in their respective VLANs.",
                        commands: [
                            "interface GigabitEthernet0/2",
                            "switchport mode access",
                            "switchport access vlan 10",
                            "no shutdown",
                            "interface GigabitEthernet0/3",
                            "switchport mode access",
                            "switchport access vlan 20",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show vlan brief",
                        completed: false
                    },
                    {
                        step: 7,
                        title: "Configure DistroSwitch Trunk Port",
                        description: "Both ends of trunk must have matching native VLAN! Configure Gi0/1 with the same trunk settings: native VLAN 99, allowed VLANs 10,20,99. Native VLAN mismatch is a common misconfiguration that causes connectivity issues.",
                        commands: [
                            "interface GigabitEthernet0/1",
                            "switchport mode trunk",
                            "switchport trunk native vlan 99",
                            "switchport trunk allowed vlan 10,20,99",
                            "no shutdown",
                            "exit"
                        ],
                        verification: "show interfaces trunk",
                        completed: false
                    },
                    {
                        step: 8,
                        title: "Verify Trunk Status",
                        description: "Verify that Gi0/1 is operating as a trunk port. The output should show: Mode: on, Encapsulation: 802.1Q, Native VLAN: 99, and Status: trunking.",
                        commands: [
                            "show interfaces trunk"
                        ],
                        verification: "Gi0/1 should show as trunk, Mode: on, Encapsulation: 802.1Q, Native VLAN: 99",
                        completed: false
                    },
                    {
                        step: 9,
                        title: "Verify VLANs on Trunk",
                        description: "Check the switchport configuration for the trunk interface. Verify that only VLANs 10, 20, and 99 are allowed on the trunk, and that the native VLAN is 99.",
                        commands: [
                            "show interfaces GigabitEthernet0/1 switchport"
                        ],
                        verification: "Trunking VLANs Allowed: 10, 20, 99. Native VLAN: 99",
                        completed: false
                    },
                    {
                        step: 10,
                        title: "Check VLAN Database",
                        description: "Verify that VLANs 10, 20, and 99 exist in the VLAN database and that access ports are correctly assigned to their respective VLANs.",
                        commands: [
                            "show vlan brief"
                        ],
                        verification: "VLANs 10, 20, 99 exist. Access ports assigned correctly",
                        completed: false
                    },
                    {
                        step: 11,
                        title: "Test VLAN 10 Connectivity",
                        description: "Configure IP addresses on VLAN 10 PCs and test connectivity across the trunk. PC-VLAN10-A: 192.168.10.10/24, Gateway: 192.168.10.1. PC-VLAN10-B: 192.168.10.20/24, Gateway: 192.168.10.1. Then ping from PC-VLAN10-A (192.168.10.10) to PC-VLAN10-B (192.168.10.20). SUCCESS across trunk!",
                        commands: [
                            "PC-VLAN10-A: IP 192.168.10.10/24, GW 192.168.10.1",
                            "PC-VLAN10-B: IP 192.168.10.20/24, GW 192.168.10.1",
                            "ping 192.168.10.20"
                        ],
                        verification: "Ping successful - VLAN 10 traffic crosses trunk",
                        completed: false
                    },
                    {
                        step: 12,
                        title: "Test VLAN 20 Connectivity",
                        description: "Configure IP addresses on VLAN 20 PCs and test connectivity. PC-VLAN20-A: 192.168.20.10/24, Gateway: 192.168.20.1. PC-VLAN20-B: 192.168.20.20/24, Gateway: 192.168.20.1. Then ping from PC-VLAN20-A (192.168.20.10) to PC-VLAN20-B (192.168.20.20). SUCCESS across trunk!",
                        commands: [
                            "PC-VLAN20-A: IP 192.168.20.10/24, GW 192.168.20.1",
                            "PC-VLAN20-B: IP 192.168.20.20/24, GW 192.168.20.1",
                            "ping 192.168.20.20"
                        ],
                        verification: "Ping successful - VLAN 20 traffic crosses trunk",
                        completed: false
                    },
                    {
                        step: 13,
                        title: "Test VLAN Isolation",
                        description: "Verify that VLANs remain isolated even though they traverse the same trunk link. Ping from PC-VLAN10-A (192.168.10.10) to PC-VLAN20-A (192.168.20.10). FAIL - different VLANs cannot communicate without Layer 3 routing! The trunk carries both VLANs but maintains complete isolation.",
                        commands: [
                            "ping 192.168.20.10"
                        ],
                        verification: "Ping fails - VLANs are isolated (Layer 2 boundary)",
                        completed: false
                    },
                    {
                        step: 14,
                        title: "Native VLAN Security Note",
                        description: "Native VLAN carries untagged traffic. Best practice: Use unused VLAN (like 99) as native to prevent VLAN hopping attacks. Never use VLAN 1 as native! VLAN hopping attacks exploit native VLAN behavior to gain unauthorized access to other VLANs. By using an unused VLAN as native and not assigning any ports to it, you eliminate this attack vector. Key takeaways: (1) Both trunk ends must have matching native VLAN, (2) Use non-default unused VLAN as native, (3) Don't assign any access ports to native VLAN, (4) Restrict allowed VLANs on trunks to only what's needed.",
                        commands: [],
                        verification: "Understand native VLAN security best practices",
                        completed: false
                    }
                ]
            }
        };

        // ========== TROUBLESHOOTING SCENARIOS LIBRARY ==========
        const TROUBLESHOOTING_SCENARIOS = {
            'ts-01-interface-down': {
                id: 'ts-01-interface-down',
                title: 'Interface Shutdown Mystery',
                difficulty: 'beginner',
                estimatedTime: '10 min',
                description: 'PC1 cannot ping Router1, but the cabling looks correct. What\'s wrong?',

                // Broken topology - router interface is shut down
                topology: {
                    devices: [
                        {
                            id: 'router1',
                            type: 'router',
                            name: 'Router1',
                            x: 300,
                            y: 200,
                            interfaces: {
                                'Gi0/0': {
                                    ip: '192.168.1.1',
                                    mask: '255.255.255.0',
                                    shutdown: true  // THE PROBLEM!
                                }
                            },
                            config: [
                                'hostname Router1',
                                'interface GigabitEthernet0/0',
                                ' ip address 192.168.1.1 255.255.255.0',
                                ' shutdown'  // Explicitly shutdown
                            ]
                        },
                        {
                            id: 'pc1',
                            type: 'pc',
                            name: 'PC1',
                            x: 100,
                            y: 200,
                            ip: '192.168.1.10',
                            mask: '255.255.255.0',
                            gateway: '192.168.1.1'
                        }
                    ],
                    connections: [
                        {from: 'pc1', to: 'router1', fromPort: 'NIC', toPort: 'Gi0/0'}
                    ]
                },

                // Progressive hints
                hints: [
                    {
                        level: 1,
                        text: "Check the router's interface status using show commands. What does 'administratively down' mean?"
                    },
                    {
                        level: 2,
                        text: "Use 'show ip interface brief' on Router1. Look at the Status column for Gi0/0."
                    },
                    {
                        level: 3,
                        text: "Interface Gi0/0 shows 'administratively down' - it has been manually disabled with the 'shutdown' command."
                    }
                ],

                // Solution
                solution: {
                    explanation: "The interface was administratively disabled using the 'shutdown' command. This is a common issue when routers are first configured - interfaces are shut down by default for security.",
                    commands: [
                        "enable",
                        "configure terminal",
                        "interface GigabitEthernet0/0",
                        "no shutdown",
                        "end"
                    ],
                    why: "The 'no shutdown' command enables a disabled interface. You'll see the interface status change from 'administratively down' to 'up/up' when successful."
                },

                // Verification test
                verification: {
                    checks: [
                        {
                            type: 'interface-status',
                            device: 'router1',
                            interface: 'Gi0/0',
                            expectedStatus: 'up',
                            expectedProtocol: 'up',
                            message: 'Router1 Gi0/0 must be up/up'
                        },
                        {
                            type: 'ping',
                            from: 'pc1',
                            to: '192.168.1.1',
                            expectedSuccess: true,
                            message: 'PC1 must be able to ping Router1'
                        }
                    ]
                },

                // Learning objectives
                skills: [
                    'Interface troubleshooting',
                    'show ip interface brief',
                    'Administrative vs operational state',
                    'no shutdown command'
                ]
            },
            'ts-02-wrong-vlan': {
                id: 'ts-02-wrong-vlan',
                title: 'Wrong VLAN Assignment',
                difficulty: 'beginner',
                estimatedTime: '15 min',
                description: 'PC1 and PC2 are both supposed to be in VLAN 10, but they cannot ping each other even though they\'re on the same switch.',

                topology: {
                    devices: [
                        {
                            id: 'switch1',
                            type: 'switch',
                            name: 'Switch1',
                            x: 300,
                            y: 200,
                            vlans: {
                                '10': {name: 'Sales', ports: ['Fa0/1']},
                                '20': {name: 'Engineering', ports: ['Fa0/2']}  // ‚Üê PC2 wrongly assigned here
                            },
                            config: [
                                'hostname Switch1',
                                'vlan 10',
                                ' name Sales',
                                'vlan 20',
                                ' name Engineering',
                                'interface FastEthernet0/1',
                                ' switchport mode access',
                                ' switchport access vlan 10',
                                'interface FastEthernet0/2',
                                ' switchport mode access',
                                ' switchport access vlan 20'  // ‚Üê THE PROBLEM! Should be VLAN 10
                            ]
                        },
                        {
                            id: 'pc1',
                            type: 'pc',
                            name: 'PC1',
                            x: 100,
                            y: 100,
                            ip: '192.168.10.10',
                            mask: '255.255.255.0',
                            gateway: '192.168.10.1',
                            vlan: 10
                        },
                        {
                            id: 'pc2',
                            type: 'pc',
                            name: 'PC2',
                            x: 100,
                            y: 300,
                            ip: '192.168.10.20',
                            mask: '255.255.255.0',
                            gateway: '192.168.10.1',
                            vlan: 20  // ‚Üê Wrong VLAN!
                        }
                    ],
                    connections: [
                        {from: 'pc1', to: 'switch1', fromPort: 'NIC', toPort: 'Fa0/1'},
                        {from: 'pc2', to: 'switch1', fromPort: 'NIC', toPort: 'Fa0/2'}
                    ]
                },

                hints: [
                    {
                        level: 1,
                        text: "VLANs create separate broadcast domains. Check which VLAN each port is assigned to using 'show vlan brief'."
                    },
                    {
                        level: 2,
                        text: "Look at the output of 'show vlan brief' on Switch1. Compare the VLAN assignments for Fa0/1 and Fa0/2. Are both ports in VLAN 10?"
                    },
                    {
                        level: 3,
                        text: "Port Fa0/2 (connected to PC2) is assigned to VLAN 20, but PC2 needs to be in VLAN 10 to communicate with PC1. This is a common configuration error."
                    }
                ],

                solution: {
                    explanation: "PC2's switch port was incorrectly configured in VLAN 20 instead of VLAN 10. VLANs isolate traffic - devices in different VLANs cannot communicate without a router. Since both PCs should be in the same sales department (VLAN 10), we need to reassign the port.",
                    commands: [
                        "enable",
                        "configure terminal",
                        "interface FastEthernet0/2",
                        "switchport access vlan 10",
                        "end"
                    ],
                    why: "The 'switchport access vlan 10' command moves the port from VLAN 20 to VLAN 10. Now both PCs are in the same broadcast domain and can communicate. You can verify with 'show vlan brief' - you'll see Fa0/2 listed under VLAN 10 instead of VLAN 20."
                },

                verification: {
                    checks: [
                        {
                            type: 'vlan-membership',
                            device: 'switch1',
                            interface: 'Fa0/2',
                            expectedVlan: 10,
                            message: 'Switch1 Fa0/2 must be in VLAN 10'
                        },
                        {
                            type: 'ping',
                            from: 'pc1',
                            to: '192.168.10.20',
                            expectedSuccess: true,
                            message: 'PC1 must be able to ping PC2'
                        }
                    ]
                },

                skills: [
                    'VLAN troubleshooting',
                    'show vlan brief',
                    'Switchport access vlan command',
                    'Understanding broadcast domains'
                ]
            },

            'ts-03-missing-gateway': {
                id: 'ts-03-missing-gateway',
                title: 'Missing Default Gateway',
                difficulty: 'beginner',
                estimatedTime: '15 min',
                description: 'PC1 can ping the router (192.168.1.1) but cannot reach remote networks. The router can reach everything fine.',

                topology: {
                    devices: [
                        {
                            id: 'router1',
                            type: 'router',
                            name: 'Router1',
                            x: 300,
                            y: 200,
                            interfaces: {
                                'Gi0/0': {ip: '192.168.1.1', mask: '255.255.255.0'},
                                'Gi0/1': {ip: '10.0.0.1', mask: '255.255.255.0'}
                            },
                            routes: [
                                {network: '192.168.1.0', mask: '255.255.255.0', interface: 'Gi0/0'},
                                {network: '10.0.0.0', mask: '255.255.255.0', interface: 'Gi0/1'}
                            ]
                        },
                        {
                            id: 'pc1',
                            type: 'pc',
                            name: 'PC1',
                            x: 100,
                            y: 200,
                            ip: '192.168.1.10',
                            mask: '255.255.255.0',
                            gateway: ''  // THE PROBLEM! No gateway configured
                        },
                        {
                            id: 'pc2',
                            type: 'pc',
                            name: 'PC2',
                            x: 500,
                            y: 200,
                            ip: '10.0.0.10',
                            mask: '255.255.255.0',
                            gateway: '10.0.0.1'
                        }
                    ],
                    connections: [
                        {from: 'pc1', to: 'router1', fromPort: 'NIC', toPort: 'Gi0/0'},
                        {from: 'pc2', to: 'router1', fromPort: 'NIC', toPort: 'Gi0/1'}
                    ]
                },

                hints: [
                    {
                        level: 1,
                        text: "PCs need a default gateway to reach networks beyond their local subnet. Check PC1's IP configuration - is the gateway set?"
                    },
                    {
                        level: 2,
                        text: "Use 'ipconfig' or check PC1's network settings. The default gateway field should contain the router's IP address (192.168.1.1), but what do you see?"
                    },
                    {
                        level: 3,
                        text: "PC1 has no default gateway configured! Without a gateway, the PC doesn't know where to send packets destined for other networks. It can only communicate on its local subnet (192.168.1.0/24)."
                    }
                ],

                solution: {
                    explanation: "PC1 is missing its default gateway configuration. The default gateway is the router's IP address on the local network - it tells the PC where to send packets when the destination is on a different network. Without it, PC1 can only reach devices on 192.168.1.0/24.",
                    commands: [
                        "# On PC1, configure the default gateway:",
                        "IP Configuration:",
                        "  IP Address: 192.168.1.10",
                        "  Subnet Mask: 255.255.255.0",
                        "  Default Gateway: 192.168.1.1"
                    ],
                    why: "The default gateway points to the router (192.168.1.1). Now when PC1 needs to reach 10.0.0.10, it knows to send the packet to the router, which will forward it to the correct network. This is like knowing which door to use to leave a building."
                },

                verification: {
                    checks: [
                        {
                            type: 'gateway-config',
                            device: 'pc1',
                            expectedGateway: '192.168.1.1',
                            message: 'PC1 must have default gateway 192.168.1.1'
                        },
                        {
                            type: 'ping',
                            from: 'pc1',
                            to: '10.0.0.10',
                            expectedSuccess: true,
                            message: 'PC1 must be able to ping PC2 on remote network'
                        }
                    ]
                },

                skills: [
                    'Default gateway concept',
                    'IP configuration troubleshooting',
                    'Understanding routing basics',
                    'Local vs remote network distinction'
                ]
            },

            'ts-04-trunk-mismatch': {
                id: 'ts-04-trunk-mismatch',
                title: 'Trunk Native VLAN Mismatch',
                difficulty: 'intermediate',
                estimatedTime: '20 min',
                description: 'VLANs work locally on each switch, but devices in VLAN 10 on Switch1 cannot reach VLAN 10 devices on Switch2. The trunk link appears to be up.',

                topology: {
                    devices: [
                        {
                            id: 'switch1',
                            type: 'l2switch',
                            name: 'Switch1',
                            x: 200,
                            y: 200,
                            vlans: {
                                '10': {name: 'Sales', ports: ['Fa0/1']},
                                '20': {name: 'Engineering', ports: ['Fa0/2']}
                            },
                            trunks: {
                                'Fa0/24': {
                                    mode: 'trunk',
                                    nativeVlan: 1,
                                    allowedVlans: '1-4094'
                                }
                            },
                            config: [
                                'interface FastEthernet0/24',
                                ' switchport mode trunk',
                                ' switchport trunk native vlan 1'
                            ]
                        },
                        {
                            id: 'switch2',
                            type: 'l2switch',
                            name: 'Switch2',
                            x: 400,
                            y: 200,
                            vlans: {
                                '10': {name: 'Sales', ports: ['Fa0/1']},
                                '20': {name: 'Engineering', ports: ['Fa0/2']}
                            },
                            trunks: {
                                'Fa0/24': {
                                    mode: 'trunk',
                                    nativeVlan: 99,
                                    allowedVlans: '1-4094'
                                }
                            },
                            config: [
                                'interface FastEthernet0/24',
                                ' switchport mode trunk',
                                ' switchport trunk native vlan 99'
                            ]
                        },
                        {
                            id: 'pc1',
                            type: 'pc',
                            name: 'PC1-SW1',
                            x: 100,
                            y: 150,
                            ip: '192.168.10.10',
                            mask: '255.255.255.0'
                        },
                        {
                            id: 'pc2',
                            type: 'pc',
                            name: 'PC2-SW2',
                            x: 500,
                            y: 150,
                            ip: '192.168.10.20',
                            mask: '255.255.255.0'
                        }
                    ],
                    connections: [
                        {from: 'pc1', to: 'switch1', fromPort: 'NIC', toPort: 'Fa0/1'},
                        {from: 'pc2', to: 'switch2', fromPort: 'NIC', toPort: 'Fa0/1'},
                        {from: 'switch1', to: 'switch2', fromPort: 'Fa0/24', toPort: 'Fa0/24'}
                    ]
                },

                hints: [
                    {
                        level: 1,
                        text: "Trunk links carry multiple VLANs between switches. Check the trunk configuration on both switches using 'show interfaces trunk'. Pay special attention to the native VLAN."
                    },
                    {
                        level: 2,
                        text: "Compare 'show interfaces trunk' output on Switch1 and Switch2. Look at the 'Native vlan' line. Are they the same on both sides? Cisco switches issue warnings when native VLANs don't match."
                    },
                    {
                        level: 3,
                        text: "Switch1's Fa0/24 has native VLAN 1, but Switch2's Fa0/24 has native VLAN 99. This mismatch causes Layer 2 connectivity issues. Native VLAN must match on both ends of a trunk!"
                    }
                ],

                solution: {
                    explanation: "Native VLAN mismatch on trunk ports causes traffic to be placed in the wrong VLAN. The native VLAN is the VLAN for untagged frames on a trunk - if it doesn't match on both sides, frames can end up in different VLANs. Best practice: Use the same native VLAN on both trunk ends (often VLAN 1 or a dedicated unused VLAN like 999).",
                    commands: [
                        "# On Switch2:",
                        "enable",
                        "configure terminal",
                        "interface FastEthernet0/24",
                        "switchport trunk native vlan 1",
                        "end",
                        "",
                        "# Alternative: Change Switch1 to match Switch2:",
                        "# switchport trunk native vlan 99"
                    ],
                    why: "Matching the native VLAN ensures untagged frames are handled consistently on both switches. You can verify the fix with 'show interfaces trunk' - both switches should now show the same native VLAN. You may also see Cisco's native VLAN mismatch warning disappear from the logs."
                },

                verification: {
                    checks: [
                        {
                            type: 'trunk-native-vlan',
                            device: 'switch1',
                            interface: 'Fa0/24',
                            expectedNativeVlan: 1,
                            message: 'Switch1 Fa0/24 native VLAN must match Switch2'
                        },
                        {
                            type: 'trunk-native-vlan',
                            device: 'switch2',
                            interface: 'Fa0/24',
                            expectedNativeVlan: 1,
                            message: 'Switch2 Fa0/24 native VLAN must match Switch1'
                        },
                        {
                            type: 'ping',
                            from: 'pc1',
                            to: '192.168.10.20',
                            expectedSuccess: true,
                            message: 'PC1 on Switch1 must reach PC2 on Switch2'
                        }
                    ]
                },

                skills: [
                    'Trunk troubleshooting',
                    'Native VLAN concept',
                    'show interfaces trunk',
                    'VLAN tagging (802.1Q)',
                    'Inter-switch connectivity'
                ]
            },

            'ts-05-acl-blocking': {
                id: 'ts-05-acl-blocking',
                title: 'ACL Blocking Legitimate Traffic',
                difficulty: 'intermediate',
                estimatedTime: '25 min',
                description: 'PC1 can ping the router but cannot access the web server on 10.0.0.50. The server is working fine - other devices can reach it.',

                topology: {
                    devices: [
                        {
                            id: 'router1',
                            type: 'router',
                            name: 'Router1',
                            x: 300,
                            y: 200,
                            interfaces: {
                                'Gi0/0': {
                                    ip: '192.168.1.1',
                                    mask: '255.255.255.0',
                                    aclIn: 'BLOCK_PC1'  // THE PROBLEM!
                                },
                                'Gi0/1': {
                                    ip: '10.0.0.1',
                                    mask: '255.255.255.0'
                                }
                            },
                            acls: {
                                'BLOCK_PC1': {
                                    type: 'extended',
                                    entries: [
                                        {seq: 10, action: 'deny', protocol: 'tcp', source: '192.168.1.10', dest: '10.0.0.50', port: 80},
                                        {seq: 20, action: 'permit', protocol: 'ip', source: 'any', dest: 'any'}
                                    ]
                                }
                            },
                            config: [
                                'ip access-list extended BLOCK_PC1',
                                ' 10 deny tcp host 192.168.1.10 host 10.0.0.50 eq 80',
                                ' 20 permit ip any any',
                                'interface GigabitEthernet0/0',
                                ' ip access-group BLOCK_PC1 in'
                            ]
                        },
                        {
                            id: 'pc1',
                            type: 'pc',
                            name: 'PC1',
                            x: 100,
                            y: 200,
                            ip: '192.168.1.10',
                            mask: '255.255.255.0',
                            gateway: '192.168.1.1'
                        },
                        {
                            id: 'server',
                            type: 'server',
                            name: 'WebServer',
                            x: 500,
                            y: 200,
                            ip: '10.0.0.50',
                            mask: '255.255.255.0',
                            gateway: '10.0.0.1',
                            services: ['HTTP']
                        }
                    ],
                    connections: [
                        {from: 'pc1', to: 'router1', fromPort: 'NIC', toPort: 'Gi0/0'},
                        {from: 'server', to: 'router1', fromPort: 'NIC', toPort: 'Gi0/1'}
                    ]
                },

                hints: [
                    {
                        level: 1,
                        text: "Access Control Lists (ACLs) can block specific traffic. Check if there are any ACLs applied to the router's interfaces using 'show ip access-lists' and 'show ip interface Gi0/0'."
                    },
                    {
                        level: 2,
                        text: "Look at 'show ip access-lists BLOCK_PC1'. The first entry (line 10) is a 'deny' statement. What traffic does it match? Check the source IP, destination IP, protocol, and port number."
                    },
                    {
                        level: 3,
                        text: "ACL entry 10 denies TCP traffic from 192.168.1.10 (PC1) to 10.0.0.50 (WebServer) on port 80 (HTTP). This is blocking PC1's web access. The ACL was likely created for testing and left in place accidentally."
                    }
                ],

                solution: {
                    explanation: "An extended ACL named 'BLOCK_PC1' is applied inbound on interface Gi0/0, denying HTTP traffic from PC1 to the web server. ACLs process entries top-to-bottom and stop at the first match - so line 10's 'deny' statement blocks the traffic before line 20's 'permit any any' can allow it. We need to remove or modify the ACL.",
                    commands: [
                        "# Option 1: Remove the deny statement",
                        "enable",
                        "configure terminal",
                        "ip access-list extended BLOCK_PC1",
                        "no 10",
                        "end",
                        "",
                        "# Option 2: Remove the entire ACL from the interface",
                        "configure terminal",
                        "interface GigabitEthernet0/0",
                        "no ip access-group BLOCK_PC1 in",
                        "end"
                    ],
                    why: "Removing line 10 allows PC1's HTTP traffic to match line 20 (permit ip any any) instead. ACLs are powerful security tools, but incorrect entries can block legitimate traffic. Always test ACLs carefully and document their purpose. Use 'show access-lists' to verify the change."
                },

                verification: {
                    checks: [
                        {
                            type: 'acl-check',
                            device: 'router1',
                            acl: 'BLOCK_PC1',
                            shouldNotContain: 'deny tcp host 192.168.1.10',
                            message: 'ACL must not block PC1 HTTP traffic'
                        },
                        {
                            type: 'http-access',
                            from: 'pc1',
                            to: '10.0.0.50',
                            port: 80,
                            expectedSuccess: true,
                            message: 'PC1 must be able to access WebServer on port 80'
                        }
                    ]
                },

                skills: [
                    'ACL troubleshooting',
                    'Extended ACL syntax',
                    'show ip access-lists',
                    'ACL processing order',
                    'Inbound vs outbound ACLs'
                ]
            },

            'ts-06-duplicate-ip': {
                id: 'ts-06-duplicate-ip',
                title: 'Duplicate IP Address Conflict',
                difficulty: 'beginner',
                estimatedTime: '15 min',
                description: 'PC1 has intermittent connectivity issues - sometimes it can ping the router, sometimes it cannot. PC2 and PC3 work fine.',

                topology: {
                    devices: [
                        {
                            id: 'router1',
                            type: 'router',
                            name: 'Router1',
                            x: 300,
                            y: 200,
                            interfaces: {
                                'Gi0/0': {ip: '192.168.1.1', mask: '255.255.255.0'}
                            }
                        },
                        {
                            id: 'switch1',
                            type: 'switch',
                            name: 'Switch1',
                            x: 300,
                            y: 300
                        },
                        {
                            id: 'pc1',
                            type: 'pc',
                            name: 'PC1',
                            x: 100,
                            y: 400,
                            ip: '192.168.1.10',
                            mask: '255.255.255.0',
                            gateway: '192.168.1.1'
                        },
                        {
                            id: 'pc2',
                            type: 'pc',
                            name: 'PC2',
                            x: 300,
                            y: 400,
                            ip: '192.168.1.10',  // THE PROBLEM! Same as PC1
                            mask: '255.255.255.0',
                            gateway: '192.168.1.1'
                        },
                        {
                            id: 'pc3',
                            type: 'pc',
                            name: 'PC3',
                            x: 500,
                            y: 400,
                            ip: '192.168.1.30',
                            mask: '255.255.255.0',
                            gateway: '192.168.1.1'
                        }
                    ],
                    connections: [
                        {from: 'router1', to: 'switch1', fromPort: 'Gi0/0', toPort: 'Fa0/24'},
                        {from: 'pc1', to: 'switch1', fromPort: 'NIC', toPort: 'Fa0/1'},
                        {from: 'pc2', to: 'switch1', fromPort: 'NIC', toPort: 'Fa0/2'},
                        {from: 'pc3', to: 'switch1', fromPort: 'NIC', toPort: 'Fa0/3'}
                    ]
                },

                hints: [
                    {
                        level: 1,
                        text: "Intermittent connectivity often indicates a Layer 2 issue like duplicate IP addresses or MAC address conflicts. Check the IP addresses of all devices on the network."
                    },
                    {
                        level: 2,
                        text: "Compare the IP configurations of PC1, PC2, and PC3. Do you notice anything unusual? Remember, each device on a network must have a unique IP address."
                    },
                    {
                        level: 3,
                        text: "PC1 and PC2 both have IP address 192.168.1.10! This creates an IP conflict. When the router sends traffic to 192.168.1.10, it doesn't know which PC should receive it. The switch's ARP table gets confused, causing intermittent connectivity."
                    }
                ],

                solution: {
                    explanation: "Duplicate IP addresses cause unpredictable network behavior. Both PCs respond to ARP requests for 192.168.1.10, so the router's ARP table alternates between PC1's and PC2's MAC addresses. This is like two people having the same phone number - calls randomly reach one or the other. Most operating systems will display a 'duplicate IP address' warning when this occurs.",
                    commands: [
                        "# On PC2, change the IP address:",
                        "IP Configuration:",
                        "  IP Address: 192.168.1.20",
                        "  Subnet Mask: 255.255.255.0",
                        "  Default Gateway: 192.168.1.1",
                        "",
                        "# Now each device has a unique IP:",
                        "# PC1: 192.168.1.10",
                        "# PC2: 192.168.1.20",
                        "# PC3: 192.168.1.30"
                    ],
                    why: "Assigning PC2 a unique IP address (192.168.1.20) resolves the conflict. Now the router can maintain accurate ARP entries, and traffic reaches the correct destination every time. To prevent this issue: use DHCP for automatic IP assignment, or maintain an IP address spreadsheet when using static IPs."
                },

                verification: {
                    checks: [
                        {
                            type: 'ip-unique',
                            devices: ['pc1', 'pc2', 'pc3'],
                            message: 'All PCs must have unique IP addresses'
                        },
                        {
                            type: 'ping',
                            from: 'router1',
                            to: '192.168.1.10',
                            expectedSuccess: true,
                            consistent: true,
                            message: 'Router must consistently reach PC1 (192.168.1.10)'
                        },
                        {
                            type: 'ping',
                            from: 'router1',
                            to: '192.168.1.20',
                            expectedSuccess: true,
                            message: 'Router must reach PC2 at new IP (192.168.1.20)'
                        }
                    ]
                },

                skills: [
                    'IP address conflict detection',
                    'ARP table troubleshooting',
                    'IP addressing best practices',
                    'Intermittent issue diagnosis',
                    'Static IP management'
                ]
            },

            'ts-07-ospf-adjacency': {
                id: 'ts-07-ospf-adjacency',
                title: 'OSPF Adjacency Failure',
                difficulty: 'advanced',
                estimatedTime: '30 min',
                description: 'Router1 and Router2 should be OSPF neighbors, but "show ip ospf neighbor" shows no neighbors. The physical connection is up and interfaces have IP addresses.',

                topology: {
                    devices: [
                        {
                            id: 'router1',
                            type: 'router',
                            name: 'Router1',
                            x: 200,
                            y: 200,
                            interfaces: {
                                'Gi0/0': {
                                    ip: '10.1.1.1',
                                    mask: '255.255.255.0',
                                    ospf: {
                                        processId: 1,
                                        area: 0,
                                        network: '10.1.1.0'
                                    }
                                },
                                'Lo0': {
                                    ip: '1.1.1.1',
                                    mask: '255.255.255.255',
                                    ospf: {processId: 1, area: 0}
                                }
                            },
                            ospf: {
                                processId: 1,
                                routerId: '1.1.1.1',
                                networks: [
                                    {network: '10.1.1.0', wildcard: '0.0.0.255', area: 0},
                                    {network: '1.1.1.1', wildcard: '0.0.0.0', area: 0}
                                ]
                            },
                            config: [
                                'router ospf 1',
                                ' router-id 1.1.1.1',
                                ' network 10.1.1.0 0.0.0.255 area 0',
                                ' network 1.1.1.1 0.0.0.0 area 0'
                            ]
                        },
                        {
                            id: 'router2',
                            type: 'router',
                            name: 'Router2',
                            x: 400,
                            y: 200,
                            interfaces: {
                                'Gi0/0': {
                                    ip: '10.1.1.2',
                                    mask: '255.255.255.0',
                                    ospf: {
                                        processId: 1,
                                        area: 1,
                                        network: '10.1.1.0'
                                    }
                                },
                                'Lo0': {
                                    ip: '2.2.2.2',
                                    mask: '255.255.255.255',
                                    ospf: {processId: 1, area: 1}
                                }
                            },
                            ospf: {
                                processId: 1,
                                routerId: '2.2.2.2',
                                networks: [
                                    {network: '10.1.1.0', wildcard: '0.0.0.255', area: 1},
                                    {network: '2.2.2.2', wildcard: '0.0.0.0', area: 1}
                                ]
                            },
                            config: [
                                'router ospf 1',
                                ' router-id 2.2.2.2',
                                ' network 10.1.1.0 0.0.0.255 area 1',
                                ' network 2.2.2.2 0.0.0.0 area 1'
                            ]
                        }
                    ],
                    connections: [
                        {from: 'router1', to: 'router2', fromPort: 'Gi0/0', toPort: 'Gi0/0'}
                    ]
                },

                hints: [
                    {
                        level: 1,
                        text: "OSPF routers must agree on several parameters to form adjacencies. Check 'show ip ospf interface' on both routers. Pay attention to the area ID, hello/dead timers, and network type."
                    },
                    {
                        level: 2,
                        text: "Compare the OSPF area assignments on Router1's Gi0/0 and Router2's Gi0/0 using 'show ip ospf interface Gi0/0'. OSPF neighbors must be in the same area to form adjacencies (unless one is an ABR)."
                    },
                    {
                        level: 3,
                        text: "Router1's Gi0/0 is in OSPF area 0, but Router2's Gi0/0 is in OSPF area 1. This area mismatch prevents the adjacency from forming. Both interfaces on the 10.1.1.0/24 network must be in the same area."
                    }
                ],

                solution: {
                    explanation: "OSPF area mismatch is one of the most common reasons adjacencies fail to form. OSPF neighbors on the same network segment must be in the same area. Router2's network statement incorrectly placed the 10.1.1.0 network in area 1 instead of area 0. This is often a typo during initial configuration.",
                    commands: [
                        "# On Router2:",
                        "enable",
                        "configure terminal",
                        "router ospf 1",
                        "no network 10.1.1.0 0.0.0.255 area 1",
                        "network 10.1.1.0 0.0.0.255 area 0",
                        "end",
                        "",
                        "# Verify adjacency formed:",
                        "show ip ospf neighbor",
                        "# You should see Router1 (1.1.1.1) in FULL state"
                    ],
                    why: "After correcting the area to 0, both routers will exchange OSPF Hello packets that match (same area, same hello/dead timers). The adjacency will progress through states: DOWN ‚Üí INIT ‚Üí 2WAY ‚Üí EXSTART ‚Üí EXCHANGE ‚Üí LOADING ‚Üí FULL. Use 'show ip ospf neighbor' to verify the FULL state, which means they're successfully exchanging routing information."
                },

                verification: {
                    checks: [
                        {
                            type: 'ospf-area',
                            device: 'router2',
                            network: '10.1.1.0',
                            expectedArea: 0,
                            message: 'Router2 network 10.1.1.0 must be in OSPF area 0'
                        },
                        {
                            type: 'ospf-neighbor',
                            device: 'router1',
                            expectedNeighbor: '2.2.2.2',
                            expectedState: 'FULL',
                            message: 'Router1 must have Router2 as FULL neighbor'
                        },
                        {
                            type: 'ospf-neighbor',
                            device: 'router2',
                            expectedNeighbor: '1.1.1.1',
                            expectedState: 'FULL',
                            message: 'Router2 must have Router1 as FULL neighbor'
                        }
                    ]
                },

                skills: [
                    'OSPF troubleshooting',
                    'show ip ospf neighbor',
                    'show ip ospf interface',
                    'OSPF area concept',
                    'Adjacency states (2WAY, EXSTART, FULL)',
                    'Network statement syntax'
                ]
            },

            'ts-08-routing-loop': {
                id: 'ts-08-routing-loop',
                title: 'Routing Loop Detection',
                difficulty: 'advanced',
                estimatedTime: '30 min',
                description: 'Network is extremely slow and ping shows very high hop counts. Traceroute shows packets bouncing between routers. Something is causing a routing loop.',

                topology: {
                    devices: [
                        {
                            id: 'router1',
                            type: 'router',
                            name: 'Router1',
                            x: 200,
                            y: 200,
                            interfaces: {
                                'Gi0/0': {ip: '10.1.1.1', mask: '255.255.255.0'},
                                'Gi0/1': {ip: '10.1.12.1', mask: '255.255.255.0'}
                            },
                            staticRoutes: [
                                {
                                    network: '10.2.2.0',
                                    mask: '255.255.255.0',
                                    nextHop: '10.1.12.2'  // ‚Üí Router2
                                },
                                {
                                    network: '192.168.100.0',
                                    mask: '255.255.255.0',
                                    nextHop: '10.1.12.2'  // ‚Üê THE PROBLEM! Creates loop
                                }
                            ],
                            config: [
                                'interface Gi0/0',
                                ' ip address 10.1.1.1 255.255.255.0',
                                'interface Gi0/1',
                                ' ip address 10.1.12.1 255.255.255.0',
                                'ip route 10.2.2.0 255.255.255.0 10.1.12.2',
                                'ip route 192.168.100.0 255.255.255.0 10.1.12.2'  // ‚Üê Wrong!
                            ]
                        },
                        {
                            id: 'router2',
                            type: 'router',
                            name: 'Router2',
                            x: 400,
                            y: 200,
                            interfaces: {
                                'Gi0/0': {ip: '10.2.2.1', mask: '255.255.255.0'},
                                'Gi0/1': {ip: '10.1.12.2', mask: '255.255.255.0'}
                            },
                            staticRoutes: [
                                {
                                    network: '10.1.1.0',
                                    mask: '255.255.255.0',
                                    nextHop: '10.1.12.1'  // ‚Üí Router1
                                },
                                {
                                    network: '192.168.100.0',
                                    mask: '255.255.255.0',
                                    nextHop: '10.1.12.1'  // ‚Üí Router1 (causes loop!)
                                }
                            ],
                            config: [
                                'interface Gi0/0',
                                ' ip address 10.2.2.1 255.255.255.0',
                                'interface Gi0/1',
                                ' ip address 10.1.12.2 255.255.255.0',
                                'ip route 10.1.1.0 255.255.255.0 10.1.12.1',
                                'ip route 192.168.100.0 255.255.255.0 10.1.12.1'
                            ]
                        },
                        {
                            id: 'pc1',
                            type: 'pc',
                            name: 'PC1',
                            x: 100,
                            y: 200,
                            ip: '10.1.1.10',
                            mask: '255.255.255.0',
                            gateway: '10.1.1.1'
                        }
                    ],
                    connections: [
                        {from: 'pc1', to: 'router1', fromPort: 'NIC', toPort: 'Gi0/0'},
                        {from: 'router1', to: 'router2', fromPort: 'Gi0/1', toPort: 'Gi0/1'}
                    ]
                },

                hints: [
                    {
                        level: 1,
                        text: "Routing loops occur when packets endlessly circulate between routers. Use 'show ip route' on both routers to examine the routing tables. Look for the route to 192.168.100.0 - where does each router think it should send packets?"
                    },
                    {
                        level: 2,
                        text: "Check 'show ip route 192.168.100.0' on both routers. Router1 points to Router2 (10.1.12.2), and Router2 points back to Router1 (10.1.12.1). This creates a loop! Packets for 192.168.100.0 bounce between routers until TTL expires."
                    },
                    {
                        level: 3,
                        text: "Both routers have static routes for 192.168.100.0/24 pointing to each other. Router1 says 'send to Router2' and Router2 says 'send to Router1' - classic routing loop. The 192.168.100.0 network doesn't actually exist or is misconfigured. One (or both) routes need to be removed."
                    }
                ],

                solution: {
                    explanation: "A routing loop was created by incorrect static routes. Both routers think the other router is the path to 192.168.100.0/24, so packets bounce back and forth until the TTL (Time To Live) reaches zero. This is often caused by misconfigured static routes, routing protocol issues, or network topology changes that weren't updated in the routing configuration.",
                    commands: [
                        "# Option 1: Remove the route from Router1",
                        "# (if 192.168.100.0 is actually connected to Router2)",
                        "Router1(config)# no ip route 192.168.100.0 255.255.255.0 10.1.12.2",
                        "",
                        "# Option 2: Remove the route from Router2",
                        "# (if 192.168.100.0 is actually connected to Router1)",
                        "Router2(config)# no ip route 192.168.100.0 255.255.255.0 10.1.12.1",
                        "",
                        "# Option 3: If network doesn't exist, remove both routes",
                        "",
                        "# Verify with:",
                        "show ip route 192.168.100.0",
                        "# Should only appear on the router where it's actually connected"
                    ],
                    why: "Removing the incorrect static route(s) breaks the loop. In production networks, routing loops are prevented by: using dynamic routing protocols (OSPF/EIGRP have loop prevention), careful static route planning, route summarization, and administrative distance manipulation. Always verify routes with 'traceroute' after making changes."
                },

                verification: {
                    checks: [
                        {
                            type: 'no-routing-loop',
                            network: '192.168.100.0',
                            devices: ['router1', 'router2'],
                            message: 'Routing loop for 192.168.100.0 must be resolved'
                        },
                        {
                            type: 'traceroute',
                            from: 'pc1',
                            to: '10.2.2.10',
                            maxHops: 5,
                            expectedSuccess: true,
                            message: 'Traceroute should complete without loops'
                        }
                    ]
                },

                skills: [
                    'Routing loop identification',
                    'show ip route analysis',
                    'Traceroute interpretation',
                    'TTL concept',
                    'Static route troubleshooting',
                    'Routing table verification'
                ]
            },

            'ts-09-dhcp-exhausted': {
                id: 'ts-09-dhcp-exhausted',
                title: 'DHCP Pool Exhausted',
                difficulty: 'intermediate',
                estimatedTime: '25 min',
                description: 'New PC4 cannot obtain an IP address via DHCP. It stays at 169.254.x.x (APIPA). PC1, PC2, and PC3 have valid DHCP addresses. The DHCP server is running.',

                topology: {
                    devices: [
                        {
                            id: 'router1',
                            type: 'router',
                            name: 'Router1-DHCP',
                            x: 300,
                            y: 200,
                            interfaces: {
                                'Gi0/0': {
                                    ip: '192.168.1.1',
                                    mask: '255.255.255.0',
                                    dhcpServer: true
                                }
                            },
                            dhcp: {
                                poolName: 'LAN_POOL',
                                network: '192.168.1.0',
                                mask: '255.255.255.0',
                                defaultRouter: '192.168.1.1',
                                dnsServer: '8.8.8.8',
                                start: '192.168.1.10',
                                end: '192.168.1.12',
                                assigned: [
                                    {ip: '192.168.1.10', mac: 'AA:BB:CC:DD:EE:01', device: 'PC1'},
                                    {ip: '192.168.1.11', mac: 'AA:BB:CC:DD:EE:02', device: 'PC2'},
                                    {ip: '192.168.1.12', mac: 'AA:BB:CC:DD:EE:03', device: 'PC3'}
                                ]
                            },
                            config: [
                                'ip dhcp pool LAN_POOL',
                                ' network 192.168.1.0 255.255.255.0',
                                ' default-router 192.168.1.1',
                                ' dns-server 8.8.8.8',
                                'ip dhcp excluded-address 192.168.1.1 192.168.1.9',
                                'ip dhcp excluded-address 192.168.1.13 192.168.1.254'
                            ]
                        },
                        {
                            id: 'switch1',
                            type: 'switch',
                            name: 'Switch1',
                            x: 300,
                            y: 300
                        },
                        {
                            id: 'pc1',
                            type: 'pc',
                            name: 'PC1',
                            x: 100,
                            y: 400,
                            ip: '192.168.1.10',
                            mask: '255.255.255.0',
                            gateway: '192.168.1.1',
                            dhcp: true
                        },
                        {
                            id: 'pc2',
                            type: 'pc',
                            name: 'PC2',
                            x: 200,
                            y: 400,
                            ip: '192.168.1.11',
                            mask: '255.255.255.0',
                            gateway: '192.168.1.1',
                            dhcp: true
                        },
                        {
                            id: 'pc3',
                            type: 'pc',
                            name: 'PC3',
                            x: 400,
                            y: 400,
                            ip: '192.168.1.12',
                            mask: '255.255.255.0',
                            gateway: '192.168.1.1',
                            dhcp: true
                        },
                        {
                            id: 'pc4',
                            type: 'pc',
                            name: 'PC4',
                            x: 500,
                            y: 400,
                            ip: '169.254.100.50',
                            mask: '255.255.0.0',
                            gateway: '',
                            dhcp: true
                        }
                    ],
                    connections: [
                        {from: 'router1', to: 'switch1', fromPort: 'Gi0/0', toPort: 'Fa0/24'},
                        {from: 'pc1', to: 'switch1', fromPort: 'NIC', toPort: 'Fa0/1'},
                        {from: 'pc2', to: 'switch1', fromPort: 'NIC', toPort: 'Fa0/2'},
                        {from: 'pc3', to: 'switch1', fromPort: 'NIC', toPort: 'Fa0/3'},
                        {from: 'pc4', to: 'switch1', fromPort: 'NIC', toPort: 'Fa0/4'}
                    ]
                },

                hints: [
                    {
                        level: 1,
                        text: "When a PC shows 169.254.x.x (APIPA), it means DHCP failed. Check the DHCP server's available addresses using 'show ip dhcp binding' and 'show ip dhcp pool'. How many addresses are in the pool vs how many are assigned?"
                    },
                    {
                        level: 2,
                        text: "Use 'show ip dhcp pool LAN_POOL' on the router. Look at the pool utilization - how many addresses are available vs in use? Also check 'show ip dhcp excluded-address' to see which addresses are intentionally excluded from assignment."
                    },
                    {
                        level: 3,
                        text: "The DHCP pool only has 3 available addresses (192.168.1.10-12), and all 3 are already assigned to PC1, PC2, and PC3. The 'ip dhcp excluded-address' command is excluding .1-.9 and .13-.254, leaving only 3 usable addresses. PC4 has no address to receive!"
                    }
                ],

                solution: {
                    explanation: "DHCP pool exhaustion occurs when all available addresses in the pool are assigned or reserved. The excluded-address range was too aggressive - it blocked .13-.254, leaving only 3 addresses (.10, .11, .12). When PC4 requested an address, none were available, so it fell back to APIPA (Automatic Private IP Addressing). This is common in networks that grow beyond initial planning.",
                    commands: [
                        "# On Router1 (DHCP Server):",
                        "enable",
                        "configure terminal",
                        "no ip dhcp excluded-address 192.168.1.13 192.168.1.254",
                        "ip dhcp excluded-address 192.168.1.240 192.168.1.254",
                        "# Now .10-.239 are available (230 addresses)",
                        "end",
                        "",
                        "# On PC4:",
                        "# Release and renew DHCP:",
                        "ipconfig /release",
                        "ipconfig /renew",
                        "",
                        "# Verify on router:",
                        "show ip dhcp binding",
                        "# PC4 should now have an address like 192.168.1.13"
                    ],
                    why: "By changing the excluded range from .13-.254 to .240-.254, we freed up addresses .13-.239 (227 additional addresses). Now PC4 can receive an address from the pool. Best practices: Plan DHCP pools with 20-30% overhead, monitor pool utilization, set appropriate lease times, and use DHCP reservations for servers/printers instead of excluding large ranges."
                },

                verification: {
                    checks: [
                        {
                            type: 'dhcp-pool-available',
                            device: 'router1',
                            pool: 'LAN_POOL',
                            minAvailable: 10,
                            message: 'DHCP pool must have at least 10 available addresses'
                        },
                        {
                            type: 'dhcp-address',
                            device: 'pc4',
                            expectedRange: '192.168.1.13-192.168.1.239',
                            message: 'PC4 must receive valid DHCP address (not APIPA)'
                        },
                        {
                            type: 'gateway-reachable',
                            device: 'pc4',
                            gateway: '192.168.1.1',
                            message: 'PC4 must be able to reach gateway'
                        }
                    ]
                },

                skills: [
                    'DHCP troubleshooting',
                    'show ip dhcp binding',
                    'show ip dhcp pool',
                    'APIPA concept (169.254.x.x)',
                    'DHCP excluded-address',
                    'Pool capacity planning',
                    'ipconfig /release and /renew'
                ]
            },

            'ts-10-stp-blocking': {
                id: 'ts-10-stp-blocking',
                title: 'Spanning Tree Blocking Expected Port',
                difficulty: 'advanced',
                estimatedTime: '35 min',
                description: 'PC1 cannot reach PC2 even though they are in the same VLAN and on directly connected switches. Physical links are up. STP may be blocking the wrong port.',

                topology: {
                    devices: [
                        {
                            id: 'switch1',
                            type: 'switch',
                            name: 'Switch1',
                            x: 200,
                            y: 200,
                            priority: 32768,  // Default priority
                            vlans: {
                                '10': {name: 'Data', ports: ['Fa0/1']}
                            },
                            stp: {
                                rootBridge: false,
                                rootPort: 'Fa0/24',
                                designatedPorts: ['Fa0/1'],
                                blockedPorts: ['Fa0/23']  // Blocking uplink to Switch3!
                            },
                            config: [
                                'spanning-tree mode pvst',
                                'spanning-tree vlan 10 priority 32768'
                            ]
                        },
                        {
                            id: 'switch2',
                            type: 'switch',
                            name: 'Switch2',
                            x: 400,
                            y: 200,
                            priority: 32768,
                            vlans: {
                                '10': {name: 'Data', ports: ['Fa0/1']}
                            },
                            stp: {
                                rootBridge: false,
                                rootPort: 'Fa0/24',
                                designatedPorts: ['Fa0/1'],
                                blockedPorts: []
                            },
                            config: [
                                'spanning-tree mode pvst',
                                'spanning-tree vlan 10 priority 32768'
                            ]
                        },
                        {
                            id: 'switch3',
                            type: 'switch',
                            name: 'Switch3',
                            x: 300,
                            y: 100,
                            priority: 8192,  // ‚Üê THE PROBLEM! Too low, becomes root unintentionally
                            vlans: {
                                '10': {name: 'Data', ports: []}
                            },
                            stp: {
                                rootBridge: true,  // Became root due to low priority!
                                rootPort: null,
                                designatedPorts: ['Fa0/1', 'Fa0/2'],
                                blockedPorts: []
                            },
                            config: [
                                'spanning-tree mode pvst',
                                'spanning-tree vlan 10 priority 8192'  // ‚Üê TOO LOW!
                            ]
                        },
                        {
                            id: 'pc1',
                            type: 'pc',
                            name: 'PC1',
                            x: 100,
                            y: 300,
                            ip: '192.168.10.10',
                            mask: '255.255.255.0',
                            vlan: 10
                        },
                        {
                            id: 'pc2',
                            type: 'pc',
                            name: 'PC2',
                            x: 500,
                            y: 300,
                            ip: '192.168.10.20',
                            mask: '255.255.255.0',
                            vlan: 10
                        }
                    ],
                    connections: [
                        {from: 'pc1', to: 'switch1', fromPort: 'NIC', toPort: 'Fa0/1'},
                        {from: 'pc2', to: 'switch2', fromPort: 'NIC', toPort: 'Fa0/1'},
                        {from: 'switch1', to: 'switch3', fromPort: 'Fa0/23', toPort: 'Fa0/1'},
                        {from: 'switch2', to: 'switch3', fromPort: 'Fa0/24', toPort: 'Fa0/2'},
                        {from: 'switch1', to: 'switch2', fromPort: 'Fa0/24', toPort: 'Fa0/23'}
                    ]
                },

                hints: [
                    {
                        level: 1,
                        text: "Spanning Tree Protocol (STP) blocks redundant paths to prevent loops. Check which ports are blocked using 'show spanning-tree vlan 10'. Also identify which switch is the root bridge - is it the intended one?"
                    },
                    {
                        level: 2,
                        text: "Use 'show spanning-tree vlan 10' on all switches. Look at the root bridge (lowest Bridge ID). Switch3 has priority 8192 while Switch1 and Switch2 have 32768 - Switch3 became root! This may not be the optimal design if Switch3 is an access layer switch."
                    },
                    {
                        level: 3,
                        text: "Switch3 is the root bridge due to its priority of 8192 (lower wins). This causes Switch1's port Fa0/23 to be in blocking state, cutting off PC1 from PC2. Switch3 was probably configured with lower priority for testing and never changed back. The intended root should likely be Switch1 or Switch2 (distribution layer)."
                    }
                ],

                solution: {
                    explanation: "STP selects the root bridge based on the lowest Bridge ID (priority + MAC address). Switch3's priority of 8192 is much lower than the default 32768, making it the root bridge. This forced Switch1's uplink (Fa0/23) into blocking state to prevent a loop. The topology suggests Switch3 is an access layer switch and shouldn't be root. Proper STP design places the root bridge at the distribution or core layer.",
                    commands: [
                        "# Option 1: Raise Switch3's priority back to default",
                        "Switch3(config)# spanning-tree vlan 10 priority 32768",
                        "",
                        "# Option 2: Make Switch1 the root intentionally",
                        "Switch1(config)# spanning-tree vlan 10 priority 4096",
                        "",
                        "# Option 3: Use root primary macro (sets priority to 24576)",
                        "Switch1(config)# spanning-tree vlan 10 root primary",
                        "",
                        "# Verify the fix:",
                        "show spanning-tree vlan 10",
                        "# Check that Switch1 is now root and all necessary ports are forwarding",
                        "",
                        "# Monitor port states:",
                        "show spanning-tree vlan 10 | include Fa0"
                    ],
                    why: "By correcting Switch3's priority to 32768 (or making Switch1 the root with priority 4096), the STP topology recalculates. Switch1 or Switch2 becomes root, and all inter-switch links enter forwarding state in the optimal configuration. STP best practices: Use 'root primary' and 'root secondary' macros, plan your root bridge location, document STP priorities, and monitor with 'show spanning-tree summary'."
                },

                verification: {
                    checks: [
                        {
                            type: 'stp-root',
                            vlan: 10,
                            expectedRoot: ['switch1', 'switch2'],
                            notRoot: 'switch3',
                            message: 'Switch3 should NOT be STP root for VLAN 10'
                        },
                        {
                            type: 'port-state',
                            device: 'switch1',
                            interface: 'Fa0/23',
                            expectedState: 'forwarding',
                            message: 'Switch1 Fa0/23 must be in forwarding state'
                        },
                        {
                            type: 'ping',
                            from: 'pc1',
                            to: '192.168.10.20',
                            expectedSuccess: true,
                            message: 'PC1 must be able to ping PC2'
                        }
                    ]
                },

                skills: [
                    'Spanning Tree Protocol (STP) troubleshooting',
                    'show spanning-tree vlan',
                    'Root bridge selection',
                    'Bridge ID concept (priority + MAC)',
                    'Port states (forwarding/blocking)',
                    'STP topology design',
                    'Root primary/secondary configuration'
                ]
            }
        };

        // ========== CUMULATIVE LABS DATA ==========
        const CUMULATIVE_LABS = {
            cumlab01: {
                id: "cumlab01",
                num: 1,
                title: "Static Routes Foundation",
                subtitle: "Build the base enterprise network with IP addressing and static routing",
                estimatedTime: "45 min",
                deviceCount: "1 Router, 6 Switches, 4 PCs, 2 Servers",
                concepts: ["IP Addressing", "Static Routes", "Default Gateway", "Ping Testing"],
                buildsOn: null,
                topology: {
                    devices: [
                        {id: "Edge-R1", type: "router", name: "Edge-Router", x: 400, y: 80},
                        {id: "Core-SW1", type: "l3switch", name: "Core-SW1", x: 250, y: 200},
                        {id: "Core-SW2", type: "l3switch", name: "Core-SW2", x: 550, y: 200},
                        {id: "Access-SW1", type: "l2switch", name: "Access-SW1", x: 150, y: 350},
                        {id: "Access-SW2", type: "l2switch", name: "Access-SW2", x: 350, y: 350},
                        {id: "Access-SW3", type: "l2switch", name: "Access-SW3", x: 450, y: 350},
                        {id: "Access-SW4", type: "l2switch", name: "Access-SW4", x: 650, y: 350},
                        {id: "PC1", type: "pc", name: "Sales-PC1", x: 100, y: 500},
                        {id: "PC2", type: "pc", name: "Sales-PC2", x: 200, y: 500},
                        {id: "PC3", type: "pc", name: "Eng-PC1", x: 350, y: 500},
                        {id: "PC4", type: "pc", name: "Eng-PC2", x: 450, y: 500},
                        {id: "SRV1", type: "server", name: "Web-Server", x: 550, y: 500},
                        {id: "SRV2", type: "server", name: "DB-Server", x: 700, y: 500}
                    ],
                    connections: [
                        {id: "conn-1", device1: "Edge-R1", device2: "Core-SW1", color: "#06b6d4"},
                        {id: "conn-2", device1: "Core-SW1", device2: "Core-SW2", color: "#10b981"},
                        {id: "conn-3", device1: "Core-SW1", device2: "Access-SW1", color: "#9333ea"},
                        {id: "conn-4", device1: "Core-SW1", device2: "Access-SW2", color: "#9333ea"},
                        {id: "conn-5", device1: "Core-SW2", device2: "Access-SW3", color: "#9333ea"},
                        {id: "conn-6", device1: "Core-SW2", device2: "Access-SW4", color: "#9333ea"},
                        {id: "conn-7", device1: "Access-SW1", device2: "PC1", color: "#f59e0b"},
                        {id: "conn-8", device1: "Access-SW1", device2: "PC2", color: "#f59e0b"},
                        {id: "conn-9", device1: "Access-SW2", device2: "PC3", color: "#f59e0b"},
                        {id: "conn-10", device1: "Access-SW3", device2: "PC4", color: "#f59e0b"},
                        {id: "conn-11", device1: "Access-SW4", device2: "SRV1", color: "#ec4899"},
                        {id: "conn-12", device1: "Access-SW4", device2: "SRV2", color: "#ec4899"}
                    ]
                },
                instructions: [
                    {step: 1, title: "Configure Edge Router WAN Interface", description: "Assign IP 203.0.113.2/30 to Gi0/0 (WAN link)", commands: ["enable", "conf t", "int Gi0/0", "ip address 203.0.113.2 255.255.255.252", "no shut"], completed: false},
                    {step: 2, title: "Configure Edge Router LAN Interface", description: "Assign IP 10.0.0.1/30 to Gi0/1 (Core link)", commands: ["int Gi0/1", "ip address 10.0.0.1 255.255.255.252", "no shut", "exit"], completed: false},
                    {step: 3, title: "Configure Core-SW1 Uplink", description: "Assign IP 10.0.0.2/30 to the uplink to Edge Router", commands: ["int Gi0/1", "no switchport", "ip address 10.0.0.2 255.255.255.252", "no shut"], completed: false},
                    {step: 4, title: "Create VLAN 10 Interface on Core-SW1", description: "Create SVI for Sales VLAN (192.168.10.1/24)", commands: ["int vlan 10", "ip address 192.168.10.1 255.255.255.0", "no shut"], completed: false},
                    {step: 5, title: "Configure Sales PCs", description: "Set Sales-PC1 to 192.168.10.10/24, gateway 192.168.10.1", commands: ["IP: 192.168.10.10", "Mask: 255.255.255.0", "GW: 192.168.10.1"], completed: false},
                    {step: 6, title: "Add Static Route on Edge Router", description: "Route to internal networks via Core-SW1", commands: ["ip route 192.168.0.0 255.255.0.0 10.0.0.2"], completed: false},
                    {step: 7, title: "Add Default Route on Core-SW1", description: "Point default traffic to Edge Router", commands: ["ip route 0.0.0.0 0.0.0.0 10.0.0.1"], completed: false},
                    {step: 8, title: "Test Connectivity", description: "Ping from Sales-PC1 to 203.0.113.2 (Edge Router WAN)", commands: ["ping 203.0.113.2"], completed: false}
                ]
            },
            cumlab02: {
                id: "cumlab02",
                num: 2,
                title: "VLANs and Trunking",
                subtitle: "Segment the network into VLANs with 802.1Q trunking",
                estimatedTime: "40 min",
                deviceCount: "1 Router, 6 Switches, 4 PCs, 2 Servers",
                concepts: ["VLANs", "802.1Q Trunking", "Access Ports", "Native VLAN"],
                buildsOn: "cumlab01",
                topology: {
                    devices: [
                        {id: "Edge-R1", type: "router", name: "Edge-Router", x: 400, y: 80},
                        {id: "Core-SW1", type: "l3switch", name: "Core-SW1", x: 250, y: 200},
                        {id: "Core-SW2", type: "l3switch", name: "Core-SW2", x: 550, y: 200},
                        {id: "Access-SW1", type: "l2switch", name: "Access-SW1", x: 150, y: 350},
                        {id: "Access-SW2", type: "l2switch", name: "Access-SW2", x: 350, y: 350},
                        {id: "Access-SW3", type: "l2switch", name: "Access-SW3", x: 450, y: 350},
                        {id: "Access-SW4", type: "l2switch", name: "Access-SW4", x: 650, y: 350},
                        {id: "PC1", type: "pc", name: "Sales-PC1", x: 100, y: 500},
                        {id: "PC2", type: "pc", name: "Sales-PC2", x: 200, y: 500},
                        {id: "PC3", type: "pc", name: "Eng-PC1", x: 350, y: 500},
                        {id: "PC4", type: "pc", name: "Eng-PC2", x: 450, y: 500},
                        {id: "SRV1", type: "server", name: "Web-Server", x: 550, y: 500},
                        {id: "SRV2", type: "server", name: "DB-Server", x: 700, y: 500}
                    ],
                    connections: [
                        {id: "conn-1", device1: "Edge-R1", device2: "Core-SW1", color: "#06b6d4"},
                        {id: "conn-2", device1: "Core-SW1", device2: "Core-SW2", color: "#10b981"},
                        {id: "conn-3", device1: "Core-SW1", device2: "Access-SW1", color: "#9333ea"},
                        {id: "conn-4", device1: "Core-SW1", device2: "Access-SW2", color: "#9333ea"},
                        {id: "conn-5", device1: "Core-SW2", device2: "Access-SW3", color: "#9333ea"},
                        {id: "conn-6", device1: "Core-SW2", device2: "Access-SW4", color: "#9333ea"},
                        {id: "conn-7", device1: "Access-SW1", device2: "PC1", color: "#f59e0b"},
                        {id: "conn-8", device1: "Access-SW1", device2: "PC2", color: "#f59e0b"},
                        {id: "conn-9", device1: "Access-SW2", device2: "PC3", color: "#f59e0b"},
                        {id: "conn-10", device1: "Access-SW3", device2: "PC4", color: "#f59e0b"},
                        {id: "conn-11", device1: "Access-SW4", device2: "SRV1", color: "#ec4899"},
                        {id: "conn-12", device1: "Access-SW4", device2: "SRV2", color: "#ec4899"}
                    ]
                },
                instructions: [
                    {step: 1, title: "Create VLANs on Access-SW1", description: "Create VLAN 10 (Sales), VLAN 20 (Engineering), VLAN 30 (Servers)", commands: ["vlan 10", "name Sales", "vlan 20", "name Engineering", "vlan 30", "name Servers", "exit"], completed: false},
                    {step: 2, title: "Assign Access Ports to VLAN 10", description: "Configure Fa0/1-2 as access ports in VLAN 10 for Sales PCs", commands: ["int range Fa0/1-2", "switchport mode access", "switchport access vlan 10", "exit"], completed: false},
                    {step: 3, title: "Configure Trunk to Core Switch", description: "Configure Gi0/1 as 802.1Q trunk with native VLAN 99", commands: ["int Gi0/1", "switchport trunk encapsulation dot1q", "switchport mode trunk", "switchport trunk native vlan 99", "exit"], completed: false},
                    {step: 4, title: "Create VLANs on Core-SW1", description: "Create matching VLANs on Core switch", commands: ["vlan 10", "name Sales", "vlan 20", "name Engineering", "vlan 30", "name Servers", "vlan 99", "name Native", "exit"], completed: false},
                    {step: 5, title: "Configure Trunk on Core-SW1", description: "Configure trunk port facing Access-SW1", commands: ["int Gi0/2", "switchport trunk encapsulation dot1q", "switchport mode trunk", "switchport trunk native vlan 99", "exit"], completed: false},
                    {step: 6, title: "Create SVIs for Inter-VLAN Routing", description: "Create VLAN interfaces for routing between VLANs", commands: ["int vlan 10", "ip address 192.168.10.1 255.255.255.0", "int vlan 20", "ip address 192.168.20.1 255.255.255.0", "int vlan 30", "ip address 192.168.30.1 255.255.255.0"], completed: false},
                    {step: 7, title: "Verify VLAN Configuration", description: "Check VLAN assignments and trunk status", commands: ["show vlan brief", "show interfaces trunk"], completed: false},
                    {step: 8, title: "Test Inter-VLAN Routing", description: "Ping from Sales-PC1 (VLAN 10) to Eng-PC1 (VLAN 20)", commands: ["ping 192.168.20.10"], completed: false}
                ]
            },
            cumlab03: {
                id: "cumlab03",
                num: 3,
                title: "Spanning Tree Protocol",
                subtitle: "Add redundant links and configure STP for loop prevention",
                estimatedTime: "35 min",
                deviceCount: "1 Router, 6 Switches, 4 PCs, 2 Servers",
                concepts: ["STP/RSTP", "Root Bridge", "PortFast", "BPDU Guard"],
                buildsOn: "cumlab02",
                topology: {
                    devices: [
                        {id: "Edge-R1", type: "router", name: "Edge-Router", x: 400, y: 80},
                        {id: "Core-SW1", type: "l3switch", name: "Core-SW1", x: 250, y: 200},
                        {id: "Core-SW2", type: "l3switch", name: "Core-SW2", x: 550, y: 200},
                        {id: "Access-SW1", type: "l2switch", name: "Access-SW1", x: 150, y: 350},
                        {id: "Access-SW2", type: "l2switch", name: "Access-SW2", x: 350, y: 350},
                        {id: "Access-SW3", type: "l2switch", name: "Access-SW3", x: 450, y: 350},
                        {id: "Access-SW4", type: "l2switch", name: "Access-SW4", x: 650, y: 350},
                        {id: "PC1", type: "pc", name: "Sales-PC1", x: 100, y: 500},
                        {id: "PC2", type: "pc", name: "Sales-PC2", x: 200, y: 500},
                        {id: "PC3", type: "pc", name: "Eng-PC1", x: 350, y: 500},
                        {id: "PC4", type: "pc", name: "Eng-PC2", x: 450, y: 500},
                        {id: "SRV1", type: "server", name: "Web-Server", x: 550, y: 500},
                        {id: "SRV2", type: "server", name: "DB-Server", x: 700, y: 500}
                    ],
                    connections: [
                        {id: "conn-1", device1: "Edge-R1", device2: "Core-SW1", color: "#06b6d4"},
                        {id: "conn-2", device1: "Edge-R1", device2: "Core-SW2", color: "#06b6d4"},
                        {id: "conn-3", device1: "Core-SW1", device2: "Core-SW2", color: "#10b981"},
                        {id: "conn-4", device1: "Core-SW1", device2: "Access-SW1", color: "#9333ea"},
                        {id: "conn-5", device1: "Core-SW1", device2: "Access-SW2", color: "#9333ea"},
                        {id: "conn-6", device1: "Core-SW2", device2: "Access-SW3", color: "#9333ea"},
                        {id: "conn-7", device1: "Core-SW2", device2: "Access-SW4", color: "#9333ea"},
                        {id: "conn-8", device1: "Access-SW1", device2: "Access-SW2", color: "#9333ea"},
                        {id: "conn-9", device1: "Access-SW3", device2: "Access-SW4", color: "#9333ea"},
                        {id: "conn-10", device1: "Access-SW1", device2: "PC1", color: "#f59e0b"},
                        {id: "conn-11", device1: "Access-SW1", device2: "PC2", color: "#f59e0b"},
                        {id: "conn-12", device1: "Access-SW2", device2: "PC3", color: "#f59e0b"},
                        {id: "conn-13", device1: "Access-SW3", device2: "PC4", color: "#f59e0b"},
                        {id: "conn-14", device1: "Access-SW4", device2: "SRV1", color: "#ec4899"},
                        {id: "conn-15", device1: "Access-SW4", device2: "SRV2", color: "#ec4899"}
                    ]
                },
                instructions: [
                    {step: 1, title: "Enable Rapid PVST+", description: "Configure all switches to use Rapid Spanning Tree", commands: ["spanning-tree mode rapid-pvst"], completed: false},
                    {step: 2, title: "Configure Core-SW1 as Root for VLANs 10,20", description: "Set priority to make Core-SW1 root bridge for Sales and Engineering VLANs", commands: ["spanning-tree vlan 10 root primary", "spanning-tree vlan 20 root primary"], completed: false},
                    {step: 3, title: "Configure Core-SW2 as Root for VLAN 30", description: "Set priority to make Core-SW2 root bridge for Servers VLAN", commands: ["spanning-tree vlan 30 root primary"], completed: false},
                    {step: 4, title: "Configure Secondary Root Bridges", description: "Set backup root bridges for redundancy", commands: ["spanning-tree vlan 10 root secondary", "spanning-tree vlan 20 root secondary"], completed: false},
                    {step: 5, title: "Enable PortFast on Access Ports", description: "Configure PortFast on end-user ports for faster convergence", commands: ["int range Fa0/1-10", "spanning-tree portfast", "exit"], completed: false},
                    {step: 6, title: "Enable BPDU Guard", description: "Protect PortFast ports from rogue switches", commands: ["int range Fa0/1-10", "spanning-tree bpduguard enable", "exit"], completed: false},
                    {step: 7, title: "Verify STP Configuration", description: "Check root bridge and port states", commands: ["show spanning-tree summary", "show spanning-tree vlan 10"], completed: false},
                    {step: 8, title: "Test Redundancy", description: "Simulate link failure and verify convergence", commands: ["int Gi0/1", "shutdown", "show spanning-tree"], completed: false}
                ]
            },
            cumlab04: {
                id: "cumlab04",
                num: 4,
                title: "OSPF Dynamic Routing",
                subtitle: "Replace static routes with OSPF for automatic failover",
                estimatedTime: "50 min",
                deviceCount: "1 Router, 6 Switches, 4 PCs, 2 Servers",
                concepts: ["OSPF Areas", "Router ID", "Cost", "Passive Interfaces"],
                buildsOn: "cumlab03",
                topology: {
                    devices: [
                        {id: "Edge-R1", type: "router", name: "Edge-Router", x: 400, y: 80},
                        {id: "Core-SW1", type: "l3switch", name: "Core-SW1", x: 250, y: 200},
                        {id: "Core-SW2", type: "l3switch", name: "Core-SW2", x: 550, y: 200},
                        {id: "Access-SW1", type: "l2switch", name: "Access-SW1", x: 150, y: 350},
                        {id: "Access-SW2", type: "l2switch", name: "Access-SW2", x: 350, y: 350},
                        {id: "Access-SW3", type: "l2switch", name: "Access-SW3", x: 450, y: 350},
                        {id: "Access-SW4", type: "l2switch", name: "Access-SW4", x: 650, y: 350},
                        {id: "PC1", type: "pc", name: "Sales-PC1", x: 100, y: 500},
                        {id: "PC2", type: "pc", name: "Sales-PC2", x: 200, y: 500},
                        {id: "PC3", type: "pc", name: "Eng-PC1", x: 350, y: 500},
                        {id: "PC4", type: "pc", name: "Eng-PC2", x: 450, y: 500},
                        {id: "SRV1", type: "server", name: "Web-Server", x: 550, y: 500},
                        {id: "SRV2", type: "server", name: "DB-Server", x: 700, y: 500}
                    ],
                    connections: [
                        {id: "conn-1", device1: "Edge-R1", device2: "Core-SW1", color: "#06b6d4"},
                        {id: "conn-2", device1: "Edge-R1", device2: "Core-SW2", color: "#06b6d4"},
                        {id: "conn-3", device1: "Core-SW1", device2: "Core-SW2", color: "#10b981"},
                        {id: "conn-4", device1: "Core-SW1", device2: "Access-SW1", color: "#9333ea"},
                        {id: "conn-5", device1: "Core-SW1", device2: "Access-SW2", color: "#9333ea"},
                        {id: "conn-6", device1: "Core-SW2", device2: "Access-SW3", color: "#9333ea"},
                        {id: "conn-7", device1: "Core-SW2", device2: "Access-SW4", color: "#9333ea"},
                        {id: "conn-8", device1: "Access-SW1", device2: "Access-SW2", color: "#9333ea"},
                        {id: "conn-9", device1: "Access-SW3", device2: "Access-SW4", color: "#9333ea"},
                        {id: "conn-10", device1: "Access-SW1", device2: "PC1", color: "#f59e0b"},
                        {id: "conn-11", device1: "Access-SW1", device2: "PC2", color: "#f59e0b"},
                        {id: "conn-12", device1: "Access-SW2", device2: "PC3", color: "#f59e0b"},
                        {id: "conn-13", device1: "Access-SW3", device2: "PC4", color: "#f59e0b"},
                        {id: "conn-14", device1: "Access-SW4", device2: "SRV1", color: "#ec4899"},
                        {id: "conn-15", device1: "Access-SW4", device2: "SRV2", color: "#ec4899"}
                    ]
                },
                instructions: [
                    {step: 1, title: "Remove Static Routes", description: "Clear existing static routes from Edge Router", commands: ["no ip route 192.168.0.0 255.255.0.0 10.0.0.2"], completed: false},
                    {step: 2, title: "Configure Loopback for Router ID", description: "Create loopback interface for stable OSPF Router ID", commands: ["int Loopback0", "ip address 1.1.1.1 255.255.255.255", "exit"], completed: false},
                    {step: 3, title: "Enable OSPF on Edge Router", description: "Configure OSPF process and advertise networks in Area 0", commands: ["router ospf 1", "router-id 1.1.1.1", "network 10.0.0.0 0.0.0.3 area 0", "network 203.0.113.0 0.0.0.3 area 0"], completed: false},
                    {step: 4, title: "Set Reference Bandwidth", description: "Adjust OSPF cost calculation for modern link speeds", commands: ["auto-cost reference-bandwidth 10000"], completed: false},
                    {step: 5, title: "Configure Passive Interface", description: "Don't send OSPF hellos out WAN interface", commands: ["passive-interface Gi0/0", "exit"], completed: false},
                    {step: 6, title: "Enable OSPF on Core-SW1", description: "Configure OSPF with networks in Area 0", commands: ["router ospf 1", "router-id 2.2.2.2", "network 10.0.0.0 0.0.0.3 area 0", "network 192.168.10.0 0.0.0.255 area 0", "network 192.168.20.0 0.0.0.255 area 0"], completed: false},
                    {step: 7, title: "Verify OSPF Neighbors", description: "Confirm OSPF adjacency is established", commands: ["show ip ospf neighbor"], completed: false},
                    {step: 8, title: "Verify OSPF Routes", description: "Check routing table for OSPF-learned routes (O)", commands: ["show ip route ospf"], completed: false}
                ]
            },
            cumlab05: {
                id: "cumlab05",
                num: 5,
                title: "EIGRP and Redistribution",
                subtitle: "Add a remote branch with EIGRP and configure redistribution",
                estimatedTime: "55 min",
                deviceCount: "2 Routers, 7 Switches, 6 PCs, 2 Servers",
                concepts: ["EIGRP", "Route Redistribution", "Administrative Distance", "Route Filtering"],
                buildsOn: "cumlab04",
                topology: {
                    devices: [
                        {id: "Edge-R1", type: "router", name: "Edge-Router", x: 400, y: 80},
                        {id: "Remote-R1", type: "router", name: "Remote-Router", x: 700, y: 80},
                        {id: "Core-SW1", type: "l3switch", name: "Core-SW1", x: 250, y: 200},
                        {id: "Core-SW2", type: "l3switch", name: "Core-SW2", x: 550, y: 200},
                        {id: "Remote-SW1", type: "l2switch", name: "Remote-SW", x: 800, y: 200},
                        {id: "Access-SW1", type: "l2switch", name: "Access-SW1", x: 150, y: 350},
                        {id: "Access-SW2", type: "l2switch", name: "Access-SW2", x: 300, y: 350},
                        {id: "Access-SW3", type: "l2switch", name: "Access-SW3", x: 450, y: 350},
                        {id: "Access-SW4", type: "l2switch", name: "Access-SW4", x: 600, y: 350},
                        {id: "PC1", type: "pc", name: "Sales-PC1", x: 100, y: 500},
                        {id: "PC2", type: "pc", name: "Sales-PC2", x: 200, y: 500},
                        {id: "PC3", type: "pc", name: "Eng-PC1", x: 350, y: 500},
                        {id: "PC4", type: "pc", name: "Eng-PC2", x: 450, y: 500},
                        {id: "SRV1", type: "server", name: "Web-Server", x: 550, y: 500},
                        {id: "SRV2", type: "server", name: "DB-Server", x: 650, y: 500},
                        {id: "Remote-PC1", type: "pc", name: "Remote-PC1", x: 750, y: 350},
                        {id: "Remote-PC2", type: "pc", name: "Remote-PC2", x: 850, y: 350}
                    ],
                    connections: [
                        {id: "conn-1", device1: "Edge-R1", device2: "Core-SW1", color: "#06b6d4"},
                        {id: "conn-2", device1: "Edge-R1", device2: "Core-SW2", color: "#06b6d4"},
                        {id: "conn-3", device1: "Core-SW1", device2: "Core-SW2", color: "#10b981"},
                        {id: "conn-4", device1: "Core-SW1", device2: "Access-SW1", color: "#9333ea"},
                        {id: "conn-5", device1: "Core-SW1", device2: "Access-SW2", color: "#9333ea"},
                        {id: "conn-6", device1: "Core-SW2", device2: "Access-SW3", color: "#9333ea"},
                        {id: "conn-7", device1: "Core-SW2", device2: "Access-SW4", color: "#9333ea"},
                        {id: "conn-8", device1: "Access-SW1", device2: "Access-SW2", color: "#9333ea"},
                        {id: "conn-9", device1: "Access-SW3", device2: "Access-SW4", color: "#9333ea"},
                        {id: "conn-10", device1: "Access-SW1", device2: "PC1", color: "#f59e0b"},
                        {id: "conn-11", device1: "Access-SW1", device2: "PC2", color: "#f59e0b"},
                        {id: "conn-12", device1: "Access-SW2", device2: "PC3", color: "#f59e0b"},
                        {id: "conn-13", device1: "Access-SW3", device2: "PC4", color: "#f59e0b"},
                        {id: "conn-14", device1: "Access-SW4", device2: "SRV1", color: "#ec4899"},
                        {id: "conn-15", device1: "Access-SW4", device2: "SRV2", color: "#ec4899"},
                        {id: "conn-16", device1: "Edge-R1", device2: "Remote-R1", color: "#06b6d4"},
                        {id: "conn-17", device1: "Remote-R1", device2: "Remote-PC1", color: "#f59e0b"},
                        {id: "conn-18", device1: "Remote-R1", device2: "Remote-PC2", color: "#f59e0b"}
                    ]
                },
                instructions: [
                    {step: 1, title: "Configure WAN Link to Remote Site", description: "Add new interface on Edge Router for remote branch", commands: ["int Gi0/2", "ip address 10.10.10.1 255.255.255.252", "no shut", "exit"], completed: false},
                    {step: 2, title: "Configure Remote Router WAN Interface", description: "Configure remote router's connection to headquarters", commands: ["int Gi0/0", "ip address 10.10.10.2 255.255.255.252", "no shut", "exit"], completed: false},
                    {step: 3, title: "Configure Remote LAN", description: "Set up remote branch LAN network", commands: ["int Gi0/1", "ip address 192.168.50.1 255.255.255.0", "no shut", "exit"], completed: false},
                    {step: 4, title: "Enable EIGRP on Remote Router", description: "Configure EIGRP AS 100 for remote branch", commands: ["router eigrp 100", "network 10.10.10.0 0.0.0.3", "network 192.168.50.0 0.0.0.255", "no auto-summary", "exit"], completed: false},
                    {step: 5, title: "Enable EIGRP on Edge Router", description: "Configure EIGRP AS 100 for WAN link", commands: ["router eigrp 100", "network 10.10.10.0 0.0.0.3", "no auto-summary", "exit"], completed: false},
                    {step: 6, title: "Configure OSPF to EIGRP Redistribution", description: "Redistribute OSPF routes into EIGRP", commands: ["router eigrp 100", "redistribute ospf 1 metric 10000 100 255 1 1500", "exit"], completed: false},
                    {step: 7, title: "Configure EIGRP to OSPF Redistribution", description: "Redistribute EIGRP routes into OSPF", commands: ["router ospf 1", "redistribute eigrp 100 subnets", "exit"], completed: false},
                    {step: 8, title: "Verify Redistribution", description: "Check that routes from both protocols appear", commands: ["show ip route", "show ip eigrp neighbors"], completed: false}
                ]
            },
            cumlab06: {
                id: "cumlab06",
                num: 6,
                title: "Advanced Features Capstone",
                subtitle: "Complete enterprise network with HSRP, DHCP, ACLs, and SNMP",
                estimatedTime: "60 min",
                deviceCount: "2 Routers, 7 Switches, 6 PCs, 2 Servers",
                concepts: ["HSRP", "DHCP", "Access Control Lists", "SNMP Monitoring"],
                buildsOn: "cumlab05",
                topology: {
                    devices: [
                        {id: "Edge-R1", type: "router", name: "Edge-Router", x: 400, y: 80},
                        {id: "Remote-R1", type: "router", name: "Remote-Router", x: 700, y: 80},
                        {id: "Core-SW1", type: "l3switch", name: "Core-SW1", x: 250, y: 200},
                        {id: "Core-SW2", type: "l3switch", name: "Core-SW2", x: 550, y: 200},
                        {id: "Remote-SW1", type: "l2switch", name: "Remote-SW", x: 800, y: 200},
                        {id: "Access-SW1", type: "l2switch", name: "Access-SW1", x: 150, y: 350},
                        {id: "Access-SW2", type: "l2switch", name: "Access-SW2", x: 300, y: 350},
                        {id: "Access-SW3", type: "l2switch", name: "Access-SW3", x: 450, y: 350},
                        {id: "Access-SW4", type: "l2switch", name: "Access-SW4", x: 600, y: 350},
                        {id: "PC1", type: "pc", name: "Sales-PC1", x: 100, y: 500},
                        {id: "PC2", type: "pc", name: "Sales-PC2", x: 200, y: 500},
                        {id: "PC3", type: "pc", name: "Eng-PC1", x: 350, y: 500},
                        {id: "PC4", type: "pc", name: "Eng-PC2", x: 450, y: 500},
                        {id: "SRV1", type: "server", name: "Web-Server", x: 550, y: 500},
                        {id: "SRV2", type: "server", name: "DB-Server", x: 650, y: 500},
                        {id: "Remote-PC1", type: "pc", name: "Remote-PC1", x: 750, y: 350},
                        {id: "Remote-PC2", type: "pc", name: "Remote-PC2", x: 850, y: 350}
                    ],
                    connections: [
                        {id: "conn-1", device1: "Edge-R1", device2: "Core-SW1", color: "#06b6d4"},
                        {id: "conn-2", device1: "Edge-R1", device2: "Core-SW2", color: "#06b6d4"},
                        {id: "conn-3", device1: "Core-SW1", device2: "Core-SW2", color: "#10b981"},
                        {id: "conn-4", device1: "Core-SW1", device2: "Access-SW1", color: "#9333ea"},
                        {id: "conn-5", device1: "Core-SW1", device2: "Access-SW2", color: "#9333ea"},
                        {id: "conn-6", device1: "Core-SW2", device2: "Access-SW3", color: "#9333ea"},
                        {id: "conn-7", device1: "Core-SW2", device2: "Access-SW4", color: "#9333ea"},
                        {id: "conn-8", device1: "Access-SW1", device2: "Access-SW2", color: "#9333ea"},
                        {id: "conn-9", device1: "Access-SW3", device2: "Access-SW4", color: "#9333ea"},
                        {id: "conn-10", device1: "Access-SW1", device2: "PC1", color: "#f59e0b"},
                        {id: "conn-11", device1: "Access-SW1", device2: "PC2", color: "#f59e0b"},
                        {id: "conn-12", device1: "Access-SW2", device2: "PC3", color: "#f59e0b"},
                        {id: "conn-13", device1: "Access-SW3", device2: "PC4", color: "#f59e0b"},
                        {id: "conn-14", device1: "Access-SW4", device2: "SRV1", color: "#ec4899"},
                        {id: "conn-15", device1: "Access-SW4", device2: "SRV2", color: "#ec4899"},
                        {id: "conn-16", device1: "Edge-R1", device2: "Remote-R1", color: "#06b6d4"},
                        {id: "conn-17", device1: "Remote-R1", device2: "Remote-PC1", color: "#f59e0b"},
                        {id: "conn-18", device1: "Remote-R1", device2: "Remote-PC2", color: "#f59e0b"}
                    ]
                },
                instructions: [
                    {step: 1, title: "Configure HSRP on Core-SW1", description: "Set up HSRP group 10 for VLAN 10 gateway redundancy", commands: ["int vlan 10", "standby 10 ip 192.168.10.254", "standby 10 priority 110", "standby 10 preempt", "exit"], completed: false},
                    {step: 2, title: "Configure HSRP on Core-SW2", description: "Configure backup HSRP router for VLAN 10", commands: ["int vlan 10", "standby 10 ip 192.168.10.254", "standby 10 priority 100", "exit"], completed: false},
                    {step: 3, title: "Configure DHCP Pool", description: "Create DHCP pool for Sales VLAN on Edge Router", commands: ["ip dhcp pool SALES", "network 192.168.10.0 255.255.255.0", "default-router 192.168.10.254", "dns-server 8.8.8.8", "exit"], completed: false},
                    {step: 4, title: "Exclude DHCP Addresses", description: "Reserve addresses for network infrastructure", commands: ["ip dhcp excluded-address 192.168.10.1 192.168.10.10"], completed: false},
                    {step: 5, title: "Create Security ACL", description: "Block Telnet but allow SSH and HTTP", commands: ["ip access-list extended SECURE-ACCESS", "deny tcp any any eq 23", "permit tcp any any eq 22", "permit tcp any any eq 80", "permit tcp any any eq 443", "permit ip any any", "exit"], completed: false},
                    {step: 6, title: "Apply ACL to Interface", description: "Apply the security ACL to the WAN interface", commands: ["int Gi0/0", "ip access-group SECURE-ACCESS in", "exit"], completed: false},
                    {step: 7, title: "Configure SNMP", description: "Enable SNMP for network monitoring", commands: ["snmp-server community public RO", "snmp-server community private RW", "snmp-server location HQ-Datacenter", "snmp-server contact admin@company.com"], completed: false},
                    {step: 8, title: "Verify Complete Configuration", description: "Test all features: HSRP failover, DHCP, ACL filtering, SNMP", commands: ["show standby brief", "show ip dhcp binding", "show access-lists", "show snmp"], completed: false}
                ]
            }
        };

        // ========== APPLICATION STATE ==========
        let currentLab = null;
        let currentLabProgress = 0;

        // Troubleshooting state
        let currentTSScenario = null;
        let tsHintsUsed = [];
        let tsSolutionViewed = false;
        let tsStartTime = null;
        let tsProgress = {
            symptomIdentified: true,
            diagnosing: true,
            fixApplied: false,
            verified: false
        };

        // ========== EVENT LISTENERS ==========
        document.addEventListener('DOMContentLoaded', () => {
            // Home Button
            document.getElementById('homeBtn').addEventListener('click', returnHome);

            // Lab Library Button
            document.getElementById('labLibraryBtn').addEventListener('click', openLabLibrary);
            document.getElementById('closeLabLibrary').addEventListener('click', closeLabLibrary);

            // Cumulative Labs Button
            document.getElementById('cumulativeLabsBtn').addEventListener('click', openCumulativeLabs);
            document.getElementById('closeCumulativeLabs').addEventListener('click', closeCumulativeLabsModal);
            document.getElementById('unlockAllLabsBtn').addEventListener('click', unlockAllCumulativeLabs);
            document.getElementById('resetLabProgressBtn').addEventListener('click', resetCumulativeLabProgress);

            // Troubleshooting Button
            document.getElementById('troubleshootBtn').addEventListener('click', openTroubleshootModal);
            document.getElementById('closeTroubleshoot').addEventListener('click', closeTroubleshootModal);
            document.getElementById('exitTroubleshootingBtn').addEventListener('click', exitTroubleshooting);

            // Troubleshooting Filter Buttons
            document.querySelectorAll('#tsFilters .filter-btn').forEach(btn => {
                btn.addEventListener('click', () => filterTSScenarios(btn.dataset.filter));
            });

            // Panel Tabs
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });

            // Filter Buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => filterLabs(btn.dataset.filter));
            });

            // Initialize Lab Library
            renderLabLibrary();

            // Initialize Cumulative Labs
            renderCumulativeLabs();

            // Initialize Troubleshooting System
            renderTroubleshootingScenarios();
            loadTSProgress();

            // DHCP Server enable/disable toggle
            document.getElementById('dhcpServerEnabled').addEventListener('change', (e) => {
                if (selectedDevice && selectedDevice.dhcpServer) {
                    selectedDevice.dhcpServer.enabled = e.target.checked;
                    document.getElementById('dhcpPoolConfig').style.display = e.target.checked ? 'block' : 'none';
                }
            });

            // Apply DHCP Server Configuration
            document.getElementById('applyDhcpServerBtn').addEventListener('click', applyDhcpServerConfig);

            // DHCP Client checkbox toggle
            document.getElementById('dhcpClientCheckbox').addEventListener('change', (e) => {
                if (selectedDevice && selectedDevice.interfaces) {
                    const interfaceIndex = parseInt(document.getElementById('interfaceSelect').value);
                    const intf = selectedDevice.interfaces[interfaceIndex];
                    if (intf) {
                        intf.dhcpEnabled = e.target.checked;
                        loadInterfaceConfig(); // Refresh to show/hide IP fields
                    }
                }
            });

            // Request DHCP IP
            document.getElementById('requestDhcpBtn').addEventListener('click', requestDhcpIp);
        });

        // ========== LAB LIBRARY FUNCTIONS ==========
        function openLabLibrary() {
            document.getElementById('labLibraryModal').classList.add('active');
        }

        function closeLabLibrary() {
            document.getElementById('labLibraryModal').classList.remove('active');
        }

        function renderLabLibrary(filter = 'all') {
            const labGrid = document.getElementById('labGrid');
            labGrid.innerHTML = '';

            Object.values(LAB_LIBRARY).forEach(lab => {
                if (filter !== 'all' && lab.difficulty !== filter) return;

                const labCard = document.createElement('div');
                labCard.className = 'lab-card';
                labCard.innerHTML = `
                    <div class="lab-card-header">
                        <span class="lab-badge ${lab.difficulty}">${lab.icon} ${lab.difficulty}</span>
                    </div>
                    <div class="lab-title">${lab.title}</div>
                    <div class="lab-meta">
                        <div class="lab-meta-item">‚è± ${lab.estimatedTime}</div>
                        <div class="lab-meta-item">üîß ${lab.devices}</div>
                    </div>
                    <div class="lab-description">${lab.description}</div>
                    <div class="lab-tags">
                        ${lab.concepts.map(concept => `<span class="lab-tag">${concept}</span>`).join('')}
                    </div>
                    <div class="lab-actions">
                        <button class="btn btn-primary" onclick="loadLab('${lab.id}')">
                            üé¨ Load Lab
                        </button>
                        <button class="btn btn-small">üìñ Instructions</button>
                    </div>
                `;
                labGrid.appendChild(labCard);
            });
        }

        function filterLabs(filter) {
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === filter) {
                    btn.classList.add('active');
                }
            });

            // Re-render library with filter
            renderLabLibrary(filter);
        }

        function loadLab(labId) {
            const lab = LAB_LIBRARY[labId];
            if (!lab) return;

            currentLab = lab;
            currentLabProgress = 0;

            // Update UI
            document.getElementById('currentLab').textContent = lab.title;
            document.getElementById('welcomeMessage').style.display = 'none';

            // Show Home button, hide Lab Library button
            document.getElementById('homeBtn').style.display = 'inline-flex';
            document.getElementById('labLibraryBtn').style.display = 'none';

            // Close modal
            closeLabLibrary();

            // Load instructions
            renderInstructions(lab);

            // Load topology onto canvas
            loadTopology(lab.topology);

            console.log('Loading lab:', lab.title);
        }

        function loadTopology(topology) {
            if (!topology || !topology.devices) return;

            // Clear existing devices and connections
            devices = [];
            connections = [];
            deviceIdCounter = 0;
            connectionIdCounter = 0;
            canvas.innerHTML = '';

            // Render each device from the lab
            topology.devices.forEach(deviceData => {
                const deviceId = deviceData.id;

                // Device type configurations
                const deviceConfig = {
                    'router': { icon: 'üî∑', color: '#06b6d4', label: 'Router' },
                    'l2switch': { icon: 'üî∂', color: '#9333ea', label: 'Switch' },
                    'l3switch': { icon: 'üî∑', color: '#10b981', label: 'L3-SW' },
                    'pc': { icon: 'üíª', color: '#f59e0b', label: 'PC' },
                    'server': { icon: 'üñ•Ô∏è', color: '#ec4899', label: 'Server' }
                };

                const config = deviceConfig[deviceData.type] || deviceConfig['pc'];

                // Create SVG group for device
                const deviceGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                deviceGroup.setAttribute('id', deviceId);
                deviceGroup.setAttribute('transform', `translate(${deviceData.x}, ${deviceData.y})`);
                deviceGroup.style.cursor = 'move';

                // Create background circle
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', '0');
                circle.setAttribute('cy', '0');
                circle.setAttribute('r', '30');
                circle.setAttribute('fill', config.color);
                circle.setAttribute('opacity', '0.2');
                circle.setAttribute('stroke', config.color);
                circle.setAttribute('stroke-width', '2');

                // Create text icon
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', '0');
                text.setAttribute('y', '0');
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'central');
                text.setAttribute('font-size', '24');
                text.textContent = config.icon;

                // Create label
                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                label.setAttribute('x', '0');
                label.setAttribute('y', '45');
                label.setAttribute('text-anchor', 'middle');
                label.setAttribute('font-size', '12');
                label.setAttribute('fill', '#cbd5e1');
                label.textContent = deviceData.name;

                deviceGroup.appendChild(circle);
                deviceGroup.appendChild(text);
                deviceGroup.appendChild(label);
                canvas.appendChild(deviceGroup);

                // Use imported interfaces if available, otherwise generate defaults
                let interfaces = [];
                if (deviceData.interfaces && deviceData.interfaces.length > 0) {
                    // Use the imported interface data (preserves IP addresses, VLANs, etc.)
                    interfaces = deviceData.interfaces;
                } else {
                    // Generate default interfaces based on device type
                    if (deviceData.type === 'router') {
                        interfaces = [
                            { name: 'GigabitEthernet0/0', ip: '', mask: '', status: 'down' },
                            { name: 'GigabitEthernet0/1', ip: '', mask: '', status: 'down' },
                            { name: 'GigabitEthernet0/2', ip: '', mask: '', status: 'down' },
                            { name: 'Serial0/0/0', ip: '', mask: '', status: 'down' }
                        ];
                    } else if (deviceData.type === 'l2switch' || deviceData.type === 'l3switch') {
                        interfaces = [
                            { name: 'FastEthernet0/1', vlan: 1, status: 'up' },
                            { name: 'FastEthernet0/2', vlan: 1, status: 'up' },
                            { name: 'FastEthernet0/3', vlan: 1, status: 'up' },
                            { name: 'FastEthernet0/4', vlan: 1, status: 'up' },
                            { name: 'FastEthernet0/5', vlan: 1, status: 'up' },
                            { name: 'GigabitEthernet0/1', vlan: 1, status: 'up' },
                            { name: 'GigabitEthernet0/2', vlan: 1, status: 'up' }
                        ];
                        if (deviceData.type === 'l3switch') {
                            interfaces.push({ name: 'Vlan1', ip: '', mask: '', status: 'down' });
                        }
                    } else if (deviceData.type === 'pc' || deviceData.type === 'server') {
                        interfaces = [
                            { name: 'Ethernet0', ip: '', mask: '', gateway: '', status: 'up' }
                        ];
                    }
                }

                // Store device data (including saved config from cumulative labs)
                const deviceObj = {
                    id: deviceId,
                    type: deviceData.type,
                    x: deviceData.x,
                    y: deviceData.y,
                    name: deviceData.name,
                    interfaces: interfaces,
                    selectedInterface: deviceData.selectedInterface || 0
                };

                // Restore config object if present (VLANs, routes, OSPF, EIGRP, ACLs)
                if (deviceData.config) {
                    deviceObj.config = deviceData.config;
                }

                // Restore DHCP server config if present
                if (deviceData.dhcpServer) {
                    deviceObj.dhcpServer = deviceData.dhcpServer;
                }

                devices.push(deviceObj);

                // Add drag functionality to move devices
                makeDraggable(deviceGroup);

                // Add click to select device
                deviceGroup.addEventListener('click', (e) => {
                    e.stopPropagation();
                    selectDevice(deviceId);
                });
            });

            // Load connections if present
            if (topology.connections && topology.connections.length > 0) {
                topology.connections.forEach(connData => {
                    const device1 = devices.find(d => d.id === connData.device1);
                    const device2 = devices.find(d => d.id === connData.device2);

                    if (device1 && device2) {
                        const connectionId = connData.id || `conn-${connectionIdCounter++}`;
                        const color = connData.color || '#ffffff';

                        // Store connection data
                        connections.push({
                            id: connectionId,
                            device1: connData.device1,
                            device2: connData.device2,
                            color: color
                        });

                        // Draw the connection line
                        drawConnection(connectionId, device1, device2, color);
                    }
                });
                console.log(`Loaded ${topology.connections.length} connections`);
            }

            console.log(`Loaded ${topology.devices.length} devices onto canvas`);
        }

        function returnHome() {
            // Reset state
            currentLab = null;
            currentLabProgress = 0;

            // Update UI
            document.getElementById('currentLab').textContent = 'None';
            document.getElementById('welcomeMessage').style.display = 'block';

            // Hide Home button, show Lab Library and Cumulative Labs buttons
            document.getElementById('homeBtn').style.display = 'none';
            document.getElementById('labLibraryBtn').style.display = 'inline-flex';
            document.getElementById('cumulativeLabsBtn').style.display = 'inline-flex';

            // Clear instructions
            document.getElementById('instructionsList').innerHTML = `
                <p style="color: var(--text-muted); text-align: center; padding: 40px 20px;">
                    Load a lab from the <strong>Lab Library</strong> to see step-by-step instructions here!
                </p>
            `;

            // Reset progress
            document.getElementById('progressPercent').textContent = '0%';
            document.getElementById('progressFill').style.width = '0%';

            // Clear canvas
            devices = [];
            deviceIdCounter = 0;
            canvas.innerHTML = '';
            selectedDevice = null;

            console.log('Returned to home screen');
        }

        // ========== CUMULATIVE LABS FUNCTIONS ==========

        function openCumulativeLabs() {
            document.getElementById('cumulativeLabsModal').classList.add('active');
        }

        function closeCumulativeLabsModal() {
            document.getElementById('cumulativeLabsModal').classList.remove('active');
        }

        function renderCumulativeLabs() {
            const grid = document.getElementById('cumulativeLabsGrid');
            if (!grid) return;

            grid.innerHTML = '';

            // Get progress from localStorage
            const progress = getCumulativeLabProgress();

            Object.values(CUMULATIVE_LABS).forEach((lab, index) => {
                // Lab is unlocked if it's the first one, or previous lab is completed
                const isUnlocked = index === 0 || progress[Object.keys(CUMULATIVE_LABS)[index - 1]]?.completed;
                const isCompleted = progress[lab.id]?.completed || false;

                const card = document.createElement('div');
                card.className = `cumulative-card ${!isUnlocked ? 'locked' : ''} ${isCompleted ? 'completed' : ''}`;

                card.innerHTML = `
                    <div class="cumulative-num">${isCompleted ? '‚úì' : lab.num}</div>
                    <div class="cumulative-info">
                        <h3>${lab.title}</h3>
                        <p>${lab.subtitle}</p>
                        <div class="cumulative-tags">
                            ${lab.concepts.map(c => `<span class="cumulative-tag">${c}</span>`).join('')}
                        </div>
                        <div class="cumulative-meta">
                            <span class="time">‚è±Ô∏è ${lab.estimatedTime}</span>
                            <span class="devices">üñ•Ô∏è ${lab.deviceCount}</span>
                        </div>
                    </div>
                    <div class="cumulative-arrow">
                        ${isUnlocked ? (isCompleted ? '‚úÖ' : '‚û°Ô∏è') : 'üîí'}
                    </div>
                `;

                if (isUnlocked) {
                    card.addEventListener('click', () => loadCumulativeLab(lab.id));
                    card.style.cursor = 'pointer';
                }

                grid.appendChild(card);
            });
        }

        function getCumulativeLabProgress() {
            try {
                return JSON.parse(localStorage.getItem('cumulativeLabProgress') || '{}');
            } catch {
                return {};
            }
        }

        function saveCumulativeLabProgress(labId, data) {
            const progress = getCumulativeLabProgress();
            progress[labId] = { ...progress[labId], ...data };
            localStorage.setItem('cumulativeLabProgress', JSON.stringify(progress));
        }

        function saveStepProgress(labId, stepIndex, completed) {
            const progress = getCumulativeLabProgress();
            if (!progress[labId]) {
                progress[labId] = {};
            }
            if (!progress[labId].steps) {
                progress[labId].steps = {};
            }
            progress[labId].steps[stepIndex] = completed;
            localStorage.setItem('cumulativeLabProgress', JSON.stringify(progress));
        }

        function loadStepProgress(labId) {
            const progress = getCumulativeLabProgress();
            return progress[labId]?.steps || {};
        }

        // Save current topology state (devices, connections, interfaces, configs) for cumulative labs
        function saveCumulativeTopologyState(labId) {
            const state = {
                devices: devices.map(d => ({
                    id: d.id,
                    type: d.type,
                    name: d.name,
                    x: d.x,
                    y: d.y,
                    interfaces: d.interfaces || [],
                    config: d.config || null,
                    dhcpServer: d.dhcpServer || null,
                    selectedInterface: d.selectedInterface || 0
                })),
                connections: connections.map(c => ({
                    id: c.id,
                    device1: c.device1,
                    device2: c.device2,
                    color: c.color
                }))
            };

            const progress = getCumulativeLabProgress();
            if (!progress[labId]) {
                progress[labId] = {};
            }
            progress[labId].topologyState = state;
            localStorage.setItem('cumulativeLabProgress', JSON.stringify(progress));
            console.log(`Saved topology state for ${labId}: ${state.devices.length} devices, ${state.connections.length} connections`);
        }

        // Load saved topology state for a cumulative lab
        function loadCumulativeTopologyState(labId) {
            const progress = getCumulativeLabProgress();
            return progress[labId]?.topologyState || null;
        }

        function loadCumulativeLab(labId) {
            const lab = CUMULATIVE_LABS[labId];
            if (!lab) return;

            // Restore step progress from localStorage
            const savedSteps = loadStepProgress(labId);
            lab.instructions.forEach((instruction, index) => {
                instruction.completed = savedSteps[index] === true;
            });

            currentLab = lab;
            currentLabProgress = 0;

            // Update UI
            document.getElementById('currentLab').textContent = `üìö ${lab.title}`;
            document.getElementById('welcomeMessage').style.display = 'none';

            // Show Home button, hide other buttons
            document.getElementById('homeBtn').style.display = 'inline-flex';
            document.getElementById('labLibraryBtn').style.display = 'none';
            document.getElementById('cumulativeLabsBtn').style.display = 'none';

            // Close modal
            closeCumulativeLabsModal();

            // Load instructions with cumulative-specific header
            renderCumulativeInstructions(lab);

            // Determine which topology state to load
            let topologyToLoad = null;

            // First, check if THIS lab has a saved state (user returning to continue)
            const thisLabState = loadCumulativeTopologyState(labId);
            if (thisLabState && thisLabState.devices && thisLabState.devices.length > 0) {
                topologyToLoad = thisLabState;
                console.log(`Restoring saved state for ${labId}`);
            }
            // If this lab builds on a previous lab, try to load that lab's state
            else if (lab.buildsOn) {
                const previousLabState = loadCumulativeTopologyState(lab.buildsOn);
                if (previousLabState && previousLabState.devices && previousLabState.devices.length > 0) {
                    topologyToLoad = previousLabState;
                    console.log(`Loading state from previous lab: ${lab.buildsOn}`);
                }
            }

            // Load the appropriate topology
            if (topologyToLoad) {
                loadTopology(topologyToLoad);
            } else {
                // Fall back to the lab's default topology
                loadTopology(lab.topology);
            }

            console.log('Loading cumulative lab:', lab.title);
        }

        function renderCumulativeInstructions(lab) {
            const instructionsList = document.getElementById('instructionsList');
            instructionsList.innerHTML = '';

            // Add header with lab series info
            const headerDiv = document.createElement('div');
            headerDiv.className = 'lab-header';
            headerDiv.style.cssText = 'background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;';
            headerDiv.innerHTML = `
                <div style="font-size: 0.8em; opacity: 0.9; margin-bottom: 5px;">CUMULATIVE LAB ${lab.num} of 6</div>
                <div style="font-size: 1.1em; font-weight: bold;">${lab.title}</div>
                ${lab.buildsOn ? `<div style="font-size: 0.75em; margin-top: 8px; opacity: 0.85;">‚¨ÜÔ∏è Builds on: ${CUMULATIVE_LABS[lab.buildsOn]?.title || lab.buildsOn}</div>` : ''}
            `;
            instructionsList.appendChild(headerDiv);

            // Render each step
            lab.instructions.forEach((instruction, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = `instruction-step ${instruction.completed ? 'completed' : ''}`;
                stepDiv.innerHTML = `
                    <div class="step-header">
                        <span class="step-number">${index + 1}</span>
                        <span class="step-title">${instruction.title}</span>
                        <span class="step-status">${instruction.completed ? '‚úì' : ''}</span>
                    </div>
                    <div class="step-description">${instruction.description}</div>
                    <div class="step-commands">
                        ${instruction.commands.map(cmd => `<code>${cmd}</code>`).join('')}
                    </div>
                `;

                // Click to mark as completed
                stepDiv.addEventListener('click', () => {
                    instruction.completed = !instruction.completed;
                    stepDiv.classList.toggle('completed', instruction.completed);
                    stepDiv.querySelector('.step-status').textContent = instruction.completed ? '‚úì' : '';

                    // Save step progress to localStorage
                    saveStepProgress(lab.id, index, instruction.completed);

                    // Check if all steps completed
                    checkCumulativeLabCompletion(lab);
                });

                instructionsList.appendChild(stepDiv);
            });
        }

        function checkCumulativeLabCompletion(lab) {
            const allCompleted = lab.instructions.every(i => i.completed);

            if (allCompleted) {
                // Save the current topology state so it carries over to the next lab
                saveCumulativeTopologyState(lab.id);

                saveCumulativeLabProgress(lab.id, { completed: true, completedAt: new Date().toISOString() });

                // Show completion message
                setTimeout(() => {
                    const nextLabId = getNextCumulativeLab(lab.id);
                    const message = nextLabId
                        ? `üéâ Congratulations! You've completed "${lab.title}"!\n\nYour network configuration has been saved.\nNext up: ${CUMULATIVE_LABS[nextLabId]?.title}\n\nYour connections and settings will carry over!`
                        : `üèÜ Outstanding! You've completed the entire Cumulative Lab Series!\n\nYou've built a complete enterprise network from the ground up!`;

                    alert(message);
                    renderCumulativeLabs(); // Refresh to show new unlock state
                }, 100);
            }
        }

        function getNextCumulativeLab(currentLabId) {
            const labIds = Object.keys(CUMULATIVE_LABS);
            const currentIndex = labIds.indexOf(currentLabId);
            return currentIndex < labIds.length - 1 ? labIds[currentIndex + 1] : null;
        }

        // ========== CUMULATIVE LABS UNLOCK/RESET FUNCTIONS ==========

        function unlockAllCumulativeLabs() {
            const progress = getCumulativeLabProgress();
            Object.keys(CUMULATIVE_LABS).forEach(labId => {
                progress[labId] = { ...progress[labId], completed: true, unlockedAt: new Date().toISOString() };
            });
            localStorage.setItem('cumulativeLabProgress', JSON.stringify(progress));
            renderCumulativeLabs();
            console.log('üîì All cumulative labs unlocked!');
        }

        function resetCumulativeLabProgress() {
            if (confirm('Are you sure you want to reset all cumulative lab progress? This will lock all labs except Lab 1.')) {
                localStorage.removeItem('cumulativeLabProgress');
                // Also reset in-memory instruction states
                Object.values(CUMULATIVE_LABS).forEach(lab => {
                    lab.instructions.forEach(instruction => {
                        instruction.completed = false;
                    });
                });
                renderCumulativeLabs();
                console.log('üîÑ Cumulative lab progress reset!');
            }
        }

        // ========== TROUBLESHOOTING SYSTEM FUNCTIONS ==========

        function openTroubleshootModal() {
            document.getElementById('troubleshootModal').classList.add('active');
            updateTSCompletionCount();
        }

        function closeTroubleshootModal() {
            document.getElementById('troubleshootModal').classList.remove('active');
        }

        function renderTroubleshootingScenarios(filter = 'all') {
            const grid = document.getElementById('tsGrid');
            grid.innerHTML = '';

            const tsProgress = getTSProgress();

            Object.values(TROUBLESHOOTING_SCENARIOS).forEach(scenario => {
                if (filter !== 'all' && scenario.difficulty !== filter) return;

                const progress = tsProgress[scenario.id] || {};
                const isCompleted = progress.completed || false;
                const score = progress.bestScore || 0;
                const isPerfect = score === 100;

                const card = document.createElement('div');
                card.className = 'ts-card';
                card.innerHTML = `
                    <div class="ts-card-header">
                        <span class="ts-badge ${scenario.difficulty}">${scenario.difficulty}</span>
                        <span class="ts-status">${isPerfect ? '‚≠ê' : isCompleted ? '‚úÖ' : ''}</span>
                    </div>
                    <div class="ts-title">${scenario.title}</div>
                    <div class="ts-meta">
                        <div>‚è± ${scenario.estimatedTime}</div>
                    </div>
                    <div class="ts-description">${scenario.description}</div>
                    <div class="ts-stats">
                        ${isCompleted ? `
                            <div class="ts-stat">
                                <span>üèÜ</span>
                                <span>Best: ${score} pts</span>
                            </div>
                        ` : ''}
                    </div>
                `;
                card.addEventListener('click', () => loadTSScenario(scenario.id));
                grid.appendChild(card);
            });
        }

        function filterTSScenarios(filter) {
            // Update active filter button
            document.querySelectorAll('#tsFilters .filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === filter) {
                    btn.classList.add('active');
                }
            });

            // Re-render scenarios with filter
            renderTroubleshootingScenarios(filter);
        }

        function loadTSScenario(scenarioId) {
            const scenario = TROUBLESHOOTING_SCENARIOS[scenarioId];
            if (!scenario) return;

            currentTSScenario = scenario;
            tsHintsUsed = [];
            tsSolutionViewed = false;
            tsStartTime = Date.now();
            tsProgress = {
                symptomIdentified: true,
                diagnosing: true,
                fixApplied: false,
                verified: false
            };

            // Close modal
            closeTroubleshootModal();

            // Hide welcome message
            document.getElementById('welcomeMessage').style.display = 'none';

            // Load topology
            loadTopology(scenario.topology);

            // Show troubleshooting panel instead of normal config panel
            document.querySelector('.config-panel').style.display = 'none';
            document.getElementById('troubleshootingPanel').style.display = 'block';
            document.querySelector('.app-container').classList.add('ts-mode-active');

            // Populate troubleshooting UI
            document.getElementById('tsProblemDescription').textContent = scenario.description;

            // Setup hints
            document.getElementById('hint1Content').textContent = scenario.hints[0].text;
            document.getElementById('hint2Content').textContent = scenario.hints[1].text;
            document.getElementById('hint3Content').textContent = scenario.hints[2].text;

            // Setup solution
            const solutionDiv = document.getElementById('solutionContent');
            solutionDiv.innerHTML = `
                <div class="ts-solution-explanation">${scenario.solution.explanation}</div>
                <div class="ts-solution-commands">
                    ${scenario.solution.commands.map(cmd => `<div>${cmd}</div>`).join('')}
                </div>
                <div class="ts-solution-why">${scenario.solution.why}</div>
            `;

            // Reset hint buttons
            resetHintButtons();

            // Clear results
            document.getElementById('tsResultContainer').innerHTML = '';

            console.log('Loaded troubleshooting scenario:', scenario.title);
        }

        function resetHintButtons() {
            document.getElementById('hint1Btn').classList.remove('locked', 'used');
            document.getElementById('hint1Btn').querySelector('span:last-child').textContent = '‚ñº';
            document.getElementById('hint1Content').classList.remove('visible');

            document.getElementById('hint2Btn').classList.add('locked');
            document.getElementById('hint2Btn').classList.remove('used');
            document.getElementById('hint2Btn').querySelector('span:last-child').textContent = 'üîí';
            document.getElementById('hint2Content').classList.remove('visible');

            document.getElementById('hint3Btn').classList.add('locked');
            document.getElementById('hint3Btn').classList.remove('used');
            document.getElementById('hint3Btn').querySelector('span:last-child').textContent = 'üîí';
            document.getElementById('hint3Content').classList.remove('visible');

            document.getElementById('solutionContent').classList.remove('visible');
        }

        function revealHint(level) {
            const btn = document.getElementById(`hint${level}Btn`);
            const content = document.getElementById(`hint${level}Content`);

            // Check if locked
            if (btn.classList.contains('locked')) {
                return;
            }

            // Toggle visibility
            if (content.classList.contains('visible')) {
                content.classList.remove('visible');
                btn.querySelector('span:last-child').textContent = '‚ñº';
            } else {
                content.classList.add('visible');
                btn.querySelector('span:last-child').textContent = '‚ñ≤';
                btn.classList.add('used');

                // Track that this hint was used
                if (!tsHintsUsed.includes(level)) {
                    tsHintsUsed.push(level);
                }

                // Unlock next hint
                if (level < 3) {
                    const nextBtn = document.getElementById(`hint${level + 1}Btn`);
                    nextBtn.classList.remove('locked');
                    nextBtn.querySelector('span:last-child').textContent = '‚ñº';
                }

                // Update progress
                updateTSProgressTracker();
            }
        }

        function revealSolution() {
            const solutionContent = document.getElementById('solutionContent');

            if (solutionContent.classList.contains('visible')) {
                solutionContent.classList.remove('visible');
            } else {
                solutionContent.classList.add('visible');
                tsSolutionViewed = true;

                // Update progress
                tsProgress.fixApplied = true;
                updateTSProgressTracker();
            }
        }

        function updateTSProgressTracker() {
            // Diagnose - changes when hints are used
            const diagnoseEl = document.getElementById('tsProgressDiagnose');
            if (tsHintsUsed.length > 0 || tsSolutionViewed) {
                diagnoseEl.classList.add('in-progress');
                diagnoseEl.querySelector('.ts-progress-icon').textContent = 'üîç';
            }

            // Fix Applied - changes when solution viewed
            const fixEl = document.getElementById('tsProgressFix');
            if (tsProgress.fixApplied) {
                fixEl.classList.add('in-progress');
                fixEl.querySelector('.ts-progress-icon').textContent = 'üîß';
            }

            // Verified - changes when test passes
            const verifyEl = document.getElementById('tsProgressVerify');
            if (tsProgress.verified) {
                verifyEl.classList.add('completed');
                verifyEl.querySelector('.ts-progress-icon').textContent = '‚úÖ';
            }
        }

        function simulateCommand(command) {
            // Simple simulation - just show an alert
            alert(`Simulating command: ${command}\n\nIn a real troubleshooting scenario, this would execute the command on the selected device and show the output.`);
        }

        function testFix() {
            if (!currentTSScenario) return;

            const resultContainer = document.getElementById('tsResultContainer');
            const verification = currentTSScenario.verification;

            // Simulate verification checks
            // In this proof-of-concept, we'll assume the user has fixed it if they've viewed hints or solution
            const fixedCorrectly = tsHintsUsed.length > 0 || tsSolutionViewed;

            // Calculate score
            let score = 100;
            if (tsSolutionViewed) {
                score = 40;
            } else if (tsHintsUsed.includes(3)) {
                score = 40;
            } else if (tsHintsUsed.includes(2)) {
                score = 60;
            } else if (tsHintsUsed.includes(1)) {
                score = 80;
            }

            // Check time bonus
            const timeElapsed = (Date.now() - tsStartTime) / 1000 / 60; // minutes
            const estimatedMinutes = parseInt(currentTSScenario.estimatedTime);
            if (timeElapsed < estimatedMinutes && score > 40) {
                score += 10;
                score = Math.min(100, score);
            }

            if (fixedCorrectly) {
                // Success!
                tsProgress.fixApplied = true;
                tsProgress.verified = true;
                updateTSProgressTracker();

                resultContainer.innerHTML = `
                    <div class="ts-result success visible">
                        <div class="ts-result-header">
                            <span>‚úÖ</span>
                            <span>Great job! Issue resolved</span>
                        </div>
                        <div class="ts-result-message">
                            The interface is now up and connectivity has been restored. You successfully identified and fixed the issue!
                        </div>
                        <div class="ts-score">
                            <div class="ts-score-number">${score}</div>
                            <div class="ts-score-label">Points</div>
                        </div>
                        <div class="ts-skills">
                            <h4>Skills Practiced:</h4>
                            <div class="ts-skills-list">
                                ${currentTSScenario.skills.map(skill => `<span class="ts-skill-tag">${skill}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                `;

                // Save progress
                saveTSProgress(currentTSScenario.id, score);
                updateTSCompletionCount();
            } else {
                // Not fixed yet
                resultContainer.innerHTML = `
                    <div class="ts-result failed visible">
                        <div class="ts-result-header">
                            <span>‚ùå</span>
                            <span>Issue still present</span>
                        </div>
                        <div class="ts-result-message">
                            The problem hasn't been resolved yet. Try using the diagnostic tools and hints to identify the root cause. Remember to check the interface status!
                        </div>
                    </div>
                `;
            }
        }

        function resetScenario() {
            if (!currentTSScenario) return;

            if (confirm('Are you sure you want to reset this scenario? All progress will be lost.')) {
                loadTSScenario(currentTSScenario.id);
            }
        }

        function exitTroubleshooting() {
            // Confirm if scenario is in progress
            if (currentTSScenario && !tsProgress.verified) {
                if (!confirm('Are you sure you want to exit? Your progress will not be saved.')) {
                    return;
                }
            }

            // Hide troubleshooting panel
            document.getElementById('troubleshootingPanel').style.display = 'none';
            document.querySelector('.config-panel').style.display = 'flex';
            document.querySelector('.app-container').classList.remove('ts-mode-active');

            // Reset state
            currentTSScenario = null;
            tsHintsUsed = [];
            tsSolutionViewed = false;
            tsStartTime = null;

            // Show welcome message
            document.getElementById('welcomeMessage').style.display = 'block';

            // Clear canvas
            devices = [];
            canvas.innerHTML = '';

            // Open modal again
            openTroubleshootModal();
        }

        function getTSProgress() {
            const stored = localStorage.getItem('ts_progress');
            return stored ? JSON.parse(stored) : {};
        }

        function saveTSProgress(scenarioId, score) {
            const progress = getTSProgress();

            if (!progress[scenarioId]) {
                progress[scenarioId] = {
                    completed: true,
                    bestScore: score,
                    attempts: 1,
                    lastAttempt: Date.now()
                };
            } else {
                progress[scenarioId].bestScore = Math.max(progress[scenarioId].bestScore, score);
                progress[scenarioId].attempts += 1;
                progress[scenarioId].lastAttempt = Date.now();
            }

            localStorage.setItem('ts_progress', JSON.stringify(progress));
        }

        function loadTSProgress() {
            // This is called on page load to restore any saved progress
            const progress = getTSProgress();
            console.log('Loaded troubleshooting progress:', Object.keys(progress).length, 'scenarios');
        }

        function updateTSCompletionCount() {
            const progress = getTSProgress();
            const total = Object.keys(TROUBLESHOOTING_SCENARIOS).length;
            const completed = Object.keys(progress).filter(id => progress[id].completed).length;

            document.getElementById('tsCompletionCount').textContent = `${completed}/${total}`;
        }

        // ========== END TROUBLESHOOTING FUNCTIONS ==========

        function renderInstructions(lab) {
            const container = document.getElementById('instructionsList');
            container.innerHTML = '';

            lab.instructions.forEach((instruction, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = `instruction-step ${instruction.completed ? 'completed' : ''}`;
                stepDiv.innerHTML = `
                    <div class="step-header">
                        <span class="step-number">Step ${instruction.step}</span>
                        <span class="step-status">${instruction.completed ? '‚úÖ' : '‚è∏Ô∏è'}</span>
                    </div>
                    <div class="step-title">${instruction.title}</div>
                    <div class="step-description">${instruction.description}</div>
                    ${instruction.commands.length > 0 ? `
                        <div class="step-commands">
                            ${instruction.commands.map(cmd => `<div>> ${cmd}</div>`).join('')}
                        </div>
                    ` : ''}
                    <div class="step-actions">
                        <button class="btn btn-small" onclick="markStepComplete(${index})">
                            ${instruction.completed ? '‚úÖ Completed' : '‚úì Mark Complete'}
                        </button>
                        <button class="btn btn-small">üí° Hint</button>
                    </div>
                `;
                container.appendChild(stepDiv);
            });

            updateProgress();
        }

        function markStepComplete(stepIndex) {
            if (!currentLab) return;

            currentLab.instructions[stepIndex].completed = true;
            renderInstructions(currentLab);
            updateProgress();
        }

        function updateProgress() {
            if (!currentLab) return;

            const totalSteps = currentLab.instructions.length;
            const completedSteps = currentLab.instructions.filter(i => i.completed).length;
            const percentage = Math.round((completedSteps / totalSteps) * 100);

            document.getElementById('progressPercent').textContent = percentage + '%';
            document.getElementById('progressFill').style.width = percentage + '%';
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                }
            });

            // Update tab panes
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });

            const targetTab = {
                'instructions': 'instructionsTab',
                'config': 'configTab',
                'cli': 'cliTab'
            }[tabName];

            if (targetTab) {
                document.getElementById(targetTab).classList.add('active');
            }
        }

        // ========== DEVICE PLACEMENT & TOPOLOGY BUILDER ==========
        let devices = [];
        let deviceIdCounter = 0;
        let connections = [];
        let connectionIdCounter = 0;
        const canvas = document.getElementById('network-canvas');
        let draggedDeviceType = null;

        // Connection mode
        let connectionMode = false;
        let connectionStart = null;

        // Delete mode
        let deleteMode = false;

        // Setup drag events for device palette items
        document.querySelectorAll('.device-item').forEach(item => {
            item.addEventListener('dragstart', (e) => {
                draggedDeviceType = item.getAttribute('data-device-type');
                e.dataTransfer.effectAllowed = 'copy';
            });

            item.addEventListener('dragend', () => {
                draggedDeviceType = null;
            });
        });

        // Setup drop zone on canvas
        const canvasContainer = document.querySelector('.canvas-container');

        canvasContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
        });

        canvasContainer.addEventListener('drop', (e) => {
            e.preventDefault();

            if (!draggedDeviceType) return;

            // Get drop position relative to canvas container
            const rect = canvasContainer.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // Add device to canvas
            addDeviceToCanvas(draggedDeviceType, x, y);
        });

        function addDeviceToCanvas(type, x, y) {
            const deviceId = `device-${deviceIdCounter++}`;

            // Device type configurations
            const deviceConfig = {
                'router': { icon: 'üî∑', color: '#06b6d4', label: 'Router' },
                'l2switch': { icon: 'üî∂', color: '#9333ea', label: 'Switch' },
                'l3switch': { icon: 'üî∑', color: '#10b981', label: 'L3-SW' },
                'pc': { icon: 'üíª', color: '#f59e0b', label: 'PC' },
                'server': { icon: 'üñ•Ô∏è', color: '#ec4899', label: 'Server' }
            };

            const config = deviceConfig[type] || deviceConfig['pc'];

            // Create SVG group for device
            const deviceGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            deviceGroup.setAttribute('id', deviceId);
            deviceGroup.setAttribute('transform', `translate(${x}, ${y})`);
            deviceGroup.style.cursor = 'move';

            // Create background circle
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', '0');
            circle.setAttribute('cy', '0');
            circle.setAttribute('r', '30');
            circle.setAttribute('fill', config.color);
            circle.setAttribute('opacity', '0.2');
            circle.setAttribute('stroke', config.color);
            circle.setAttribute('stroke-width', '2');

            // Create text icon
            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', '0');
            text.setAttribute('y', '0');
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('dominant-baseline', 'central');
            text.setAttribute('font-size', '24');
            text.textContent = config.icon;

            // Create label
            const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('x', '0');
            label.setAttribute('y', '45');
            label.setAttribute('text-anchor', 'middle');
            label.setAttribute('font-size', '12');
            label.setAttribute('fill', '#cbd5e1');
            label.textContent = `${config.label}${deviceIdCounter}`;

            deviceGroup.appendChild(circle);
            deviceGroup.appendChild(text);
            deviceGroup.appendChild(label);
            canvas.appendChild(deviceGroup);

            // Initialize interfaces based on device type
            let interfaces = [];
            if (type === 'router') {
                interfaces = [
                    { name: 'GigabitEthernet0/0', ip: '', mask: '', status: 'down' },
                    { name: 'GigabitEthernet0/1', ip: '', mask: '', status: 'down' },
                    { name: 'GigabitEthernet0/2', ip: '', mask: '', status: 'down' },
                    { name: 'Serial0/0/0', ip: '', mask: '', status: 'down' }
                ];
            } else if (type === 'l2switch' || type === 'l3switch') {
                interfaces = [
                    { name: 'FastEthernet0/1', vlan: 1, status: 'up' },
                    { name: 'FastEthernet0/2', vlan: 1, status: 'up' },
                    { name: 'FastEthernet0/3', vlan: 1, status: 'up' },
                    { name: 'FastEthernet0/4', vlan: 1, status: 'up' },
                    { name: 'FastEthernet0/5', vlan: 1, status: 'up' },
                    { name: 'GigabitEthernet0/1', vlan: 1, status: 'up' },
                    { name: 'GigabitEthernet0/2', vlan: 1, status: 'up' }
                ];
                if (type === 'l3switch') {
                    interfaces.push({ name: 'Vlan1', ip: '', mask: '', status: 'down' });
                }
            } else if (type === 'pc' || type === 'server') {
                interfaces = [
                    { name: 'Ethernet0', ip: '', mask: '', gateway: '', status: 'up', dhcpEnabled: false }
                ];
            }

            // Store device data
            const deviceData = {
                id: deviceId,
                type: type,
                x: x,
                y: y,
                name: `${config.label}${deviceIdCounter}`,
                interfaces: interfaces,
                selectedInterface: 0
            };

            // Add DHCP server properties for server devices
            if (type === 'server') {
                deviceData.dhcpServer = {
                    enabled: false,
                    poolName: 'default',
                    network: '',
                    mask: '',
                    startIp: '',
                    endIp: '',
                    defaultGateway: '',
                    dnsServer: '',
                    leaseTime: 86400, // 24 hours in seconds
                    leases: []
                };
            }

            devices.push(deviceData);

            // Add drag functionality to move devices
            makeDraggable(deviceGroup);

            // Add click to select device
            deviceGroup.addEventListener('click', (e) => {
                e.stopPropagation();
                selectDevice(deviceId);
            });

            console.log(`Added ${type} at (${x}, ${y})`);
        }

        function makeDraggable(element) {
            let isDragging = false;
            let startX, startY, currentTransform;

            element.addEventListener('mousedown', startDrag);

            function startDrag(e) {
                isDragging = true;
                const transform = element.getAttribute('transform');
                const match = transform.match(/translate\(([^,]+),\s*([^)]+)\)/);
                currentTransform = match ? { x: parseFloat(match[1]), y: parseFloat(match[2]) } : { x: 0, y: 0 };
                startX = e.clientX;
                startY = e.clientY;

                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                e.stopPropagation();
            }

            function drag(e) {
                if (!isDragging) return;
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                const newX = currentTransform.x + dx;
                const newY = currentTransform.y + dy;

                element.setAttribute('transform', `translate(${newX}, ${newY})`);

                // Update device position in data
                const deviceId = element.getAttribute('id');
                const device = devices.find(d => d.id === deviceId);
                if (device) {
                    device.x = newX;
                    device.y = newY;
                }

                // Update connected lines
                updateAllConnections();
            }

            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', stopDrag);
            }
        }

        // ========== DEVICE SELECTION & CONFIGURATION ==========
        let selectedDevice = null;

        function selectDevice(deviceId) {
            // Handle delete mode - delete device and return
            if (deleteMode) {
                if (confirm('Delete this device and all its connections?')) {
                    deleteDevice(deviceId);
                }
                return;
            }

            selectedDevice = devices.find(d => d.id === deviceId);
            if (!selectedDevice) return;

            // Highlight selected device
            document.querySelectorAll('#network-canvas g').forEach(g => {
                const circle = g.querySelector('circle');
                if (circle) circle.setAttribute('stroke-width', '2');
            });

            const selectedElement = document.getElementById(deviceId);
            if (selectedElement) {
                const circle = selectedElement.querySelector('circle');
                if (circle) circle.setAttribute('stroke-width', '4');
            }

            // Handle connection mode
            if (connectionMode) {
                handleConnectionClick(deviceId);
                return;
            }

            // Update Config panel
            updateConfigPanel();

            // Update CLI panel
            updateCLIPanel();

            console.log('Selected device:', selectedDevice.name);
        }

        // ========== CONNECTION/LINK SYSTEM ==========
        document.getElementById('connectBtn').addEventListener('click', () => {
            connectionMode = !connectionMode;
            const btn = document.getElementById('connectBtn');

            if (connectionMode) {
                btn.style.background = 'var(--accent-green)';
                btn.style.color = 'white';
                connectionStart = null;
                console.log('Connection mode: ENABLED - Click two devices to connect them');
            } else {
                btn.style.background = '';
                btn.style.color = '';
                connectionStart = null;
                console.log('Connection mode: DISABLED');
            }
        });

        // ========== DELETE MODE SYSTEM ==========
        document.getElementById('deleteModeBtn').addEventListener('click', () => {
            deleteMode = !deleteMode;
            const btn = document.getElementById('deleteModeBtn');
            const canvasContainer = document.querySelector('.canvas-container');

            // Turn off connection mode if delete mode is activated
            if (deleteMode && connectionMode) {
                connectionMode = false;
                const connectBtn = document.getElementById('connectBtn');
                connectBtn.style.background = '';
                connectBtn.style.color = '';
                connectionStart = null;
            }

            if (deleteMode) {
                btn.classList.add('delete-mode-active');
                canvasContainer.classList.add('canvas-delete-mode');
                console.log('Delete mode: ENABLED - Click connections or devices to remove them');
            } else {
                btn.classList.remove('delete-mode-active');
                canvasContainer.classList.remove('canvas-delete-mode');
                console.log('Delete mode: DISABLED');
            }
        });

        function handleDeleteClick(targetId, targetType) {
            if (!deleteMode) return false;

            if (targetType === 'connection') {
                deleteConnection(targetId);
                return true;
            } else if (targetType === 'device') {
                deleteDevice(targetId);
                return true;
            }
            return false;
        }

        function deleteDevice(deviceId) {
            // Remove all connections to this device first
            const deviceConnections = connections.filter(c => c.device1 === deviceId || c.device2 === deviceId);
            deviceConnections.forEach(conn => {
                const line = document.getElementById(conn.id);
                if (line) line.remove();
            });
            connections = connections.filter(c => c.device1 !== deviceId && c.device2 !== deviceId);

            // Remove device from array
            devices = devices.filter(d => d.id !== deviceId);

            // Remove device from canvas
            const element = document.getElementById(deviceId);
            if (element) element.remove();

            // Clear selection if this was selected
            if (selectedDevice && selectedDevice.id === deviceId) {
                selectedDevice = null;
                document.getElementById('configPanel').style.display = 'none';
            }

            console.log(`Device ${deviceId} and its connections deleted`);
        }

        function handleConnectionClick(deviceId) {
            if (!connectionStart) {
                // First device clicked
                connectionStart = deviceId;
                const device = devices.find(d => d.id === deviceId);
                console.log(`Connection start: ${device.name}`);

                // Highlight first device
                const element = document.getElementById(deviceId);
                if (element) {
                    const circle = element.querySelector('circle');
                    if (circle) {
                        circle.setAttribute('stroke-width', '6');
                        circle.setAttribute('stroke-dasharray', '5,5');
                    }
                }
            } else {
                // Second device clicked - create connection
                if (connectionStart === deviceId) {
                    console.log('Cannot connect device to itself');
                    return;
                }

                const device1 = devices.find(d => d.id === connectionStart);
                const device2 = devices.find(d => d.id === deviceId);

                createConnection(connectionStart, deviceId);
                console.log(`Connected: ${device1.name} ‚Üî ${device2.name}`);

                // Reset highlighting
                document.querySelectorAll('#network-canvas g circle').forEach(circle => {
                    circle.setAttribute('stroke-width', '2');
                    circle.setAttribute('stroke-dasharray', 'none');
                });

                connectionStart = null;
            }
        }

        function createConnection(device1Id, device2Id) {
            const connectionId = `connection-${connectionIdCounter++}`;
            const color = document.getElementById('connectionColor').value;

            const device1 = devices.find(d => d.id === device1Id);
            const device2 = devices.find(d => d.id === device2Id);

            if (!device1 || !device2) return;

            // Store connection data
            connections.push({
                id: connectionId,
                device1: device1Id,
                device2: device2Id,
                color: color
            });

            // Draw the connection
            drawConnection(connectionId, device1, device2, color);

            // Auto-save topology state for cumulative labs
            if (currentLab && currentLab.id && currentLab.id.startsWith('cumlab')) {
                saveCumulativeTopologyState(currentLab.id);
            }
        }

        function drawConnection(connectionId, device1, device2, color) {
            // Create SVG line
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('id', connectionId);
            line.setAttribute('x1', device1.x);
            line.setAttribute('y1', device1.y);
            line.setAttribute('x2', device2.x);
            line.setAttribute('y2', device2.y);
            line.setAttribute('stroke', color);
            line.setAttribute('stroke-width', '3');
            line.setAttribute('opacity', '0.7');
            line.style.cursor = 'pointer';

            // Add to canvas (insert before devices so lines appear behind)
            canvas.insertBefore(line, canvas.firstChild);

            // Add click handler to delete connection (delete mode or Ctrl+Click)
            line.addEventListener('click', (e) => {
                if (deleteMode || e.ctrlKey || e.metaKey) {
                    e.stopPropagation();
                    deleteConnection(connectionId);
                }
            });

            // Add hover effect
            line.addEventListener('mouseenter', () => {
                line.setAttribute('stroke-width', '5');
                line.setAttribute('opacity', '1');
            });

            line.addEventListener('mouseleave', () => {
                line.setAttribute('stroke-width', '3');
                line.setAttribute('opacity', '0.7');
            });
        }

        function deleteConnection(connectionId) {
            // Remove from connections array
            connections = connections.filter(c => c.id !== connectionId);

            // Remove from canvas
            const line = document.getElementById(connectionId);
            if (line) line.remove();

            console.log(`Connection ${connectionId} deleted`);
        }

        function updateAllConnections() {
            // Redraw all connections with updated device positions
            connections.forEach(conn => {
                const device1 = devices.find(d => d.id === conn.device1);
                const device2 = devices.find(d => d.id === conn.device2);

                if (device1 && device2) {
                    const line = document.getElementById(conn.id);
                    if (line) {
                        line.setAttribute('x1', device1.x);
                        line.setAttribute('y1', device1.y);
                        line.setAttribute('x2', device2.x);
                        line.setAttribute('y2', device2.y);
                    }
                }
            });
        }

        // ========== DHCP PROTOCOL FUNCTIONS ==========

        function applyDhcpServerConfig() {
            if (!selectedDevice || !selectedDevice.dhcpServer) return;

            const dhcp = selectedDevice.dhcpServer;
            dhcp.poolName = document.getElementById('dhcpPoolName').value || 'default';
            dhcp.network = document.getElementById('dhcpNetwork').value;
            dhcp.mask = document.getElementById('dhcpSubnetMask').value;
            dhcp.startIp = document.getElementById('dhcpStartIp').value;
            dhcp.endIp = document.getElementById('dhcpEndIp').value;
            dhcp.defaultGateway = document.getElementById('dhcpGateway').value;
            dhcp.dnsServer = document.getElementById('dhcpDns').value;

            const output = document.getElementById('cliOutput');
            output.innerHTML += `<div style="color: #0f0; margin-top: 10px;">‚úì DHCP Server configuration applied</div>`;
            output.innerHTML += `<div>  Pool: ${dhcp.poolName}</div>`;
            output.innerHTML += `<div>  Network: ${dhcp.network} ${dhcp.mask}</div>`;
            output.innerHTML += `<div>  Range: ${dhcp.startIp} - ${dhcp.endIp}</div>`;
            output.innerHTML += `<div>  Gateway: ${dhcp.defaultGateway}</div>`;
            output.innerHTML += `<div>  DNS: ${dhcp.dnsServer}</div>`;
            output.scrollTop = output.scrollHeight;

            console.log('DHCP Server configured:', dhcp);
        }

        function requestDhcpIp() {
            if (!selectedDevice || selectedDevice.type !== 'pc') {
                alert('DHCP client requests are only available for PC devices');
                return;
            }

            // Find a DHCP server on the network
            const dhcpServer = findDhcpServer();

            if (!dhcpServer) {
                const output = document.getElementById('cliOutput');
                output.innerHTML += `<div style="color: #f00; margin-top: 10px;">‚úó DHCP DISCOVER failed - No DHCP server found on network</div>`;
                output.scrollTop = output.scrollHeight;
                return;
            }

            // Simulate DHCP DORA process
            simulateDhcpDora(selectedDevice, dhcpServer);
        }

        function findDhcpServer() {
            // Find first enabled DHCP server in the network
            return devices.find(d =>
                d.type === 'server' &&
                d.dhcpServer &&
                d.dhcpServer.enabled &&
                d.dhcpServer.startIp &&
                d.dhcpServer.endIp
            );
        }

        function simulateDhcpDora(client, server) {
            const output = document.getElementById('cliOutput');
            const interfaceIndex = parseInt(document.getElementById('interfaceSelect').value);
            const intf = client.interfaces[interfaceIndex];

            if (!intf) return;

            // Allocate IP from pool
            const newIp = allocateIpFromPool(server, client);

            if (!newIp) {
                output.innerHTML += `<div style="color: #f00; margin-top: 10px;">‚úó DHCP REQUEST failed - No available IPs in pool</div>`;
                output.scrollTop = output.scrollHeight;
                return;
            }

            // Simulate DORA with delays
            let step = 0;
            const steps = [
                { msg: `üîç DHCP DISCOVER - Broadcasting on network...`, color: '#06b6d4', delay: 500 },
                { msg: `üì® DHCP OFFER - Server ${server.name} offers ${newIp.ip}`, color: '#10b981', delay: 800 },
                { msg: `üôã DHCP REQUEST - Requesting ${newIp.ip} from ${server.name}`, color: '#f59e0b', delay: 800 },
                { msg: `‚úì DHCP ACK - Lease granted by ${server.name}`, color: '#0f0', delay: 500 }
            ];

            function showNextStep() {
                if (step < steps.length) {
                    const s = steps[step];
                    output.innerHTML += `<div style="color: ${s.color}; margin-top: 10px;">${s.msg}</div>`;
                    output.scrollTop = output.scrollHeight;
                    step++;
                    setTimeout(showNextStep, s.delay);
                } else {
                    // Apply configuration
                    intf.ip = newIp.ip;
                    intf.mask = server.dhcpServer.mask;
                    intf.gateway = server.dhcpServer.defaultGateway;

                    output.innerHTML += `<div style="color: #0ff; margin-top: 10px; padding: 10px; background: rgba(6, 182, 212, 0.1); border-radius: 4px;">`;
                    output.innerHTML += `<strong>üìã IP Configuration Received:</strong><br>`;
                    output.innerHTML += `  IP Address: ${intf.ip}<br>`;
                    output.innerHTML += `  Subnet Mask: ${intf.mask}<br>`;
                    output.innerHTML += `  Default Gateway: ${intf.gateway}<br>`;
                    output.innerHTML += `  DNS Server: ${server.dhcpServer.dnsServer}<br>`;
                    output.innerHTML += `  Lease Time: ${(server.dhcpServer.leaseTime / 3600).toFixed(0)} hours`;
                    output.innerHTML += `</div>`;
                    output.scrollTop = output.scrollHeight;

                    // Update config panel
                    loadInterfaceConfig();

                    // Update lease display on server
                    if (selectedDevice.type === 'server') {
                        updateDhcpLeaseDisplay();
                    }

                    console.log(`DHCP lease granted: ${client.name} ‚Üí ${newIp.ip}`);
                }
            }

            output.innerHTML += `<div style="margin-top: 15px; border-top: 2px solid var(--accent-cyan); padding-top: 10px;">`;
            output.innerHTML += `<strong style="color: #06b6d4;">üåê DHCP Protocol Exchange (${client.name})</strong>`;
            output.innerHTML += `</div>`;
            showNextStep();
        }

        function allocateIpFromPool(server, client) {
            const dhcp = server.dhcpServer;

            // Check if client already has a lease
            const existingLease = dhcp.leases.find(l => l.clientId === client.id);
            if (existingLease) {
                // Renew existing lease
                existingLease.expiry = Date.now() + (dhcp.leaseTime * 1000);
                return { ip: existingLease.ip };
            }

            // Parse IP range
            const startParts = dhcp.startIp.split('.').map(Number);
            const endParts = dhcp.endIp.split('.').map(Number);

            // Calculate start and end as integers
            const startNum = (startParts[0] << 24) + (startParts[1] << 16) + (startParts[2] << 8) + startParts[3];
            const endNum = (endParts[0] << 24) + (endParts[1] << 16) + (endParts[2] << 8) + endParts[3];

            // Get all leased IPs
            const leasedIps = new Set(dhcp.leases.map(l => l.ip));

            // Find first available IP
            for (let ipNum = startNum; ipNum <= endNum; ipNum++) {
                const ip = `${(ipNum >> 24) & 255}.${(ipNum >> 16) & 255}.${(ipNum >> 8) & 255}.${ipNum & 255}`;

                if (!leasedIps.has(ip)) {
                    // Create new lease
                    const lease = {
                        clientId: client.id,
                        clientName: client.name,
                        ip: ip,
                        expiry: Date.now() + (dhcp.leaseTime * 1000)
                    };
                    dhcp.leases.push(lease);
                    return { ip: ip };
                }
            }

            return null; // No available IPs
        }

        function updateConfigPanel() {
            if (!selectedDevice || !selectedDevice.interfaces) return;

            document.getElementById('selectedDeviceInfo').textContent =
                `Configuring: ${selectedDevice.name} (${selectedDevice.type.toUpperCase()})`;

            document.getElementById('deviceConfigForm').style.display = 'block';
            document.getElementById('deviceNameInput').value = selectedDevice.name || '';

            // Populate interface dropdown
            const interfaceSelect = document.getElementById('interfaceSelect');
            interfaceSelect.innerHTML = '';
            selectedDevice.interfaces.forEach((intf, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${intf.name} ${intf.status === 'up' ? '(UP)' : '(DOWN)'}`;
                interfaceSelect.appendChild(option);
            });

            // Set selected interface
            interfaceSelect.value = selectedDevice.selectedInterface || 0;

            // Show/hide DHCP server config for servers
            const dhcpServerConfig = document.getElementById('dhcpServerConfig');
            if (selectedDevice.type === 'server') {
                dhcpServerConfig.style.display = 'block';
                loadDhcpServerConfig();
            } else {
                dhcpServerConfig.style.display = 'none';
            }

            // Load interface config
            loadInterfaceConfig();
        }

        function loadDhcpServerConfig() {
            if (!selectedDevice || !selectedDevice.dhcpServer) return;

            const dhcp = selectedDevice.dhcpServer;
            document.getElementById('dhcpServerEnabled').checked = dhcp.enabled;
            document.getElementById('dhcpPoolConfig').style.display = dhcp.enabled ? 'block' : 'none';

            document.getElementById('dhcpPoolName').value = dhcp.poolName || 'default';
            document.getElementById('dhcpNetwork').value = dhcp.network || '';
            document.getElementById('dhcpSubnetMask').value = dhcp.mask || '';
            document.getElementById('dhcpStartIp').value = dhcp.startIp || '';
            document.getElementById('dhcpEndIp').value = dhcp.endIp || '';
            document.getElementById('dhcpGateway').value = dhcp.defaultGateway || '';
            document.getElementById('dhcpDns').value = dhcp.dnsServer || '';

            updateDhcpLeaseDisplay();
        }

        function updateDhcpLeaseDisplay() {
            if (!selectedDevice || !selectedDevice.dhcpServer) return;

            const leaseList = document.getElementById('dhcpLeaseList');
            const leases = selectedDevice.dhcpServer.leases;

            if (leases.length === 0) {
                leaseList.innerHTML = '<div style="color: var(--text-muted);">No active leases</div>';
            } else {
                leaseList.innerHTML = leases.map(lease =>
                    `<div style="margin-bottom: 5px; padding: 5px; background: var(--bg-panel); border-radius: 4px;">
                        <strong style="color: var(--accent-cyan);">${lease.clientName}</strong>: ${lease.ip}
                        <br><span style="font-size: 0.8em; color: var(--text-muted);">Expires: ${new Date(lease.expiry).toLocaleTimeString()}</span>
                    </div>`
                ).join('');
            }
        }

        function loadInterfaceConfig() {
            if (!selectedDevice) return;

            const interfaceIndex = parseInt(document.getElementById('interfaceSelect').value);
            const intf = selectedDevice.interfaces[interfaceIndex];
            if (!intf) return;

            selectedDevice.selectedInterface = interfaceIndex;

            // Update form fields based on interface
            document.getElementById('deviceIpInput').value = intf.ip || '';
            document.getElementById('deviceMaskInput').value = intf.mask || '';
            document.getElementById('interfaceStatus').value = intf.status || 'down';

            // Show/hide gateway field (only for PCs/Servers)
            const gatewayGroup = document.getElementById('gatewayGroup');
            const dhcpClientGroup = document.getElementById('dhcpClientGroup');

            if (selectedDevice.type === 'pc' || selectedDevice.type === 'server') {
                gatewayGroup.style.display = 'block';
                document.getElementById('deviceGatewayInput').value = intf.gateway || '';

                // Show DHCP client options for PCs only (servers are DHCP servers)
                if (selectedDevice.type === 'pc') {
                    dhcpClientGroup.style.display = 'block';
                    const dhcpCheckbox = document.getElementById('dhcpClientCheckbox');
                    dhcpCheckbox.checked = intf.dhcpEnabled || false;

                    // Enable/disable manual IP fields based on DHCP
                    const ipInput = document.getElementById('deviceIpInput');
                    const maskInput = document.getElementById('deviceMaskInput');
                    const gatewayInput = document.getElementById('deviceGatewayInput');
                    const requestBtn = document.getElementById('requestDhcpBtn');

                    if (intf.dhcpEnabled) {
                        ipInput.disabled = true;
                        maskInput.disabled = true;
                        gatewayInput.disabled = true;
                        requestBtn.style.display = 'block';
                    } else {
                        ipInput.disabled = false;
                        maskInput.disabled = false;
                        gatewayInput.disabled = false;
                        requestBtn.style.display = 'none';
                    }
                } else {
                    dhcpClientGroup.style.display = 'none';
                }
            } else {
                gatewayGroup.style.display = 'none';
                dhcpClientGroup.style.display = 'none';
            }
        }

        // Interface selector change handler
        document.getElementById('interfaceSelect').addEventListener('change', loadInterfaceConfig);

        function updateCLIPanel() {
            if (!selectedDevice) return;

            document.getElementById('cliDeviceInfo').textContent =
                `Connected to: ${selectedDevice.name} (${selectedDevice.type.toUpperCase()})`;

            document.getElementById('cliInterface').style.display = 'block';
            document.getElementById('cliPrompt').textContent = `${selectedDevice.name}>`;
        }

        // Apply configuration from Config panel
        document.getElementById('applyConfigBtn').addEventListener('click', () => {
            if (!selectedDevice || !selectedDevice.interfaces) return;

            // Update device name
            selectedDevice.name = document.getElementById('deviceNameInput').value;

            // Update selected interface configuration
            const interfaceIndex = parseInt(document.getElementById('interfaceSelect').value);
            const intf = selectedDevice.interfaces[interfaceIndex];
            if (intf) {
                intf.ip = document.getElementById('deviceIpInput').value;
                intf.mask = document.getElementById('deviceMaskInput').value;
                intf.status = document.getElementById('interfaceStatus').value;

                // Only update gateway for PCs/Servers
                if (selectedDevice.type === 'pc' || selectedDevice.type === 'server') {
                    intf.gateway = document.getElementById('deviceGatewayInput').value;
                }
            }

            // Update device label on canvas
            const deviceElement = document.getElementById(selectedDevice.id);
            if (deviceElement) {
                const label = deviceElement.querySelector('text[y="45"]');
                if (label) label.textContent = selectedDevice.name;
            }

            // Update interface dropdown to show new status
            updateConfigPanel();

            // Show confirmation
            const output = document.getElementById('cliOutput');
            output.innerHTML += `<div style="color: #0f0; margin-top: 10px;">‚úì Configuration applied to ${selectedDevice.name}</div>`;
            output.innerHTML += `<div>  Interface: ${intf.name}</div>`;
            output.innerHTML += `<div>  IP: ${intf.ip || 'Not configured'}</div>`;
            output.innerHTML += `<div>  Mask: ${intf.mask || 'Not configured'}</div>`;
            output.innerHTML += `<div>  Status: ${intf.status}</div>`;
            if (intf.gateway) {
                output.innerHTML += `<div>  Gateway: ${intf.gateway}</div>`;
            }
            output.scrollTop = output.scrollHeight;

            // Auto-save topology state for cumulative labs after GUI config change
            if (currentLab && currentLab.id && currentLab.id.startsWith('cumlab')) {
                saveCumulativeTopologyState(currentLab.id);
            }

            console.log('Configuration applied:', selectedDevice);
        });

        // CLI Command Processing
        document.getElementById('cliInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const input = e.target.value.trim();
                if (!input) return;

                processCommand(input);
                e.target.value = '';
            }
        });

        function processCommand(cmd) {
            const output = document.getElementById('cliOutput');
            const promptEl = document.getElementById('cliPrompt');

            // Initialize device config storage if needed
            if (selectedDevice && !selectedDevice.config) {
                selectedDevice.config = { vlans: {}, staticRoutes: [], ospf: null, eigrp: null, hsrp: {}, acls: {}, stpPriority: {} };
            }

            // Echo command
            output.innerHTML += `<div style="margin-top: 10px;">${promptEl.textContent} ${cmd}</div>`;

            const lowerCmd = cmd.toLowerCase().trim();

            // ========== HELP ==========
            if (lowerCmd === 'help' || lowerCmd === '?') {
                output.innerHTML += `<div style="color: #0ff; font-weight: bold;">‚îÅ‚îÅ‚îÅ Packet Tracer Lite CLI v3.9 ‚îÅ‚îÅ‚îÅ</div>`;
                output.innerHTML += `<div style="color: #ff0;">Mode Commands:</div>`;
                output.innerHTML += `<div>  enable / en            Enter privileged mode</div>`;
                output.innerHTML += `<div>  configure terminal     Enter config mode (conf t)</div>`;
                output.innerHTML += `<div>  exit / end             Return to previous mode</div>`;
                output.innerHTML += `<div style="color: #ff0; margin-top: 5px;">Interface Config:</div>`;
                output.innerHTML += `<div>  interface [name]       e.g., int Gi0/0, int vlan 10</div>`;
                output.innerHTML += `<div>  ip address [ip] [mask] Configure IP</div>`;
                output.innerHTML += `<div>  no shutdown / shutdown Enable/disable interface</div>`;
                output.innerHTML += `<div style="color: #ff0; margin-top: 5px;">Switching:</div>`;
                output.innerHTML += `<div>  vlan [id]              Create VLAN</div>`;
                output.innerHTML += `<div>  switchport mode access/trunk</div>`;
                output.innerHTML += `<div>  switchport access vlan [id]</div>`;
                output.innerHTML += `<div>  spanning-tree vlan [id] root primary</div>`;
                output.innerHTML += `<div style="color: #ff0; margin-top: 5px;">Routing:</div>`;
                output.innerHTML += `<div>  ip route [net] [mask] [next-hop]</div>`;
                output.innerHTML += `<div>  router ospf [id] / router eigrp [as]</div>`;
                output.innerHTML += `<div>  network [ip] [wildcard] area [id]</div>`;
                output.innerHTML += `<div style="color: #ff0; margin-top: 5px;">Show Commands:</div>`;
                output.innerHTML += `<div>  show ip int brief, show run, show vlan brief</div>`;
                output.innerHTML += `<div>  show ip route, show span, show ip ospf neighbor</div>`;
                output.innerHTML += `<div style="color: #ff0; margin-top: 5px;">Other:</div>`;
                output.innerHTML += `<div>  hostname [name], ping [ip], clear</div>`;
            }
            // ========== CLEAR ==========
            else if (lowerCmd === 'clear') {
                output.innerHTML = '<div>Cisco IOS Software, Lite Version 3.9</div><div>Type \'help\' or \'?\' for commands</div><div style="margin-top: 10px;">Ready.</div>';
            }
            // ========== ENABLE ==========
            else if (lowerCmd === 'enable' || lowerCmd === 'en') {
                cliMode = 'privileged';
                updateCLIPrompt(promptEl, selectedDevice.name);
                output.innerHTML += `<div style="color: #0f0;">‚úì Privileged EXEC mode</div>`;
            }
            // ========== CONFIGURE TERMINAL ==========
            else if (lowerCmd === 'configure terminal' || lowerCmd === 'conf t') {
                if (cliMode === 'user') {
                    output.innerHTML += `<div style="color: #f00;">% Must be in privileged mode first (type 'enable')</div>`;
                } else {
                    cliMode = 'config';
                    currentInterface = null;
                    updateCLIPrompt(promptEl, selectedDevice.name);
                    output.innerHTML += `<div style="color: #0ff;">Enter configuration commands, one per line.</div>`;
                }
            }
            // ========== EXIT / END ==========
            else if (lowerCmd === 'exit') {
                if (cliMode === 'config-if' || cliMode === 'config-router' || cliMode === 'config-vlan') {
                    cliMode = 'config';
                    currentInterface = null;
                } else if (cliMode === 'config') {
                    cliMode = 'privileged';
                } else if (cliMode === 'privileged') {
                    cliMode = 'user';
                }
                updateCLIPrompt(promptEl, selectedDevice.name);
                output.innerHTML += `<div style="color: #0ff;">Exiting...</div>`;
            }
            else if (lowerCmd === 'end') {
                cliMode = 'privileged';
                currentInterface = null;
                currentRouterProcess = null;
                updateCLIPrompt(promptEl, selectedDevice.name);
                output.innerHTML += `<div style="color: #0ff;">Returning to privileged mode</div>`;
            }
            // ========== INTERFACE ==========
            else if (lowerCmd.startsWith('interface ') || lowerCmd.startsWith('int ')) {
                const intfName = cmd.substring(cmd.indexOf(' ') + 1).trim();
                handleInterface(intfName, output, promptEl, selectedDevice);
            }
            // ========== IP ADDRESS ==========
            else if (lowerCmd.startsWith('ip address ')) {
                const parts = cmd.substring(11).trim().split(/\s+/);
                if (parts[0] === 'dhcp') {
                    output.innerHTML += `<div style="color: #0f0;">‚úì DHCP client enabled</div>`;
                } else if (parts.length >= 2 && currentInterface) {
                    const intf = selectedDevice.interfaces.find(i => i.name === currentInterface);
                    if (intf) {
                        intf.ip = parts[0];
                        intf.mask = parts[1];
                        output.innerHTML += `<div style="color: #0f0;">‚úì IP ${parts[0]} ${parts[1]} on ${currentInterface}</div>`;
                    }
                } else if (parts.length >= 2) {
                    output.innerHTML += `<div style="color: #0f0;">‚úì IP address configured</div>`;
                } else {
                    output.innerHTML += `<div style="color: #f00;">% Usage: ip address [ip] [mask]</div>`;
                }
            }
            // ========== NO SHUTDOWN ==========
            else if (lowerCmd === 'no shutdown' || lowerCmd === 'no shut') {
                if (currentInterface) {
                    const intf = selectedDevice.interfaces.find(i => i.name === currentInterface);
                    if (intf) { intf.status = 'up'; }
                    output.innerHTML += `<div style="color: #0f0;">‚úì Interface ${currentInterface} enabled</div>`;
                } else {
                    output.innerHTML += `<div style="color: #f00;">% Must be in interface config mode</div>`;
                }
            }
            else if (lowerCmd === 'shutdown' || lowerCmd === 'shut') {
                if (currentInterface) {
                    const intf = selectedDevice.interfaces.find(i => i.name === currentInterface);
                    if (intf) { intf.status = 'down'; }
                    output.innerHTML += `<div style="color: #ff0;">‚ö† Interface ${currentInterface} disabled</div>`;
                }
            }
            // ========== HOSTNAME ==========
            else if (lowerCmd.startsWith('hostname ')) {
                const newName = cmd.substring(9).trim();
                if (newName) {
                    selectedDevice.name = newName;
                    const el = document.getElementById(selectedDevice.id);
                    if (el) { const lbl = el.querySelector('text[y="45"]'); if (lbl) lbl.textContent = newName; }
                    updateCLIPrompt(promptEl, newName);
                    document.getElementById('deviceNameInput').value = newName;
                    output.innerHTML += `<div style="color: #0f0;">‚úì Hostname: ${newName}</div>`;
                }
            }
            // ========== VLAN ==========
            else if (lowerCmd.startsWith('vlan ') && (cliMode === 'config' || cliMode === 'privileged')) {
                const vlanId = cmd.substring(5).trim();
                if (vlanId && !isNaN(vlanId)) {
                    currentVlan = vlanId;
                    selectedDevice.config.vlans[vlanId] = selectedDevice.config.vlans[vlanId] || { id: vlanId, name: 'VLAN' + vlanId };
                    cliMode = 'config-vlan';
                    updateCLIPrompt(promptEl, selectedDevice.name);
                    output.innerHTML += `<div style="color: #0f0;">‚úì VLAN ${vlanId} configured</div>`;
                }
            }
            else if (lowerCmd.startsWith('name ') && cliMode === 'config-vlan' && currentVlan) {
                selectedDevice.config.vlans[currentVlan].name = cmd.substring(5).trim();
                output.innerHTML += `<div style="color: #0f0;">‚úì VLAN ${currentVlan} named</div>`;
            }
            // ========== SWITCHPORT ==========
            else if (lowerCmd.startsWith('switchport ')) {
                if (!currentInterface) { output.innerHTML += `<div style="color: #f00;">% Must be in interface config</div>`; }
                else {
                    const intf = selectedDevice.interfaces.find(i => i.name === currentInterface);
                    if (lowerCmd.includes('mode access')) { if(intf) intf.switchportMode = 'access'; output.innerHTML += `<div style="color: #0f0;">‚úì Mode access</div>`; }
                    else if (lowerCmd.includes('mode trunk')) { if(intf) intf.switchportMode = 'trunk'; output.innerHTML += `<div style="color: #0f0;">‚úì Mode trunk</div>`; }
                    else if (lowerCmd.includes('access vlan')) { const m = cmd.match(/vlan\s+(\d+)/i); if(m && intf) { intf.vlan = parseInt(m[1]); output.innerHTML += `<div style="color: #0f0;">‚úì Access VLAN ${m[1]}</div>`; } }
                    else if (lowerCmd.includes('trunk native vlan')) { const m = cmd.match(/vlan\s+(\d+)/i); if(m && intf) { intf.nativeVlan = parseInt(m[1]); output.innerHTML += `<div style="color: #0f0;">‚úì Native VLAN ${m[1]}</div>`; } }
                    else if (lowerCmd.includes('trunk encapsulation')) { output.innerHTML += `<div style="color: #0f0;">‚úì Encapsulation 802.1Q</div>`; }
                    else { output.innerHTML += `<div style="color: #0f0;">‚úì Switchport configured</div>`; }
                }
            }
            else if (lowerCmd === 'no switchport') {
                if (currentInterface) { const intf = selectedDevice.interfaces.find(i => i.name === currentInterface); if(intf) intf.isRouted = true; }
                output.innerHTML += `<div style="color: #0f0;">‚úì Routed port (L3)</div>`;
            }
            // ========== IP ROUTE ==========
            else if (lowerCmd.startsWith('ip route ')) {
                const parts = cmd.substring(9).trim().split(/\s+/);
                if (parts.length >= 3) {
                    selectedDevice.config.staticRoutes.push({ network: parts[0], mask: parts[1], nextHop: parts[2] });
                    output.innerHTML += `<div style="color: #0f0;">‚úì Static route: ${parts[0]} via ${parts[2]}</div>`;
                }
            }
            // ========== ROUTER OSPF ==========
            else if (lowerCmd.startsWith('router ospf ')) {
                const pid = cmd.substring(12).trim();
                selectedDevice.config.ospf = { processId: pid, networks: [], routerId: null };
                currentRouterProcess = 'ospf';
                cliMode = 'config-router';
                updateCLIPrompt(promptEl, selectedDevice.name);
                output.innerHTML += `<div style="color: #0f0;">‚úì OSPF process ${pid}</div>`;
            }
            // ========== ROUTER EIGRP ==========
            else if (lowerCmd.startsWith('router eigrp ')) {
                const as = cmd.substring(13).trim();
                selectedDevice.config.eigrp = { asNumber: as, networks: [] };
                currentRouterProcess = 'eigrp';
                cliMode = 'config-router';
                updateCLIPrompt(promptEl, selectedDevice.name);
                output.innerHTML += `<div style="color: #0f0;">‚úì EIGRP AS ${as}</div>`;
            }
            // ========== NETWORK (OSPF/EIGRP) ==========
            else if (lowerCmd.startsWith('network ') && cliMode === 'config-router') {
                const parts = cmd.substring(8).trim().split(/\s+/);
                if (currentRouterProcess === 'ospf' && parts.length >= 4) {
                    selectedDevice.config.ospf.networks.push({ ip: parts[0], wildcard: parts[1], area: parts[3] });
                    output.innerHTML += `<div style="color: #0f0;">‚úì Network ${parts[0]} area ${parts[3]}</div>`;
                } else if (currentRouterProcess === 'eigrp' && parts.length >= 2) {
                    selectedDevice.config.eigrp.networks.push({ ip: parts[0], wildcard: parts[1] });
                    output.innerHTML += `<div style="color: #0f0;">‚úì Network ${parts[0]}</div>`;
                }
            }
            else if (lowerCmd.startsWith('router-id ') && cliMode === 'config-router') {
                output.innerHTML += `<div style="color: #0f0;">‚úì Router-ID set</div>`;
            }
            else if (lowerCmd.startsWith('passive-interface ')) {
                output.innerHTML += `<div style="color: #0f0;">‚úì Passive interface configured</div>`;
            }
            else if (lowerCmd === 'no auto-summary') {
                output.innerHTML += `<div style="color: #0f0;">‚úì Auto-summary disabled</div>`;
            }
            else if (lowerCmd.startsWith('redistribute ')) {
                output.innerHTML += `<div style="color: #0f0;">‚úì Redistribution configured</div>`;
            }
            else if (lowerCmd.startsWith('auto-cost reference-bandwidth ')) {
                output.innerHTML += `<div style="color: #0f0;">‚úì Reference bandwidth set</div>`;
            }
            // ========== SPANNING-TREE ==========
            else if (lowerCmd.startsWith('spanning-tree ')) {
                if (lowerCmd.includes('mode rapid-pvst')) { output.innerHTML += `<div style="color: #0f0;">‚úì Rapid-PVST+ enabled</div>`; }
                else if (lowerCmd.includes('root primary')) { output.innerHTML += `<div style="color: #0f0;">‚úì Root primary configured</div>`; }
                else if (lowerCmd.includes('root secondary')) { output.innerHTML += `<div style="color: #0f0;">‚úì Root secondary configured</div>`; }
                else if (lowerCmd.includes('portfast')) { output.innerHTML += `<div style="color: #0f0;">‚úì PortFast enabled</div>`; }
                else if (lowerCmd.includes('bpduguard')) { output.innerHTML += `<div style="color: #0f0;">‚úì BPDU Guard enabled</div>`; }
                else { output.innerHTML += `<div style="color: #0f0;">‚úì STP configured</div>`; }
            }
            // ========== STANDBY (HSRP) ==========
            else if (lowerCmd.startsWith('standby ')) {
                const parts = cmd.substring(8).trim().split(/\s+/);
                if (parts[1] === 'ip') { output.innerHTML += `<div style="color: #0f0;">‚úì HSRP ${parts[0]} VIP: ${parts[2]}</div>`; }
                else if (parts[1] === 'priority') { output.innerHTML += `<div style="color: #0f0;">‚úì HSRP ${parts[0]} priority: ${parts[2]}</div>`; }
                else if (parts[1] === 'preempt') { output.innerHTML += `<div style="color: #0f0;">‚úì HSRP ${parts[0]} preempt</div>`; }
                else { output.innerHTML += `<div style="color: #0f0;">‚úì HSRP configured</div>`; }
            }
            // ========== IP ACCESS-LIST ==========
            else if (lowerCmd.startsWith('ip access-list ')) {
                const parts = cmd.substring(15).trim().split(/\s+/);
                currentAcl = parts[1] || 'ACL';
                selectedDevice.config.acls[currentAcl] = { entries: [] };
                cliMode = 'config-acl';
                output.innerHTML += `<div style="color: #0f0;">‚úì ACL "${currentAcl}" created</div>`;
            }
            else if ((lowerCmd.startsWith('permit ') || lowerCmd.startsWith('deny ')) && currentAcl) {
                output.innerHTML += `<div style="color: #0f0;">‚úì ACL entry: ${cmd}</div>`;
            }
            else if (lowerCmd.startsWith('ip access-group ')) {
                output.innerHTML += `<div style="color: #0f0;">‚úì ACL applied to interface</div>`;
            }
            // ========== IP DHCP ==========
            else if (lowerCmd.startsWith('ip dhcp pool ')) {
                output.innerHTML += `<div style="color: #0f0;">‚úì DHCP pool configured</div>`;
            }
            else if (lowerCmd.startsWith('ip dhcp excluded-address ')) {
                output.innerHTML += `<div style="color: #0f0;">‚úì DHCP exclusion set</div>`;
            }
            else if (lowerCmd.startsWith('default-router ') || lowerCmd.startsWith('dns-server ')) {
                output.innerHTML += `<div style="color: #0f0;">‚úì DHCP option configured</div>`;
            }
            // ========== SNMP ==========
            else if (lowerCmd.startsWith('snmp-server ')) {
                output.innerHTML += `<div style="color: #0f0;">‚úì SNMP configured</div>`;
            }
            // ========== PING ==========
            else if (lowerCmd.startsWith('ping ')) {
                const target = cmd.substring(5).trim();
                output.innerHTML += `<div style="color: #ff0;">Pinging ${target}...</div>`;
                output.innerHTML += `<div style="color: #0f0;">Reply from ${target}: time<1ms TTL=64</div>`;
                output.innerHTML += `<div style="color: #0f0;">Reply from ${target}: time<1ms TTL=64</div>`;
                output.innerHTML += `<div>Packets: Sent=4, Received=4, Lost=0</div>`;
            }
            // ========== SHOW COMMANDS ==========
            else if (lowerCmd.startsWith('show ')) {
                handleShowCommand(lowerCmd, output, selectedDevice);
            }
            // ========== INT RANGE ==========
            else if (lowerCmd.startsWith('int range ') || lowerCmd.startsWith('interface range ')) {
                output.innerHTML += `<div style="color: #0f0;">‚úì Interface range selected</div>`;
                cliMode = 'config-if';
                updateCLIPrompt(promptEl, selectedDevice.name);
            }
            // ========== LOOPBACK ==========
            else if (lowerCmd.startsWith('int loopback') || lowerCmd.startsWith('interface loopback')) {
                output.innerHTML += `<div style="color: #0f0;">‚úì Loopback interface configured</div>`;
                cliMode = 'config-if';
                currentInterface = 'Loopback0';
                updateCLIPrompt(promptEl, selectedDevice.name);
            }
            // ========== UNKNOWN ==========
            else {
                output.innerHTML += `<div style="color: #f00;">% Unrecognized: "${cmd}"</div>`;
                output.innerHTML += `<div>Type 'help' or '?' for commands</div>`;
            }

            // Auto-scroll to bottom
            output.scrollTop = output.scrollHeight;

            // Auto-save topology state for cumulative labs after any CLI command
            if (currentLab && currentLab.id && currentLab.id.startsWith('cumlab')) {
                saveCumulativeTopologyState(currentLab.id);
            }
        }

        function updateCLIPrompt(promptEl, name) {
            const n = name || 'Router';
            switch(cliMode) {
                case 'user': promptEl.textContent = `${n}>`; break;
                case 'privileged': promptEl.textContent = `${n}#`; break;
                case 'config': promptEl.textContent = `${n}(config)#`; break;
                case 'config-if': promptEl.textContent = `${n}(config-if)#`; break;
                case 'config-router': promptEl.textContent = `${n}(config-router)#`; break;
                case 'config-vlan': promptEl.textContent = `${n}(config-vlan)#`; break;
                case 'config-acl': promptEl.textContent = `${n}(config-ext-nacl)#`; break;
                default: promptEl.textContent = `${n}>`; break;
            }
        }

        function handleInterface(intfName, output, promptEl, device) {
            let normalized = intfName;
            if (intfName.toLowerCase().startsWith('gi')) normalized = 'GigabitEthernet' + intfName.substring(2).replace(/gabitethernet/i, '');
            else if (intfName.toLowerCase().startsWith('fa')) normalized = 'FastEthernet' + intfName.substring(2).replace(/stethernet/i, '');
            else if (intfName.toLowerCase().startsWith('vlan')) normalized = 'Vlan' + intfName.substring(4).trim();
            else if (intfName.toLowerCase().startsWith('se')) normalized = 'Serial' + intfName.substring(2).replace(/rial/i, '');
            else if (intfName.toLowerCase().startsWith('lo')) normalized = 'Loopback' + intfName.replace(/^(lo|loop|loopback)\s*/i, '');

            // Strip non-alphanumeric for comparison (fixes Gi0/1 vs GigabitEthernet0/1 matching)
            const normalizedStripped = normalized.toLowerCase().replace(/[^a-z0-9]/g, '');
            let intf = device.interfaces.find(i => {
                const intfStripped = i.name.toLowerCase().replace(/[^a-z0-9]/g, '');
                return intfStripped === normalizedStripped || intfStripped.includes(normalizedStripped);
            });

            // Auto-create VLAN interfaces (SVIs) on demand
            if (!intf && normalized.toLowerCase().startsWith('vlan')) {
                intf = { name: normalized, ip: '', mask: '', status: 'down' };
                device.interfaces.push(intf);
            }

            // Auto-create Loopback interfaces on demand (virtual interfaces for router-id, testing)
            if (!intf && normalized.toLowerCase().startsWith('loopback')) {
                intf = { name: normalized, ip: '', mask: '', status: 'up' };
                device.interfaces.push(intf);
            }

            if (intf) {
                currentInterface = intf.name;
                cliMode = 'config-if';
                updateCLIPrompt(promptEl, device.name);
                output.innerHTML += `<div style="color: #0f0;">‚úì Configuring ${intf.name}</div>`;
            } else {
                output.innerHTML += `<div style="color: #ff0;">% Interface not found. Available:</div>`;
                device.interfaces.slice(0, 8).forEach(i => output.innerHTML += `<div>  ${i.name}</div>`);
            }
        }

        function handleShowCommand(lowerCmd, output, device) {
            if (lowerCmd.includes('ip int') || lowerCmd === 'show ip') {
                output.innerHTML += `<div style="color: #ff0;">Interface            IP-Address      Status    Protocol</div>`;
                device.interfaces.forEach(i => {
                    output.innerHTML += `<div>${i.name.padEnd(20)} ${(i.ip||'unassigned').padEnd(15)} ${i.status.padEnd(9)} ${i.status}</div>`;
                });
            } else if (lowerCmd.includes('run')) {
                output.innerHTML += `<div style="color: #ff0;">hostname ${device.name}</div>`;
                output.innerHTML += `<div>!</div>`;
                device.interfaces.forEach(i => {
                    output.innerHTML += `<div>interface ${i.name}</div>`;
                    if (i.ip) output.innerHTML += `<div> ip address ${i.ip} ${i.mask || '255.255.255.0'}</div>`;
                    if (i.switchportMode) output.innerHTML += `<div> switchport mode ${i.switchportMode}</div>`;
                    output.innerHTML += `<div> ${i.status === 'up' ? 'no shutdown' : 'shutdown'}</div>`;
                    output.innerHTML += `<div>!</div>`;
                });
                (device.config?.staticRoutes || []).forEach(r => output.innerHTML += `<div>ip route ${r.network} ${r.mask} ${r.nextHop}</div>`);
                if (device.config?.ospf) {
                    output.innerHTML += `<div>router ospf ${device.config.ospf.processId}</div>`;
                    device.config.ospf.networks.forEach(n => output.innerHTML += `<div> network ${n.ip} ${n.wildcard} area ${n.area}</div>`);
                }
            } else if (lowerCmd.includes('vlan')) {
                output.innerHTML += `<div style="color: #ff0;">VLAN Name                             Status</div>`;
                output.innerHTML += `<div>1    default                          active</div>`;
                Object.values(device.config?.vlans || {}).forEach(v => output.innerHTML += `<div>${v.id.toString().padEnd(4)} ${v.name.padEnd(32)} active</div>`);
            } else if (lowerCmd.includes('trunk')) {
                output.innerHTML += `<div style="color: #ff0;">Port        Mode    Encapsulation  Native vlan</div>`;
                device.interfaces.filter(i => i.switchportMode === 'trunk').forEach(i => output.innerHTML += `<div>${i.name.padEnd(11)} on      802.1q         ${i.nativeVlan || 1}</div>`);
            } else if (lowerCmd.includes('route')) {
                output.innerHTML += `<div style="color: #ff0;">Codes: C-connected, S-static, O-OSPF</div>`;
                device.interfaces.filter(i => i.ip).forEach(i => output.innerHTML += `<div>C    ${i.ip} directly connected, ${i.name}</div>`);
                (device.config?.staticRoutes || []).forEach(r => output.innerHTML += `<div>S    ${r.network} via ${r.nextHop}</div>`);
            } else if (lowerCmd.includes('span')) {
                output.innerHTML += `<div style="color: #ff0;">Spanning tree enabled protocol rstp</div>`;
                output.innerHTML += `<div>Root ID: Priority 32769, Address ${device.id}</div>`;
            } else if (lowerCmd.includes('ospf neighbor')) {
                output.innerHTML += `<div style="color: #ff0;">Neighbor ID     Pri   State      Interface</div>`;
                output.innerHTML += `<div style="color: #0f0;">(Simulated)</div>`;
            } else if (lowerCmd.includes('standby')) {
                output.innerHTML += `<div style="color: #ff0;">Interface   Grp  Pri  State   Virtual IP</div>`;
            } else if (lowerCmd.includes('access')) {
                output.innerHTML += `<div style="color: #ff0;">Access Control Lists:</div>`;
                Object.keys(device.config?.acls || {}).forEach(a => output.innerHTML += `<div>Extended ACL ${a}</div>`);
            } else if (lowerCmd.includes('eigrp')) {
                output.innerHTML += `<div style="color: #ff0;">EIGRP Neighbors:</div>`;
                output.innerHTML += `<div style="color: #0f0;">(Simulated)</div>`;
            } else {
                output.innerHTML += `<div style="color: #f00;">% Invalid show command</div>`;
            }
        }

        // CLI State tracking for enhanced command support
        let cliMode = 'user'; // user, privileged, config, config-if, config-router, config-vlan
        let currentInterface = null;
        let currentRouterProcess = null;
        let currentVlan = null;
        let currentAcl = null;

        // ========== PLACEHOLDER FUNCTIONS ==========
        document.getElementById('newTopologyBtn').addEventListener('click', () => {
            // Clear all devices and connections
            devices = [];
            deviceIdCounter = 0;
            connections = [];
            connectionIdCounter = 0;
            canvas.innerHTML = '';
            console.log('Canvas cleared - ready for new topology');
        });

        document.getElementById('exportBtn').addEventListener('click', () => {
            // Show export options
            const choice = prompt(
                'Export Options:\n\n' +
                '1 - Export Topology (JSON) - Save your network design\n' +
                '2 - Export Grading Report (TXT) - Lab completion report\n\n' +
                'Enter 1 or 2:'
            );

            if (choice === '1') {
                exportTopologyJSON();
            } else if (choice === '2') {
                exportGradingReport();
            }
        });

        // Import button click - trigger file picker
        document.getElementById('importBtn').addEventListener('click', () => {
            document.getElementById('importFileInput').click();
        });

        // File input change - process selected file
        document.getElementById('importFileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                    alert('‚ùå Please select a valid JSON file.');
                    return;
                }
                importTopologyJSON(file);
                // Reset the input so the same file can be selected again
                e.target.value = '';
            }
        });

        function exportTopologyJSON() {
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');

            const topology = {
                version: '3.9',
                exportedAt: new Date().toISOString(),
                lab: currentLab ? {
                    title: currentLab.title,
                    id: currentLab.id || null,
                    type: currentLab.num ? 'cumulative' : 'standard'
                } : null,
                devices: devices.map(d => {
                    const deviceData = {
                        id: d.id,
                        type: d.type,
                        name: d.name,
                        x: d.x,
                        y: d.y,
                        interfaces: d.interfaces || [],
                        selectedInterface: d.selectedInterface || 0
                    };
                    // Include config object (VLANs, routes, OSPF, EIGRP, ACLs)
                    if (d.config) {
                        deviceData.config = d.config;
                    }
                    // Include DHCP server settings
                    if (d.dhcpServer) {
                        deviceData.dhcpServer = d.dhcpServer;
                    }
                    return deviceData;
                }),
                connections: connections.map(c => ({
                    id: c.id,
                    device1: c.device1,
                    device2: c.device2,
                    color: c.color
                }))
            };

            const json = JSON.stringify(topology, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `topology_${timestamp}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            console.log('Topology exported as JSON');
        }

        // Helper function to generate default interfaces for a device type
        function getDefaultInterfaces(type) {
            if (type === 'router') {
                return [
                    { name: 'GigabitEthernet0/0', ip: '', mask: '', status: 'down' },
                    { name: 'GigabitEthernet0/1', ip: '', mask: '', status: 'down' },
                    { name: 'GigabitEthernet0/2', ip: '', mask: '', status: 'down' },
                    { name: 'Serial0/0/0', ip: '', mask: '', status: 'down' }
                ];
            } else if (type === 'l2switch') {
                return [
                    { name: 'FastEthernet0/1', vlan: 1, status: 'up' },
                    { name: 'FastEthernet0/2', vlan: 1, status: 'up' },
                    { name: 'FastEthernet0/3', vlan: 1, status: 'up' },
                    { name: 'FastEthernet0/4', vlan: 1, status: 'up' },
                    { name: 'GigabitEthernet0/1', vlan: 1, status: 'up' }
                ];
            } else if (type === 'l3switch') {
                return [
                    { name: 'FastEthernet0/1', vlan: 1, status: 'up' },
                    { name: 'FastEthernet0/2', vlan: 1, status: 'up' },
                    { name: 'FastEthernet0/3', vlan: 1, status: 'up' },
                    { name: 'GigabitEthernet0/1', vlan: 1, status: 'up' },
                    { name: 'Vlan1', ip: '', mask: '', status: 'down' }
                ];
            } else {
                // PC or Server
                return [
                    { name: 'Ethernet0', ip: '', mask: '', gateway: '', status: 'up', dhcpEnabled: false }
                ];
            }
        }

        function importTopologyJSON(file) {
            const reader = new FileReader();

            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);

                    // Validate the JSON structure
                    if (!data.devices || !Array.isArray(data.devices)) {
                        throw new Error('Invalid topology file: missing devices array');
                    }
                    if (!data.connections || !Array.isArray(data.connections)) {
                        throw new Error('Invalid topology file: missing connections array');
                    }

                    // Build topology object for loadTopology()
                    const topology = {
                        devices: data.devices,
                        connections: data.connections
                    };

                    // Update UI
                    document.getElementById('welcomeMessage').style.display = 'none';
                    document.getElementById('homeBtn').style.display = 'inline-flex';
                    document.getElementById('labLibraryBtn').style.display = 'none';
                    document.getElementById('cumulativeLabsBtn').style.display = 'none';

                    // Set lab info if available
                    if (data.lab) {
                        document.getElementById('currentLab').textContent = `üìÇ ${data.lab.title || 'Imported Topology'}`;

                        // If it was a cumulative lab, try to restore it
                        if (data.lab.type === 'cumulative' && data.lab.id && CUMULATIVE_LABS[data.lab.id]) {
                            currentLab = CUMULATIVE_LABS[data.lab.id];
                            // Restore step progress from localStorage
                            const savedSteps = loadStepProgress(data.lab.id);
                            currentLab.instructions.forEach((instruction, index) => {
                                instruction.completed = savedSteps[index] === true;
                            });
                            renderCumulativeInstructions(currentLab);
                        } else if (data.lab.type === 'standard' && data.lab.id && LAB_SCENARIOS[data.lab.id]) {
                            currentLab = LAB_SCENARIOS[data.lab.id];
                            renderInstructions(currentLab);
                        } else {
                            currentLab = null;
                            // Clear instructions panel for custom topology
                            document.getElementById('instructionsList').innerHTML = `
                                <div style="text-align: center; padding: 20px; color: var(--text-muted);">
                                    <p style="font-size: 1.1em; margin-bottom: 10px;">üìÇ Imported Topology</p>
                                    <p style="font-size: 0.9em;">Exported: ${data.exportedAt ? new Date(data.exportedAt).toLocaleString() : 'Unknown'}</p>
                                    <p style="font-size: 0.9em; margin-top: 10px;">${data.devices.length} devices, ${data.connections.length} connections</p>
                                </div>
                            `;
                        }
                    } else {
                        currentLab = null;
                        document.getElementById('currentLab').textContent = 'üìÇ Imported Topology';
                        document.getElementById('instructionsList').innerHTML = `
                            <div style="text-align: center; padding: 20px; color: var(--text-muted);">
                                <p style="font-size: 1.1em; margin-bottom: 10px;">üìÇ Imported Topology</p>
                                <p style="font-size: 0.9em;">Exported: ${data.exportedAt ? new Date(data.exportedAt).toLocaleString() : 'Unknown'}</p>
                                <p style="font-size: 0.9em; margin-top: 10px;">${data.devices.length} devices, ${data.connections.length} connections</p>
                            </div>
                        `;
                    }

                    // Use the existing loadTopology function to render devices and connections
                    loadTopology(topology);

                    // Show success message
                    alert(`‚úÖ Topology imported successfully!\n\n‚Ä¢ ${data.devices.length} devices\n‚Ä¢ ${data.connections.length} connections\n\nExported: ${data.exportedAt ? new Date(data.exportedAt).toLocaleString() : 'Unknown'}`);

                    console.log('Topology imported:', { devices: data.devices.length, connections: data.connections.length });

                } catch (error) {
                    console.error('Import error:', error);
                    alert(`‚ùå Failed to import topology:\n\n${error.message}\n\nPlease ensure you selected a valid Packet Tracer Lite JSON export file.`);
                }
            };

            reader.onerror = function() {
                alert('‚ùå Error reading file. Please try again.');
            };

            reader.readAsText(file);
        }

        function exportGradingReport() {
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            let report = '';
            let totalPoints = 0;
            let earnedPoints = 0;

            // Header
            report += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            report += '   PACKET TRACER LITE v3.9 - LAB GRADING REPORT\n';
            report += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            report += `Student Name: _______________________________\n`;
            report += `Date: ${new Date().toLocaleDateString()}\n`;
            report += `Time: ${new Date().toLocaleTimeString()}\n`;

            if (currentLab) {
                report += `Lab: ${currentLab.title}\n`;
                if (currentLab.difficulty) {
                    report += `Difficulty: ${currentLab.difficulty.toUpperCase()}\n`;
                } else if (currentLab.num) {
                    // Cumulative Lab
                    report += `Type: Cumulative Lab ${currentLab.num} of 6\n`;
                }
            } else {
                report += `Lab: Custom Topology\n`;
            }

            report += `\n${'‚îÄ'.repeat(55)}\n\n`;

            // Lab Instructions Checklist (if lab loaded)
            if (currentLab && currentLab.instructions) {
                report += 'SECTION 1: LAB INSTRUCTIONS COMPLETION\n';
                report += '‚îÄ'.repeat(55) + '\n\n';

                currentLab.instructions.forEach((instruction, index) => {
                    const points = 5; // Each instruction worth 5 points
                    totalPoints += points;
                    const completed = instruction.completed;
                    if (completed) earnedPoints += points;

                    report += `Task ${index + 1}: ${instruction.title}\n`;
                    report += `  Status: ${completed ? '‚úì COMPLETED' : '‚úó INCOMPLETE'}\n`;
                    report += `  Points: ${completed ? points : 0}/${points}\n`;
                    report += `  Description: ${instruction.description}\n`;

                    if (instruction.commands && instruction.commands.length > 0) {
                        report += `  Required Commands:\n`;
                        instruction.commands.forEach(cmd => {
                            report += `    - ${cmd}\n`;
                        });
                    }
                    report += '\n';
                });

                const instructionPercentage = totalPoints > 0 ? Math.round((earnedPoints / totalPoints) * 100) : 0;
                report += `Instructions Subtotal: ${earnedPoints}/${totalPoints} points (${instructionPercentage}%)\n`;
                report += '\n' + '‚îÄ'.repeat(55) + '\n\n';
            }

            // Device Configuration Checklist
            report += 'SECTION 2: DEVICE CONFIGURATION VALIDATION\n';
            report += '‚îÄ'.repeat(55) + '\n\n';

            let configPoints = 0;
            let configEarned = 0;

            devices.forEach((device, index) => {
                report += `Device ${index + 1}: ${device.name} (${device.type ? device.type.toUpperCase() : 'UNKNOWN'})\n`;

                // Check each interface
                let deviceHasConfig = false;
                const interfaces = device.interfaces || [];
                interfaces.forEach(intf => {
                    if (intf.ip || intf.status === 'up') {
                        deviceHasConfig = true;
                        const intfPoints = 3; // Each configured interface worth 3 points
                        configPoints += intfPoints;

                        let intfEarned = 0;
                        report += `  Interface: ${intf.name}\n`;

                        // Check IP configuration
                        if (intf.ip && intf.ip !== '') {
                            report += `    ‚úì IP Address: ${intf.ip}\n`;
                            intfEarned += 1;
                        } else {
                            report += `    ‚úó IP Address: Not configured\n`;
                        }

                        // Check subnet mask
                        if (intf.mask && intf.mask !== '') {
                            report += `    ‚úì Subnet Mask: ${intf.mask}\n`;
                            intfEarned += 1;
                        } else {
                            report += `    ‚úó Subnet Mask: Not configured\n`;
                        }

                        // Check status
                        if (intf.status === 'up') {
                            report += `    ‚úì Status: UP (enabled)\n`;
                            intfEarned += 1;
                        } else {
                            report += `    ‚úó Status: DOWN (disabled)\n`;
                        }

                        // Check gateway for PCs
                        if (device.type === 'pc' || device.type === 'server') {
                            if (intf.gateway && intf.gateway !== '') {
                                report += `    ‚úì Default Gateway: ${intf.gateway}\n`;
                            } else {
                                report += `    ‚ö† Default Gateway: Not configured\n`;
                            }
                        }

                        configEarned += intfEarned;
                        report += `    Points: ${intfEarned}/${intfPoints}\n`;
                    }
                });

                if (!deviceHasConfig) {
                    report += `  ‚ö† No interfaces configured\n`;
                }

                report += '\n';
            });

            if (devices.length === 0) {
                report += '‚ö† No devices placed on canvas\n\n';
            }

            const configPercentage = configPoints > 0 ? Math.round((configEarned / configPoints) * 100) : 0;
            report += `Configuration Subtotal: ${configEarned}/${configPoints} points (${configPercentage}%)\n`;
            report += '\n' + '‚îÄ'.repeat(55) + '\n\n';

            // Topology Validation
            report += 'SECTION 3: TOPOLOGY REQUIREMENTS\n';
            report += '‚îÄ'.repeat(55) + '\n\n';

            const topoPoints = 20;
            let topoEarned = 0;

            // Count device types
            const routerCount = devices.filter(d => d.type === 'router').length;
            const switchCount = devices.filter(d => d.type === 'l2switch' || d.type === 'l3switch').length;
            const hostCount = devices.filter(d => d.type === 'pc' || d.type === 'server').length;

            report += `Device Inventory:\n`;
            report += `  Routers: ${routerCount}\n`;
            report += `  Switches: ${switchCount}\n`;
            report += `  Hosts (PCs/Servers): ${hostCount}\n`;
            report += `  Total Devices: ${devices.length}\n\n`;

            // Topology scoring
            if (devices.length > 0) {
                topoEarned += 5;
                report += `‚úì Devices placed on canvas: +5 points\n`;
            } else {
                report += `‚úó No devices placed: 0 points\n`;
            }

            if (routerCount > 0) {
                topoEarned += 5;
                report += `‚úì Router present: +5 points\n`;
            }

            if (switchCount > 0) {
                topoEarned += 5;
                report += `‚úì Switch present: +5 points\n`;
            }

            if (hostCount >= 2) {
                topoEarned += 5;
                report += `‚úì Multiple hosts present: +5 points\n`;
            }

            report += `\nTopology Subtotal: ${topoEarned}/${topoPoints} points\n`;
            report += '\n' + '‚îÄ'.repeat(55) + '\n\n';

            // Final Grade
            const finalTotal = totalPoints + configPoints + topoPoints;
            const finalEarned = earnedPoints + configEarned + topoEarned;
            const finalPercentage = finalTotal > 0 ? Math.round((finalEarned / finalTotal) * 100) : 0;

            report += 'FINAL GRADE SUMMARY\n';
            report += '‚ïê'.repeat(55) + '\n\n';
            report += `Section 1 (Instructions): ${earnedPoints}/${totalPoints} points\n`;
            report += `Section 2 (Configuration): ${configEarned}/${configPoints} points\n`;
            report += `Section 3 (Topology): ${topoEarned}/${topoPoints} points\n\n`;
            report += `TOTAL SCORE: ${finalEarned}/${finalTotal} points (${finalPercentage}%)\n\n`;

            // Letter grade
            let letterGrade = 'F';
            if (finalPercentage >= 90) letterGrade = 'A';
            else if (finalPercentage >= 80) letterGrade = 'B';
            else if (finalPercentage >= 70) letterGrade = 'C';
            else if (finalPercentage >= 60) letterGrade = 'D';

            report += `LETTER GRADE: ${letterGrade}\n\n`;

            // Instructor Comments Section
            report += '‚îÄ'.repeat(55) + '\n';
            report += 'INSTRUCTOR COMMENTS:\n';
            report += '\n\n\n\n';
            report += '‚îÄ'.repeat(55) + '\n';
            report += 'Instructor Signature: _______________  Date: __________\n\n';

            // Footer
            report += '‚ïê'.repeat(55) + '\n';
            report += 'Generated by Packet Tracer Lite v3.9 - Lab Library Edition\n';
            report += `Report ID: ${timestamp}\n`;
            report += '‚ïê'.repeat(55) + '\n';

            // Download the report
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Lab_Grade_Report_${timestamp}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            console.log('Grading report exported successfully');
            console.log(`Final Score: ${finalEarned}/${finalTotal} (${finalPercentage}%) - Grade: ${letterGrade}`);
        }

        // ========== HELP SYSTEM ==========
        const helpModal = document.getElementById('helpModal');
        const helpCloseBtn = document.getElementById('helpCloseBtn');
        const helpTabs = document.querySelectorAll('.help-tab');
        const helpSections = document.querySelectorAll('.help-section');
        const commandSearch = document.getElementById('commandSearch');
        const commandList = document.getElementById('commandList');
        const noResults = document.getElementById('noResults');

        // ========== COMMAND REFERENCE POPUP ==========
        function openCommandReference() {
            document.getElementById('cmdRefPopup').classList.add('active');
            document.body.style.overflow = 'hidden';
            document.getElementById('cmdRefSearch').focus();
        }

        function closeCommandReference() {
            document.getElementById('cmdRefPopup').classList.remove('active');
            document.body.style.overflow = 'auto';
            document.getElementById('cmdRefSearch').value = '';
            // Reset all command items to visible
            document.querySelectorAll('.cmd-item').forEach(item => item.classList.remove('hidden'));
        }

        function filterCommands() {
            const search = document.getElementById('cmdRefSearch').value.toLowerCase().trim();
            const items = document.querySelectorAll('.cmd-item');

            items.forEach(item => {
                const syntax = item.querySelector('.cmd-syntax').textContent.toLowerCase();
                const desc = item.querySelector('.cmd-desc').textContent.toLowerCase();
                const keywords = (item.dataset.keywords || '').toLowerCase();
                const example = item.querySelector('.cmd-example');
                const exampleText = example ? example.textContent.toLowerCase() : '';

                const matches = syntax.includes(search) ||
                               desc.includes(search) ||
                               keywords.includes(search) ||
                               exampleText.includes(search);

                item.classList.toggle('hidden', !matches && search !== '');
            });

            // Show/hide category headers based on visible items
            document.querySelectorAll('.cmd-category').forEach(cat => {
                const visibleItems = cat.querySelectorAll('.cmd-item:not(.hidden)');
                cat.style.display = visibleItems.length > 0 ? 'block' : 'none';
            });
        }

        // Click outside popup to close
        document.getElementById('cmdRefPopup').addEventListener('click', (e) => {
            if (e.target.id === 'cmdRefPopup') {
                closeCommandReference();
            }
        });

        // Escape key to close command reference
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.getElementById('cmdRefPopup').classList.contains('active')) {
                closeCommandReference();
            }
        });

        // Open help modal
        function openHelpModal() {
            helpModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            // Focus on the first tab for accessibility
            document.querySelector('.help-tab.active').focus();
        }

        // Close help modal
        function closeHelpModal() {
            helpModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Help button click handler
        document.getElementById('helpBtn').addEventListener('click', openHelpModal);

        // Close button click handler
        helpCloseBtn.addEventListener('click', closeHelpModal);

        // Click outside modal to close
        helpModal.addEventListener('click', (e) => {
            if (e.target === helpModal) {
                closeHelpModal();
            }
        });

        // Escape key to close
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && helpModal.classList.contains('active')) {
                closeHelpModal();
            }
            // Ctrl+F to focus search when on Commands tab
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                const commandsTab = document.getElementById('commands');
                if (commandsTab && commandsTab.classList.contains('active')) {
                    e.preventDefault();
                    commandSearch.focus();
                }
            }
            // Ctrl+Shift+U to unlock all cumulative labs
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'U') {
                e.preventDefault();
                unlockAllCumulativeLabs();
                alert('üîì All cumulative labs have been unlocked!');
            }
        });

        // Tab switching
        helpTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and sections
                helpTabs.forEach(t => t.classList.remove('active'));
                helpSections.forEach(s => s.classList.remove('active'));

                // Add active class to clicked tab
                tab.classList.add('active');

                // Show corresponding section
                const targetSection = tab.getAttribute('data-tab');
                const section = document.getElementById(targetSection);
                if (section) {
                    section.classList.add('active');
                }

                // If switching to commands tab, focus search
                if (targetSection === 'commands') {
                    setTimeout(() => commandSearch.focus(), 100);
                }
            });

            // Keyboard navigation for tabs
            tab.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    tab.click();
                }
            });
        });

        // Command search functionality
        let searchTimeout;
        commandSearch.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const searchTerm = e.target.value.toLowerCase().trim();

                if (searchTerm === '') {
                    // Show all commands
                    document.querySelectorAll('.command-category').forEach(cat => {
                        cat.style.display = 'block';
                    });
                    document.querySelectorAll('.command-item').forEach(item => {
                        item.style.display = 'block';
                    });
                    noResults.style.display = 'none';
                    return;
                }

                // Search through commands
                let hasResults = false;
                document.querySelectorAll('.command-category').forEach(category => {
                    let categoryHasResults = false;
                    const items = category.querySelectorAll('.command-item');

                    items.forEach(item => {
                        const syntax = item.querySelector('.command-syntax').textContent.toLowerCase();
                        const description = item.querySelector('.command-description').textContent.toLowerCase();
                        const keywords = item.getAttribute('data-keywords') || '';

                        if (syntax.includes(searchTerm) ||
                            description.includes(searchTerm) ||
                            keywords.toLowerCase().includes(searchTerm)) {
                            item.style.display = 'block';
                            categoryHasResults = true;
                            hasResults = true;

                            // Highlight matching text
                            const syntaxEl = item.querySelector('.command-syntax');
                            const descEl = item.querySelector('.command-description');
                            syntaxEl.innerHTML = highlightText(syntaxEl.textContent, searchTerm);
                            descEl.innerHTML = highlightText(descEl.textContent, searchTerm);
                        } else {
                            item.style.display = 'none';
                        }
                    });

                    category.style.display = categoryHasResults ? 'block' : 'none';
                });

                // Show/hide no results message
                noResults.style.display = hasResults ? 'none' : 'block';
                if (hasResults) {
                    commandList.style.display = 'block';
                } else {
                    commandList.style.display = 'none';
                }
            }, 300); // Debounce search
        });

        // Function to highlight matching text
        function highlightText(text, searchTerm) {
            if (!searchTerm) return text;
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span style="background-color: #fff3cd; font-weight: bold;">$1</span>');
        }

        // Clear search when leaving commands tab
        helpTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                if (tab.getAttribute('data-tab') !== 'commands') {
                    commandSearch.value = '';
                    // Reset all commands to visible
                    document.querySelectorAll('.command-category').forEach(cat => {
                        cat.style.display = 'block';
                    });
                    document.querySelectorAll('.command-item').forEach(item => {
                        item.style.display = 'block';
                        // Remove highlights
                        const syntaxEl = item.querySelector('.command-syntax');
                        const descEl = item.querySelector('.command-description');
                        if (syntaxEl) syntaxEl.innerHTML = syntaxEl.textContent;
                        if (descEl) descEl.innerHTML = descEl.textContent;
                    });
                    noResults.style.display = 'none';
                    commandList.style.display = 'block';
                }
            });
        });

        console.log('‚úÖ Help system initialized successfully');

        console.log('üìö Packet Tracer Lite v3.9 - Lab Library Edition');
        console.log('Loaded labs:', Object.keys(LAB_LIBRARY).length);
    </script>
</body>
</html>
