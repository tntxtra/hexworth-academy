<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linux Firewall Rules Builder - House of Shield</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a0000 0%, #2d0a0a 50%, #1a0000 100%);
            color: #fca5a5;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
            border-radius: 15px;
            border: 2px solid #dc2626;
            box-shadow: 0 8px 32px rgba(220, 38, 38, 0.3);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(239, 68, 68, 0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        h1 {
            color: #fca5a5;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
            position: relative;
            z-index: 1;
        }

        .shield-icon {
            font-size: 3em;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 10px rgba(239, 68, 68, 0.8));
        }

        .subtitle {
            color: #fca5a5;
            font-size: 1.2em;
            position: relative;
            z-index: 1;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 15px 25px;
            background: #7f1d1d;
            color: #fca5a5;
            border: 2px solid #dc2626;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab-button:hover {
            background: #991b1b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.4);
        }

        .tab-button.active {
            background: #dc2626;
            color: #fff;
            box-shadow: 0 5px 20px rgba(220, 38, 38, 0.6);
        }

        .tab-content {
            display: none;
            background: rgba(127, 29, 29, 0.3);
            border: 2px solid #dc2626;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            color: #fca5a5;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        select, input {
            padding: 12px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #dc2626;
            border-radius: 6px;
            color: #fca5a5;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }

        select option {
            background: #2d0a0a;
            color: #fca5a5;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: #fff;
            border: 2px solid #ef4444;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(220, 38, 38, 0.5);
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        button:active {
            transform: translateY(0);
        }

        .output-section {
            margin-top: 30px;
        }

        .output-box {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #dc2626;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .output-box h3 {
            color: #ef4444;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #dc2626;
            padding-bottom: 10px;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #7f1d1d;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            color: #fca5a5;
            margin: 10px 0;
            position: relative;
            overflow-x: auto;
        }

        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 12px;
            font-size: 0.85em;
            background: #7f1d1d;
            border: 1px solid #dc2626;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .template-card {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #dc2626;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
            border-color: #ef4444;
        }

        .template-card h4 {
            color: #ef4444;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .template-card p {
            color: #fca5a5;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .flow-diagram {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #dc2626;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
        }

        .chain-flow {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
        }

        .chain-box {
            background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
            border: 2px solid #dc2626;
            border-radius: 10px;
            padding: 20px;
            min-width: 150px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(220, 38, 38, 0.3);
        }

        .chain-box h4 {
            color: #fca5a5;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .chain-box p {
            color: #fca5a5;
            font-size: 0.85em;
        }

        .arrow {
            color: #ef4444;
            font-size: 2em;
            font-weight: bold;
        }

        .rule-item {
            background: rgba(0, 0, 0, 0.4);
            border-left: 4px solid #dc2626;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .rule-item.accept { border-left-color: #22c55e; }
        .rule-item.drop { border-left-color: #dc2626; }
        .rule-item.log { border-left-color: #eab308; }

        .rule-details {
            flex: 1;
        }

        .rule-action {
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .rule-action.accept {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid #22c55e;
        }

        .rule-action.drop {
            background: rgba(220, 38, 38, 0.2);
            color: #ef4444;
            border: 1px solid #dc2626;
        }

        .rule-action.log {
            background: rgba(234, 179, 8, 0.2);
            color: #eab308;
            border: 1px solid #eab308;
        }

        .delete-rule {
            padding: 5px 10px;
            margin-left: 10px;
            font-size: 0.85em;
        }

        .visual-packet-flow {
            margin: 30px 0;
        }

        .packet-path {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .packet-node {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #dc2626;
            border-radius: 8px;
            padding: 15px;
            min-width: 120px;
            text-align: center;
        }

        .packet-node h5 {
            color: #ef4444;
            margin-bottom: 5px;
        }

        .packet-node p {
            color: #fca5a5;
            font-size: 0.85em;
        }

        .info-box {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid #dc2626;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .info-box h4 {
            color: #ef4444;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .info-box ul {
            list-style: none;
            padding-left: 0;
        }

        .info-box li {
            color: #fca5a5;
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }

        .info-box li::before {
            content: '‚ñ∂';
            position: absolute;
            left: 0;
            color: #dc2626;
        }

        .quiz-question {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #dc2626;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .quiz-question h4 {
            color: #ef4444;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }

        .quiz-option {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #7f1d1d;
            border-radius: 6px;
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #fca5a5;
        }

        .quiz-option:hover {
            border-color: #dc2626;
            background: rgba(127, 29, 29, 0.3);
        }

        .quiz-option.correct {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.2);
        }

        .quiz-option.incorrect {
            border-color: #dc2626;
            background: rgba(220, 38, 38, 0.2);
        }

        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            display: none;
        }

        .quiz-feedback.show {
            display: block;
        }

        .quiz-feedback.correct {
            background: rgba(34, 197, 94, 0.2);
            border: 2px solid #22c55e;
            color: #22c55e;
        }

        .quiz-feedback.incorrect {
            background: rgba(220, 38, 38, 0.2);
            border: 2px solid #dc2626;
            color: #ef4444;
        }

        .cidr-helper {
            font-size: 0.85em;
            color: #fca5a5;
            margin-top: 5px;
            font-style: italic;
        }

        .rules-list {
            margin-top: 20px;
        }

        .no-rules {
            text-align: center;
            color: #fca5a5;
            padding: 30px;
            font-style: italic;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .packet-path {
                flex-direction: column;
            }

            .arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="shield-icon">üõ°Ô∏è</div>
            <h1>Linux Firewall Rules Builder</h1>
            <p class="subtitle">House of Shield - Defend Your Network Perimeter</p>
        </header>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('builder')">Rule Builder</button>
            <button class="tab-button" onclick="switchTab('visualization')">Packet Flow</button>
            <button class="tab-button" onclick="switchTab('templates')">Templates</button>
            <button class="tab-button" onclick="switchTab('chains')">Chains Guide</button>
            <button class="tab-button" onclick="switchTab('ufw')">UFW Reference</button>
            <button class="tab-button" onclick="switchTab('best-practices')">Best Practices</button>
            <button class="tab-button" onclick="switchTab('quiz')">Security Quiz</button>
        </div>

        <!-- Rule Builder Tab -->
        <div id="builder" class="tab-content active">
            <h2 style="color: #ef4444; margin-bottom: 20px;">Build Your Firewall Rule</h2>

            <div class="form-grid">
                <div class="form-group">
                    <label for="chain">Chain</label>
                    <select id="chain">
                        <option value="INPUT">INPUT (Incoming)</option>
                        <option value="OUTPUT">OUTPUT (Outgoing)</option>
                        <option value="FORWARD">FORWARD (Routing)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="protocol">Protocol</label>
                    <select id="protocol" onchange="togglePortFields()">
                        <option value="tcp">TCP</option>
                        <option value="udp">UDP</option>
                        <option value="icmp">ICMP</option>
                        <option value="all">ALL</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="action">Action</label>
                    <select id="action">
                        <option value="ACCEPT">ACCEPT (Allow)</option>
                        <option value="DROP">DROP (Silent Deny)</option>
                        <option value="REJECT">REJECT (Deny with Response)</option>
                        <option value="LOG">LOG (Record Only)</option>
                    </select>
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="sourceIP">Source IP/Network</label>
                    <input type="text" id="sourceIP" placeholder="0.0.0.0/0 (any)" value="0.0.0.0/0">
                    <span class="cidr-helper">Examples: 192.168.1.0/24, 10.0.0.1, 0.0.0.0/0 (any)</span>
                </div>

                <div class="form-group">
                    <label for="destIP">Destination IP/Network</label>
                    <input type="text" id="destIP" placeholder="0.0.0.0/0 (any)" value="0.0.0.0/0">
                    <span class="cidr-helper">Examples: 192.168.1.0/24, 10.0.0.1, 0.0.0.0/0 (any)</span>
                </div>
            </div>

            <div class="form-grid" id="portFields">
                <div class="form-group">
                    <label for="sourcePort">Source Port</label>
                    <input type="text" id="sourcePort" placeholder="any">
                    <span class="cidr-helper">Examples: 22, 80, 1024:65535 (range)</span>
                </div>

                <div class="form-group">
                    <label for="destPort">Destination Port</label>
                    <input type="text" id="destPort" placeholder="any">
                    <span class="cidr-helper">Examples: 22, 80, 443</span>
                </div>
            </div>

            <div class="button-group">
                <button onclick="generateRule()">Generate Rule</button>
                <button onclick="addToRulesList()">Add to Rules List</button>
                <button onclick="clearForm()">Clear Form</button>
            </div>

            <div class="output-section">
                <div class="output-box">
                    <h3>iptables Command</h3>
                    <div class="code-block">
                        <button class="copy-button" onclick="copyToClipboard('iptablesOutput')">Copy</button>
                        <pre id="iptablesOutput"># Configure your rule above and click "Generate Rule"</pre>
                    </div>
                </div>

                <div class="output-box">
                    <h3>UFW Command</h3>
                    <div class="code-block">
                        <button class="copy-button" onclick="copyToClipboard('ufwOutput')">Copy</button>
                        <pre id="ufwOutput"># UFW syntax will appear here</pre>
                    </div>
                </div>

                <div class="output-box">
                    <h3>firewall-cmd Command</h3>
                    <div class="code-block">
                        <button class="copy-button" onclick="copyToClipboard('firewalldOutput')">Copy</button>
                        <pre id="firewalldOutput"># firewalld syntax will appear here</pre>
                    </div>
                </div>
            </div>

            <div class="rules-list">
                <h3 style="color: #ef4444; margin-bottom: 15px;">Your Firewall Rules</h3>
                <div id="rulesContainer">
                    <div class="no-rules">No rules added yet. Create and add rules above.</div>
                </div>
                <div class="button-group" style="margin-top: 20px;">
                    <button onclick="exportAllRules('iptables')">Export All (iptables)</button>
                    <button onclick="exportAllRules('ufw')">Export All (UFW)</button>
                    <button onclick="clearAllRules()">Clear All Rules</button>
                </div>
            </div>
        </div>

        <!-- Visualization Tab -->
        <div id="visualization" class="tab-content">
            <h2 style="color: #ef4444; margin-bottom: 20px;">Packet Flow Visualization</h2>

            <div class="flow-diagram">
                <h3 style="color: #ef4444; margin-bottom: 20px;">Network Packet Journey</h3>

                <div class="visual-packet-flow">
                    <h4 style="color: #fca5a5; margin-bottom: 15px;">Incoming Packet (INPUT Chain)</h4>
                    <div class="packet-path">
                        <div class="packet-node">
                            <h5>Network</h5>
                            <p>Packet arrives</p>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="packet-node" style="border-color: #22c55e;">
                            <h5>PREROUTING</h5>
                            <p>NAT decisions</p>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="packet-node" style="border-color: #eab308;">
                            <h5>INPUT</h5>
                            <p>Your rules here</p>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="packet-node" style="border-color: #3b82f6;">
                            <h5>Local Process</h5>
                            <p>Destination</p>
                        </div>
                    </div>
                </div>

                <div class="visual-packet-flow">
                    <h4 style="color: #fca5a5; margin-bottom: 15px;">Outgoing Packet (OUTPUT Chain)</h4>
                    <div class="packet-path">
                        <div class="packet-node" style="border-color: #3b82f6;">
                            <h5>Local Process</h5>
                            <p>Origin</p>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="packet-node" style="border-color: #eab308;">
                            <h5>OUTPUT</h5>
                            <p>Your rules here</p>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="packet-node" style="border-color: #22c55e;">
                            <h5>POSTROUTING</h5>
                            <p>NAT decisions</p>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="packet-node">
                            <h5>Network</h5>
                            <p>Packet leaves</p>
                        </div>
                    </div>
                </div>

                <div class="visual-packet-flow">
                    <h4 style="color: #fca5a5; margin-bottom: 15px;">Forwarded Packet (FORWARD Chain)</h4>
                    <div class="packet-path">
                        <div class="packet-node">
                            <h5>Network A</h5>
                            <p>Packet arrives</p>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="packet-node" style="border-color: #22c55e;">
                            <h5>PREROUTING</h5>
                            <p>NAT decisions</p>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="packet-node" style="border-color: #eab308;">
                            <h5>FORWARD</h5>
                            <p>Your rules here</p>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="packet-node" style="border-color: #22c55e;">
                            <h5>POSTROUTING</h5>
                            <p>NAT decisions</p>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="packet-node">
                            <h5>Network B</h5>
                            <p>Packet leaves</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <h4>Rule Evaluation Colors</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div style="background: rgba(34, 197, 94, 0.2); padding: 15px; border-radius: 6px; border: 2px solid #22c55e;">
                        <strong style="color: #22c55e;">GREEN - ACCEPT</strong>
                        <p style="margin-top: 5px; font-size: 0.9em;">Packet is allowed through</p>
                    </div>
                    <div style="background: rgba(220, 38, 38, 0.2); padding: 15px; border-radius: 6px; border: 2px solid #dc2626;">
                        <strong style="color: #ef4444;">RED - DROP/REJECT</strong>
                        <p style="margin-top: 5px; font-size: 0.9em;">Packet is blocked</p>
                    </div>
                    <div style="background: rgba(234, 179, 8, 0.2); padding: 15px; border-radius: 6px; border: 2px solid #eab308;">
                        <strong style="color: #eab308;">YELLOW - LOG</strong>
                        <p style="margin-top: 5px; font-size: 0.9em;">Packet is logged</p>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <h4>How Rules Are Evaluated</h4>
                <ul>
                    <li>Rules are evaluated from top to bottom in order</li>
                    <li>First matching rule is applied (unless using LOG)</li>
                    <li>If no rule matches, the default policy is applied</li>
                    <li>LOG action records packet info but continues evaluation</li>
                    <li>More specific rules should come before general rules</li>
                    <li>ACCEPT stops evaluation, DROP/REJECT end the packet</li>
                </ul>
            </div>
        </div>

        <!-- Templates Tab -->
        <div id="templates" class="tab-content">
            <h2 style="color: #ef4444; margin-bottom: 20px;">Common Firewall Rule Templates</h2>
            <p style="color: #fca5a5; margin-bottom: 20px;">Click any template to load it into the rule builder</p>

            <div class="template-grid">
                <div class="template-card" onclick="loadTemplate('ssh')">
                    <h4>Allow SSH</h4>
                    <p>Permit incoming SSH connections on port 22 (TCP)</p>
                    <div class="code-block" style="margin-top: 10px; font-size: 0.8em;">
                        <pre>Port: 22/TCP
Action: ACCEPT</pre>
                    </div>
                </div>

                <div class="template-card" onclick="loadTemplate('http-https')">
                    <h4>Allow HTTP/HTTPS</h4>
                    <p>Permit web traffic on ports 80 and 443 (TCP)</p>
                    <div class="code-block" style="margin-top: 10px; font-size: 0.8em;">
                        <pre>Ports: 80,443/TCP
Action: ACCEPT</pre>
                    </div>
                </div>

                <div class="template-card" onclick="loadTemplate('ping')">
                    <h4>Allow Ping (ICMP)</h4>
                    <p>Permit ICMP echo requests for network diagnostics</p>
                    <div class="code-block" style="margin-top: 10px; font-size: 0.8em;">
                        <pre>Protocol: ICMP
Action: ACCEPT</pre>
                    </div>
                </div>

                <div class="template-card" onclick="loadTemplate('dns')">
                    <h4>Allow DNS</h4>
                    <p>Permit DNS queries on port 53 (UDP/TCP)</p>
                    <div class="code-block" style="margin-top: 10px; font-size: 0.8em;">
                        <pre>Port: 53/UDP
Action: ACCEPT</pre>
                    </div>
                </div>

                <div class="template-card" onclick="loadTemplate('established')">
                    <h4>Allow Established</h4>
                    <p>Permit responses to outgoing connections</p>
                    <div class="code-block" style="margin-top: 10px; font-size: 0.8em;">
                        <pre>State: ESTABLISHED
Action: ACCEPT</pre>
                    </div>
                </div>

                <div class="template-card" onclick="loadTemplate('block-ip')">
                    <h4>Block Specific IP</h4>
                    <p>Drop all traffic from a malicious IP address</p>
                    <div class="code-block" style="margin-top: 10px; font-size: 0.8em;">
                        <pre>Source: 192.168.1.100
Action: DROP</pre>
                    </div>
                </div>

                <div class="template-card" onclick="loadTemplate('log-ssh')">
                    <h4>Log SSH Attempts</h4>
                    <p>Record all SSH connection attempts</p>
                    <div class="code-block" style="margin-top: 10px; font-size: 0.8em;">
                        <pre>Port: 22/TCP
Action: LOG</pre>
                    </div>
                </div>

                <div class="template-card" onclick="loadTemplate('mysql')">
                    <h4>Allow MySQL</h4>
                    <p>Permit MySQL connections from local network</p>
                    <div class="code-block" style="margin-top: 10px; font-size: 0.8em;">
                        <pre>Port: 3306/TCP
Source: 192.168.1.0/24</pre>
                    </div>
                </div>
            </div>

            <div class="info-box" style="margin-top: 30px;">
                <h4>Default Policy Templates</h4>
                <div class="code-block">
                    <pre># Secure default - deny all incoming, allow outgoing
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# Allow loopback
iptables -A INPUT -i lo -j ACCEPT

# Allow established connections
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT</pre>
                </div>
            </div>
        </div>

        <!-- Chains Guide Tab -->
        <div id="chains" class="tab-content">
            <h2 style="color: #ef4444; margin-bottom: 20px;">Understanding Firewall Chains</h2>

            <div class="chain-flow">
                <div class="chain-box">
                    <h4>INPUT</h4>
                    <p>Incoming packets destined for this machine</p>
                </div>
                <div class="chain-box">
                    <h4>OUTPUT</h4>
                    <p>Outgoing packets originating from this machine</p>
                </div>
                <div class="chain-box">
                    <h4>FORWARD</h4>
                    <p>Packets passing through this machine to another destination</p>
                </div>
            </div>

            <div class="info-box">
                <h4>INPUT Chain - Detailed Explanation</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Controls packets coming INTO your server from the network</p>
                <ul>
                    <li>Web traffic to your web server (port 80, 443)</li>
                    <li>SSH connections to your server (port 22)</li>
                    <li>Ping requests to your server (ICMP)</li>
                    <li>Database connections to your server (port 3306, 5432)</li>
                </ul>
                <div class="code-block" style="margin-top: 15px;">
                    <pre># Allow incoming SSH
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# Allow incoming HTTP/HTTPS
iptables -A INPUT -p tcp -m multiport --dports 80,443 -j ACCEPT</pre>
                </div>
            </div>

            <div class="info-box">
                <h4>OUTPUT Chain - Detailed Explanation</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Controls packets going OUT from your server to the network</p>
                <ul>
                    <li>Your server connecting to external APIs</li>
                    <li>Your server sending emails (port 25, 587)</li>
                    <li>Your server making DNS queries (port 53)</li>
                    <li>Your server downloading updates (HTTP/HTTPS)</li>
                </ul>
                <div class="code-block" style="margin-top: 15px;">
                    <pre># Allow outgoing DNS
iptables -A OUTPUT -p udp --dport 53 -j ACCEPT

# Allow outgoing HTTP/HTTPS
iptables -A OUTPUT -p tcp -m multiport --dports 80,443 -j ACCEPT</pre>
                </div>
            </div>

            <div class="info-box">
                <h4>FORWARD Chain - Detailed Explanation</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Controls packets being routed THROUGH your server to other destinations</p>
                <ul>
                    <li>Your server acting as a router/gateway</li>
                    <li>NAT (Network Address Translation) scenarios</li>
                    <li>Traffic between different network interfaces</li>
                    <li>Docker containers routing through host</li>
                </ul>
                <div class="code-block" style="margin-top: 15px;">
                    <pre># Allow forwarding from internal to external network
iptables -A FORWARD -i eth1 -o eth0 -j ACCEPT

# Allow forwarding for established connections
iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT</pre>
                </div>
            </div>

            <div class="info-box">
                <h4>Default Policies</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">What happens to packets that don't match any rule</p>
                <div class="code-block">
                    <pre># View current policies
iptables -L | grep policy

# Set default DROP (secure - deny all, allow specific)
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# Set default ACCEPT (permissive - allow all, block specific)
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT</pre>
                </div>
            </div>
        </div>

        <!-- UFW Reference Tab -->
        <div id="ufw" class="tab-content">
            <h2 style="color: #ef4444; margin-bottom: 20px;">UFW Quick Reference</h2>
            <p style="color: #fca5a5; margin-bottom: 20px;">Uncomplicated Firewall (UFW) - A user-friendly frontend for iptables</p>

            <div class="info-box">
                <h4>Basic UFW Commands</h4>
                <div class="code-block">
                    <pre># Enable UFW
sudo ufw enable

# Disable UFW
sudo ufw disable

# Check status
sudo ufw status
sudo ufw status verbose
sudo ufw status numbered

# Reset to defaults
sudo ufw reset</pre>
                </div>
            </div>

            <div class="info-box">
                <h4>Allow Rules</h4>
                <div class="code-block">
                    <pre># Allow specific port
sudo ufw allow 22
sudo ufw allow 80/tcp
sudo ufw allow 53/udp

# Allow port range
sudo ufw allow 6000:6007/tcp

# Allow from specific IP
sudo ufw allow from 192.168.1.100

# Allow from subnet to specific port
sudo ufw allow from 192.168.1.0/24 to any port 22

# Allow specific service
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https</pre>
                </div>
            </div>

            <div class="info-box">
                <h4>Deny Rules</h4>
                <div class="code-block">
                    <pre># Deny specific port
sudo ufw deny 23

# Deny from specific IP
sudo ufw deny from 192.168.1.100

# Deny to specific IP
sudo ufw deny to 192.168.1.100

# Deny from subnet
sudo ufw deny from 10.0.0.0/8</pre>
                </div>
            </div>

            <div class="info-box">
                <h4>Delete Rules</h4>
                <div class="code-block">
                    <pre># Delete by rule specification
sudo ufw delete allow 80

# Delete by rule number
sudo ufw status numbered
sudo ufw delete 3

# Delete specific rule
sudo ufw delete allow from 192.168.1.100</pre>
                </div>
            </div>

            <div class="info-box">
                <h4>Advanced UFW</h4>
                <div class="code-block">
                    <pre># Set default policies
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw default deny forward

# Rate limiting (prevents brute force)
sudo ufw limit ssh
sudo ufw limit 22/tcp

# Application profiles
sudo ufw app list
sudo ufw allow 'Nginx Full'
sudo ufw allow 'OpenSSH'

# Logging
sudo ufw logging on
sudo ufw logging off
sudo ufw logging low
sudo ufw logging medium
sudo ufw logging high</pre>
                </div>
            </div>

            <div class="info-box">
                <h4>Common UFW Scenarios</h4>
                <div class="code-block">
                    <pre># Web server setup
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
sudo ufw enable

# Database server (MySQL) from local network only
sudo ufw allow from 192.168.1.0/24 to any port 3306

# Allow ping
sudo ufw allow proto icmp

# Block specific IP
sudo ufw deny from 203.0.113.100

# Allow specific IP to all ports
sudo ufw allow from 192.168.1.50</pre>
                </div>
            </div>
        </div>

        <!-- Best Practices Tab -->
        <div id="best-practices" class="tab-content">
            <h2 style="color: #ef4444; margin-bottom: 20px;">Firewall Security Best Practices</h2>

            <div class="info-box">
                <h4>1. Default Deny Policy</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Start with a secure baseline - deny everything by default, then explicitly allow what you need</p>
                <div class="code-block">
                    <pre># iptables approach
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# UFW approach
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw default deny forward</pre>
                </div>
                <ul>
                    <li>Minimizes attack surface</li>
                    <li>Forces you to think about what services you actually need</li>
                    <li>Easier to audit allowed services</li>
                    <li>More secure than "allow all, block some"</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>2. Allow Only Necessary Ports</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Every open port is a potential attack vector</p>
                <ul>
                    <li>Identify which services actually need network access</li>
                    <li>Close unused services (FTP, Telnet, unnecessary databases)</li>
                    <li>Use non-standard ports for common services (but don't rely on security through obscurity)</li>
                    <li>Regularly audit open ports with: <code style="color: #ef4444;">netstat -tulpn</code> or <code style="color: #ef4444;">ss -tulpn</code></li>
                </ul>
            </div>

            <div class="info-box">
                <h4>3. Rate Limiting</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Prevent brute force attacks by limiting connection attempts</p>
                <div class="code-block">
                    <pre># UFW rate limiting (easy)
sudo ufw limit ssh
sudo ufw limit 22/tcp

# iptables rate limiting (more control)
iptables -A INPUT -p tcp --dport 22 -m conntrack --ctstate NEW -m recent --set
iptables -A INPUT -p tcp --dport 22 -m conntrack --ctstate NEW -m recent --update --seconds 60 --hitcount 4 -j DROP

# Explanation: Allow only 3 new SSH connections per 60 seconds per IP</pre>
                </div>
                <ul>
                    <li>Protects against brute force password attacks</li>
                    <li>Mitigates DoS attempts</li>
                    <li>Apply to SSH, web login pages, API endpoints</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>4. Allow Established Connections</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Permit return traffic for connections you initiated</p>
                <div class="code-block">
                    <pre># Allow established and related connections
iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

# Or using state module
iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</pre>
                </div>
                <ul>
                    <li>Allows responses to your outgoing requests</li>
                    <li>Essential for normal network operation</li>
                    <li>Should be one of your first rules</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>5. Logging Suspicious Traffic</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Monitor and log potential attacks or unusual activity</p>
                <div class="code-block">
                    <pre># Log dropped packets (before DROP policy)
iptables -A INPUT -m limit --limit 5/min -j LOG --log-prefix "iptables-DROP: " --log-level 7

# Log specific port attempts
iptables -A INPUT -p tcp --dport 23 -j LOG --log-prefix "Telnet-attempt: "

# View logs
sudo tail -f /var/log/syslog | grep iptables
sudo journalctl -f | grep iptables</pre>
                </div>
                <ul>
                    <li>Use rate limiting on logs to prevent log flooding</li>
                    <li>Monitor logs regularly for attack patterns</li>
                    <li>Set up alerts for critical events</li>
                    <li>Be careful not to log too much (performance impact)</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>6. Restrict by Source IP</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Limit access to sensitive services based on source address</p>
                <div class="code-block">
                    <pre># Allow SSH only from your office network
iptables -A INPUT -p tcp --dport 22 -s 203.0.113.0/24 -j ACCEPT

# Allow database only from app servers
iptables -A INPUT -p tcp --dport 3306 -s 192.168.1.10 -j ACCEPT
iptables -A INPUT -p tcp --dport 3306 -s 192.168.1.11 -j ACCEPT

# UFW equivalent
sudo ufw allow from 203.0.113.0/24 to any port 22</pre>
                </div>
                <ul>
                    <li>Apply to administrative services (SSH, database management)</li>
                    <li>Use VPN if accessing from dynamic IPs</li>
                    <li>Consider fail2ban for dynamic blacklisting</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>7. Loopback Interface</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Always allow local communication</p>
                <div class="code-block">
                    <pre># Allow all loopback traffic
iptables -A INPUT -i lo -j ACCEPT
iptables -A OUTPUT -o lo -j ACCEPT

# UFW automatically allows loopback</pre>
                </div>
                <ul>
                    <li>Essential for local services to communicate</li>
                    <li>Required for many applications to function</li>
                    <li>Should be one of your first rules</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>8. Persistence and Backups</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Make your rules survive reboots and maintain backups</p>
                <div class="code-block">
                    <pre># Save iptables rules
sudo iptables-save > /etc/iptables/rules.v4
sudo ip6tables-save > /etc/iptables/rules.v6

# Install iptables-persistent (Debian/Ubuntu)
sudo apt install iptables-persistent

# Or use netfilter-persistent
sudo netfilter-persistent save

# UFW persists automatically when enabled

# Backup your rules
sudo cp /etc/iptables/rules.v4 /root/iptables-backup-$(date +%Y%m%d).v4</pre>
                </div>
            </div>

            <div class="info-box">
                <h4>9. Regular Auditing</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Periodically review your firewall configuration</p>
                <div class="code-block">
                    <pre># List all rules
sudo iptables -L -n -v --line-numbers
sudo ufw status numbered

# Check for open ports
sudo netstat -tulpn
sudo ss -tulpn

# Review logs
sudo grep -i iptables /var/log/syslog
sudo journalctl -u ufw</pre>
                </div>
                <ul>
                    <li>Remove obsolete rules</li>
                    <li>Verify rules are still necessary</li>
                    <li>Check for conflicts or overlaps</li>
                    <li>Test firewall effectiveness with external scans</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>10. Testing Before Production</h4>
                <p style="color: #fca5a5; margin-bottom: 15px;">Always test firewall changes to avoid lockouts</p>
                <ul>
                    <li>Have console/KVM access before making changes</li>
                    <li>Use a testing environment first</li>
                    <li>Add rules one at a time and verify connectivity</li>
                    <li>Keep a second SSH session open when modifying SSH rules</li>
                    <li>Set up a cron job to reset firewall if you get locked out</li>
                </ul>
                <div class="code-block">
                    <pre># Emergency reset cron job (removes itself after 5 minutes)
at now + 5 minutes <<< "iptables -F; iptables -X; iptables -P INPUT ACCEPT"</pre>
                </div>
            </div>
        </div>

        <!-- Quiz Tab -->
        <div id="quiz" class="tab-content">
            <h2 style="color: #ef4444; margin-bottom: 20px;">Firewall Security Quiz</h2>
            <p style="color: #fca5a5; margin-bottom: 30px;">Test your knowledge of Linux firewall concepts and best practices</p>

            <div class="quiz-question">
                <h4>Question 1: Which chain handles packets coming INTO your server?</h4>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(1, 'a', 'INPUT')">A) INPUT</div>
                    <div class="quiz-option" onclick="checkAnswer(1, 'b', 'INPUT')">B) OUTPUT</div>
                    <div class="quiz-option" onclick="checkAnswer(1, 'c', 'INPUT')">C) FORWARD</div>
                    <div class="quiz-option" onclick="checkAnswer(1, 'd', 'INPUT')">D) PREROUTING</div>
                </div>
                <div class="quiz-feedback" id="feedback1"></div>
            </div>

            <div class="quiz-question">
                <h4>Question 2: What is the most secure default policy?</h4>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(2, 'a', 'DROP')">A) ACCEPT all, then block specific</div>
                    <div class="quiz-option" onclick="checkAnswer(2, 'b', 'DROP')">B) DROP all, then allow specific</div>
                    <div class="quiz-option" onclick="checkAnswer(2, 'c', 'DROP')">C) LOG all traffic</div>
                    <div class="quiz-option" onclick="checkAnswer(2, 'd', 'DROP')">D) No default policy</div>
                </div>
                <div class="quiz-feedback" id="feedback2"></div>
            </div>

            <div class="quiz-question">
                <h4>Question 3: What does DROP do differently than REJECT?</h4>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(3, 'a', 'silent')">A) DROP silently discards packets, REJECT sends a response</div>
                    <div class="quiz-option" onclick="checkAnswer(3, 'b', 'silent')">B) DROP is faster than REJECT</div>
                    <div class="quiz-option" onclick="checkAnswer(3, 'c', 'silent')">C) DROP logs packets, REJECT doesn't</div>
                    <div class="quiz-option" onclick="checkAnswer(3, 'd', 'silent')">D) There is no difference</div>
                </div>
                <div class="quiz-feedback" id="feedback3"></div>
            </div>

            <div class="quiz-question">
                <h4>Question 4: Which command enables UFW?</h4>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(4, 'a', 'enable')">A) sudo ufw enable</div>
                    <div class="quiz-option" onclick="checkAnswer(4, 'b', 'enable')">B) sudo ufw start</div>
                    <div class="quiz-option" onclick="checkAnswer(4, 'c', 'enable')">C) sudo systemctl start ufw</div>
                    <div class="quiz-option" onclick="checkAnswer(4, 'd', 'enable')">D) sudo firewall-cmd --enable</div>
                </div>
                <div class="quiz-feedback" id="feedback4"></div>
            </div>

            <div class="quiz-question">
                <h4>Question 5: What is rate limiting used for?</h4>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(5, 'a', 'brute')">A) Preventing brute force attacks</div>
                    <div class="quiz-option" onclick="checkAnswer(5, 'b', 'brute')">B) Limiting bandwidth usage</div>
                    <div class="quiz-option" onclick="checkAnswer(5, 'c', 'brute')">C) Blocking specific IPs</div>
                    <div class="quiz-option" onclick="checkAnswer(5, 'd', 'brute')">D) Logging traffic</div>
                </div>
                <div class="quiz-feedback" id="feedback5"></div>
            </div>

            <div class="quiz-question">
                <h4>Question 6: You want to allow SSH only from your office network (192.168.1.0/24). Which UFW command is correct?</h4>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(6, 'a', 'from')">A) sudo ufw allow from 192.168.1.0/24 to any port 22</div>
                    <div class="quiz-option" onclick="checkAnswer(6, 'b', 'from')">B) sudo ufw allow 22 from 192.168.1.0/24</div>
                    <div class="quiz-option" onclick="checkAnswer(6, 'c', 'from')">C) sudo ufw allow ssh --from 192.168.1.0/24</div>
                    <div class="quiz-option" onclick="checkAnswer(6, 'd', 'from')">D) sudo ufw limit 192.168.1.0/24 port 22</div>
                </div>
                <div class="quiz-feedback" id="feedback6"></div>
            </div>

            <div class="quiz-question">
                <h4>Question 7: What does CIDR notation /24 mean?</h4>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(7, 'a', '24bits')">A) First 24 bits are network address (256 addresses)</div>
                    <div class="quiz-option" onclick="checkAnswer(7, 'b', '24bits')">B) 24 IP addresses in the range</div>
                    <div class="quiz-option" onclick="checkAnswer(7, 'c', '24bits')">C) Port number 24</div>
                    <div class="quiz-option" onclick="checkAnswer(7, 'd', '24bits')">D) 24 hours of access</div>
                </div>
                <div class="quiz-feedback" id="feedback7"></div>
            </div>

            <div class="quiz-question">
                <h4>Question 8: Which protocol does ping use?</h4>
                <div class="quiz-options">
                    <div class="quiz-option" onclick="checkAnswer(8, 'a', 'ICMP')">A) ICMP</div>
                    <div class="quiz-option" onclick="checkAnswer(8, 'b', 'ICMP')">B) TCP</div>
                    <div class="quiz-option" onclick="checkAnswer(8, 'c', 'ICMP')">C) UDP</div>
                    <div class="quiz-option" onclick="checkAnswer(8, 'd', 'ICMP')">D) HTTP</div>
                </div>
                <div class="quiz-feedback" id="feedback8"></div>
            </div>

            <div class="button-group" style="margin-top: 30px;">
                <button onclick="resetQuiz()">Reset Quiz</button>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tabName) {
            // Hide all tab contents
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => button.classList.remove('active'));

            // Show selected tab
            document.getElementById(tabName).classList.add('active');

            // Highlight active button
            event.target.classList.add('active');
        }

        // Rule storage
        let rulesList = [];

        // Toggle port fields based on protocol
        function togglePortFields() {
            const protocol = document.getElementById('protocol').value;
            const portFields = document.getElementById('portFields');

            if (protocol === 'icmp') {
                portFields.style.opacity = '0.5';
                portFields.style.pointerEvents = 'none';
            } else {
                portFields.style.opacity = '1';
                portFields.style.pointerEvents = 'auto';
            }
        }

        // Generate firewall rule
        function generateRule() {
            const chain = document.getElementById('chain').value;
            const protocol = document.getElementById('protocol').value;
            const action = document.getElementById('action').value;
            const sourceIP = document.getElementById('sourceIP').value || '0.0.0.0/0';
            const destIP = document.getElementById('destIP').value || '0.0.0.0/0';
            const sourcePort = document.getElementById('sourcePort').value;
            const destPort = document.getElementById('destPort').value;

            // Generate iptables command
            let iptablesCmd = `iptables -A ${chain}`;

            if (protocol !== 'all') {
                iptablesCmd += ` -p ${protocol}`;
            }

            if (sourceIP && sourceIP !== '0.0.0.0/0') {
                iptablesCmd += ` -s ${sourceIP}`;
            }

            if (destIP && destIP !== '0.0.0.0/0') {
                iptablesCmd += ` -d ${destIP}`;
            }

            if (protocol !== 'icmp' && protocol !== 'all') {
                if (sourcePort) {
                    iptablesCmd += ` --sport ${sourcePort}`;
                }
                if (destPort) {
                    iptablesCmd += ` --dport ${destPort}`;
                }
            }

            iptablesCmd += ` -j ${action}`;

            // Generate UFW command
            let ufwCmd = generateUFWCommand(action, protocol, sourceIP, destIP, sourcePort, destPort);

            // Generate firewalld command
            let firewalldCmd = generateFirewalldCommand(action, protocol, sourceIP, destIP, destPort, chain);

            // Display commands
            document.getElementById('iptablesOutput').textContent = iptablesCmd;
            document.getElementById('ufwOutput').textContent = ufwCmd;
            document.getElementById('firewalldOutput').textContent = firewalldCmd;
        }

        // Generate UFW command
        function generateUFWCommand(action, protocol, sourceIP, destIP, sourcePort, destPort) {
            let ufwAction = action.toLowerCase();
            if (action === 'LOG') {
                return '# UFW does not have a direct LOG action\n# Use iptables or enable UFW logging: sudo ufw logging on';
            }
            if (action === 'REJECT') {
                ufwAction = 'deny'; // UFW uses deny instead of reject
            }

            let cmd = `sudo ufw ${ufwAction}`;

            if (sourceIP && sourceIP !== '0.0.0.0/0') {
                cmd += ` from ${sourceIP}`;
            }

            if (destPort && protocol !== 'icmp' && protocol !== 'all') {
                cmd += ` to any port ${destPort}`;
                if (protocol !== 'all') {
                    cmd += ` proto ${protocol}`;
                }
            } else if (protocol === 'icmp') {
                cmd += ` proto icmp`;
            }

            return cmd;
        }

        // Generate firewalld command
        function generateFirewalldCommand(action, protocol, sourceIP, destIP, destPort, chain) {
            let cmd = '';

            if (action === 'ACCEPT') {
                if (destPort && protocol !== 'icmp' && protocol !== 'all') {
                    cmd = `# Add port to allowed services\n`;
                    cmd += `sudo firewall-cmd --permanent --add-port=${destPort}/${protocol}\n`;
                    cmd += `sudo firewall-cmd --reload`;
                } else if (protocol === 'icmp') {
                    cmd = `sudo firewall-cmd --permanent --add-icmp-block-inversion\n`;
                    cmd += `sudo firewall-cmd --reload`;
                } else {
                    cmd = `# Use rich rules for complex scenarios\n`;
                    cmd += `sudo firewall-cmd --permanent --add-rich-rule='rule family="ipv4"`;
                    if (sourceIP && sourceIP !== '0.0.0.0/0') {
                        cmd += ` source address="${sourceIP}"`;
                    }
                    cmd += ` accept'`;
                }
            } else if (action === 'DROP' || action === 'REJECT') {
                cmd = `# Block with rich rule\n`;
                cmd += `sudo firewall-cmd --permanent --add-rich-rule='rule family="ipv4"`;
                if (sourceIP && sourceIP !== '0.0.0.0/0') {
                    cmd += ` source address="${sourceIP}"`;
                }
                if (destPort && protocol !== 'icmp') {
                    cmd += ` port port="${destPort}" protocol="${protocol}"`;
                }
                cmd += ` ${action === 'DROP' ? 'drop' : 'reject'}'`;
            } else {
                cmd = `# firewalld uses different logging mechanisms\n# Enable logging in the zone configuration`;
            }

            return cmd;
        }

        // Add rule to list
        function addToRulesList() {
            const chain = document.getElementById('chain').value;
            const protocol = document.getElementById('protocol').value;
            const action = document.getElementById('action').value;
            const sourceIP = document.getElementById('sourceIP').value || '0.0.0.0/0';
            const destIP = document.getElementById('destIP').value || '0.0.0.0/0';
            const sourcePort = document.getElementById('sourcePort').value || 'any';
            const destPort = document.getElementById('destPort').value || 'any';

            const rule = {
                chain,
                protocol,
                action,
                sourceIP,
                destIP,
                sourcePort,
                destPort,
                iptables: document.getElementById('iptablesOutput').textContent,
                ufw: document.getElementById('ufwOutput').textContent
            };

            rulesList.push(rule);
            displayRulesList();
        }

        // Display rules list
        function displayRulesList() {
            const container = document.getElementById('rulesContainer');

            if (rulesList.length === 0) {
                container.innerHTML = '<div class="no-rules">No rules added yet. Create and add rules above.</div>';
                return;
            }

            let html = '';
            rulesList.forEach((rule, index) => {
                const actionClass = rule.action.toLowerCase();
                html += `
                    <div class="rule-item ${actionClass}">
                        <div class="rule-details">
                            <strong style="color: #ef4444;">${rule.chain}</strong> |
                            ${rule.protocol.toUpperCase()} |
                            ${rule.sourceIP} ${rule.sourcePort !== 'any' ? ':' + rule.sourcePort : ''} ‚Üí
                            ${rule.destIP} ${rule.destPort !== 'any' ? ':' + rule.destPort : ''}
                            <div style="font-size: 0.85em; margin-top: 5px; font-family: monospace;">
                                ${rule.iptables}
                            </div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <span class="rule-action ${actionClass}">${rule.action}</span>
                            <button class="delete-rule" onclick="deleteRule(${index})">Delete</button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Delete rule
        function deleteRule(index) {
            rulesList.splice(index, 1);
            displayRulesList();
        }

        // Clear all rules
        function clearAllRules() {
            if (confirm('Are you sure you want to clear all rules?')) {
                rulesList = [];
                displayRulesList();
            }
        }

        // Export all rules
        function exportAllRules(format) {
            if (rulesList.length === 0) {
                alert('No rules to export');
                return;
            }

            let output = '';
            if (format === 'iptables') {
                output = '#!/bin/bash\n# Generated by House of Shield Firewall Builder\n\n';
                rulesList.forEach(rule => {
                    output += rule.iptables + '\n';
                });
            } else if (format === 'ufw') {
                output = '#!/bin/bash\n# Generated by House of Shield Firewall Builder\n\n';
                rulesList.forEach(rule => {
                    output += rule.ufw + '\n';
                });
            }

            // Create download
            const blob = new Blob([output], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `firewall-rules-${format}.sh`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Clear form
        function clearForm() {
            document.getElementById('chain').value = 'INPUT';
            document.getElementById('protocol').value = 'tcp';
            document.getElementById('action').value = 'ACCEPT';
            document.getElementById('sourceIP').value = '0.0.0.0/0';
            document.getElementById('destIP').value = '0.0.0.0/0';
            document.getElementById('sourcePort').value = '';
            document.getElementById('destPort').value = '';
            document.getElementById('iptablesOutput').textContent = '# Configure your rule above and click "Generate Rule"';
            document.getElementById('ufwOutput').textContent = '# UFW syntax will appear here';
            document.getElementById('firewalldOutput').textContent = '# firewalld syntax will appear here';
            togglePortFields();
        }

        // Load template
        function loadTemplate(template) {
            // Switch to builder tab
            document.getElementById('builder').classList.add('active');
            document.getElementById('templates').classList.remove('active');
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-button')[0].classList.add('active');

            // Clear form first
            clearForm();

            // Load template values
            switch(template) {
                case 'ssh':
                    document.getElementById('chain').value = 'INPUT';
                    document.getElementById('protocol').value = 'tcp';
                    document.getElementById('destPort').value = '22';
                    document.getElementById('action').value = 'ACCEPT';
                    break;
                case 'http-https':
                    document.getElementById('chain').value = 'INPUT';
                    document.getElementById('protocol').value = 'tcp';
                    document.getElementById('destPort').value = '80,443';
                    document.getElementById('action').value = 'ACCEPT';
                    break;
                case 'ping':
                    document.getElementById('chain').value = 'INPUT';
                    document.getElementById('protocol').value = 'icmp';
                    document.getElementById('action').value = 'ACCEPT';
                    break;
                case 'dns':
                    document.getElementById('chain').value = 'OUTPUT';
                    document.getElementById('protocol').value = 'udp';
                    document.getElementById('destPort').value = '53';
                    document.getElementById('action').value = 'ACCEPT';
                    break;
                case 'established':
                    document.getElementById('chain').value = 'INPUT';
                    document.getElementById('protocol').value = 'all';
                    document.getElementById('action').value = 'ACCEPT';
                    alert('Note: This template requires connection tracking. Use:\niptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT');
                    break;
                case 'block-ip':
                    document.getElementById('chain').value = 'INPUT';
                    document.getElementById('protocol').value = 'all';
                    document.getElementById('sourceIP').value = '192.168.1.100';
                    document.getElementById('action').value = 'DROP';
                    break;
                case 'log-ssh':
                    document.getElementById('chain').value = 'INPUT';
                    document.getElementById('protocol').value = 'tcp';
                    document.getElementById('destPort').value = '22';
                    document.getElementById('action').value = 'LOG';
                    break;
                case 'mysql':
                    document.getElementById('chain').value = 'INPUT';
                    document.getElementById('protocol').value = 'tcp';
                    document.getElementById('sourceIP').value = '192.168.1.0/24';
                    document.getElementById('destPort').value = '3306';
                    document.getElementById('action').value = 'ACCEPT';
                    break;
            }

            togglePortFields();
            generateRule();
        }

        // Copy to clipboard
        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            });
        }

        // Quiz functionality
        const quizAnswers = {
            1: { correct: 'a', explanation: 'INPUT chain handles packets coming INTO your server from the network.' },
            2: { correct: 'b', explanation: 'DROP all by default, then explicitly allow specific traffic is the most secure approach (default deny policy).' },
            3: { correct: 'a', explanation: 'DROP silently discards packets without response, while REJECT sends back an error message to the sender.' },
            4: { correct: 'a', explanation: 'The command "sudo ufw enable" activates UFW firewall.' },
            5: { correct: 'a', explanation: 'Rate limiting is primarily used to prevent brute force attacks by limiting connection attempts per time period.' },
            6: { correct: 'a', explanation: 'The correct syntax is "sudo ufw allow from 192.168.1.0/24 to any port 22"' },
            7: { correct: 'a', explanation: '/24 means the first 24 bits are the network address, leaving 8 bits for hosts (256 addresses: .0 to .255)' },
            8: { correct: 'a', explanation: 'Ping uses ICMP (Internet Control Message Protocol), not TCP or UDP.' }
        };

        function checkAnswer(questionNum, selected, correctKey) {
            const feedback = document.getElementById(`feedback${questionNum}`);
            const options = event.target.parentElement.querySelectorAll('.quiz-option');

            // Remove previous styling
            options.forEach(opt => {
                opt.classList.remove('correct', 'incorrect');
            });

            const isCorrect = selected === quizAnswers[questionNum].correct;

            if (isCorrect) {
                event.target.classList.add('correct');
                feedback.className = 'quiz-feedback show correct';
                feedback.textContent = '‚úì Correct! ' + quizAnswers[questionNum].explanation;
            } else {
                event.target.classList.add('incorrect');
                feedback.className = 'quiz-feedback show incorrect';
                feedback.textContent = '‚úó Incorrect. ' + quizAnswers[questionNum].explanation;
            }
        }

        function resetQuiz() {
            for (let i = 1; i <= 8; i++) {
                const feedback = document.getElementById(`feedback${i}`);
                feedback.className = 'quiz-feedback';
                feedback.textContent = '';
            }

            document.querySelectorAll('.quiz-option').forEach(opt => {
                opt.classList.remove('correct', 'incorrect');
            });
        }

        // Initialize
        togglePortFields();
    </script>
</body>
</html>